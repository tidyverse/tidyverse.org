<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>dplyr-1-1-0 | Tidyverse</title><link>https://www.tidyverse.org/tags/dplyr-1-1-0/</link><atom:link href="https://www.tidyverse.org/tags/dplyr-1-1-0/index.xml" rel="self" type="application/rss+xml"/><description>dplyr-1-1-0</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Wed, 22 Mar 2023 00:00:00 +0000</lastBuildDate><item><title>dplyr 1.1.1</title><link>https://www.tidyverse.org/blog/2023/03/dplyr-1-1-1/</link><pubDate>Wed, 22 Mar 2023 00:00:00 +0000</pubDate><guid>https://www.tidyverse.org/blog/2023/03/dplyr-1-1-1/</guid><description>&lt;p>We&amp;rsquo;re stoked to announce the release of
&lt;a href="https://dplyr.tidyverse.org/" target="_blank" rel="noopener">dplyr 1.1.1&lt;/a>. We don&amp;rsquo;t typically blog about patch releases, because they generally only fix bugs without significantly changing behavior, but this one includes two important updates:&lt;/p>
&lt;ul>
&lt;li>Addressing various performance regressions&lt;/li>
&lt;li>Refining the &lt;code>multiple&lt;/code> match warning thrown by dplyr&amp;rsquo;s joins&lt;/li>
&lt;/ul>
&lt;p>You can see a full list of changes in the
&lt;a href="https://dplyr.tidyverse.org/news/index.html" target="_blank" rel="noopener">release notes&lt;/a>. To see the other blog posts in the dplyr 1.1.0 series, head
&lt;a href="https://www.tidyverse.org/tags/dplyr-1-1-0/" target="_blank" rel="noopener">here&lt;/a>.&lt;/p>
&lt;p>You can install dplyr 1.1.1 from CRAN with:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>&lt;a href='https://rdrr.io/r/utils/install.packages.html'>install.packages&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"dplyr"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='kr'>&lt;a href='https://rdrr.io/r/base/library.html'>library&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>&lt;a href='https://dplyr.tidyverse.org'>dplyr&lt;/a>&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;h2 id="performance-regressions">Performance regressions
&lt;a href="#performance-regressions">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>In the
&lt;a href="https://www.tidyverse.org/blog/2023/02/dplyr-1-1-0-vctrs">1.1.0 post on vctrs&lt;/a>, we discussed that we&amp;rsquo;ve rewritten all of dplyr&amp;rsquo;s vector functions on top of
&lt;a href="https://vctrs.r-lib.org/" target="_blank" rel="noopener">vctrs&lt;/a> for improved versatility. Unfortunately, we accidentally made two sets of functions much slower, especially when used on a data frame with many groups:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>
&lt;a href="https://dplyr.tidyverse.org/reference/case_when.html" target="_blank" rel="noopener">&lt;code>case_when()&lt;/code>&lt;/a> and
&lt;a href="https://dplyr.tidyverse.org/reference/if_else.html" target="_blank" rel="noopener">&lt;code>if_else()&lt;/code>&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>
&lt;a href="https://dplyr.tidyverse.org/reference/nth.html" target="_blank" rel="noopener">&lt;code>nth()&lt;/code>&lt;/a>,
&lt;a href="https://dplyr.tidyverse.org/reference/nth.html" target="_blank" rel="noopener">&lt;code>first()&lt;/code>&lt;/a>, and
&lt;a href="https://dplyr.tidyverse.org/reference/nth.html" target="_blank" rel="noopener">&lt;code>last()&lt;/code>&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>These performance issues have been addressed, and should be back to 1.0.10 level of performance.
&lt;a href="https://dplyr.tidyverse.org/reference/case_when.html" target="_blank" rel="noopener">&lt;code>case_when()&lt;/code>&lt;/a> is still &lt;em>slightly&lt;/em> slower than 1.0.10, but it isn&amp;rsquo;t likely to be very noticeable, and we already have plans to improve this further in a future release.&lt;/p>
&lt;h2 id="revisiting-multiple-matches">Revisiting multiple matches
&lt;a href="#revisiting-multiple-matches">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>In the
&lt;a href="https://www.tidyverse.org/blog/2023/01/dplyr-1-1-0-joins">1.1.0 post on joins&lt;/a>, we discussed the new &lt;code>multiple&lt;/code> argument that was added to
&lt;a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" target="_blank" rel="noopener">&lt;code>left_join()&lt;/code>&lt;/a> and friends, which had a built in safety check that warned when you performed a join where a row from &lt;code>x&lt;/code> matched more than one row from &lt;code>y&lt;/code>. The TLDR of the discussion below is that we&amp;rsquo;ve realized that this warning was being thrown in too many cases, so we&amp;rsquo;ve adjusted it in such a way that it now only catches the most dangerous type of join (a many-to-many join), meaning that you should see the warning &lt;em>much&lt;/em> less often.&lt;/p>
&lt;p>As a reminder, &lt;code>multiple&lt;/code> determines what happens when a row from &lt;code>x&lt;/code> matches more than one row from &lt;code>y&lt;/code>. You can choose to return &lt;code>&amp;quot;all&amp;quot;&lt;/code> of the matches, the &lt;code>&amp;quot;first&amp;quot;&lt;/code> or &lt;code>&amp;quot;last&amp;quot;&lt;/code> match, or &lt;code>&amp;quot;any&amp;quot;&lt;/code> of the matches if you are just interested in detecting if there is at least one. &lt;code>multiple&lt;/code> defaulted to a behavior similar to &lt;code>&amp;quot;all&amp;quot;&lt;/code>, with the added side effect of throwing a warning if multiple matches were actually detected, like this:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>student&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> student_id &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>1&lt;/span>, &lt;span class='m'>2&lt;/span>, &lt;span class='m'>3&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> transfer &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='kc'>FALSE&lt;/span>, &lt;span class='kc'>TRUE&lt;/span>, &lt;span class='kc'>TRUE&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> initial_term &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"fall 2018"&lt;/span>, &lt;span class='s'>"fall 2020"&lt;/span>, &lt;span class='s'>"fall 2020"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>term&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> student_id &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>1&lt;/span>, &lt;span class='m'>1&lt;/span>, &lt;span class='m'>2&lt;/span>, &lt;span class='m'>3&lt;/span>, &lt;span class='m'>3&lt;/span>, &lt;span class='m'>3&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> term &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"fall 2018"&lt;/span>, &lt;span class='s'>"spring 2019"&lt;/span>, &lt;span class='s'>"fall 2020"&lt;/span>, &lt;span class='s'>"fall 2020"&lt;/span>, &lt;span class='s'>"spring 2021"&lt;/span>, &lt;span class='s'>"fall 2021"&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> course_load &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>12&lt;/span>, &lt;span class='m'>15&lt;/span>, &lt;span class='m'>10&lt;/span>, &lt;span class='m'>14&lt;/span>, &lt;span class='m'>15&lt;/span>, &lt;span class='m'>12&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='c'># Information about students attending a university.&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'># One row per (student_id).&lt;/span>&lt;/span>
&lt;span>&lt;span class='nv'>student&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 3 × 3&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; student_id transfer initial_term&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;lgl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 1 FALSE fall 2018 &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 2 TRUE fall 2020 &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> 3 TRUE fall 2020&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;span>&lt;/span>
&lt;span>&lt;span class='c'># Term specific information about each student.&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'># One row per (student_id, term) combination.&lt;/span>&lt;/span>
&lt;span>&lt;span class='nv'>term&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 6 × 3&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; student_id term course_load&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 1 fall 2018 12&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 1 spring 2019 15&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> 2 fall 2020 10&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> 3 fall 2020 14&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>5&lt;/span> 3 spring 2021 15&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>6&lt;/span> 3 fall 2021 12&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>student&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>term&lt;/span>, &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/join_by.html'>join_by&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>student_id&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; Warning in left_join(student, term, join_by(student_id)): Each row in `x` is expected to match at most 1 row in `y`.&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; i Row 1 of `x` matches multiple rows.&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; i If multiple matches are expected, set `multiple = "all"` to silence this warning.&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; # A tibble: 6 × 5&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; student_id transfer initial_term term course_load&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;lgl&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; 1 1 FALSE fall 2018 fall 2018 12&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; 2 1 FALSE fall 2018 spring 2019 15&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; 3 2 TRUE fall 2020 fall 2020 10&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; 4 3 TRUE fall 2020 fall 2020 14&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; 5 3 TRUE fall 2020 spring 2021 15&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; 6 3 TRUE fall 2020 fall 2021 12&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>To silence this warning, we encouraged you to set &lt;code>multiple = &amp;quot;all&amp;quot;&lt;/code> to be explicit about the fact that you expected a row from &lt;code>x&lt;/code> to match multiple rows in &lt;code>y&lt;/code>.&lt;/p>
&lt;p>The original motivation for this behavior comes from a two-part hypothesis of ours:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Users are often surprised when a join returns more rows than the left-hand table started with (in the above example, &lt;code>student&lt;/code> has 3 rows but the join result has 6).&lt;/p>
&lt;/li>
&lt;li>
&lt;p>It is dangerous to allow joins that can result in a Cartesian explosion of the number of rows (i.e. &lt;code>nrow(x) * nrow(y)&lt;/code>).&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>This hypothesis led us to automatically warn on two types of join relationships, one-to-many joins and many-to-many joins. If you aren&amp;rsquo;t familiar with these terms, here is a quick rundown of the 4 types of join relationships (often discussed in a SQL context), which provide constraints on the number of allowed matches:&lt;/p>
&lt;ul>
&lt;li>one-to-one:
&lt;ul>
&lt;li>A row from &lt;code>x&lt;/code> can match at most 1 row from &lt;code>y&lt;/code>.&lt;/li>
&lt;li>A row from &lt;code>y&lt;/code> can match at most 1 row from &lt;code>x&lt;/code>.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>one-to-many:
&lt;ul>
&lt;li>A row from &lt;code>x&lt;/code> can match any number of rows in &lt;code>y&lt;/code>.&lt;/li>
&lt;li>A row from &lt;code>y&lt;/code> can match at most 1 row from &lt;code>x&lt;/code>.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>many-to-one:
&lt;ul>
&lt;li>A row from &lt;code>x&lt;/code> can match at most 1 row from &lt;code>y&lt;/code>.&lt;/li>
&lt;li>A row from &lt;code>y&lt;/code> can match any number of rows in &lt;code>x&lt;/code>.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>many-to-many:
&lt;ul>
&lt;li>A row from &lt;code>x&lt;/code> can match any number of rows in &lt;code>y&lt;/code>.&lt;/li>
&lt;li>A row from &lt;code>y&lt;/code> can match any number of rows in &lt;code>x&lt;/code>.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>After gathering some valuable
&lt;a href="https://github.com/tidyverse/dplyr/issues/6717" target="_blank" rel="noopener">user feedback&lt;/a> and conducting an
&lt;a href="https://github.com/tidyverse/dplyr/issues/6731" target="_blank" rel="noopener">in depth analysis&lt;/a> of these join relationships, we&amp;rsquo;ve determined that the only relationship style actually worth warning on is many-to-many, because that is the one that can result in a Cartesian explosion of rows. In retrospect, the one-to-many relationship is actually quite common, and is symmetrical with many-to-one, which we weren&amp;rsquo;t warning on. You could actually exploit this fact by switching the above join around, which would silence the warning:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>term&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>student&lt;/span>, &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/join_by.html'>join_by&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>student_id&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 6 × 5&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; student_id term course_load transfer initial_term&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;lgl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 1 fall 2018 12 FALSE fall 2018 &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 1 spring 2019 15 FALSE fall 2018 &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> 2 fall 2020 10 TRUE fall 2020 &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> 3 fall 2020 14 TRUE fall 2020 &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>5&lt;/span> 3 spring 2021 15 TRUE fall 2020 &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>6&lt;/span> 3 fall 2021 12 TRUE fall 2020&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>We still believe that new users are often surprised when a join returns more rows than they originally started with, but the many-to-one case of this is rarely a problem in practice. So, as of dplyr 1.1.1, we no longer warn on one-to-many relationships, which should drastically reduce the amount of warnings that you see.&lt;/p>
&lt;h3 id="many-to-many-relationships">Many-to-many relationships
&lt;a href="#many-to-many-relationships">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h3>&lt;p>A many-to-many relationship is much harder to construct (which is good). In fact, a database system won&amp;rsquo;t even let you create one of these &amp;ldquo;relationships&amp;rdquo; between two tables directly, instead requiring you to create a third bridge table that turns the many-to-many relationship into two one-to-many relationships. We can &amp;ldquo;accidentally&amp;rdquo; create one of these in R though:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>course&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> student_id &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>1&lt;/span>, &lt;span class='m'>1&lt;/span>, &lt;span class='m'>1&lt;/span>, &lt;span class='m'>2&lt;/span>, &lt;span class='m'>2&lt;/span>, &lt;span class='m'>3&lt;/span>, &lt;span class='m'>3&lt;/span>, &lt;span class='m'>3&lt;/span>, &lt;span class='m'>3&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> instructor_id &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>1&lt;/span>, &lt;span class='m'>2&lt;/span>, &lt;span class='m'>3&lt;/span>, &lt;span class='m'>1&lt;/span>, &lt;span class='m'>2&lt;/span>, &lt;span class='m'>1&lt;/span>, &lt;span class='m'>2&lt;/span>, &lt;span class='m'>3&lt;/span>, &lt;span class='m'>4&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> course &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>101&lt;/span>, &lt;span class='m'>110&lt;/span>, &lt;span class='m'>123&lt;/span>, &lt;span class='m'>110&lt;/span>, &lt;span class='m'>101&lt;/span>, &lt;span class='m'>110&lt;/span>, &lt;span class='m'>115&lt;/span>, &lt;span class='m'>110&lt;/span>, &lt;span class='m'>101&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> term &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> &lt;span class='s'>"fall 2018"&lt;/span>, &lt;span class='s'>"fall 2018"&lt;/span>, &lt;span class='s'>"spring 2019"&lt;/span>, &lt;span class='s'>"fall 2020"&lt;/span>, &lt;span class='s'>"fall 2020"&lt;/span>, &lt;/span>
&lt;span> &lt;span class='s'>"fall 2020"&lt;/span>, &lt;span class='s'>"fall 2020"&lt;/span>, &lt;span class='s'>"spring 2021"&lt;/span>, &lt;span class='s'>"fall 2021"&lt;/span>&lt;/span>
&lt;span> &lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> grade &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"A"&lt;/span>, &lt;span class='s'>"B"&lt;/span>, &lt;span class='s'>"A"&lt;/span>, &lt;span class='s'>"B"&lt;/span>, &lt;span class='s'>"C"&lt;/span>, &lt;span class='s'>"A"&lt;/span>, &lt;span class='s'>"C"&lt;/span>, &lt;span class='s'>"D"&lt;/span>, &lt;span class='s'>"B"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='c'># Information about the courses each student took per semester.&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'># One row per (student_id, course, term) combination.&lt;/span>&lt;/span>
&lt;span>&lt;span class='nv'>course&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 9 × 5&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; student_id instructor_id course term grade&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 1 1 101 fall 2018 A &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 1 2 110 fall 2018 B &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> 1 3 123 spring 2019 A &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> 2 1 110 fall 2020 B &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>5&lt;/span> 2 2 101 fall 2020 C &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>6&lt;/span> 3 1 110 fall 2020 A &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>7&lt;/span> 3 2 115 fall 2020 C &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>8&lt;/span> 3 3 110 spring 2021 D &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>9&lt;/span> 3 4 101 fall 2021 B&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='c'># Forgetting to join by both `student_id` and `term`!&lt;/span>&lt;/span>
&lt;span>&lt;span class='nv'>term&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>course&lt;/span>, by &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/join_by.html'>join_by&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>student_id&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; Warning in left_join(term, course, by = join_by(student_id)): Detected an unexpected many-to-many relationship between `x` and `y`.&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #00BBBB;'>ℹ&lt;/span> Row 1 of `x` matches multiple rows in `y`.&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #00BBBB;'>ℹ&lt;/span> Row 1 of `y` matches multiple rows in `x`.&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #00BBBB;'>ℹ&lt;/span> If a many-to-many relationship is expected, set `relationship =&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; "many-to-many"` to silence this warning.&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 20 × 7&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; student_id term.x course_load instructor_id course term.y grade&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 1&lt;/span> 1 fall 2018 12 1 101 fall 2018 A &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 2&lt;/span> 1 fall 2018 12 2 110 fall 2018 B &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 3&lt;/span> 1 fall 2018 12 3 123 spring 2019 A &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 4&lt;/span> 1 spring 2019 15 1 101 fall 2018 A &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 5&lt;/span> 1 spring 2019 15 2 110 fall 2018 B &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 6&lt;/span> 1 spring 2019 15 3 123 spring 2019 A &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 7&lt;/span> 2 fall 2020 10 1 110 fall 2020 B &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 8&lt;/span> 2 fall 2020 10 2 101 fall 2020 C &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 9&lt;/span> 3 fall 2020 14 1 110 fall 2020 A &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>10&lt;/span> 3 fall 2020 14 2 115 fall 2020 C &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>11&lt;/span> 3 fall 2020 14 3 110 spring 2021 D &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>12&lt;/span> 3 fall 2020 14 4 101 fall 2021 B &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>13&lt;/span> 3 spring 2021 15 1 110 fall 2020 A &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>14&lt;/span> 3 spring 2021 15 2 115 fall 2020 C &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>15&lt;/span> 3 spring 2021 15 3 110 spring 2021 D &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>16&lt;/span> 3 spring 2021 15 4 101 fall 2021 B &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>17&lt;/span> 3 fall 2021 12 1 110 fall 2020 A &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>18&lt;/span> 3 fall 2021 12 2 115 fall 2020 C &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>19&lt;/span> 3 fall 2021 12 3 110 spring 2021 D &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>20&lt;/span> 3 fall 2021 12 4 101 fall 2021 B&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>In the example above, we&amp;rsquo;ve forgotten to include the &lt;code>term&lt;/code> column when joining these two tables together, which accidentally results in a small explosion of rows (we end up with 20 rows, more than in either original input, but not quite the maximum possible amount, which is a whopping 54 rows!). Luckily, dplyr warns us that at least one row in each table matches more than one row in the opposite table - a sign that something isn&amp;rsquo;t right. At this point we can do one of two things:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Look into the new &lt;code>relationship&lt;/code> argument that the warning mentions (we&amp;rsquo;ll discuss this below)&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Look at our join to see if we made a mistake&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>Of course, in this case we&amp;rsquo;ve messed up, and adding &lt;code>term&lt;/code> into the by expression results in the correct (and silent) join:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>term&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>course&lt;/span>, by &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/join_by.html'>join_by&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>student_id&lt;/span>, &lt;span class='nv'>term&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 9 × 6&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; student_id term course_load instructor_id course grade&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 1 fall 2018 12 1 101 A &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 1 fall 2018 12 2 110 B &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> 1 spring 2019 15 3 123 A &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> 2 fall 2020 10 1 110 B &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>5&lt;/span> 2 fall 2020 10 2 101 C &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>6&lt;/span> 3 fall 2020 14 1 110 A &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>7&lt;/span> 3 fall 2020 14 2 115 C &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>8&lt;/span> 3 spring 2021 15 3 110 D &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>9&lt;/span> 3 fall 2021 12 4 101 B&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;h3 id="join-relationships">Join &lt;code>relationship&lt;/code>s
&lt;a href="#join-relationships">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h3>&lt;p>To adjust the joins to only warn on many-to-many relationships, we&amp;rsquo;ve done two things:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>multiple&lt;/code> now defaults to &lt;code>&amp;quot;all&amp;quot;&lt;/code>, and is now focused solely on limiting the matches returned if multiple are detected, rather than also optionally warning/erroring.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>We&amp;rsquo;ve added a new &lt;code>relationship&lt;/code> argument.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>The &lt;code>relationship&lt;/code> argument allows you to explicitly specify the expected join relationship between the keys of &lt;code>x&lt;/code> and &lt;code>y&lt;/code> using the exact options we listed above: &lt;code>&amp;quot;one-to-one&amp;quot;&lt;/code>, &lt;code>&amp;quot;one-to-many&amp;quot;&lt;/code>, &lt;code>&amp;quot;many-to-one&amp;quot;&lt;/code>, and &lt;code>&amp;quot;many-to-many&amp;quot;&lt;/code>. If the constraints of the relationship you choose are violated, an error is thrown. For example, we could use this to require that the &lt;code>student&lt;/code> + &lt;code>term&lt;/code> join contains a one-to-many relationship between the two tables:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>student&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>term&lt;/span>, &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/join_by.html'>join_by&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>student_id&lt;/span>&lt;span class='o'>)&lt;/span>, relationship &lt;span class='o'>=&lt;/span> &lt;span class='s'>"one-to-many"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 6 × 5&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; student_id transfer initial_term term course_load&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;lgl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 1 FALSE fall 2018 fall 2018 12&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 1 FALSE fall 2018 spring 2019 15&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> 2 TRUE fall 2020 fall 2020 10&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> 3 TRUE fall 2020 fall 2020 14&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>5&lt;/span> 3 TRUE fall 2020 spring 2021 15&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>6&lt;/span> 3 TRUE fall 2020 fall 2021 12&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>Let&amp;rsquo;s violate this by adding a duplicate row in &lt;code>student&lt;/code>:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>student_bad&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nv'>student&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>tibble&lt;/span>&lt;span class='nf'>::&lt;/span>&lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/add_row.html'>add_row&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> student_id &lt;span class='o'>=&lt;/span> &lt;span class='m'>1&lt;/span>, &lt;/span>
&lt;span> transfer &lt;span class='o'>=&lt;/span> &lt;span class='kc'>FALSE&lt;/span>, &lt;/span>
&lt;span> initial_term &lt;span class='o'>=&lt;/span> &lt;span class='s'>"fall 2019"&lt;/span>, &lt;/span>
&lt;span> .after &lt;span class='o'>=&lt;/span> &lt;span class='m'>1&lt;/span>&lt;/span>
&lt;span> &lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>student_bad&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 4 × 3&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; student_id transfer initial_term&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;lgl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 1 FALSE fall 2018 &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 1 FALSE fall 2019 &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> 2 TRUE fall 2020 &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> 3 TRUE fall 2020&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>student_bad&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>term&lt;/span>, &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/join_by.html'>join_by&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>student_id&lt;/span>&lt;span class='o'>)&lt;/span>, relationship &lt;span class='o'>=&lt;/span> &lt;span class='s'>"one-to-many"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #BBBB00; font-weight: bold;'>Error&lt;/span>&lt;span style='font-weight: bold;'> in `left_join()`:&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #BBBB00;'>!&lt;/span> Each row in `y` must match at most 1 row in `x`.&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #00BBBB;'>ℹ&lt;/span> Row 1 of `y` matches multiple rows in `x`.&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>The default value of &lt;code>relationship&lt;/code> doesn&amp;rsquo;t add any constraints, but for equality joins it will check to see if a many-to-many relationship exists, and will warn if one occurs (like with the &lt;code>term&lt;/code> + &lt;code>course&lt;/code> join from above). As mentioned before, this is quite hard to do, and often means you have a mistake in your join call or in the data itself. If you really do want to perform a join with this kind of relationship, to silence the warning you can explicitly specify &lt;code>relationship = &amp;quot;many-to-many&amp;quot;&lt;/code>.&lt;/p>
&lt;p>One last thing to note is that &lt;code>relationship&lt;/code> doesn&amp;rsquo;t handle the case of an &lt;em>unmatched&lt;/em> row. For that, you should use the &lt;code>unmatched&lt;/code> argument that was also added in 1.1.0. The combination of &lt;code>relationship&lt;/code> and &lt;code>unmatched&lt;/code> provides a complete set of tools for adding production level quality control checks to your joins.&lt;/p>
&lt;h2 id="acknowledgements">Acknowledgements
&lt;a href="#acknowledgements">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>The examples used in this blog post were adapted from
&lt;a href="https://github.com/eipi10" target="_blank" rel="noopener">@eipi10&lt;/a> in
&lt;a href="https://github.com/tidyverse/dplyr/issues/6717" target="_blank" rel="noopener">this issue&lt;/a>.&lt;/p>
&lt;p>We&amp;rsquo;d like to thank all 66 contributors who help in someway, whether it was filing issues or contributing code and documentation:
&lt;a href="https://github.com/alexhallam" target="_blank" rel="noopener">@alexhallam&lt;/a>,
&lt;a href="https://github.com/ammar-gla" target="_blank" rel="noopener">@ammar-gla&lt;/a>,
&lt;a href="https://github.com/arnaudgallou" target="_blank" rel="noopener">@arnaudgallou&lt;/a>,
&lt;a href="https://github.com/ArthurAndrews" target="_blank" rel="noopener">@ArthurAndrews&lt;/a>,
&lt;a href="https://github.com/AuburnEagle-578" target="_blank" rel="noopener">@AuburnEagle-578&lt;/a>,
&lt;a href="https://github.com/batpigandme" target="_blank" rel="noopener">@batpigandme&lt;/a>,
&lt;a href="https://github.com/billdenney" target="_blank" rel="noopener">@billdenney&lt;/a>,
&lt;a href="https://github.com/Bisaloo" target="_blank" rel="noopener">@Bisaloo&lt;/a>,
&lt;a href="https://github.com/bitplane" target="_blank" rel="noopener">@bitplane&lt;/a>,
&lt;a href="https://github.com/chrarnold" target="_blank" rel="noopener">@chrarnold&lt;/a>,
&lt;a href="https://github.com/D5n9sMatrix" target="_blank" rel="noopener">@D5n9sMatrix&lt;/a>,
&lt;a href="https://github.com/daattali" target="_blank" rel="noopener">@daattali&lt;/a>,
&lt;a href="https://github.com/DanChaltiel" target="_blank" rel="noopener">@DanChaltiel&lt;/a>,
&lt;a href="https://github.com/DavisVaughan" target="_blank" rel="noopener">@DavisVaughan&lt;/a>,
&lt;a href="https://github.com/dieghernan" target="_blank" rel="noopener">@dieghernan&lt;/a>,
&lt;a href="https://github.com/dkutner" target="_blank" rel="noopener">@dkutner&lt;/a>,
&lt;a href="https://github.com/eipi10" target="_blank" rel="noopener">@eipi10&lt;/a>,
&lt;a href="https://github.com/eitsupi" target="_blank" rel="noopener">@eitsupi&lt;/a>,
&lt;a href="https://github.com/emilBeBri" target="_blank" rel="noopener">@emilBeBri&lt;/a>,
&lt;a href="https://github.com/fawda123" target="_blank" rel="noopener">@fawda123&lt;/a>,
&lt;a href="https://github.com/fedassembly" target="_blank" rel="noopener">@fedassembly&lt;/a>,
&lt;a href="https://github.com/fkohrt" target="_blank" rel="noopener">@fkohrt&lt;/a>,
&lt;a href="https://github.com/gavinsimpson" target="_blank" rel="noopener">@gavinsimpson&lt;/a>,
&lt;a href="https://github.com/geogale" target="_blank" rel="noopener">@geogale&lt;/a>,
&lt;a href="https://github.com/ggrothendieck" target="_blank" rel="noopener">@ggrothendieck&lt;/a>,
&lt;a href="https://github.com/hadley" target="_blank" rel="noopener">@hadley&lt;/a>,
&lt;a href="https://github.com/hope-data-science" target="_blank" rel="noopener">@hope-data-science&lt;/a>,
&lt;a href="https://github.com/jaganmn" target="_blank" rel="noopener">@jaganmn&lt;/a>,
&lt;a href="https://github.com/jakub-jedrusiak" target="_blank" rel="noopener">@jakub-jedrusiak&lt;/a>,
&lt;a href="https://github.com/JorisChau" target="_blank" rel="noopener">@JorisChau&lt;/a>,
&lt;a href="https://github.com/krlmlr" target="_blank" rel="noopener">@krlmlr&lt;/a>,
&lt;a href="https://github.com/krprasangdas" target="_blank" rel="noopener">@krprasangdas&lt;/a>,
&lt;a href="https://github.com/larry77" target="_blank" rel="noopener">@larry77&lt;/a>,
&lt;a href="https://github.com/lionel-" target="_blank" rel="noopener">@lionel-&lt;/a>,
&lt;a href="https://github.com/lschneiderbauer" target="_blank" rel="noopener">@lschneiderbauer&lt;/a>,
&lt;a href="https://github.com/LukasWallrich" target="_blank" rel="noopener">@LukasWallrich&lt;/a>,
&lt;a href="https://github.com/maellecoursonnais" target="_blank" rel="noopener">@maellecoursonnais&lt;/a>,
&lt;a href="https://github.com/manhnguyen48" target="_blank" rel="noopener">@manhnguyen48&lt;/a>,
&lt;a href="https://github.com/mattansb" target="_blank" rel="noopener">@mattansb&lt;/a>,
&lt;a href="https://github.com/mgirlich" target="_blank" rel="noopener">@mgirlich&lt;/a>,
&lt;a href="https://github.com/mhaynam" target="_blank" rel="noopener">@mhaynam&lt;/a>,
&lt;a href="https://github.com/MichaelChirico" target="_blank" rel="noopener">@MichaelChirico&lt;/a>,
&lt;a href="https://github.com/mine-cetinkaya-rundel" target="_blank" rel="noopener">@mine-cetinkaya-rundel&lt;/a>,
&lt;a href="https://github.com/mkoohafkan" target="_blank" rel="noopener">@mkoohafkan&lt;/a>,
&lt;a href="https://github.com/moodymudskipper" target="_blank" rel="noopener">@moodymudskipper&lt;/a>,
&lt;a href="https://github.com/Moohan" target="_blank" rel="noopener">@Moohan&lt;/a>,
&lt;a href="https://github.com/msgoussi" target="_blank" rel="noopener">@msgoussi&lt;/a>,
&lt;a href="https://github.com/multimeric" target="_blank" rel="noopener">@multimeric&lt;/a>,
&lt;a href="https://github.com/osheen1" target="_blank" rel="noopener">@osheen1&lt;/a>,
&lt;a href="https://github.com/Pozdniakov" target="_blank" rel="noopener">@Pozdniakov&lt;/a>,
&lt;a href="https://github.com/psychelzh" target="_blank" rel="noopener">@psychelzh&lt;/a>,
&lt;a href="https://github.com/pur80a" target="_blank" rel="noopener">@pur80a&lt;/a>,
&lt;a href="https://github.com/robayo" target="_blank" rel="noopener">@robayo&lt;/a>,
&lt;a href="https://github.com/rszulkin" target="_blank" rel="noopener">@rszulkin&lt;/a>,
&lt;a href="https://github.com/salim-b" target="_blank" rel="noopener">@salim-b&lt;/a>,
&lt;a href="https://github.com/sda030" target="_blank" rel="noopener">@sda030&lt;/a>,
&lt;a href="https://github.com/sfirke" target="_blank" rel="noopener">@sfirke&lt;/a>,
&lt;a href="https://github.com/shannonpileggi" target="_blank" rel="noopener">@shannonpileggi&lt;/a>,
&lt;a href="https://github.com/stephLH" target="_blank" rel="noopener">@stephLH&lt;/a>,
&lt;a href="https://github.com/szabgab" target="_blank" rel="noopener">@szabgab&lt;/a>,
&lt;a href="https://github.com/tjebo" target="_blank" rel="noopener">@tjebo&lt;/a>,
&lt;a href="https://github.com/Torvaney" target="_blank" rel="noopener">@Torvaney&lt;/a>,
&lt;a href="https://github.com/twest820" target="_blank" rel="noopener">@twest820&lt;/a>,
&lt;a href="https://github.com/vanillajonathan" target="_blank" rel="noopener">@vanillajonathan&lt;/a>,
&lt;a href="https://github.com/warnes" target="_blank" rel="noopener">@warnes&lt;/a>, and
&lt;a href="https://github.com/zknitter" target="_blank" rel="noopener">@zknitter&lt;/a>.&lt;/p></description></item><item><title>dplyr 1.1.0: `pick()`, `reframe()`, and `arrange()`</title><link>https://www.tidyverse.org/blog/2023/02/dplyr-1-1-0-pick-reframe-arrange/</link><pubDate>Tue, 07 Feb 2023 00:00:00 +0000</pubDate><guid>https://www.tidyverse.org/blog/2023/02/dplyr-1-1-0-pick-reframe-arrange/</guid><description>&lt;p>In this final
&lt;a href="https://dplyr.tidyverse.org/news/index.html#dplyr-110" target="_blank" rel="noopener">dplyr 1.1.0&lt;/a> post, we&amp;rsquo;ll take a look at two new verbs,
&lt;a href="https://dplyr.tidyverse.org/reference/pick.html" target="_blank" rel="noopener">&lt;code>pick()&lt;/code>&lt;/a> and
&lt;a href="https://dplyr.tidyverse.org/reference/reframe.html" target="_blank" rel="noopener">&lt;code>reframe()&lt;/code>&lt;/a>, along with some changes to
&lt;a href="https://dplyr.tidyverse.org/reference/arrange.html" target="_blank" rel="noopener">&lt;code>arrange()&lt;/code>&lt;/a> that improve both reproducibility and performance. If you missed our previous posts, you should definitely go back and
&lt;a href="https://www.tidyverse.org/tags/dplyr-1-1-0/" target="_blank" rel="noopener">check them out&lt;/a>!&lt;/p>
&lt;p>You can install it from CRAN with:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>&lt;a href='https://rdrr.io/r/utils/install.packages.html'>install.packages&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"dplyr"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='kr'>&lt;a href='https://rdrr.io/r/base/library.html'>library&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>&lt;a href='https://dplyr.tidyverse.org'>dplyr&lt;/a>&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/Random.html'>set.seed&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>12345&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;h2 id="pick">&lt;code>pick()&lt;/code>
&lt;a href="#pick">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>One thing we noticed after dplyr 1.0.0 was released is that many people like to use
&lt;a href="https://dplyr.tidyverse.org/reference/across.html" target="_blank" rel="noopener">&lt;code>across()&lt;/code>&lt;/a> for its column selection features while working inside a data-masking function like
&lt;a href="https://dplyr.tidyverse.org/reference/mutate.html" target="_blank" rel="noopener">&lt;code>mutate()&lt;/code>&lt;/a> or
&lt;a href="https://dplyr.tidyverse.org/reference/summarise.html" target="_blank" rel="noopener">&lt;code>summarise()&lt;/code>&lt;/a>. This is typically useful if you have a function that takes data frames as inputs, or if you need to compute features about a specific subset of columns.&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>df&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> x_1 &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>1&lt;/span>, &lt;span class='m'>3&lt;/span>, &lt;span class='m'>2&lt;/span>, &lt;span class='m'>1&lt;/span>, &lt;span class='m'>2&lt;/span>&lt;span class='o'>)&lt;/span>, &lt;/span>
&lt;span> x_2 &lt;span class='o'>=&lt;/span> &lt;span class='m'>6&lt;/span>&lt;span class='o'>:&lt;/span>&lt;span class='m'>10&lt;/span>, &lt;/span>
&lt;span> w_4 &lt;span class='o'>=&lt;/span> &lt;span class='m'>11&lt;/span>&lt;span class='o'>:&lt;/span>&lt;span class='m'>15&lt;/span>, &lt;/span>
&lt;span> y_2 &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>5&lt;/span>, &lt;span class='m'>2&lt;/span>, &lt;span class='m'>4&lt;/span>, &lt;span class='m'>0&lt;/span>, &lt;span class='m'>6&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>df&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> n_x &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/nrow.html'>ncol&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/across.html'>across&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>&lt;a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"x"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> n_y &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/nrow.html'>ncol&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/across.html'>across&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>&lt;a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"y"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span> &lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 1 × 2&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; n_x n_y&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;int&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;int&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 2 1&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>
&lt;a href="https://dplyr.tidyverse.org/reference/across.html" target="_blank" rel="noopener">&lt;code>across()&lt;/code>&lt;/a> is intended to apply a function to each of these columns, rather than just select them, which is why its name doesn&amp;rsquo;t feel natural for this operation. In dplyr 1.1.0 we&amp;rsquo;ve introduced
&lt;a href="https://dplyr.tidyverse.org/reference/pick.html" target="_blank" rel="noopener">&lt;code>pick()&lt;/code>&lt;/a>, a specialized column selection variant with a more natural name:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>df&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> n_x &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/nrow.html'>ncol&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/pick.html'>pick&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>&lt;a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"x"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> n_y &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/nrow.html'>ncol&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/pick.html'>pick&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>&lt;a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"y"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span> &lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 1 × 2&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; n_x n_y&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;int&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;int&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 2 1&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>
&lt;a href="https://dplyr.tidyverse.org/reference/pick.html" target="_blank" rel="noopener">&lt;code>pick()&lt;/code>&lt;/a> is particularly useful in combination with ranking functions like
&lt;a href="https://dplyr.tidyverse.org/reference/row_number.html" target="_blank" rel="noopener">&lt;code>dense_rank()&lt;/code>&lt;/a>, which have been upgraded in 1.1.0 to take data frames as inputs, serving as a way to jointly rank by multiple columns at once.&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>df&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> rank1 &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/row_number.html'>dense_rank&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>x_1&lt;/span>&lt;span class='o'>)&lt;/span>, &lt;/span>
&lt;span> rank2 &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/row_number.html'>dense_rank&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/pick.html'>pick&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>x_1&lt;/span>, &lt;span class='nv'>y_2&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span> &lt;span class='c'># Using `y_2` to break ties in `x_1`&lt;/span>&lt;/span>
&lt;span> &lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 5 × 6&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; x_1 x_2 w_4 y_2 rank1 rank2&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;int&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;int&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;int&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;int&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 1 6 11 5 1 2&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 3 7 12 2 3 5&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> 2 8 13 4 2 3&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> 1 9 14 0 1 1&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>5&lt;/span> 2 10 15 6 2 4&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>We haven&amp;rsquo;t deprecated using
&lt;a href="https://dplyr.tidyverse.org/reference/across.html" target="_blank" rel="noopener">&lt;code>across()&lt;/code>&lt;/a> without supplying &lt;code>.fns&lt;/code> yet, but we plan to in the future now that
&lt;a href="https://dplyr.tidyverse.org/reference/pick.html" target="_blank" rel="noopener">&lt;code>pick()&lt;/code>&lt;/a> exists as a better alternative.&lt;/p>
&lt;h2 id="reframe">&lt;code>reframe()&lt;/code>
&lt;a href="#reframe">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>As we mentioned in the
&lt;a href="https://www.tidyverse.org/blog/2022/11/dplyr-1-1-0-is-coming-soon/" target="_blank" rel="noopener">coming soon&lt;/a> blog post, in dplyr 1.1.0 we&amp;rsquo;ve decided to walk back the change we introduced to
&lt;a href="https://dplyr.tidyverse.org/reference/summarise.html" target="_blank" rel="noopener">&lt;code>summarise()&lt;/code>&lt;/a> in dplyr 1.0.0 that allowed it to return per-group results of any length, rather than results of length 1. We think that the idea of multi-row results is extremely powerful, as it serves as a flexible way to apply arbitrary operations to each group, but we&amp;rsquo;ve realized that
&lt;a href="https://dplyr.tidyverse.org/reference/summarise.html" target="_blank" rel="noopener">&lt;code>summarise()&lt;/code>&lt;/a> wasn&amp;rsquo;t the best home for it because it increases the chance for users to run into silent recycling bugs (thanks to
&lt;a href="https://github.com/tidyverse/dplyr/issues/6382" target="_blank" rel="noopener">Kirill Müller&lt;/a> and
&lt;a href="https://twitter.com/drob/status/1563198515626770432?s=20&amp;amp;t=iTFWSCPNOGWalIrpXHx2qg" target="_blank" rel="noopener">David Robinson&lt;/a> for bringing this to our attention).&lt;/p>
&lt;p>As an example, here we&amp;rsquo;re computing the mean and standard deviation of &lt;code>x&lt;/code>, grouped by &lt;code>g&lt;/code>. Unfortunately, I accidentally forgot to use &lt;code>sd(x)&lt;/code> and instead just typed &lt;code>x&lt;/code>. Because of how
&lt;a href="https://vctrs.r-lib.org/reference/vector_recycling_rules.html" target="_blank" rel="noopener">tidyverse recycling rules&lt;/a> work, the multi-row behavior silently recycled the size 1 mean values instead of erroring, so rather than 2 rows, we end up with 5.&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>df&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> g &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>1&lt;/span>, &lt;span class='m'>1&lt;/span>, &lt;span class='m'>1&lt;/span>, &lt;span class='m'>2&lt;/span>, &lt;span class='m'>2&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> x &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>4&lt;/span>, &lt;span class='m'>3&lt;/span>, &lt;span class='m'>6&lt;/span>, &lt;span class='m'>2&lt;/span>, &lt;span class='m'>8&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> y &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>5&lt;/span>, &lt;span class='m'>1&lt;/span>, &lt;span class='m'>2&lt;/span>, &lt;span class='m'>8&lt;/span>, &lt;span class='m'>9&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>df&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 5 × 3&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; g x y&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 1 4 5&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 1 3 1&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> 1 6 2&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> 2 2 8&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>5&lt;/span> 2 8 9&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>df&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> x_average &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/mean.html'>mean&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>x&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> x_sd &lt;span class='o'>=&lt;/span> &lt;span class='nv'>x&lt;/span>, &lt;span class='c'># Oops&lt;/span>&lt;/span>
&lt;span> .by &lt;span class='o'>=&lt;/span> &lt;span class='nv'>g&lt;/span>&lt;/span>
&lt;span> &lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; Warning: Returning more (or less) than 1 row per `summarise()` group was deprecated in&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; dplyr 1.1.0.&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #00BBBB;'>ℹ&lt;/span> Please use `reframe()` instead.&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #00BBBB;'>ℹ&lt;/span> When switching from `summarise()` to `reframe()`, remember that `reframe()`&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; always returns an ungrouped data frame and adjust accordingly.&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 5 × 3&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; g x_average x_sd&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 1 4.33 4&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 1 4.33 3&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> 1 4.33 6&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> 2 5 2&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>5&lt;/span> 2 5 8&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>
&lt;a href="https://dplyr.tidyverse.org/reference/summarise.html" target="_blank" rel="noopener">&lt;code>summarise()&lt;/code>&lt;/a> now throws a warning when any group returns a result that isn&amp;rsquo;t length 1. We expect to upgrade this to an error in the future to revert
&lt;a href="https://dplyr.tidyverse.org/reference/summarise.html" target="_blank" rel="noopener">&lt;code>summarise()&lt;/code>&lt;/a> back to its &amp;ldquo;safe&amp;rdquo; behavior of requiring 1 row per group.&lt;/p>
&lt;p>
&lt;a href="https://dplyr.tidyverse.org/reference/summarise.html" target="_blank" rel="noopener">&lt;code>summarise()&lt;/code>&lt;/a> also wasn&amp;rsquo;t the best name for a function with this feature, as the name itself implies one row per group. After
&lt;a href="https://github.com/tidyverse/dplyr/issues/6565" target="_blank" rel="noopener">gathering some feedback&lt;/a>, we&amp;rsquo;ve settled on a new verb with a more appropriate name,
&lt;a href="https://dplyr.tidyverse.org/reference/reframe.html" target="_blank" rel="noopener">&lt;code>reframe()&lt;/code>&lt;/a>. We think of
&lt;a href="https://dplyr.tidyverse.org/reference/reframe.html" target="_blank" rel="noopener">&lt;code>reframe()&lt;/code>&lt;/a> as a way to &amp;ldquo;do something&amp;rdquo; to each group, with no restrictions on the number of rows returned per group. The name has a nice connection to the tibble functions
&lt;a href="https://tibble.tidyverse.org/reference/enframe.html" target="_blank" rel="noopener">&lt;code>tibble::enframe()&lt;/code>&lt;/a> and
&lt;a href="https://tibble.tidyverse.org/reference/enframe.html" target="_blank" rel="noopener">&lt;code>tibble::deframe()&lt;/code>&lt;/a>, which are used for converting vectors to data frames and vice versa:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>enframe()&lt;/code>: Takes a vector, returns a data frame&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>deframe()&lt;/code>: Takes a data frame, returns a vector&lt;/p>
&lt;/li>
&lt;li>
&lt;p>
&lt;a href="https://dplyr.tidyverse.org/reference/reframe.html" target="_blank" rel="noopener">&lt;code>reframe()&lt;/code>&lt;/a>: Takes a data frame, returns a data frame&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>One nice application of
&lt;a href="https://dplyr.tidyverse.org/reference/reframe.html" target="_blank" rel="noopener">&lt;code>reframe()&lt;/code>&lt;/a> is computing quantiles at various probability thresholds. It&amp;rsquo;s particularly nice if we wrap
&lt;a href="https://rdrr.io/r/stats/quantile.html" target="_blank" rel="noopener">&lt;code>quantile()&lt;/code>&lt;/a> into a helper that returns a data frame, which
&lt;a href="https://dplyr.tidyverse.org/reference/reframe.html" target="_blank" rel="noopener">&lt;code>reframe()&lt;/code>&lt;/a> then automatically unpacks.&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>quantile_df&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='kr'>function&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>x&lt;/span>, &lt;span class='nv'>probs&lt;/span> &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>0.25&lt;/span>, &lt;span class='m'>0.5&lt;/span>, &lt;span class='m'>0.75&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>&amp;#123;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> value &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/stats/quantile.html'>quantile&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>x&lt;/span>, &lt;span class='nv'>probs&lt;/span>, na.rm &lt;span class='o'>=&lt;/span> &lt;span class='kc'>TRUE&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> prob &lt;span class='o'>=&lt;/span> &lt;span class='nv'>probs&lt;/span>&lt;/span>
&lt;span> &lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>&amp;#125;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>df&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/reframe.html'>reframe&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>quantile_df&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>x&lt;/span>&lt;span class='o'>)&lt;/span>, .by &lt;span class='o'>=&lt;/span> &lt;span class='nv'>g&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 6 × 3&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; g value prob&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 1 3.5 0.25&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 1 4 0.5 &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> 1 5 0.75&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> 2 3.5 0.25&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>5&lt;/span> 2 5 0.5 &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>6&lt;/span> 2 6.5 0.75&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>This also works well if you want to apply it to multiple columns using
&lt;a href="https://dplyr.tidyverse.org/reference/across.html" target="_blank" rel="noopener">&lt;code>across()&lt;/code>&lt;/a>:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>df&lt;/span> &lt;span class='o'>&lt;a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&amp;gt;%&lt;/a>&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/reframe.html'>reframe&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/across.html'>across&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>x&lt;/span>&lt;span class='o'>:&lt;/span>&lt;span class='nv'>y&lt;/span>, &lt;span class='nv'>quantile_df&lt;/span>&lt;span class='o'>)&lt;/span>, .by &lt;span class='o'>=&lt;/span> &lt;span class='nv'>g&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 6 × 3&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; g x$value $prob y$value $prob&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 1 3.5 0.25 1.5 0.25&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 1 4 0.5 2 0.5 &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> 1 5 0.75 3.5 0.75&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> 2 3.5 0.25 8.25 0.25&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>5&lt;/span> 2 5 0.5 8.5 0.5 &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>6&lt;/span> 2 6.5 0.75 8.75 0.75&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>Because &lt;code>quantile_df()&lt;/code> returns a tibble, we end up with
&lt;a href="https://tidyr.tidyverse.org/reference/pack.html" target="_blank" rel="noopener">&lt;em>packed&lt;/em>&lt;/a> data frame columns. You&amp;rsquo;ll often want to unpack these into their individual columns, and
&lt;a href="https://dplyr.tidyverse.org/reference/across.html" target="_blank" rel="noopener">&lt;code>across()&lt;/code>&lt;/a> has gained a new &lt;code>.unpack&lt;/code> argument in 1.1.0 that helps you do exactly that:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>df&lt;/span> &lt;span class='o'>&lt;a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&amp;gt;%&lt;/a>&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/reframe.html'>reframe&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/across.html'>across&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>x&lt;/span>&lt;span class='o'>:&lt;/span>&lt;span class='nv'>y&lt;/span>, &lt;span class='nv'>quantile_df&lt;/span>, .unpack &lt;span class='o'>=&lt;/span> &lt;span class='kc'>TRUE&lt;/span>&lt;span class='o'>)&lt;/span>, .by &lt;span class='o'>=&lt;/span> &lt;span class='nv'>g&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 6 × 5&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; g x_value x_prob y_value y_prob&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 1 3.5 0.25 1.5 0.25&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 1 4 0.5 2 0.5 &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> 1 5 0.75 3.5 0.75&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> 2 3.5 0.25 8.25 0.25&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>5&lt;/span> 2 5 0.5 8.5 0.5 &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>6&lt;/span> 2 6.5 0.75 8.75 0.75&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>We expect that seeing
&lt;a href="https://dplyr.tidyverse.org/reference/reframe.html" target="_blank" rel="noopener">&lt;code>reframe()&lt;/code>&lt;/a> in a colleague&amp;rsquo;s code will serve as an extremely clear signal that something &amp;ldquo;special&amp;rdquo; is happening, because they&amp;rsquo;ve made a conscious decision to opt-into the 1% case of returning multiple rows per group.&lt;/p>
&lt;h2 id="arrange">&lt;code>arrange()&lt;/code>
&lt;a href="#arrange">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>We also mentioned in the
&lt;a href="https://www.tidyverse.org/blog/2022/11/dplyr-1-1-0-is-coming-soon/" target="_blank" rel="noopener">coming soon&lt;/a> post that
&lt;a href="https://dplyr.tidyverse.org/reference/arrange.html" target="_blank" rel="noopener">&lt;code>arrange()&lt;/code>&lt;/a> has undergone two user-facing changes:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>When sorting character vectors, the C locale is now the default, rather than the system locale&lt;/p>
&lt;/li>
&lt;li>
&lt;p>A new &lt;code>.locale&lt;/code> argument, powered by stringi, allows you to explicitly request an alternative locale using a stringi locale identifier (like &lt;code>&amp;quot;en&amp;quot;&lt;/code> for English, or &lt;code>&amp;quot;fr&amp;quot;&lt;/code> for French)&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>These changes were made for two reasons:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Much faster performance by default, due to usage of a custom radix sort algorithm inspired by
&lt;a href="https://cran.r-project.org/web/packages/data.table/index.html" target="_blank" rel="noopener">data.table&lt;/a>&amp;lsquo;s &lt;code>forder()&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Improved reproducibility across R sessions, where different computers might use different system locales and different operating systems have different ways to specify the same system locale&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>If you use
&lt;a href="https://dplyr.tidyverse.org/reference/arrange.html" target="_blank" rel="noopener">&lt;code>arrange()&lt;/code>&lt;/a> for the purpose of grouping similar values together (and don&amp;rsquo;t care much about the specific locale that it uses to do so), then you&amp;rsquo;ll likely see performance improvements of up to 100x in dplyr 1.1.0. If you do care about the locale and supply &lt;code>.locale&lt;/code>, you should still see improvements of up to 10x.&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='c'># 10,000 random strings, sampled up to 1,000,000 rows&lt;/span>&lt;/span>
&lt;span>&lt;span class='nv'>dictionary&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>stringi&lt;/span>&lt;span class='nf'>::&lt;/span>&lt;span class='nf'>&lt;a href='https://rdrr.io/pkg/stringi/man/stri_rand_strings.html'>stri_rand_strings&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>10000&lt;/span>, length &lt;span class='o'>=&lt;/span> &lt;span class='m'>10&lt;/span>, pattern &lt;span class='o'>=&lt;/span> &lt;span class='s'>"[a-z]"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='nv'>str&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>x &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/sample.html'>sample&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>dictionary&lt;/span>, size &lt;span class='o'>=&lt;/span> &lt;span class='m'>1e6&lt;/span>, replace &lt;span class='o'>=&lt;/span> &lt;span class='kc'>TRUE&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='nv'>str&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 1,000,000 × 1&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; x &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 1&lt;/span> slpqkdtpyr&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 2&lt;/span> xtoucpndhc&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 3&lt;/span> vsvfoqcyqm&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 4&lt;/span> gnbpkwcmse&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 5&lt;/span> xutzdqxpsi&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 6&lt;/span> gkolsrndrz&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 7&lt;/span> mitqahkkou&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 8&lt;/span> eehfrrimhd&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 9&lt;/span> ymxxjczjsv&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>10&lt;/span> svpvizfxwe&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># … with 999,990 more rows&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='c'># dplyr 1.0.10 (American English system locale)&lt;/span>&lt;/span>
&lt;span>&lt;span class='nf'>bench&lt;/span>&lt;span class='nf'>::&lt;/span>&lt;span class='nf'>&lt;a href='http://bench.r-lib.org/reference/mark.html'>mark&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>str&lt;/span>, &lt;span class='nv'>x&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; # A tibble: 1 × 6&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; expression min median `itr/sec` mem_alloc `gc/sec`&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &amp;lt;bch:expr&amp;gt; &amp;lt;bch:tm&amp;gt; &amp;lt;bch:tm&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;bch:byt&amp;gt; &amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; 1 arrange(str, x) 4.38s 4.89s 0.204 12.7MB 0.148&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='c'># dplyr 1.1.0 (C locale default, 100x faster)&lt;/span>&lt;/span>
&lt;span>&lt;span class='nf'>bench&lt;/span>&lt;span class='nf'>::&lt;/span>&lt;span class='nf'>&lt;a href='http://bench.r-lib.org/reference/mark.html'>mark&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>str&lt;/span>, &lt;span class='nv'>x&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; # A tibble: 1 × 6&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; expression min median `itr/sec` mem_alloc `gc/sec`&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &amp;lt;bch:expr&amp;gt; &amp;lt;bch:tm&amp;gt; &amp;lt;bch:tm&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;bch:byt&amp;gt; &amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; 1 arrange(str, x) 42.3ms 46.6ms 20.8 22.4MB 46.0&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='c'># dplyr 1.1.0 (American English `.locale`, 10x faster)&lt;/span>&lt;/span>
&lt;span>&lt;span class='nf'>bench&lt;/span>&lt;span class='nf'>::&lt;/span>&lt;span class='nf'>&lt;a href='http://bench.r-lib.org/reference/mark.html'>mark&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>str&lt;/span>, &lt;span class='nv'>x&lt;/span>, .locale &lt;span class='o'>=&lt;/span> &lt;span class='s'>"en"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; # A tibble: 1 × 6&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; expression min median `itr/sec` mem_alloc&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &amp;lt;bch:expr&amp;gt; &amp;lt;bch:tm&amp;gt; &amp;lt;bch:&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;bch:byt&amp;gt;&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; 1 arrange(str, x, .locale = "en") 377ms 430ms 2.21 27.9MB&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; # … with 1 more variable: `gc/sec` &amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>We are hopeful that switching to a C locale default will have a relatively small amount of impact in exchange for much faster performance. To read more about the exact differences between the C locale and locales like American English or Spanish, see the
&lt;a href="https://www.tidyverse.org/blog/2022/11/dplyr-1-1-0-is-coming-soon/#arrange-improvements-with-character-vectors" target="_blank" rel="noopener">coming soon&lt;/a> post or our detailed
&lt;a href="https://github.com/tidyverse/tidyups/blob/main/003-dplyr-radix-ordering.md" target="_blank" rel="noopener">tidyup&lt;/a>. If you are having trouble converting an existing script over to the new behavior, you can set the temporary global option &lt;code>options(dplyr.legacy_locale = TRUE)&lt;/code>, which will revert to the pre-1.1.0 behavior of using the system locale. We expect to remove this option in a future release.&lt;/p>
&lt;h2 id="acknowledgements">Acknowledgements
&lt;a href="#acknowledgements">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>A big thanks to the 88 contributors who helped make the 1.1.0 release possible by opening issues, contributing features and documentation, and asking questions!
&lt;a href="https://github.com/7708801314520dym" target="_blank" rel="noopener">@7708801314520dym&lt;/a>,
&lt;a href="https://github.com/abalter" target="_blank" rel="noopener">@abalter&lt;/a>,
&lt;a href="https://github.com/aghaynes" target="_blank" rel="noopener">@aghaynes&lt;/a>,
&lt;a href="https://github.com/AlbertRapp" target="_blank" rel="noopener">@AlbertRapp&lt;/a>,
&lt;a href="https://github.com/AlexGaithuma" target="_blank" rel="noopener">@AlexGaithuma&lt;/a>,
&lt;a href="https://github.com/algsat" target="_blank" rel="noopener">@algsat&lt;/a>,
&lt;a href="https://github.com/andrewbaxter439" target="_blank" rel="noopener">@andrewbaxter439&lt;/a>,
&lt;a href="https://github.com/andrewpbray" target="_blank" rel="noopener">@andrewpbray&lt;/a>,
&lt;a href="https://github.com/asadow" target="_blank" rel="noopener">@asadow&lt;/a>,
&lt;a href="https://github.com/asmlgkj" target="_blank" rel="noopener">@asmlgkj&lt;/a>,
&lt;a href="https://github.com/barbosawf" target="_blank" rel="noopener">@barbosawf&lt;/a>,
&lt;a href="https://github.com/barnabasharris" target="_blank" rel="noopener">@barnabasharris&lt;/a>,
&lt;a href="https://github.com/bart1" target="_blank" rel="noopener">@bart1&lt;/a>,
&lt;a href="https://github.com/bergsmat" target="_blank" rel="noopener">@bergsmat&lt;/a>,
&lt;a href="https://github.com/chrisbrownlie" target="_blank" rel="noopener">@chrisbrownlie&lt;/a>,
&lt;a href="https://github.com/cjyetman" target="_blank" rel="noopener">@cjyetman&lt;/a>,
&lt;a href="https://github.com/CNUlichao" target="_blank" rel="noopener">@CNUlichao&lt;/a>,
&lt;a href="https://github.com/daattali" target="_blank" rel="noopener">@daattali&lt;/a>,
&lt;a href="https://github.com/DanChaltiel" target="_blank" rel="noopener">@DanChaltiel&lt;/a>,
&lt;a href="https://github.com/davidchall" target="_blank" rel="noopener">@davidchall&lt;/a>,
&lt;a href="https://github.com/DavisVaughan" target="_blank" rel="noopener">@DavisVaughan&lt;/a>,
&lt;a href="https://github.com/ddsjoberg" target="_blank" rel="noopener">@ddsjoberg&lt;/a>,
&lt;a href="https://github.com/donboyd5" target="_blank" rel="noopener">@donboyd5&lt;/a>,
&lt;a href="https://github.com/drmowinckels" target="_blank" rel="noopener">@drmowinckels&lt;/a>,
&lt;a href="https://github.com/dxtxs1" target="_blank" rel="noopener">@dxtxs1&lt;/a>,
&lt;a href="https://github.com/eitsupi" target="_blank" rel="noopener">@eitsupi&lt;/a>,
&lt;a href="https://github.com/eogoodwin" target="_blank" rel="noopener">@eogoodwin&lt;/a>,
&lt;a href="https://github.com/erhoppe" target="_blank" rel="noopener">@erhoppe&lt;/a>,
&lt;a href="https://github.com/eutwt" target="_blank" rel="noopener">@eutwt&lt;/a>,
&lt;a href="https://github.com/ggrothendieck" target="_blank" rel="noopener">@ggrothendieck&lt;/a>,
&lt;a href="https://github.com/grayskripko" target="_blank" rel="noopener">@grayskripko&lt;/a>,
&lt;a href="https://github.com/H-Mateus" target="_blank" rel="noopener">@H-Mateus&lt;/a>,
&lt;a href="https://github.com/hadley" target="_blank" rel="noopener">@hadley&lt;/a>,
&lt;a href="https://github.com/haozhou1988" target="_blank" rel="noopener">@haozhou1988&lt;/a>,
&lt;a href="https://github.com/hassanjfry" target="_blank" rel="noopener">@hassanjfry&lt;/a>,
&lt;a href="https://github.com/Hesham999666" target="_blank" rel="noopener">@Hesham999666&lt;/a>,
&lt;a href="https://github.com/hideaki" target="_blank" rel="noopener">@hideaki&lt;/a>,
&lt;a href="https://github.com/jeffreypullin" target="_blank" rel="noopener">@jeffreypullin&lt;/a>,
&lt;a href="https://github.com/jic007" target="_blank" rel="noopener">@jic007&lt;/a>,
&lt;a href="https://github.com/jmbarbone" target="_blank" rel="noopener">@jmbarbone&lt;/a>,
&lt;a href="https://github.com/jonspring" target="_blank" rel="noopener">@jonspring&lt;/a>,
&lt;a href="https://github.com/jonthegeek" target="_blank" rel="noopener">@jonthegeek&lt;/a>,
&lt;a href="https://github.com/jpeacock29" target="_blank" rel="noopener">@jpeacock29&lt;/a>,
&lt;a href="https://github.com/kendonB" target="_blank" rel="noopener">@kendonB&lt;/a>,
&lt;a href="https://github.com/kenkoonwong" target="_blank" rel="noopener">@kenkoonwong&lt;/a>,
&lt;a href="https://github.com/kevinushey" target="_blank" rel="noopener">@kevinushey&lt;/a>,
&lt;a href="https://github.com/krlmlr" target="_blank" rel="noopener">@krlmlr&lt;/a>,
&lt;a href="https://github.com/larry77" target="_blank" rel="noopener">@larry77&lt;/a>,
&lt;a href="https://github.com/latot" target="_blank" rel="noopener">@latot&lt;/a>,
&lt;a href="https://github.com/lionel-" target="_blank" rel="noopener">@lionel-&lt;/a>,
&lt;a href="https://github.com/llayman12" target="_blank" rel="noopener">@llayman12&lt;/a>,
&lt;a href="https://github.com/LukasWallrich" target="_blank" rel="noopener">@LukasWallrich&lt;/a>,
&lt;a href="https://github.com/m-sostero" target="_blank" rel="noopener">@m-sostero&lt;/a>,
&lt;a href="https://github.com/machow" target="_blank" rel="noopener">@machow&lt;/a>,
&lt;a href="https://github.com/mc-unimi" target="_blank" rel="noopener">@mc-unimi&lt;/a>,
&lt;a href="https://github.com/mgacc0" target="_blank" rel="noopener">@mgacc0&lt;/a>,
&lt;a href="https://github.com/mgirlich" target="_blank" rel="noopener">@mgirlich&lt;/a>,
&lt;a href="https://github.com/MichelleSMA" target="_blank" rel="noopener">@MichelleSMA&lt;/a>,
&lt;a href="https://github.com/mine-cetinkaya-rundel" target="_blank" rel="noopener">@mine-cetinkaya-rundel&lt;/a>,
&lt;a href="https://github.com/moodymudskipper" target="_blank" rel="noopener">@moodymudskipper&lt;/a>,
&lt;a href="https://github.com/moriarais" target="_blank" rel="noopener">@moriarais&lt;/a>,
&lt;a href="https://github.com/NicChr" target="_blank" rel="noopener">@NicChr&lt;/a>,
&lt;a href="https://github.com/nstjhp" target="_blank" rel="noopener">@nstjhp&lt;/a>,
&lt;a href="https://github.com/omarwh" target="_blank" rel="noopener">@omarwh&lt;/a>,
&lt;a href="https://github.com/orgadish" target="_blank" rel="noopener">@orgadish&lt;/a>,
&lt;a href="https://github.com/rempsyc" target="_blank" rel="noopener">@rempsyc&lt;/a>,
&lt;a href="https://github.com/rorynolan" target="_blank" rel="noopener">@rorynolan&lt;/a>,
&lt;a href="https://github.com/ryanvoyack" target="_blank" rel="noopener">@ryanvoyack&lt;/a>,
&lt;a href="https://github.com/selkamand" target="_blank" rel="noopener">@selkamand&lt;/a>,
&lt;a href="https://github.com/seth-cp" target="_blank" rel="noopener">@seth-cp&lt;/a>,
&lt;a href="https://github.com/shalom-lab" target="_blank" rel="noopener">@shalom-lab&lt;/a>,
&lt;a href="https://github.com/shannonpileggi" target="_blank" rel="noopener">@shannonpileggi&lt;/a>,
&lt;a href="https://github.com/simonpcouch" target="_blank" rel="noopener">@simonpcouch&lt;/a>,
&lt;a href="https://github.com/sjackson1997" target="_blank" rel="noopener">@sjackson1997&lt;/a>,
&lt;a href="https://github.com/spono" target="_blank" rel="noopener">@spono&lt;/a>,
&lt;a href="https://github.com/stibu81" target="_blank" rel="noopener">@stibu81&lt;/a>,
&lt;a href="https://github.com/tfehring" target="_blank" rel="noopener">@tfehring&lt;/a>,
&lt;a href="https://github.com/Theresaliu" target="_blank" rel="noopener">@Theresaliu&lt;/a>,
&lt;a href="https://github.com/TimBMK" target="_blank" rel="noopener">@TimBMK&lt;/a>,
&lt;a href="https://github.com/TimTeaFan" target="_blank" rel="noopener">@TimTeaFan&lt;/a>,
&lt;a href="https://github.com/Torvaney" target="_blank" rel="noopener">@Torvaney&lt;/a>,
&lt;a href="https://github.com/turbanisch" target="_blank" rel="noopener">@turbanisch&lt;/a>,
&lt;a href="https://github.com/weiyangtham" target="_blank" rel="noopener">@weiyangtham&lt;/a>,
&lt;a href="https://github.com/wurli" target="_blank" rel="noopener">@wurli&lt;/a>,
&lt;a href="https://github.com/xet869" target="_blank" rel="noopener">@xet869&lt;/a>,
&lt;a href="https://github.com/yuliaUU" target="_blank" rel="noopener">@yuliaUU&lt;/a>,
&lt;a href="https://github.com/yutannihilation" target="_blank" rel="noopener">@yutannihilation&lt;/a>, and
&lt;a href="https://github.com/zeehio" target="_blank" rel="noopener">@zeehio&lt;/a>.&lt;/p></description></item><item><title>dplyr 1.1.0: The power of vctrs</title><link>https://www.tidyverse.org/blog/2023/02/dplyr-1-1-0-vctrs/</link><pubDate>Thu, 02 Feb 2023 00:00:00 +0000</pubDate><guid>https://www.tidyverse.org/blog/2023/02/dplyr-1-1-0-vctrs/</guid><description>&lt;p>Today&amp;rsquo;s
&lt;a href="https://dplyr.tidyverse.org/news/index.html#dplyr-110" target="_blank" rel="noopener">dplyr 1.1.0&lt;/a> post is focused on various updates to vector functions, like
&lt;a href="https://dplyr.tidyverse.org/reference/case_when.html" target="_blank" rel="noopener">&lt;code>case_when()&lt;/code>&lt;/a> and
&lt;a href="https://dplyr.tidyverse.org/reference/between.html" target="_blank" rel="noopener">&lt;code>between()&lt;/code>&lt;/a>. If you missed our previous posts, you can also see the other
&lt;a href="https://www.tidyverse.org/tags/dplyr-1-1-0/" target="_blank" rel="noopener">blog posts&lt;/a> in this series. All of dplyr&amp;rsquo;s vector functions are now backed by
&lt;a href="https://vctrs.r-lib.org/" target="_blank" rel="noopener">vctrs&lt;/a>, which typically results in better error messages, better performance, and greater versatility.&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>&lt;a href='https://rdrr.io/r/utils/install.packages.html'>install.packages&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"dplyr"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='kr'>&lt;a href='https://rdrr.io/r/base/library.html'>library&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>&lt;a href='https://dplyr.tidyverse.org'>dplyr&lt;/a>&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;h2 id="case_when">&lt;code>case_when()&lt;/code>
&lt;a href="#case_when">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>If you&amp;rsquo;ve used
&lt;a href="https://dplyr.tidyverse.org/reference/case_when.html" target="_blank" rel="noopener">&lt;code>case_when()&lt;/code>&lt;/a> before, you&amp;rsquo;ve probably written a statement like this:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>x&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>1&lt;/span>, &lt;span class='m'>12&lt;/span>, &lt;span class='o'>-&lt;/span>&lt;span class='m'>5&lt;/span>, &lt;span class='m'>6&lt;/span>, &lt;span class='o'>-&lt;/span>&lt;span class='m'>2&lt;/span>, &lt;span class='kc'>NA&lt;/span>, &lt;span class='m'>0&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> &lt;span class='nv'>x&lt;/span> &lt;span class='o'>&amp;gt;=&lt;/span> &lt;span class='m'>10&lt;/span> &lt;span class='o'>~&lt;/span> &lt;span class='s'>"large"&lt;/span>,&lt;/span>
&lt;span> &lt;span class='nv'>x&lt;/span> &lt;span class='o'>&amp;gt;=&lt;/span> &lt;span class='m'>0&lt;/span> &lt;span class='o'>~&lt;/span> &lt;span class='s'>"small"&lt;/span>,&lt;/span>
&lt;span> &lt;span class='nv'>x&lt;/span> &lt;span class='o'>&amp;lt;&lt;/span> &lt;span class='m'>0&lt;/span> &lt;span class='o'>~&lt;/span> &lt;span class='kc'>NA&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; Error: `NA` must be &amp;lt;character&amp;gt;, not &amp;lt;logical&amp;gt;.&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>Like me, you&amp;rsquo;ve probably forgotten that
&lt;a href="https://dplyr.tidyverse.org/reference/case_when.html" target="_blank" rel="noopener">&lt;code>case_when()&lt;/code>&lt;/a> has historically been strict about the types on the right-hand side of the &lt;code>~&lt;/code>, which means that I needed to use &lt;code>NA_character_&lt;/code> here instead of &lt;code>NA&lt;/code>. Luckily, the switch to vctrs means that the above code now &amp;ldquo;just works&amp;rdquo;:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> &lt;span class='nv'>x&lt;/span> &lt;span class='o'>&amp;gt;=&lt;/span> &lt;span class='m'>10&lt;/span> &lt;span class='o'>~&lt;/span> &lt;span class='s'>"large"&lt;/span>,&lt;/span>
&lt;span> &lt;span class='nv'>x&lt;/span> &lt;span class='o'>&amp;gt;=&lt;/span> &lt;span class='m'>0&lt;/span> &lt;span class='o'>~&lt;/span> &lt;span class='s'>"small"&lt;/span>,&lt;/span>
&lt;span> &lt;span class='nv'>x&lt;/span> &lt;span class='o'>&amp;lt;&lt;/span> &lt;span class='m'>0&lt;/span> &lt;span class='o'>~&lt;/span> &lt;span class='kc'>NA&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; [1] "small" "large" NA "small" NA NA "small"&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>You&amp;rsquo;ve probably also written a statement like this:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> &lt;span class='nv'>x&lt;/span> &lt;span class='o'>&amp;gt;=&lt;/span> &lt;span class='m'>10&lt;/span> &lt;span class='o'>~&lt;/span> &lt;span class='s'>"large"&lt;/span>,&lt;/span>
&lt;span> &lt;span class='nv'>x&lt;/span> &lt;span class='o'>&amp;gt;=&lt;/span> &lt;span class='m'>0&lt;/span> &lt;span class='o'>~&lt;/span> &lt;span class='s'>"small"&lt;/span>,&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/NA.html'>is.na&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>x&lt;/span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>~&lt;/span> &lt;span class='s'>"missing"&lt;/span>,&lt;/span>
&lt;span> &lt;span class='kc'>TRUE&lt;/span> &lt;span class='o'>~&lt;/span> &lt;span class='s'>"other"&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; [1] "small" "large" "other" "small" "other" "missing" "small"&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>In this case, we have a fall-through &amp;ldquo;default&amp;rdquo; captured by &lt;code>TRUE ~&lt;/code>. This has always felt a little awkward and is fairly difficult to explain to new R users. To make this clearer, we&amp;rsquo;ve added an explicit &lt;code>.default&lt;/code> argument that we encourage you to use instead:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> &lt;span class='nv'>x&lt;/span> &lt;span class='o'>&amp;gt;=&lt;/span> &lt;span class='m'>10&lt;/span> &lt;span class='o'>~&lt;/span> &lt;span class='s'>"large"&lt;/span>,&lt;/span>
&lt;span> &lt;span class='nv'>x&lt;/span> &lt;span class='o'>&amp;gt;=&lt;/span> &lt;span class='m'>0&lt;/span> &lt;span class='o'>~&lt;/span> &lt;span class='s'>"small"&lt;/span>,&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/NA.html'>is.na&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>x&lt;/span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>~&lt;/span> &lt;span class='s'>"missing"&lt;/span>,&lt;/span>
&lt;span> .default &lt;span class='o'>=&lt;/span> &lt;span class='s'>"other"&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; [1] "small" "large" "other" "small" "other" "missing" "small"&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>&lt;code>.default&lt;/code> will always be processed last, regardless of where you put it in the call to
&lt;a href="https://dplyr.tidyverse.org/reference/case_when.html" target="_blank" rel="noopener">&lt;code>case_when()&lt;/code>&lt;/a>, so we recommend placing it at the very end.&lt;/p>
&lt;p>We haven&amp;rsquo;t started any formal deprecation process for &lt;code>TRUE ~&lt;/code> yet, but now that there is a better solution available we encourage you to switch over. We do plan to deprecate this feature in the future because it involves some slightly problematic recycling rules (but we wouldn&amp;rsquo;t even begin this process for at least a year).&lt;/p>
&lt;h2 id="case_match">&lt;code>case_match()&lt;/code>
&lt;a href="#case_match">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>Another type of
&lt;a href="https://dplyr.tidyverse.org/reference/case_when.html" target="_blank" rel="noopener">&lt;code>case_when()&lt;/code>&lt;/a> statement you&amp;rsquo;ve probably written is some kind of value remapping like:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>x&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"USA"&lt;/span>, &lt;span class='s'>"Canada"&lt;/span>, &lt;span class='s'>"Wales"&lt;/span>, &lt;span class='s'>"UK"&lt;/span>, &lt;span class='s'>"China"&lt;/span>, &lt;span class='kc'>NA&lt;/span>, &lt;span class='s'>"Mexico"&lt;/span>, &lt;span class='s'>"Russia"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> &lt;span class='nv'>x&lt;/span> &lt;span class='o'>&lt;a href='https://rdrr.io/r/base/match.html'>%in%&lt;/a>&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"USA"&lt;/span>, &lt;span class='s'>"Canada"&lt;/span>, &lt;span class='s'>"Mexico"&lt;/span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>~&lt;/span> &lt;span class='s'>"North America"&lt;/span>,&lt;/span>
&lt;span> &lt;span class='nv'>x&lt;/span> &lt;span class='o'>&lt;a href='https://rdrr.io/r/base/match.html'>%in%&lt;/a>&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"Wales"&lt;/span>, &lt;span class='s'>"UK"&lt;/span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>~&lt;/span> &lt;span class='s'>"Europe"&lt;/span>,&lt;/span>
&lt;span> &lt;span class='nv'>x&lt;/span> &lt;span class='o'>&lt;a href='https://rdrr.io/r/base/match.html'>%in%&lt;/a>&lt;/span> &lt;span class='s'>"China"&lt;/span> &lt;span class='o'>~&lt;/span> &lt;span class='s'>"Asia"&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; [1] "North America" "North America" "Europe" "Europe" &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; [5] "Asia" NA "North America" NA&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>Remapping values in this way is so common that SQL gives it its own name - the &amp;ldquo;simple&amp;rdquo; case statement. To streamline this further, we&amp;rsquo;ve taken out some of the repetition involved with &lt;code>x %in%&lt;/code> by introducing
&lt;a href="https://dplyr.tidyverse.org/reference/case_match.html" target="_blank" rel="noopener">&lt;code>case_match()&lt;/code>&lt;/a>, a variant of
&lt;a href="https://dplyr.tidyverse.org/reference/case_when.html" target="_blank" rel="noopener">&lt;code>case_when()&lt;/code>&lt;/a> that allows you to specify one or more &lt;em>values&lt;/em> on the left-hand side of the &lt;code>~&lt;/code>, rather than logical vectors.&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/case_match.html'>case_match&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> &lt;span class='nv'>x&lt;/span>,&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"USA"&lt;/span>, &lt;span class='s'>"Canada"&lt;/span>, &lt;span class='s'>"Mexico"&lt;/span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>~&lt;/span> &lt;span class='s'>"North America"&lt;/span>,&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"France"&lt;/span>, &lt;span class='s'>"UK"&lt;/span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>~&lt;/span> &lt;span class='s'>"Europe"&lt;/span>,&lt;/span>
&lt;span> &lt;span class='s'>"China"&lt;/span> &lt;span class='o'>~&lt;/span> &lt;span class='s'>"Asia"&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; [1] "North America" "North America" NA "Europe" &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; [5] "Asia" NA "North America" NA&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>I think that
&lt;a href="https://dplyr.tidyverse.org/reference/case_match.html" target="_blank" rel="noopener">&lt;code>case_match()&lt;/code>&lt;/a> is particularly neat because it can be wrapped into an ad-hoc replacement helper if you just need to collapse or replace a few problematic values in a vector, while leaving everything else unchanged:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>replace_match&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='kr'>function&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>x&lt;/span>, &lt;span class='nv'>...&lt;/span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>&amp;#123;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/case_match.html'>case_match&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>x&lt;/span>, &lt;span class='nv'>...&lt;/span>, .default &lt;span class='o'>=&lt;/span> &lt;span class='nv'>x&lt;/span>, .ptype &lt;span class='o'>=&lt;/span> &lt;span class='nv'>x&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>&amp;#125;&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nf'>replace_match&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> &lt;span class='nv'>x&lt;/span>, &lt;/span>
&lt;span> &lt;span class='s'>"USA"&lt;/span> &lt;span class='o'>~&lt;/span> &lt;span class='s'>"United States"&lt;/span>, &lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"UK"&lt;/span>, &lt;span class='s'>"Wales"&lt;/span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>~&lt;/span> &lt;span class='s'>"United Kingdom"&lt;/span>,&lt;/span>
&lt;span> &lt;span class='kc'>NA&lt;/span> &lt;span class='o'>~&lt;/span> &lt;span class='s'>"[Missing]"&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; [1] "United States" "Canada" "United Kingdom" "United Kingdom"&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; [5] "China" "[Missing]" "Mexico" "Russia"&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;h2 id="consecutive_id">&lt;code>consecutive_id()&lt;/code>
&lt;a href="#consecutive_id">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>At Posit, we have regular company update meetings. Since we are all remote, these meetings are over Zoom. Zoom has a neat feature where it can record the transcript of your call, and it will report who was speaking and what they said. It looks something like this:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>transcript&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/tribble.html'>tribble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> &lt;span class='o'>~&lt;/span>&lt;span class='nv'>name&lt;/span>, &lt;span class='o'>~&lt;/span>&lt;span class='nv'>text&lt;/span>,&lt;/span>
&lt;span> &lt;span class='s'>"Hadley"&lt;/span>, &lt;span class='s'>"I'll never learn Python."&lt;/span>,&lt;/span>
&lt;span> &lt;span class='s'>"Davis"&lt;/span>, &lt;span class='s'>"But aren't you speaking at PyCon?"&lt;/span>,&lt;/span>
&lt;span> &lt;span class='s'>"Hadley"&lt;/span>, &lt;span class='s'>"So?"&lt;/span>,&lt;/span>
&lt;span> &lt;span class='s'>"Hadley"&lt;/span>, &lt;span class='s'>"That doesn't influence my decision."&lt;/span>,&lt;/span>
&lt;span> &lt;span class='s'>"Hadley"&lt;/span>, &lt;span class='s'>"I'm not budging!"&lt;/span>,&lt;/span>
&lt;span> &lt;span class='s'>"Mara"&lt;/span>, &lt;span class='s'>"Typical, Hadley. Stubborn as always."&lt;/span>,&lt;/span>
&lt;span> &lt;span class='s'>"Davis"&lt;/span>, &lt;span class='s'>"Fair enough!"&lt;/span>,&lt;/span>
&lt;span> &lt;span class='s'>"Davis"&lt;/span>, &lt;span class='s'>"Let's move on."&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>transcript&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 8 × 2&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; name text &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> Hadley I'll never learn Python. &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> Davis But aren't you speaking at PyCon? &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> Hadley So? &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> Hadley That doesn't influence my decision. &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>5&lt;/span> Hadley I'm not budging! &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>6&lt;/span> Mara Typical, Hadley. Stubborn as always.&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>7&lt;/span> Davis Fair enough! &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>8&lt;/span> Davis Let's move on.&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>We were working with this data and wanted a way to collapse each continuous thought down to one line. For example, rows 3-5 all contain a single idea from Hadley, so we&amp;rsquo;d like those to be collapsed into a single line. This isn&amp;rsquo;t quite as straightforward as a simple group-by-&lt;code>name&lt;/code> and
&lt;a href="https://dplyr.tidyverse.org/reference/summarise.html" target="_blank" rel="noopener">&lt;code>summarise()&lt;/code>&lt;/a>:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>transcript&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>text &lt;span class='o'>=&lt;/span> &lt;span class='nf'>stringr&lt;/span>&lt;span class='nf'>::&lt;/span>&lt;span class='nf'>&lt;a href='https://stringr.tidyverse.org/reference/str_flatten.html'>str_flatten&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>text&lt;/span>, collapse &lt;span class='o'>=&lt;/span> &lt;span class='s'>" "&lt;/span>&lt;span class='o'>)&lt;/span>, .by &lt;span class='o'>=&lt;/span> &lt;span class='nv'>name&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 3 × 2&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; name text &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> Hadley I'll never learn Python. So? That doesn't influence my decision. I'm n…&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> Davis But aren't you speaking at PyCon? Fair enough! Let's move on. &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> Mara Typical, Hadley. Stubborn as always.&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>This isn&amp;rsquo;t quite right because it collapsed the first row where Hadley says &amp;ldquo;I&amp;rsquo;ll never learn Python&amp;rdquo; alongside rows 3-5. We need a way to identify consecutive &lt;em>runs&lt;/em> representing when a single person is speaking, which is exactly what
&lt;a href="https://dplyr.tidyverse.org/reference/consecutive_id.html" target="_blank" rel="noopener">&lt;code>consecutive_id()&lt;/code>&lt;/a> is for!&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>transcript&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>id &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/consecutive_id.html'>consecutive_id&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>name&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 8 × 3&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; name text id&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;int&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> Hadley I'll never learn Python. 1&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> Davis But aren't you speaking at PyCon? 2&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> Hadley So? 3&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> Hadley That doesn't influence my decision. 3&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>5&lt;/span> Hadley I'm not budging! 3&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>6&lt;/span> Mara Typical, Hadley. Stubborn as always. 4&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>7&lt;/span> Davis Fair enough! 5&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>8&lt;/span> Davis Let's move on. 5&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>
&lt;a href="https://dplyr.tidyverse.org/reference/consecutive_id.html" target="_blank" rel="noopener">&lt;code>consecutive_id()&lt;/code>&lt;/a> takes one or more columns and generates an integer vector that increments every time a value in one of those columns changes. This gives us something we can group on to correctly flatten our &lt;code>text&lt;/code>.&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>transcript&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>id &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/consecutive_id.html'>consecutive_id&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>name&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>text &lt;span class='o'>=&lt;/span> &lt;span class='nf'>stringr&lt;/span>&lt;span class='nf'>::&lt;/span>&lt;span class='nf'>&lt;a href='https://stringr.tidyverse.org/reference/str_flatten.html'>str_flatten&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>text&lt;/span>, collapse &lt;span class='o'>=&lt;/span> &lt;span class='s'>" "&lt;/span>&lt;span class='o'>)&lt;/span>, .by &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>id&lt;/span>, &lt;span class='nv'>name&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 5 × 3&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; id name text &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;int&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 1 Hadley I'll never learn Python. &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 2 Davis But aren't you speaking at PyCon? &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> 3 Hadley So? That doesn't influence my decision. I'm not budging!&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> 4 Mara Typical, Hadley. Stubborn as always. &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>5&lt;/span> 5 Davis Fair enough! Let's move on.&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>Grouping by &lt;code>id&lt;/code> alone is actually enough, but I&amp;rsquo;ve also grouped by &lt;code>name&lt;/code> for a convenient way to drag the name along into the summary table.&lt;/p>
&lt;p>
&lt;a href="https://dplyr.tidyverse.org/reference/consecutive_id.html" target="_blank" rel="noopener">&lt;code>consecutive_id()&lt;/code>&lt;/a> is inspired by
&lt;a href="https://rdatatable.gitlab.io/data.table/reference/rleid.html" target="_blank" rel="noopener">&lt;code>data.table::rleid()&lt;/code>&lt;/a>, which serves a similar purpose.&lt;/p>
&lt;h2 id="miscellaneous-updates">Miscellaneous updates
&lt;a href="#miscellaneous-updates">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>
&lt;a href="https://dplyr.tidyverse.org/reference/between.html" target="_blank" rel="noopener">&lt;code>between()&lt;/code>&lt;/a> is no longer restricted to length 1 &lt;code>left&lt;/code> and &lt;code>right&lt;/code> boundaries. They are now allowed to be length 1 or the same length as &lt;code>x&lt;/code>. Additionally,
&lt;a href="https://dplyr.tidyverse.org/reference/between.html" target="_blank" rel="noopener">&lt;code>between()&lt;/code>&lt;/a> now works with any type supported by vctrs, rather than just with numerics and date-times.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>
&lt;a href="https://dplyr.tidyverse.org/reference/if_else.html" target="_blank" rel="noopener">&lt;code>if_else()&lt;/code>&lt;/a> has received the same updates as
&lt;a href="https://dplyr.tidyverse.org/reference/case_when.html" target="_blank" rel="noopener">&lt;code>case_when()&lt;/code>&lt;/a>. In particular, it is no longer as strict about typed missing values.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>The ranking functions, like
&lt;a href="https://dplyr.tidyverse.org/reference/row_number.html" target="_blank" rel="noopener">&lt;code>dense_rank()&lt;/code>&lt;/a>, now allow data frame inputs as a way to rank by multiple columns at once.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>
&lt;a href="https://dplyr.tidyverse.org/reference/nth.html" target="_blank" rel="noopener">&lt;code>first()&lt;/code>&lt;/a>,
&lt;a href="https://dplyr.tidyverse.org/reference/nth.html" target="_blank" rel="noopener">&lt;code>last()&lt;/code>&lt;/a>, and
&lt;a href="https://dplyr.tidyverse.org/reference/nth.html" target="_blank" rel="noopener">&lt;code>nth()&lt;/code>&lt;/a> have all gained an &lt;code>na_rm&lt;/code> argument since they are summary functions.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>
&lt;a href="https://dplyr.tidyverse.org/reference/na_if.html" target="_blank" rel="noopener">&lt;code>na_if()&lt;/code>&lt;/a> now casts &lt;code>y&lt;/code> to the type of &lt;code>x&lt;/code> to make it clear that it is type stable on &lt;code>x&lt;/code>. In particular, this means you can no longer do &lt;code>na_if(&amp;lt;tbl&amp;gt;, 0)&lt;/code>, which previously accidentally allowed you to attempt to replace missing values in every column with &lt;code>0&lt;/code>. This function has always been intended as a vector function, and this is considered off-label usage. It also now replaces &lt;code>NaN&lt;/code> values in double and complex vectors.&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>dplyr 1.1.0: Per-operation grouping</title><link>https://www.tidyverse.org/blog/2023/02/dplyr-1-1-0-per-operation-grouping/</link><pubDate>Wed, 01 Feb 2023 00:00:00 +0000</pubDate><guid>https://www.tidyverse.org/blog/2023/02/dplyr-1-1-0-per-operation-grouping/</guid><description>&lt;p>Today we are going to look at one of the major new features in
&lt;a href="https://dplyr.tidyverse.org/news/index.html#dplyr-110" target="_blank" rel="noopener">dplyr 1.1.0&lt;/a>, per-operation grouping with
&lt;a href="https://dplyr.tidyverse.org/reference/dplyr_by.html" target="_blank" rel="noopener">&lt;code>.by&lt;/code>/&lt;code>by&lt;/code>&lt;/a>. Per-operation grouping is an experimental alternative to
&lt;a href="https://dplyr.tidyverse.org/reference/group_by.html" target="_blank" rel="noopener">&lt;code>group_by()&lt;/code>&lt;/a> which is only active within a single dplyr verb. This is another of the new dplyr features that was inspired by
&lt;a href="https://cran.r-project.org/web/packages/data.table/index.html" target="_blank" rel="noopener">data.table&lt;/a>, this time by their own grouping syntax with &lt;code>by&lt;/code>.&lt;/p>
&lt;p>To see the other blog posts in this series, head
&lt;a href="https://www.tidyverse.org/tags/dplyr-1-1-0/" target="_blank" rel="noopener">here&lt;/a>.&lt;/p>
&lt;p>You can install it from CRAN with:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>&lt;a href='https://rdrr.io/r/utils/install.packages.html'>install.packages&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"dplyr"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='kr'>&lt;a href='https://rdrr.io/r/base/library.html'>library&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>&lt;a href='https://dplyr.tidyverse.org'>dplyr&lt;/a>&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;h2 id="persistent-grouping-with-group_by">Persistent grouping with &lt;code>group_by()&lt;/code>
&lt;a href="#persistent-grouping-with-group_by">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>In dplyr, grouping radically affects the computation of the verb that you use it with. Since the very beginning of dplyr, you&amp;rsquo;ve been able to perform grouped operations by modifying your data frame with
&lt;a href="https://dplyr.tidyverse.org/reference/group_by.html" target="_blank" rel="noopener">&lt;code>group_by()&lt;/code>&lt;/a>. This grouping is &lt;em>persistent&lt;/em>, meaning that it typically sticks around in some form for more than one operation. As an example, take a look at this &lt;code>transactions&lt;/code> dataset which tracks revenue brought in from various transactions across multiple companies. If we wanted to add a column for the total yearly revenue per company, we might do:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>transactions&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> company &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"A"&lt;/span>, &lt;span class='s'>"A"&lt;/span>, &lt;span class='s'>"A"&lt;/span>, &lt;span class='s'>"B"&lt;/span>, &lt;span class='s'>"B"&lt;/span>, &lt;span class='s'>"B"&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> year &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>2019&lt;/span>, &lt;span class='m'>2019&lt;/span>, &lt;span class='m'>2020&lt;/span>, &lt;span class='m'>2021&lt;/span>, &lt;span class='m'>2023&lt;/span>, &lt;span class='m'>2023&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> revenue &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>20&lt;/span>, &lt;span class='m'>50&lt;/span>, &lt;span class='m'>4&lt;/span>, &lt;span class='m'>10&lt;/span>, &lt;span class='m'>12&lt;/span>, &lt;span class='m'>18&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>transactions&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 6 × 3&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; company year revenue&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>019 20&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>019 50&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>020 4&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>021 10&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>5&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>023 12&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>6&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>023 18&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>transactions&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>company&lt;/span>, &lt;span class='nv'>year&lt;/span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>total &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/sum.html'>sum&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>revenue&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 6 × 4&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># Groups: company, year [4]&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; company year revenue total&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>019 20 70&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>019 50 70&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>020 4 4&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>021 10 10&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>5&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>023 12 30&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>6&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>023 18 30&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>Notice that the result is still grouped by both &lt;code>company&lt;/code> and &lt;code>year&lt;/code>. This is useful if you need to follow up with additional grouped operations (with the exact same grouping columns), but many people follow this
&lt;a href="https://dplyr.tidyverse.org/reference/mutate.html" target="_blank" rel="noopener">&lt;code>mutate()&lt;/code>&lt;/a> with an
&lt;a href="https://dplyr.tidyverse.org/reference/group_by.html" target="_blank" rel="noopener">&lt;code>ungroup()&lt;/code>&lt;/a>.&lt;/p>
&lt;p>If we only need the totals, we could also use
&lt;a href="https://dplyr.tidyverse.org/reference/summarise.html" target="_blank" rel="noopener">&lt;code>summarise()&lt;/code>&lt;/a>, which peels off 1 layer of grouping by default:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>transactions&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>company&lt;/span>, &lt;span class='nv'>year&lt;/span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>total &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/sum.html'>sum&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>revenue&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; `summarise()` has grouped output by 'company'. You can override using the&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; `.groups` argument.&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 4 × 3&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># Groups: company [2]&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; company year total&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>019 70&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>020 4&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>021 10&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>023 30&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>Here the grouping of the output isn&amp;rsquo;t exactly the same as the input, but we still consider this persistent grouping because some of the groups outlive the verb they were used with.&lt;/p>
&lt;h2 id="per-operation-grouping-with-byby">Per-operation grouping with &lt;code>.by&lt;/code>/&lt;code>by&lt;/code>
&lt;a href="#per-operation-grouping-with-byby">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>In dplyr 1.1.0, we&amp;rsquo;ve added an alternative to
&lt;a href="https://dplyr.tidyverse.org/reference/group_by.html" target="_blank" rel="noopener">&lt;code>group_by()&lt;/code>&lt;/a> known as
&lt;a href="https://dplyr.tidyverse.org/reference/dplyr_by.html" target="_blank" rel="noopener">&lt;code>.by&lt;/code>&lt;/a> that introduces the idea of &lt;em>per-operation&lt;/em> grouping:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>transactions&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>total &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/sum.html'>sum&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>revenue&lt;/span>&lt;span class='o'>)&lt;/span>, .by &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>company&lt;/span>, &lt;span class='nv'>year&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 6 × 4&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; company year revenue total&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>019 20 70&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>019 50 70&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>020 4 4&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>021 10 10&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>5&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>023 12 30&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>6&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>023 18 30&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>transactions&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>total &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/sum.html'>sum&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>revenue&lt;/span>&lt;span class='o'>)&lt;/span>, .by &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>company&lt;/span>, &lt;span class='nv'>year&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 4 × 3&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; company year total&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>019 70&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>020 4&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>021 10&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>023 30&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>There are a few things about &lt;code>.by&lt;/code> worth noting:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>The result is always ungrouped, regardless of the number of grouping columns. With &lt;code>.by&lt;/code>, you never need to remember to call
&lt;a href="https://dplyr.tidyverse.org/reference/group_by.html" target="_blank" rel="noopener">&lt;code>ungroup()&lt;/code>&lt;/a>.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>We used
&lt;a href="https://tidyselect.r-lib.org/reference/language.html" target="_blank" rel="noopener">tidyselect&lt;/a> to group by multiple columns.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>
&lt;a href="https://dplyr.tidyverse.org/reference/summarise.html" target="_blank" rel="noopener">&lt;code>summarise()&lt;/code>&lt;/a> didn&amp;rsquo;t emit a message about regrouping.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>One of the things we like about &lt;code>.by&lt;/code> is that it allows you to place the grouping specification alongside the code that uses it, rather than in a separate
&lt;a href="https://dplyr.tidyverse.org/reference/group_by.html" target="_blank" rel="noopener">&lt;code>group_by()&lt;/code>&lt;/a> line. This idea was inspired by data.table&amp;rsquo;s grouping syntax, which looks like:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>transactions&lt;/span>&lt;span class='o'>[&lt;/span>, &lt;span class='nf'>.&lt;/span>&lt;span class='o'>(&lt;/span>total &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/sum.html'>sum&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>revenue&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>, by &lt;span class='o'>=&lt;/span> &lt;span class='nf'>.&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>company&lt;/span>, &lt;span class='nv'>year&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>]&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>To see a complete list of dplyr verbs that support &lt;code>.by&lt;/code>, look
&lt;a href="https://dplyr.tidyverse.org/reference/dplyr_by.html#supported-verbs" target="_blank" rel="noopener">here&lt;/a>.&lt;/p>
&lt;h3 id="by-or-by">&lt;code>.by&lt;/code> or &lt;code>by&lt;/code>?
&lt;a href="#by-or-by">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h3>&lt;p>As you use per-operation grouping in dplyr, you&amp;rsquo;ll likely notice that some verbs use &lt;code>.by&lt;/code> and others use &lt;code>by&lt;/code>, for example:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>transactions&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/slice.html'>slice_max&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>revenue&lt;/span>, n &lt;span class='o'>=&lt;/span> &lt;span class='m'>2&lt;/span>, by &lt;span class='o'>=&lt;/span> &lt;span class='nv'>company&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 4 × 3&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; company year revenue&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>019 50&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>019 20&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>023 18&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>023 12&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>This is a technical difference resulting from the fact that some verbs consistently use a &lt;code>.&lt;/code> prefix for their arguments, and others don&amp;rsquo;t (see our design notes on the
&lt;a href="https://design.tidyverse.org/dots-prefix.html" target="_blank" rel="noopener">dot prefix&lt;/a> for more details). Most dplyr verbs use &lt;code>.by&lt;/code>, and we&amp;rsquo;ve tried to ensure that the cases that are most likely to result in typos instead generate an informative error:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='c'># Uses `by` to be consistent with `n` and `prop`&lt;/span>&lt;/span>
&lt;span>&lt;span class='nv'>transactions&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/slice.html'>slice_max&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>revenue&lt;/span>, n &lt;span class='o'>=&lt;/span> &lt;span class='m'>2&lt;/span>, .by &lt;span class='o'>=&lt;/span> &lt;span class='nv'>company&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #BBBB00; font-weight: bold;'>Error&lt;/span>&lt;span style='font-weight: bold;'> in `slice_max()`:&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #BBBB00;'>!&lt;/span> Can't specify an argument named `.by` in this verb.&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #00BBBB;'>ℹ&lt;/span> Did you mean to use `by` instead?&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;span>&lt;/span>
&lt;span>&lt;span class='c'># Uses `.by` to be consistent with `.preserve`&lt;/span>&lt;/span>
&lt;span>&lt;span class='nv'>transactions&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/slice.html'>slice&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>revenue&lt;/span>, by &lt;span class='o'>=&lt;/span> &lt;span class='nv'>company&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #BBBB00; font-weight: bold;'>Error&lt;/span>&lt;span style='font-weight: bold;'> in `slice()`:&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #BBBB00;'>!&lt;/span> Can't specify an argument named `by` in this verb.&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #00BBBB;'>ℹ&lt;/span> Did you mean to use `.by` instead?&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;h3 id="translating-from-group_by">Translating from &lt;code>group_by()&lt;/code>
&lt;a href="#translating-from-group_by">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h3>&lt;p>You shouldn&amp;rsquo;t feel pressured to translate existing code using
&lt;a href="https://dplyr.tidyverse.org/reference/group_by.html" target="_blank" rel="noopener">&lt;code>group_by()&lt;/code>&lt;/a> to use &lt;code>.by&lt;/code> instead.
&lt;a href="https://dplyr.tidyverse.org/reference/group_by.html" target="_blank" rel="noopener">&lt;code>group_by()&lt;/code>&lt;/a> won&amp;rsquo;t ever disappear, and is not currently being superseded.&lt;/p>
&lt;p>That said, if you do want to start using &lt;code>.by&lt;/code>, there are a few differences from
&lt;a href="https://dplyr.tidyverse.org/reference/group_by.html" target="_blank" rel="noopener">&lt;code>group_by()&lt;/code>&lt;/a> to be aware of.&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>.by&lt;/code> always returns an ungrouped data frame. This is one of the main reasons to use &lt;code>.by&lt;/code>, but is worth keeping in mind if you have existing code that takes advantage of persistent grouping from
&lt;a href="https://dplyr.tidyverse.org/reference/group_by.html" target="_blank" rel="noopener">&lt;code>group_by()&lt;/code>&lt;/a>.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>.by&lt;/code> uses tidy-selection.
&lt;a href="https://dplyr.tidyverse.org/reference/group_by.html" target="_blank" rel="noopener">&lt;code>group_by()&lt;/code>&lt;/a>, on the other hand, works more like
&lt;a href="https://dplyr.tidyverse.org/reference/mutate.html" target="_blank" rel="noopener">&lt;code>mutate()&lt;/code>&lt;/a> in that it allows you to create grouping columns on the fly, i.e. &lt;code>df |&amp;gt; group_by(month = floor_date(date, &amp;quot;month&amp;quot;))&lt;/code>. With &lt;code>.by&lt;/code>, you must create your grouping columns ahead of time. An added benefit of &lt;code>.by&lt;/code>'s usage of tidy-selection is that you can supply an external character vector of grouping variables using &lt;code>.by = all_of(groups_vec)&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>.by&lt;/code> doesn&amp;rsquo;t sort grouping keys.
&lt;a href="https://dplyr.tidyverse.org/reference/group_by.html" target="_blank" rel="noopener">&lt;code>group_by()&lt;/code>&lt;/a> always sorts keys in ascending order, which affects the results of verbs like
&lt;a href="https://dplyr.tidyverse.org/reference/summarise.html" target="_blank" rel="noopener">&lt;code>summarise()&lt;/code>&lt;/a>.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>The last point might seem strange, but consider what happens if we preferred our transactions data in order by descending year so that the most recent transactions are at the top.&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>transactions2&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nv'>transactions&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>company&lt;/span>, &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/desc.html'>desc&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>year&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>transactions2&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 6 × 3&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; company year revenue&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>020 4&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>019 20&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>019 50&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>023 12&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>5&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>023 18&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>6&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>021 10&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='c'># Note that `group_by()` re-ordered&lt;/span>&lt;/span>
&lt;span>&lt;span class='nv'>transactions2&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>company&lt;/span>, &lt;span class='nv'>year&lt;/span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>total &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/sum.html'>sum&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>revenue&lt;/span>&lt;span class='o'>)&lt;/span>, .groups &lt;span class='o'>=&lt;/span> &lt;span class='s'>"drop"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 4 × 3&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; company year total&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>019 70&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>020 4&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>021 10&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>023 30&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;span>&lt;/span>
&lt;span>&lt;span class='c'># But `.by` used whatever order was already there&lt;/span>&lt;/span>
&lt;span>&lt;span class='nv'>transactions2&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>total &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/sum.html'>sum&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>revenue&lt;/span>&lt;span class='o'>)&lt;/span>, .by &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>company&lt;/span>, &lt;span class='nv'>year&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 4 × 3&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; company year total&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>020 4&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>019 70&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>023 30&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>021 10&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>Notice that &lt;code>.by&lt;/code> doesn&amp;rsquo;t re-sort the grouping keys. Instead, the previous call to
&lt;a href="https://dplyr.tidyverse.org/reference/arrange.html" target="_blank" rel="noopener">&lt;code>arrange()&lt;/code>&lt;/a> is &amp;ldquo;respected&amp;rdquo; in the summary (this is also useful in combination with the new &lt;code>.locale&lt;/code> argument to
&lt;a href="https://dplyr.tidyverse.org/reference/arrange.html" target="_blank" rel="noopener">&lt;code>arrange()&lt;/code>&lt;/a>).&lt;/p>
&lt;p>We expect that most code won&amp;rsquo;t depend on the ordering of these group keys, but it is worth keeping in mind if you are switching to &lt;code>.by&lt;/code>. If you did rely on sorted group keys, you currently need to explicitly call
&lt;a href="https://dplyr.tidyverse.org/reference/arrange.html" target="_blank" rel="noopener">&lt;code>arrange()&lt;/code>&lt;/a> either before or after the call to &lt;code>summarise(.by =)&lt;/code>. In a future release, we may add
&lt;a href="https://github.com/tidyverse/dplyr/issues/6663" target="_blank" rel="noopener">an argument&lt;/a> to control this.&lt;/p>
&lt;h2 id="nestby--">&lt;code>nest(.by = )&lt;/code>
&lt;a href="#nestby--">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='kr'>&lt;a href='https://rdrr.io/r/base/library.html'>library&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>&lt;a href='https://tidyr.tidyverse.org'>tidyr&lt;/a>&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>The idea behind &lt;code>.by&lt;/code> turns out to be useful in contexts outside of dplyr. In
&lt;a href="https://www.tidyverse.org/blog/2023/01/tidyr-1-3-0/#nestby" target="_blank" rel="noopener">tidyr 1.3.0&lt;/a>,
&lt;a href="https://tidyr.tidyverse.org/reference/nest.html" target="_blank" rel="noopener">&lt;code>nest()&lt;/code>&lt;/a> gained a &lt;code>.by&lt;/code> argument, allowing you to specify the columns you want to nest &lt;em>by&lt;/em> rather than the columns that appear in the nested results, which often makes for more natural calls to
&lt;a href="https://tidyr.tidyverse.org/reference/nest.html" target="_blank" rel="noopener">&lt;code>nest()&lt;/code>&lt;/a>.&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='c'># Specify what to nest by&lt;/span>&lt;/span>
&lt;span>&lt;span class='nv'>transactions&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://tidyr.tidyverse.org/reference/nest.html'>nest&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>.by &lt;span class='o'>=&lt;/span> &lt;span class='nv'>company&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 2 × 2&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; company data &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;list&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> A &lt;span style='color: #555555;'>&amp;lt;tibble [3 × 2]&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> B &lt;span style='color: #555555;'>&amp;lt;tibble [3 × 2]&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;span>&lt;/span>
&lt;span>&lt;span class='c'># Specify what to nest&lt;/span>&lt;/span>
&lt;span>&lt;span class='nv'>transactions&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://tidyr.tidyverse.org/reference/nest.html'>nest&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>data &lt;span class='o'>=&lt;/span> &lt;span class='o'>!&lt;/span>&lt;span class='nv'>company&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 2 × 2&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; company data &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;list&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> A &lt;span style='color: #555555;'>&amp;lt;tibble [3 × 2]&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> B &lt;span style='color: #555555;'>&amp;lt;tibble [3 × 2]&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;span>&lt;/span>
&lt;span>&lt;span class='c'># Specify both, allowing you to drop `year` along the way&lt;/span>&lt;/span>
&lt;span>&lt;span class='nv'>transactions&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://tidyr.tidyverse.org/reference/nest.html'>nest&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>data &lt;span class='o'>=&lt;/span> &lt;span class='nv'>revenue&lt;/span>, .by &lt;span class='o'>=&lt;/span> &lt;span class='nv'>company&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 2 × 2&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; company data &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;list&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> A &lt;span style='color: #555555;'>&amp;lt;tibble [3 × 1]&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> B &lt;span style='color: #555555;'>&amp;lt;tibble [3 × 1]&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>We currently have 3 different nesting variants in the tidyverse:
&lt;a href="https://tidyr.tidyverse.org/reference/nest.html" target="_blank" rel="noopener">&lt;code>tidyr::nest()&lt;/code>&lt;/a>,
&lt;a href="https://dplyr.tidyverse.org/reference/group_nest.html" target="_blank" rel="noopener">&lt;code>dplyr::group_nest()&lt;/code>&lt;/a>, and
&lt;a href="https://dplyr.tidyverse.org/reference/nest_by.html" target="_blank" rel="noopener">&lt;code>dplyr::nest_by()&lt;/code>&lt;/a>. Because the tidyr variant is now the most flexible of all of these, and because
&lt;a href="https://tidyr.tidyverse.org/reference/unnest.html" target="_blank" rel="noopener">&lt;code>unnest()&lt;/code>&lt;/a> also lives in tidyr, we are likely to deprecate the two experimental dplyr options in the future.&lt;/p></description></item><item><title>dplyr 1.1.0: Joins</title><link>https://www.tidyverse.org/blog/2023/01/dplyr-1-1-0-joins/</link><pubDate>Tue, 31 Jan 2023 00:00:00 +0000</pubDate><guid>https://www.tidyverse.org/blog/2023/01/dplyr-1-1-0-joins/</guid><description>&lt;p>
&lt;a href="https://dplyr.tidyverse.org/news/index.html#dplyr-110" target="_blank" rel="noopener">dplyr 1.1.0&lt;/a> is out now! This is a giant release, so we&amp;rsquo;re splitting the release announcement up into four blog posts which we&amp;rsquo;ll post over the course of this week. Today, we&amp;rsquo;re focusing on joins, including the new
&lt;a href="https://dplyr.tidyverse.org/reference/join_by.html" target="_blank" rel="noopener">&lt;code>join_by()&lt;/code>&lt;/a> syntax, new warnings for multiple matches, inequality joins, rolling joins, and new tools for handling unmatched rows. To learn more about joins, you might want to read the updated
&lt;a href="https://r4ds.hadley.nz/joins.html" target="_blank" rel="noopener">joins chapter&lt;/a> in the upcoming 2nd edition of
&lt;a href="https://r4ds.hadley.nz" target="_blank" rel="noopener">R for Data Science&lt;/a>.&lt;/p>
&lt;p>This version of dplyr includes a number of features inspired by our
&lt;a href="https://cran.r-project.org/web/packages/data.table/index.html" target="_blank" rel="noopener">data.table&lt;/a> friends. The inequality and rolling joins we discuss today were popularized in R by data.table, and greatly inspired our own implementation.&lt;/p>
&lt;p>To see the other blog posts in this series, head
&lt;a href="https://www.tidyverse.org/tags/dplyr-1-1-0/" target="_blank" rel="noopener">here&lt;/a>.&lt;/p>
&lt;p>You can install it from CRAN with:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>&lt;a href='https://rdrr.io/r/utils/install.packages.html'>install.packages&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"dplyr"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='kr'>&lt;a href='https://rdrr.io/r/base/library.html'>library&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>&lt;a href='https://dplyr.tidyverse.org'>dplyr&lt;/a>&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;h2 id="join_by">&lt;code>join_by()&lt;/code>
&lt;a href="#join_by">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>Consider the following two tables, &lt;code>transactions&lt;/code> and &lt;code>companies&lt;/code>. &lt;code>transactions&lt;/code> tracks sales across various years for different companies, and &lt;code>companies&lt;/code> connects the short company id to its actual company name - either Patagonia (a fellow B-Corp!) or RStudio.&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>transactions&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> company &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"A"&lt;/span>, &lt;span class='s'>"A"&lt;/span>, &lt;span class='s'>"B"&lt;/span>, &lt;span class='s'>"B"&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> year &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>2019&lt;/span>, &lt;span class='m'>2020&lt;/span>, &lt;span class='m'>2021&lt;/span>, &lt;span class='m'>2023&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> revenue &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>50&lt;/span>, &lt;span class='m'>4&lt;/span>, &lt;span class='m'>10&lt;/span>, &lt;span class='m'>12&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='nv'>transactions&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 4 × 3&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; company year revenue&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>019 50&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>020 4&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>021 10&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>023 12&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>companies&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> id &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"A"&lt;/span>, &lt;span class='s'>"B"&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> name &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"Patagonia"&lt;/span>, &lt;span class='s'>"RStudio"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='nv'>companies&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 2 × 2&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; id name &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> A Patagonia&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> B RStudio&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>To join these two tables together, we might use an inner join:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>transactions&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span> &lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>inner_join&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>companies&lt;/span>, by &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>company &lt;span class='o'>=&lt;/span> &lt;span class='s'>"id"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 4 × 4&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; company year revenue name &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>019 50 Patagonia&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>020 4 Patagonia&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>021 10 RStudio &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>023 12 RStudio&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>This works great, but has always felt a little clunky. Specifying &lt;code>c(company = &amp;quot;id&amp;quot;)&lt;/code> is a little awkward because it uses &lt;code>=&lt;/code>, not &lt;code>==&lt;/code>: here we&amp;rsquo;re asserting that we want &lt;code>company&lt;/code> to equal &lt;code>id&lt;/code>, not naming a function argument or performing assignment. We&amp;rsquo;ve improved on this with a new helper,
&lt;a href="https://dplyr.tidyverse.org/reference/join_by.html" target="_blank" rel="noopener">&lt;code>join_by()&lt;/code>&lt;/a>, which takes expressions in a way that allows you to more naturally express this join:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/join_by.html'>join_by&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>company&lt;/span> &lt;span class='o'>==&lt;/span> &lt;span class='nv'>id&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; Join By:&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; - company == id&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>This &lt;em>join specification&lt;/em> can be used as the &lt;code>by&lt;/code> argument in any of the &lt;code>*_join()&lt;/code> functions:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>transactions&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span> &lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>inner_join&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>companies&lt;/span>, by &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/join_by.html'>join_by&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>company&lt;/span> &lt;span class='o'>==&lt;/span> &lt;span class='nv'>id&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 4 × 4&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; company year revenue name &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>019 50 Patagonia&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>020 4 Patagonia&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>021 10 RStudio &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>023 12 RStudio&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>This small quality of life improvement is just one of the many new features that come with
&lt;a href="https://dplyr.tidyverse.org/reference/join_by.html" target="_blank" rel="noopener">&lt;code>join_by()&lt;/code>&lt;/a>. We&amp;rsquo;ll look at more of these next.&lt;/p>
&lt;h2 id="multiple-matches">Multiple matches
&lt;a href="#multiple-matches">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;hr>
&lt;p>&lt;strong>Update&lt;/strong>: As of March 22, dplyr 1.1.1 is available on CRAN, which alters the behavior of multiple match detection so that you see warnings much less often. Read
&lt;a href="https://www.tidyverse.org/blog/2023/03/dplyr-1-1-1/">all about it&lt;/a> or install it now with &lt;code>install.packages(&amp;quot;dplyr&amp;quot;)&lt;/code>.&lt;/p>
&lt;hr>
&lt;p>To make things a little more interesting, we&amp;rsquo;ll add one more column to &lt;code>companies&lt;/code>, and one more row:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>companies&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> id &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"A"&lt;/span>, &lt;span class='s'>"B"&lt;/span>, &lt;span class='s'>"B"&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> since &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>1973&lt;/span>, &lt;span class='m'>2009&lt;/span>, &lt;span class='m'>2022&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> name &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"Patagonia"&lt;/span>, &lt;span class='s'>"RStudio"&lt;/span>, &lt;span class='s'>"Posit"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>companies&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 3 × 3&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; id since name &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> A &lt;span style='text-decoration: underline;'>1&lt;/span>973 Patagonia&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>009 RStudio &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>022 Posit&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>This table now also tracks name changes that have happened over the course of a company&amp;rsquo;s history. In 2022, we changed our name from RStudio to Posit, so we&amp;rsquo;ve tracked that as an additional row in our dataset. Note that both RStudio and Posit are given an &lt;code>id&lt;/code> of &lt;code>B&lt;/code>, which links back to the &lt;code>transactions&lt;/code> table.&lt;/p>
&lt;p>If we were to join these two tables together, ideally we&amp;rsquo;d bring over the name that was in effect when the transaction took place. For example, for the transaction in 2021, the company was still RStudio, so ideally we&amp;rsquo;d only match up against the RStudio row in &lt;code>companies&lt;/code>. If we colored the expected matches, they&amp;rsquo;d look something like this:&lt;/p>
&lt;p>&lt;img src="img/ideal-join.png" alt="">&lt;/p>
&lt;p>How can we do this? We can try the same join from before, but we won&amp;rsquo;t like the results:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>faulty&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nv'>transactions&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span> &lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>inner_join&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>companies&lt;/span>, by &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/join_by.html'>join_by&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>company&lt;/span> &lt;span class='o'>==&lt;/span> &lt;span class='nv'>id&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; Warning in inner_join(transactions, companies, by = join_by(company == id)): Each row in `x` is expected to match at most 1 row in `y`.&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #00BBBB;'>ℹ&lt;/span> Row 3 of `x` matches multiple rows.&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #00BBBB;'>ℹ&lt;/span> If multiple matches are expected, set `multiple = "all"` to silence this&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; warning.&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>faulty&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 6 × 5&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; company year revenue since name &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>019 50 &lt;span style='text-decoration: underline;'>1&lt;/span>973 Patagonia&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>020 4 &lt;span style='text-decoration: underline;'>1&lt;/span>973 Patagonia&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>021 10 &lt;span style='text-decoration: underline;'>2&lt;/span>009 RStudio &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>021 10 &lt;span style='text-decoration: underline;'>2&lt;/span>022 Posit &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>5&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>023 12 &lt;span style='text-decoration: underline;'>2&lt;/span>009 RStudio &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>6&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>023 12 &lt;span style='text-decoration: underline;'>2&lt;/span>022 Posit&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>Company &lt;code>A&lt;/code> matches correctly, but since we only joined on the company id, we get &lt;em>multiple matches&lt;/em> for each of company &lt;code>B&lt;/code>'s transactions and end up with more rows than we started with. This is a problem, as we were expecting a 1:1 match for each row in &lt;code>transactions&lt;/code>. Multiple matches in equality joins like this one are typically unexpected (even though they are baked in to SQL) so we&amp;rsquo;ve also added a new warning to alert you when this happens. If multiple matches are expected, you can explicitly set &lt;code>multiple = &amp;quot;all&amp;quot;&lt;/code> to silence this warning. This also serves as a code &amp;ldquo;sign post&amp;rdquo; for future readers of your code to let them know that this is a join that is expected to increase the number of rows in the data. If multiple matches &lt;em>aren&amp;rsquo;t&lt;/em> expected, you can also set &lt;code>multiple = &amp;quot;error&amp;quot;&lt;/code> to immediately halt the analysis. We expect this will be useful as a quality control check for production code where you might rerun analyses with new data on a rolling basis.&lt;/p>
&lt;h2 id="inequality-joins">Inequality joins
&lt;a href="#inequality-joins">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>To actually fix this issue, we&amp;rsquo;ll need to expand our join specification to include another condition. Let&amp;rsquo;s zoom in to just 2021:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/filter.html'>filter&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>faulty&lt;/span>, &lt;span class='nv'>company&lt;/span> &lt;span class='o'>==&lt;/span> &lt;span class='s'>"B"&lt;/span>, &lt;span class='nv'>year&lt;/span> &lt;span class='o'>==&lt;/span> &lt;span class='m'>2021&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 2 × 5&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; company year revenue since name &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>021 10 &lt;span style='text-decoration: underline;'>2&lt;/span>009 RStudio&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>021 10 &lt;span style='text-decoration: underline;'>2&lt;/span>022 Posit&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>We want to retain the match with RStudio, but not with Posit (because the name hasn&amp;rsquo;t changed yet). One way to express this is by using the &lt;code>year&lt;/code> and &lt;code>since&lt;/code> columns to state that you only want a match if the transaction &lt;code>year&lt;/code> occurred &lt;em>after&lt;/em> a name change:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='c'># `year[i] &amp;gt;= since`?&lt;/span>&lt;/span>
&lt;span>&lt;span class='m'>2021&lt;/span> &lt;span class='o'>&amp;gt;=&lt;/span> &lt;span class='m'>2009&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; [1] TRUE&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;span>&lt;span class='m'>2021&lt;/span> &lt;span class='o'>&amp;gt;=&lt;/span> &lt;span class='m'>2022&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; [1] FALSE&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>Because
&lt;a href="https://dplyr.tidyverse.org/reference/join_by.html" target="_blank" rel="noopener">&lt;code>join_by()&lt;/code>&lt;/a> accepts expressions, we can express this inequality directly inside the join specification:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/join_by.html'>join_by&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>company&lt;/span> &lt;span class='o'>==&lt;/span> &lt;span class='nv'>id&lt;/span>, &lt;span class='nv'>year&lt;/span> &lt;span class='o'>&amp;gt;=&lt;/span> &lt;span class='nv'>since&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; Join By:&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; - company == id&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; - year &amp;gt;= since&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>transactions&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>inner_join&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>companies&lt;/span>, &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/join_by.html'>join_by&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>company&lt;/span> &lt;span class='o'>==&lt;/span> &lt;span class='nv'>id&lt;/span>, &lt;span class='nv'>year&lt;/span> &lt;span class='o'>&amp;gt;=&lt;/span> &lt;span class='nv'>since&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 5 × 5&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; company year revenue since name &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>019 50 &lt;span style='text-decoration: underline;'>1&lt;/span>973 Patagonia&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>020 4 &lt;span style='text-decoration: underline;'>1&lt;/span>973 Patagonia&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>021 10 &lt;span style='text-decoration: underline;'>2&lt;/span>009 RStudio &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>023 12 &lt;span style='text-decoration: underline;'>2&lt;/span>009 RStudio &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>5&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>023 12 &lt;span style='text-decoration: underline;'>2&lt;/span>022 Posit&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>This eliminated the 2021 match to Posit, as expected! This type of join is known as an &lt;em>inequality join&lt;/em>, i.e. it involves at least one join expression containing one of the following inequality conditions: &lt;code>&amp;gt;=&lt;/code>, &lt;code>&amp;gt;&lt;/code>, &lt;code>&amp;lt;=&lt;/code>, or &lt;code>&amp;lt;&lt;/code>.&lt;/p>
&lt;p>However, we still have 2 matches corresponding to the 2023 year. In this case, we only wanted the match to Posit. We can understand why we are still getting multiple matches here by running the same row-by-row analysis as before:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='c'># `year[i] &amp;gt;= since`? Both are true!&lt;/span>&lt;/span>
&lt;span>&lt;span class='m'>2023&lt;/span> &lt;span class='o'>&amp;gt;=&lt;/span> &lt;span class='m'>2009&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; [1] TRUE&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;span>&lt;span class='m'>2023&lt;/span> &lt;span class='o'>&amp;gt;=&lt;/span> &lt;span class='m'>2022&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; [1] TRUE&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>To remove the last problematic match of the 2023 transaction to the RStudio name, we&amp;rsquo;ll need to refine our join specification one more time.&lt;/p>
&lt;h2 id="rolling-joins">Rolling joins
&lt;a href="#rolling-joins">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>Inequality conditions like &lt;code>year &amp;gt;= since&lt;/code> are powerful, but since the condition is only bounded on one side it is common for them to return a large number of matches. Since multiple matches are the typical case with inequality joins, we don&amp;rsquo;t get a warning like with the equality join, but we clearly still haven&amp;rsquo;t gotten the join right. As a reminder, here are where we still have too many matches:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>transactions&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>inner_join&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>companies&lt;/span>, &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/join_by.html'>join_by&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>company&lt;/span> &lt;span class='o'>==&lt;/span> &lt;span class='nv'>id&lt;/span>, &lt;span class='nv'>year&lt;/span> &lt;span class='o'>&amp;gt;=&lt;/span> &lt;span class='nv'>since&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/filter.html'>filter&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>company&lt;/span> &lt;span class='o'>==&lt;/span> &lt;span class='s'>"B"&lt;/span>, &lt;span class='nv'>year&lt;/span> &lt;span class='o'>==&lt;/span> &lt;span class='m'>2023&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 2 × 5&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; company year revenue since name &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>023 12 &lt;span style='text-decoration: underline;'>2&lt;/span>009 RStudio&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>023 12 &lt;span style='text-decoration: underline;'>2&lt;/span>022 Posit&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>We need a way to filter down the matches returned from &lt;code>year &amp;gt;= since&lt;/code> to only the most recent name change. In other words, we prefer the Posit match over the RStudio match because 2022 is &lt;em>closer&lt;/em> to the transaction year of 2023 than 2009 is. We can express this in
&lt;a href="https://dplyr.tidyverse.org/reference/join_by.html" target="_blank" rel="noopener">&lt;code>join_by()&lt;/code>&lt;/a> by using a helper named &lt;code>closest()&lt;/code>.&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>transactions&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>inner_join&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>companies&lt;/span>, &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/join_by.html'>join_by&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>company&lt;/span> &lt;span class='o'>==&lt;/span> &lt;span class='nv'>id&lt;/span>, &lt;span class='nf'>closest&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>year&lt;/span> &lt;span class='o'>&amp;gt;=&lt;/span> &lt;span class='nv'>since&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 4 × 5&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; company year revenue since name &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>019 50 &lt;span style='text-decoration: underline;'>1&lt;/span>973 Patagonia&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>020 4 &lt;span style='text-decoration: underline;'>1&lt;/span>973 Patagonia&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>021 10 &lt;span style='text-decoration: underline;'>2&lt;/span>009 RStudio &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>023 12 &lt;span style='text-decoration: underline;'>2&lt;/span>022 Posit&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>&lt;code>closest(year &amp;gt;= since)&lt;/code> finds all of the matches in &lt;code>since&lt;/code> for a particular &lt;code>year&lt;/code>, and then filters them down to only the closest match to that &lt;code>year&lt;/code>. This is known as a &lt;em>rolling join&lt;/em>, because in this case it &lt;em>rolls&lt;/em> the most recent name change forward to match up with the transaction. Rolling joins were popularized by data.table, and are related to &lt;code>ASOF&lt;/code> joins supported by some SQL flavors.&lt;/p>
&lt;p>There is a third new class of joins supported by
&lt;a href="https://dplyr.tidyverse.org/reference/join_by.html" target="_blank" rel="noopener">&lt;code>join_by()&lt;/code>&lt;/a> that we won&amp;rsquo;t discuss today known as &lt;em>overlap joins&lt;/em>. These are particularly useful in time series where you are looking for cases where a date or range of dates from one table &lt;em>overlaps&lt;/em> a range of dates in another table. There are three helpers for overlap joins:
&lt;a href="https://dplyr.tidyverse.org/reference/join_by.html#overlap-joins" target="_blank" rel="noopener">&lt;code>between()&lt;/code>&lt;/a>,
&lt;a href="https://dplyr.tidyverse.org/reference/join_by.html#overlap-joins" target="_blank" rel="noopener">&lt;code>overlaps()&lt;/code>&lt;/a>, and
&lt;a href="https://dplyr.tidyverse.org/reference/join_by.html#overlap-joins" target="_blank" rel="noopener">&lt;code>within()&lt;/code>&lt;/a>, which you can read more about
&lt;a href="https://dplyr.tidyverse.org/reference/join_by.html#overlap-joins" target="_blank" rel="noopener">in the documentation&lt;/a>.&lt;/p>
&lt;h2 id="unmatched-rows">Unmatched rows
&lt;a href="#unmatched-rows">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>I mentioned earlier that we expected a 1:1 match between &lt;code>transactions&lt;/code> and &lt;code>companies&lt;/code>. We saw that &lt;code>multiple&lt;/code> can help protect us from having too many matches, but what about not having enough? Consider what happens if we add a new company to &lt;code>transactions&lt;/code> without a corresponding match in &lt;code>companies&lt;/code>.&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>transactions&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nv'>transactions&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>tibble&lt;/span>&lt;span class='nf'>::&lt;/span>&lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/add_row.html'>add_row&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>company &lt;span class='o'>=&lt;/span> &lt;span class='s'>"C"&lt;/span>, year &lt;span class='o'>=&lt;/span> &lt;span class='m'>2023&lt;/span>, revenue &lt;span class='o'>=&lt;/span> &lt;span class='m'>15&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>transactions&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 5 × 3&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; company year revenue&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>019 50&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>020 4&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>021 10&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>023 12&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>5&lt;/span> C &lt;span style='text-decoration: underline;'>2&lt;/span>023 15&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>transactions&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>inner_join&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> &lt;span class='nv'>companies&lt;/span>, &lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/join_by.html'>join_by&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>company&lt;/span> &lt;span class='o'>==&lt;/span> &lt;span class='nv'>id&lt;/span>, &lt;span class='nf'>closest&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>year&lt;/span> &lt;span class='o'>&amp;gt;=&lt;/span> &lt;span class='nv'>since&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span> &lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 4 × 5&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; company year revenue since name &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>019 50 &lt;span style='text-decoration: underline;'>1&lt;/span>973 Patagonia&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>020 4 &lt;span style='text-decoration: underline;'>1&lt;/span>973 Patagonia&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>021 10 &lt;span style='text-decoration: underline;'>2&lt;/span>009 RStudio &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>023 12 &lt;span style='text-decoration: underline;'>2&lt;/span>022 Posit&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>We&amp;rsquo;ve accidentally lost the &lt;code>C&lt;/code> row! If you don&amp;rsquo;t expect any unmatched rows, you can now catch this problem automatically by using our other new quality control argument, &lt;code>unmatched&lt;/code>:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>transactions&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>inner_join&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> &lt;span class='nv'>companies&lt;/span>, &lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/join_by.html'>join_by&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>company&lt;/span> &lt;span class='o'>==&lt;/span> &lt;span class='nv'>id&lt;/span>, &lt;span class='nf'>closest&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>year&lt;/span> &lt;span class='o'>&amp;gt;=&lt;/span> &lt;span class='nv'>since&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> unmatched &lt;span class='o'>=&lt;/span> &lt;span class='s'>"error"&lt;/span>&lt;/span>
&lt;span> &lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #BBBB00; font-weight: bold;'>Error&lt;/span>&lt;span style='font-weight: bold;'> in `inner_join()`:&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #BBBB00;'>!&lt;/span> Each row of `x` must have a match in `y`.&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #00BBBB;'>ℹ&lt;/span> Row 5 of `x` does not have a match.&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>If you&amp;rsquo;ve been questioning why I&amp;rsquo;ve been using an
&lt;a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" target="_blank" rel="noopener">&lt;code>inner_join()&lt;/code>&lt;/a> over a
&lt;a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" target="_blank" rel="noopener">&lt;code>left_join()&lt;/code>&lt;/a> this whole time, &lt;code>unmatched&lt;/code> is why. We could use a
&lt;a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" target="_blank" rel="noopener">&lt;code>left_join()&lt;/code>&lt;/a>:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>transactions&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> &lt;span class='nv'>companies&lt;/span>, &lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/join_by.html'>join_by&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>company&lt;/span> &lt;span class='o'>==&lt;/span> &lt;span class='nv'>id&lt;/span>, &lt;span class='nf'>closest&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>year&lt;/span> &lt;span class='o'>&amp;gt;=&lt;/span> &lt;span class='nv'>since&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> unmatched &lt;span class='o'>=&lt;/span> &lt;span class='s'>"error"&lt;/span>&lt;/span>
&lt;span> &lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 5 × 5&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; company year revenue since name &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>019 50 &lt;span style='text-decoration: underline;'>1&lt;/span>973 Patagonia&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> A &lt;span style='text-decoration: underline;'>2&lt;/span>020 4 &lt;span style='text-decoration: underline;'>1&lt;/span>973 Patagonia&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>021 10 &lt;span style='text-decoration: underline;'>2&lt;/span>009 RStudio &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> B &lt;span style='text-decoration: underline;'>2&lt;/span>023 12 &lt;span style='text-decoration: underline;'>2&lt;/span>022 Posit &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>5&lt;/span> C &lt;span style='text-decoration: underline;'>2&lt;/span>023 15 &lt;span style='color: #BB0000;'>NA&lt;/span> &lt;span style='color: #BB0000;'>NA&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>But you&amp;rsquo;ll notice that we don&amp;rsquo;t get an error here. &lt;code>unmatched&lt;/code> will only error if the input that has the potential to drop rows has an unmatched row. The reason you&amp;rsquo;d use a
&lt;a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" target="_blank" rel="noopener">&lt;code>left_join()&lt;/code>&lt;/a> is to ensure that rows from &lt;code>x&lt;/code> are always retained, so it wouldn&amp;rsquo;t make sense to error when rows from &lt;code>x&lt;/code> are also unmatched. If &lt;code>y&lt;/code> had unmatched rows instead, &lt;em>then&lt;/em> it would have errored because those rows would otherwise be lost from the join. In an
&lt;a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" target="_blank" rel="noopener">&lt;code>inner_join()&lt;/code>&lt;/a>, both inputs can potentially drop rows, so &lt;code>unmatched = &amp;quot;error&amp;quot;&lt;/code> checks for unmatched rows in both inputs.&lt;/p></description></item><item><title>dplyr 1.1.0 is coming soon</title><link>https://www.tidyverse.org/blog/2022/11/dplyr-1-1-0-is-coming-soon/</link><pubDate>Mon, 28 Nov 2022 00:00:00 +0000</pubDate><guid>https://www.tidyverse.org/blog/2022/11/dplyr-1-1-0-is-coming-soon/</guid><description>&lt;p>
&lt;a href="https://dplyr.tidyverse.org/dev/" target="_blank" rel="noopener">dplyr&lt;/a> 1.1.0 is coming soon! We haven&amp;rsquo;t started the official release process yet (where we inform maintainers), but that will start in the next few weeks, and then dplyr 1.1.0 is likely to be submitted to CRAN in late January 2023.&lt;/p>
&lt;p>This is an exciting release for dplyr, incorporating a number of features that have been in flight for years, including:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>An inline alternative to
&lt;a href="https://dplyr.tidyverse.org/reference/group_by.html" target="_blank" rel="noopener">&lt;code>group_by()&lt;/code>&lt;/a> that implements temporary grouping&lt;/p>
&lt;/li>
&lt;li>
&lt;p>New join types, such as non-equi joins&lt;/p>
&lt;/li>
&lt;li>
&lt;p>
&lt;a href="https://dplyr.tidyverse.org/reference/arrange.html" target="_blank" rel="noopener">&lt;code>arrange()&lt;/code>&lt;/a> improvements with character vectors&lt;/p>
&lt;/li>
&lt;li>
&lt;p>
&lt;a href="https://dplyr.tidyverse.org/reference/reframe.html" target="_blank" rel="noopener">&lt;code>reframe()&lt;/code>&lt;/a>, a generalization of
&lt;a href="https://dplyr.tidyverse.org/reference/summarise.html" target="_blank" rel="noopener">&lt;code>summarise()&lt;/code>&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>This pre-release blog post will discuss these new features in more detail. By releasing this post before 1.1.0 is sent to CRAN, we&amp;rsquo;re hoping to get your feedback to catch any potential problems that we&amp;rsquo;ve missed! If you do find a bug, or have general feedback about the new features, we welcome discussion on the
&lt;a href="https://github.com/tidyverse/dplyr/issues" target="_blank" rel="noopener">dplyr issues page&lt;/a>.&lt;/p>
&lt;p>You can see a full list of changes in the
&lt;a href="https://dplyr.tidyverse.org/dev/news/index.html" target="_blank" rel="noopener">release notes&lt;/a>. There are many additional improvements that couldn&amp;rsquo;t fit in a single blog post!&lt;/p>
&lt;p>dplyr 1.1.0 is not on CRAN yet, but you can install the development version from GitHub with:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>pak&lt;/span>&lt;span class='nf'>::&lt;/span>&lt;span class='nf'>&lt;a href='http://pak.r-lib.org/reference/pak.html'>pak&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"tidyverse/dplyr"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>The development version is mostly stable, but is still subject to minor changes before the official release. We don&amp;rsquo;t encourage relying on it for production usage, but we would love for you to try out these new features.&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='kr'>&lt;a href='https://rdrr.io/r/base/library.html'>library&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>&lt;a href='https://dplyr.tidyverse.org'>dplyr&lt;/a>&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='kr'>&lt;a href='https://rdrr.io/r/base/library.html'>library&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>&lt;a href='https://clock.r-lib.org'>clock&lt;/a>&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/Random.html'>set.seed&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>12345&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;h2 id="temporary-grouping-with-by">Temporary grouping with &lt;code>.by&lt;/code>
&lt;a href="#temporary-grouping-with-by">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>Verbs that work &amp;ldquo;by group,&amp;rdquo; such as
&lt;a href="https://dplyr.tidyverse.org/reference/mutate.html" target="_blank" rel="noopener">&lt;code>mutate()&lt;/code>&lt;/a>,
&lt;a href="https://dplyr.tidyverse.org/reference/summarise.html" target="_blank" rel="noopener">&lt;code>summarise()&lt;/code>&lt;/a>,
&lt;a href="https://dplyr.tidyverse.org/reference/filter.html" target="_blank" rel="noopener">&lt;code>filter()&lt;/code>&lt;/a>, and
&lt;a href="https://dplyr.tidyverse.org/reference/slice.html" target="_blank" rel="noopener">&lt;code>slice()&lt;/code>&lt;/a>, have gained an experimental new argument, &lt;code>.by&lt;/code>, which allows for inline and temporary grouping. Grouping radically affects the computation of the dplyr verb you use it with, and one of the goals of &lt;code>.by&lt;/code> is to allow you to place that grouping specification alongside the code that actually uses it. As an added benefit, with &lt;code>.by&lt;/code> you no longer need to remember to
&lt;a href="https://dplyr.tidyverse.org/reference/group_by.html" target="_blank" rel="noopener">&lt;code>ungroup()&lt;/code>&lt;/a> after
&lt;a href="https://dplyr.tidyverse.org/reference/summarise.html" target="_blank" rel="noopener">&lt;code>summarise()&lt;/code>&lt;/a>, and
&lt;a href="https://dplyr.tidyverse.org/reference/summarise.html" target="_blank" rel="noopener">&lt;code>summarise()&lt;/code>&lt;/a> won&amp;rsquo;t ever message you about how it&amp;rsquo;s handling the groups!&lt;/p>
&lt;p>This feature was inspired by
&lt;a href="https://cran.r-project.org/package=data.table" target="_blank" rel="noopener">data.table&lt;/a>, which has always used per-operation grouping.&lt;/p>
&lt;p>We&amp;rsquo;ll explore &lt;code>.by&lt;/code> with this &lt;code>expenses&lt;/code> dataset, containing various &lt;code>cost&lt;/code>s tracked across &lt;code>id&lt;/code> and &lt;code>region&lt;/code>.&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>expenses&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> id &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>1&lt;/span>, &lt;span class='m'>2&lt;/span>, &lt;span class='m'>1&lt;/span>, &lt;span class='m'>3&lt;/span>, &lt;span class='m'>1&lt;/span>, &lt;span class='m'>2&lt;/span>, &lt;span class='m'>3&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> region &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"A"&lt;/span>, &lt;span class='s'>"A"&lt;/span>, &lt;span class='s'>"A"&lt;/span>, &lt;span class='s'>"B"&lt;/span>, &lt;span class='s'>"B"&lt;/span>, &lt;span class='s'>"A"&lt;/span>, &lt;span class='s'>"A"&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> cost &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>25&lt;/span>, &lt;span class='m'>20&lt;/span>, &lt;span class='m'>19&lt;/span>, &lt;span class='m'>12&lt;/span>, &lt;span class='m'>9&lt;/span>, &lt;span class='m'>6&lt;/span>, &lt;span class='m'>6&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='nv'>expenses&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 7 × 3&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; id region cost&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 1 A 25&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 2 A 20&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> 1 A 19&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> 3 B 12&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>5&lt;/span> 1 B 9&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>6&lt;/span> 2 A 6&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>7&lt;/span> 3 A 6&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>If I were to ask you to compute the average &lt;code>cost&lt;/code> per &lt;code>region&lt;/code>, you&amp;rsquo;d probably write something like:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>expenses&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>region&lt;/span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>cost &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/mean.html'>mean&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>cost&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 2 × 2&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; region cost&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> A 15.2&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> B 10.5&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>With &lt;code>.by&lt;/code>, you can now write:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>expenses&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>cost &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/mean.html'>mean&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>cost&lt;/span>&lt;span class='o'>)&lt;/span>, .by &lt;span class='o'>=&lt;/span> &lt;span class='nv'>region&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 2 × 2&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; region cost&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> A 15.2&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> B 10.5&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>These two particular results look the same, but the behavior of &lt;code>.by&lt;/code> diverges from
&lt;a href="https://dplyr.tidyverse.org/reference/group_by.html" target="_blank" rel="noopener">&lt;code>group_by()&lt;/code>&lt;/a> when multiple group columns are involved:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>expenses&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>id&lt;/span>, &lt;span class='nv'>region&lt;/span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>cost &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/mean.html'>mean&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>cost&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; `summarise()` has grouped output by 'id'. You can override using the `.groups`&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; argument.&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 5 × 3&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># Groups: id [3]&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; id region cost&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 1 A 22&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 1 B 9&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> 2 A 13&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> 3 A 6&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>5&lt;/span> 3 B 12&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>expenses&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>cost &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/mean.html'>mean&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>cost&lt;/span>&lt;span class='o'>)&lt;/span>, .by &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>id&lt;/span>, &lt;span class='nv'>region&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 5 × 3&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; id region cost&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 1 A 22&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 2 A 13&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> 3 B 12&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> 1 B 9&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>5&lt;/span> 3 A 6&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>Usage of &lt;code>.by&lt;/code> always results in an ungrouped data frame, regardless of the number of group columns involved.&lt;/p>
&lt;p>You might also recognize that these results aren&amp;rsquo;t returned in exactly the same order.
&lt;a href="https://dplyr.tidyverse.org/reference/group_by.html" target="_blank" rel="noopener">&lt;code>group_by()&lt;/code>&lt;/a> always sorts the grouping keys in ascending order, but &lt;code>.by&lt;/code> retains the original ordering found in the data. If you need ordered summaries with &lt;code>.by&lt;/code>, we recommend calling
&lt;a href="https://dplyr.tidyverse.org/reference/arrange.html" target="_blank" rel="noopener">&lt;code>arrange()&lt;/code>&lt;/a> explicitly before or after summarizing.&lt;/p>
&lt;p>While here we&amp;rsquo;ve focused on using &lt;code>.by&lt;/code> with
&lt;a href="https://dplyr.tidyverse.org/reference/summarise.html" target="_blank" rel="noopener">&lt;code>summarise()&lt;/code>&lt;/a>, it also works with other verbs, like
&lt;a href="https://dplyr.tidyverse.org/reference/mutate.html" target="_blank" rel="noopener">&lt;code>mutate()&lt;/code>&lt;/a> and
&lt;a href="https://dplyr.tidyverse.org/reference/slice.html" target="_blank" rel="noopener">&lt;code>slice()&lt;/code>&lt;/a>:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>expenses&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>mean &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/mean.html'>mean&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>cost&lt;/span>&lt;span class='o'>)&lt;/span>, .by &lt;span class='o'>=&lt;/span> &lt;span class='nv'>region&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 7 × 4&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; id region cost mean&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 1 A 25 15.2&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 2 A 20 15.2&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> 1 A 19 15.2&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> 3 B 12 10.5&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>5&lt;/span> 1 B 9 10.5&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>6&lt;/span> 2 A 6 15.2&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>7&lt;/span> 3 A 6 15.2&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>expenses&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/slice.html'>slice&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>2&lt;/span>, .by &lt;span class='o'>=&lt;/span> &lt;span class='nv'>region&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 2 × 3&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; id region cost&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 2 A 20&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 1 B 9&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>
&lt;a href="https://dplyr.tidyverse.org/reference/group_by.html" target="_blank" rel="noopener">&lt;code>group_by()&lt;/code>&lt;/a> won&amp;rsquo;t ever disappear, but we are having a lot of fun writing new code with &lt;code>.by&lt;/code>, and we think you will too.&lt;/p>
&lt;h2 id="join-improvements">Join improvements
&lt;a href="#join-improvements">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>All of the join functions in dplyr, such as
&lt;a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" target="_blank" rel="noopener">&lt;code>left_join()&lt;/code>&lt;/a>, now accept a flexible join specification created through the new
&lt;a href="https://dplyr.tidyverse.org/reference/join_by.html" target="_blank" rel="noopener">&lt;code>join_by()&lt;/code>&lt;/a> helper.
&lt;a href="https://dplyr.tidyverse.org/reference/join_by.html" target="_blank" rel="noopener">&lt;code>join_by()&lt;/code>&lt;/a> allows you to specify your join conditions as expressions rather than as named character vectors.&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/join_by.html'>join_by&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>x_id&lt;/span> &lt;span class='o'>==&lt;/span> &lt;span class='nv'>y_id&lt;/span>, &lt;span class='nv'>region&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; Join By:&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; - x_id == y_id&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; - region&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>This join specification matches &lt;code>x_id&lt;/code> in the left-hand data frame with &lt;code>y_id&lt;/code> in the right-hand one, and also matches between a commonly named &lt;code>region&lt;/code> column, computing the following equi-join:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>df1&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>x_id &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>1&lt;/span>, &lt;span class='m'>2&lt;/span>, &lt;span class='m'>2&lt;/span>&lt;span class='o'>)&lt;/span>, region &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"A"&lt;/span>, &lt;span class='s'>"B"&lt;/span>, &lt;span class='s'>"A"&lt;/span>&lt;span class='o'>)&lt;/span>, x &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>5&lt;/span>, &lt;span class='m'>10&lt;/span>, &lt;span class='m'>4&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='nv'>df2&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>y_id &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>2&lt;/span>, &lt;span class='m'>1&lt;/span>, &lt;span class='m'>2&lt;/span>&lt;span class='o'>)&lt;/span>, region &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"A"&lt;/span>, &lt;span class='s'>"A"&lt;/span>, &lt;span class='s'>"C"&lt;/span>&lt;span class='o'>)&lt;/span>, y &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>12&lt;/span>, &lt;span class='m'>8&lt;/span>, &lt;span class='m'>7&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>df1&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 3 × 3&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; x_id region x&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 1 A 5&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 2 B 10&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> 2 A 4&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>df2&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 3 × 3&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; y_id region y&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 2 A 12&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 1 A 8&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> 2 C 7&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>df1&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>df2&lt;/span>, &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/join_by.html'>join_by&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>x_id&lt;/span> &lt;span class='o'>==&lt;/span> &lt;span class='nv'>y_id&lt;/span>, &lt;span class='nv'>region&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 3 × 4&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; x_id region x y&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 1 A 5 8&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 2 B 10 &lt;span style='color: #BB0000;'>NA&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> 2 A 4 12&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;h3 id="non-equi-joins">Non-equi joins
&lt;a href="#non-equi-joins">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h3>&lt;p>Allowing expressions in
&lt;a href="https://dplyr.tidyverse.org/reference/join_by.html" target="_blank" rel="noopener">&lt;code>join_by()&lt;/code>&lt;/a> opens up a whole new world of joins in dplyr known as &lt;em>non-equi joins&lt;/em>. As the name somewhat implies, these are joins that involve binary conditions other than equality. There are 4 particularly useful types of non-equi joins:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>Cross joins&lt;/strong> match every pair of rows and were already supported in dplyr.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Inequality joins&lt;/strong> match using &lt;code>&amp;gt;&lt;/code>, &lt;code>&amp;gt;=&lt;/code>, &lt;code>&amp;lt;&lt;/code>, or &lt;code>&amp;lt;=&lt;/code> instead of &lt;code>==&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Rolling joins&lt;/strong> are based on inequality joins, but only find the closest match.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Overlap joins&lt;/strong> are also based on inequality joins, but are specialized for working with ranges.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>Non-equi joins were requested back in 2016, and were the highest requested dplyr feature at the time they were finally implemented, with over
&lt;a href="https://github.com/tidyverse/dplyr/issues/2240" target="_blank" rel="noopener">147 thumbs up&lt;/a>! data.table has had support for non-equi joins for many years, and their implementation greatly inspired the one used in dplyr.&lt;/p>
&lt;p>To demonstrate the different types of non-equi joins, imagine that you are in charge of the party planning committee for your office. Unfortunately, you only get to have one party per quarter, but it is your job to ensure that every employee is assigned to a single party. Upper management has provided the following 4 party dates:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>parties&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> q &lt;span class='o'>=&lt;/span> &lt;span class='m'>1&lt;/span>&lt;span class='o'>:&lt;/span>&lt;span class='m'>4&lt;/span>,&lt;/span>
&lt;span> party &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://clock.r-lib.org/reference/date_parse.html'>date_parse&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"2022-01-10"&lt;/span>, &lt;span class='s'>"2022-04-04"&lt;/span>, &lt;span class='s'>"2022-07-11"&lt;/span>, &lt;span class='s'>"2022-10-03"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>parties&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 4 × 2&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; q party &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;int&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;date&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 1 2022-01-10&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 2 2022-04-04&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> 3 2022-07-11&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> 4 2022-10-03&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>With this set of employees:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>employees&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> name &lt;span class='o'>=&lt;/span> &lt;span class='nf'>wakefield&lt;/span>&lt;span class='nf'>::&lt;/span>&lt;span class='nf'>&lt;a href='https://rdrr.io/pkg/wakefield/man/name.html'>name&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>100&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> birthday &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://clock.r-lib.org/reference/date_parse.html'>date_parse&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"2022-01-01"&lt;/span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>+&lt;/span> &lt;span class='o'>(&lt;/span>&lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/sample.html'>sample&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>365&lt;/span>, &lt;span class='m'>100&lt;/span>, replace &lt;span class='o'>=&lt;/span> &lt;span class='kc'>TRUE&lt;/span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>-&lt;/span> &lt;span class='m'>1&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>employees&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 100 × 2&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; name birthday &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;variable&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;date&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 1&lt;/span> Seager 2022-08-26&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 2&lt;/span> Nathion 2022-10-04&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 3&lt;/span> Sametra 2022-06-13&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 4&lt;/span> Netty 2022-05-12&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 5&lt;/span> Yalissa 2022-05-28&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 6&lt;/span> Mirai 2022-08-20&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 7&lt;/span> Toyoko 2022-08-23&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 8&lt;/span> Earlene 2022-04-21&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 9&lt;/span> Abbegayle 2022-01-27&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>10&lt;/span> Valyssa 2022-03-06&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># … with 90 more rows&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>One way to start approaching this problem is to look for the party that happened directly before each birthday. You can do this with an inequality join:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>employees&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>parties&lt;/span>, &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/join_by.html'>join_by&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>birthday&lt;/span> &lt;span class='o'>&amp;gt;=&lt;/span> &lt;span class='nv'>party&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 251 × 4&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; name birthday q party &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;variable&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;date&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;int&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;date&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 1&lt;/span> Seager 2022-08-26 1 2022-01-10&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 2&lt;/span> Seager 2022-08-26 2 2022-04-04&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 3&lt;/span> Seager 2022-08-26 3 2022-07-11&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 4&lt;/span> Nathion 2022-10-04 1 2022-01-10&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 5&lt;/span> Nathion 2022-10-04 2 2022-04-04&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 6&lt;/span> Nathion 2022-10-04 3 2022-07-11&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 7&lt;/span> Nathion 2022-10-04 4 2022-10-03&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 8&lt;/span> Sametra 2022-06-13 1 2022-01-10&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 9&lt;/span> Sametra 2022-06-13 2 2022-04-04&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>10&lt;/span> Netty 2022-05-12 1 2022-01-10&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># … with 241 more rows&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>This looks like a good start, but we&amp;rsquo;ve assigned people with birthdays later in the year to multiple parties. We can restrict this to only the party that is &lt;em>closest&lt;/em> to the employee&amp;rsquo;s birthday by using a rolling join. Rolling joins are activated by wrapping an inequality in &lt;code>closest()&lt;/code>.&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>closest&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nv'>employees&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>parties&lt;/span>, &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/join_by.html'>join_by&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>closest&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>birthday&lt;/span> &lt;span class='o'>&amp;gt;=&lt;/span> &lt;span class='nv'>party&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>closest&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 100 × 4&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; name birthday q party &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;variable&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;date&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;int&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;date&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 1&lt;/span> Seager 2022-08-26 3 2022-07-11&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 2&lt;/span> Nathion 2022-10-04 4 2022-10-03&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 3&lt;/span> Sametra 2022-06-13 2 2022-04-04&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 4&lt;/span> Netty 2022-05-12 2 2022-04-04&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 5&lt;/span> Yalissa 2022-05-28 2 2022-04-04&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 6&lt;/span> Mirai 2022-08-20 3 2022-07-11&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 7&lt;/span> Toyoko 2022-08-23 3 2022-07-11&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 8&lt;/span> Earlene 2022-04-21 2 2022-04-04&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 9&lt;/span> Abbegayle 2022-01-27 1 2022-01-10&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>10&lt;/span> Valyssa 2022-03-06 1 2022-01-10&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># … with 90 more rows&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>This is close to what we want, but isn&amp;rsquo;t &lt;em>quite&lt;/em> right. It turns out that poor Della hasn&amp;rsquo;t been assigned to a party.&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/filter.html'>filter&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>closest&lt;/span>, &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/NA.html'>is.na&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>party&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 1 × 4&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; name birthday q party &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;variable&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;date&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;int&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;date&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> Della 2022-01-06 &lt;span style='color: #BB0000;'>NA&lt;/span> &lt;span style='color: #BB0000;'>NA&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>This is because their birthday occurred before the first party date, &lt;code>2022-01-10&lt;/code>, so there wasn&amp;rsquo;t any &amp;ldquo;previous party&amp;rdquo; to match them to. It&amp;rsquo;s a little easier to fix this if we are explicit about the quarter start/end dates that form the ranges to look for matches in:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='c'># Some helpers from &amp;#123;clock&amp;#125;&lt;/span>&lt;/span>
&lt;span>&lt;span class='nv'>quarter_start&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='kr'>function&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>x&lt;/span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>&amp;#123;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nv'>x&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://clock.r-lib.org/reference/as_year_quarter_day.html'>as_year_quarter_day&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>x&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span> &lt;span class='nv'>x&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://clock.r-lib.org/reference/calendar-boundary.html'>calendar_start&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>x&lt;/span>, &lt;span class='s'>"quarter"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://clock.r-lib.org/reference/as_date.html'>as_date&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>x&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>&amp;#125;&lt;/span>&lt;/span>
&lt;span>&lt;span class='nv'>quarter_end&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='kr'>function&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>x&lt;/span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>&amp;#123;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nv'>x&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://clock.r-lib.org/reference/as_year_quarter_day.html'>as_year_quarter_day&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>x&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span> &lt;span class='nv'>x&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://clock.r-lib.org/reference/calendar-boundary.html'>calendar_end&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>x&lt;/span>, &lt;span class='s'>"quarter"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/as.Date.html'>as.Date&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>x&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>&amp;#125;&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>parties&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nv'>parties&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>start &lt;span class='o'>=&lt;/span> &lt;span class='nf'>quarter_start&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>party&lt;/span>&lt;span class='o'>)&lt;/span>, end &lt;span class='o'>=&lt;/span> &lt;span class='nf'>quarter_end&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>party&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>parties&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 4 × 4&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; q party start end &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;int&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;date&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;date&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;date&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 1 2022-01-10 2022-01-01 2022-03-31&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 2 2022-04-04 2022-04-01 2022-06-30&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> 3 2022-07-11 2022-07-01 2022-09-30&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> 4 2022-10-03 2022-10-01 2022-12-31&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>Now that we have 4 distinct &lt;em>ranges&lt;/em> of dates to work with, we&amp;rsquo;ll use an overlap join to figure out which range each birthday fell
&lt;a href="https://dplyr.tidyverse.org/reference/between.html" target="_blank" rel="noopener">&lt;code>between()&lt;/code>&lt;/a>. Since we know that each birthday should be matched to exactly one party, we&amp;rsquo;ll also take this chance to set &lt;code>multiple&lt;/code>, a new argument to the join functions that allows you to optionally &lt;code>&amp;quot;error&amp;quot;&lt;/code> if a birthday is matched to multiple parties.&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>employees&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> &lt;span class='nv'>parties&lt;/span>, &lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/join_by.html'>join_by&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/between.html'>between&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>birthday&lt;/span>, &lt;span class='nv'>start&lt;/span>, &lt;span class='nv'>end&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> multiple &lt;span class='o'>=&lt;/span> &lt;span class='s'>"error"&lt;/span>&lt;/span>
&lt;span> &lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 100 × 6&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; name birthday q party start end &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;variable&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;date&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;int&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;date&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;date&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;date&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 1&lt;/span> Seager 2022-08-26 3 2022-07-11 2022-07-01 2022-09-30&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 2&lt;/span> Nathion 2022-10-04 4 2022-10-03 2022-10-01 2022-12-31&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 3&lt;/span> Sametra 2022-06-13 2 2022-04-04 2022-04-01 2022-06-30&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 4&lt;/span> Netty 2022-05-12 2 2022-04-04 2022-04-01 2022-06-30&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 5&lt;/span> Yalissa 2022-05-28 2 2022-04-04 2022-04-01 2022-06-30&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 6&lt;/span> Mirai 2022-08-20 3 2022-07-11 2022-07-01 2022-09-30&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 7&lt;/span> Toyoko 2022-08-23 3 2022-07-11 2022-07-01 2022-09-30&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 8&lt;/span> Earlene 2022-04-21 2 2022-04-04 2022-04-01 2022-06-30&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 9&lt;/span> Abbegayle 2022-01-27 1 2022-01-10 2022-01-01 2022-03-31&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>10&lt;/span> Valyssa 2022-03-06 1 2022-01-10 2022-01-01 2022-03-31&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># … with 90 more rows&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>We consider &lt;code>multiple&lt;/code> to be an important &amp;ldquo;quality control&amp;rdquo; argument to help you enforce constraints on the join procedure.&lt;/p>
&lt;h3 id="multiple-matches">Multiple matches
&lt;a href="#multiple-matches">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h3>&lt;p>Speaking of &lt;code>multiple&lt;/code>, we&amp;rsquo;ve also given this argument an important default. When doing data analysis with equi-joins, it is often surprising when a join returns more rows than were present in the left-hand side table.&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>df1&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 3 × 3&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; x_id region x&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 1 A 5&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 2 B 10&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> 2 A 4&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>df2&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>y_id &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>1&lt;/span>, &lt;span class='m'>2&lt;/span>, &lt;span class='m'>1&lt;/span>, &lt;span class='m'>2&lt;/span>&lt;span class='o'>)&lt;/span>, region &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"A"&lt;/span>, &lt;span class='s'>"B"&lt;/span>, &lt;span class='s'>"A"&lt;/span>, &lt;span class='s'>"A"&lt;/span>&lt;span class='o'>)&lt;/span>, y &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>9&lt;/span>, &lt;span class='m'>10&lt;/span>, &lt;span class='m'>12&lt;/span>, &lt;span class='m'>4&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='nv'>df2&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 4 × 3&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; y_id region y&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 1 A 9&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 2 B 10&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> 1 A 12&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> 2 A 4&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>df1&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>df2&lt;/span>, &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/join_by.html'>join_by&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>x_id&lt;/span> &lt;span class='o'>==&lt;/span> &lt;span class='nv'>y_id&lt;/span>, &lt;span class='nv'>region&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; Warning in left_join(df1, df2, join_by(x_id == y_id, region)): Each row in `x` is expected to match at most 1 row in `y`.&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #00BBBB;'>ℹ&lt;/span> Row 1 of `x` matches multiple rows.&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #00BBBB;'>ℹ&lt;/span> If multiple matches are expected, set `multiple = "all"` to silence this&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; warning.&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 4 × 4&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; x_id region x y&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 1 A 5 9&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 1 A 5 12&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> 2 B 10 10&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> 2 A 4 4&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>In this case, row 1 of &lt;code>df1&lt;/code> matched both rows &lt;code>1&lt;/code> and &lt;code>3&lt;/code> of &lt;code>df2&lt;/code>, so the output has 4 rows rather than &lt;code>df1&lt;/code>'s 3. While this is standard SQL behavior, community feedback has shown that many people don&amp;rsquo;t expect this, and a number of people were horrified to learn that this was even possible! Because of this, we&amp;rsquo;ve made this case a warning by default, which you can silence with &lt;code>multiple = &amp;quot;all&amp;quot;&lt;/code>.&lt;/p>
&lt;h2 id="arrange-improvements-with-character-vectors">&lt;code>arrange()&lt;/code> improvements with character vectors
&lt;a href="#arrange-improvements-with-character-vectors">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>
&lt;a href="https://dplyr.tidyverse.org/reference/arrange.html" target="_blank" rel="noopener">&lt;code>arrange()&lt;/code>&lt;/a> now uses a new custom backend for generating the ordering. This generally improves performance, but it is especially apparent with character vectors.&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='c'># 10,000 random strings, sampled up to 1,000,000 rows&lt;/span>&lt;/span>
&lt;span>&lt;span class='nv'>dictionary&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>stringi&lt;/span>&lt;span class='nf'>::&lt;/span>&lt;span class='nf'>&lt;a href='https://rdrr.io/pkg/stringi/man/stri_rand_strings.html'>stri_rand_strings&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>10000&lt;/span>, length &lt;span class='o'>=&lt;/span> &lt;span class='m'>10&lt;/span>, pattern &lt;span class='o'>=&lt;/span> &lt;span class='s'>"[a-z]"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='nv'>str&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>x &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/sample.html'>sample&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>dictionary&lt;/span>, size &lt;span class='o'>=&lt;/span> &lt;span class='m'>1e6&lt;/span>, replace &lt;span class='o'>=&lt;/span> &lt;span class='kc'>TRUE&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='nv'>str&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 1,000,000 × 1&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; x &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 1&lt;/span> btjgpowbav&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 2&lt;/span> jrddujrxwt&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 3&lt;/span> ofgkybvsoo&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 4&lt;/span> dzyxfvwktu&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 5&lt;/span> qobgfmkgof&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 6&lt;/span> rmzjvtnpbf&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 7&lt;/span> jxrqgxouqg&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 8&lt;/span> empcmhnlqq&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 9&lt;/span> nwfgauiurp&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>10&lt;/span> hdswclaxys&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># … with 999,990 more rows&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='c'># dplyr 1.0.10&lt;/span>&lt;/span>
&lt;span>&lt;span class='nf'>bench&lt;/span>&lt;span class='nf'>::&lt;/span>&lt;span class='nf'>&lt;a href='http://bench.r-lib.org/reference/mark.html'>mark&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>str&lt;/span>, &lt;span class='nv'>x&lt;/span>&lt;span class='o'>)&lt;/span>, iterations &lt;span class='o'>=&lt;/span> &lt;span class='m'>100&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; # A tibble: 1 × 6&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; expression min median `itr/sec` mem_alloc `gc/sec`&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &amp;lt;bch:expr&amp;gt; &amp;lt;bch:tm&amp;gt; &amp;lt;bch:tm&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;bch:byt&amp;gt; &amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; 1 arrange(str, x) 4.38s 4.89s 0.204 12.7MB 0.148&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='c'># dplyr 1.1.0&lt;/span>&lt;/span>
&lt;span>&lt;span class='nf'>bench&lt;/span>&lt;span class='nf'>::&lt;/span>&lt;span class='nf'>&lt;a href='http://bench.r-lib.org/reference/mark.html'>mark&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>str&lt;/span>, &lt;span class='nv'>x&lt;/span>&lt;span class='o'>)&lt;/span>, iterations &lt;span class='o'>=&lt;/span> &lt;span class='m'>100&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; # A tibble: 1 × 6&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; expression min median `itr/sec` mem_alloc `gc/sec`&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &amp;lt;bch:expr&amp;gt; &amp;lt;bch:tm&amp;gt; &amp;lt;bch:tm&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;bch:byt&amp;gt; &amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; 1 arrange(str, x) 42.3ms 46.6ms 20.8 22.4MB 46.0&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>For those keeping score, that is a 100x improvement! Now, I&amp;rsquo;ll be honest, I&amp;rsquo;m being a bit tricky here. The new backend for
&lt;a href="https://dplyr.tidyverse.org/reference/arrange.html" target="_blank" rel="noopener">&lt;code>arrange()&lt;/code>&lt;/a> comes with a meaningful change in behavior - it now sorts character strings in the C locale by default, rather than in the much slower system locale (American English, for me). We made this change for two main reasons:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Much faster performance by default, because it can use {vctrs} radix sort (inspired by data.table)&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Improved reproducibility across R sessions, where different computers might use different system locales&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>For English users, we expect this change to have fairly minimal impact. The largest difference in ordering between the C and American English locales has to do with capitalization. In the C locale, uppercase letters are always placed before &lt;em>any&lt;/em> lowercase letters. In the American English locale, uppercase letters are placed directly after their lowercase equivalent.&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>df&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>x &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"a"&lt;/span>, &lt;span class='s'>"B"&lt;/span>, &lt;span class='s'>"A"&lt;/span>, &lt;span class='s'>"b"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>df&lt;/span>, &lt;span class='nv'>x&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 4 × 1&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; x &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> A &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> B &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> a &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> b&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>If you do need to order with a specific locale, you can specify the new &lt;code>.locale&lt;/code> argument, which takes a locale identifier string, just like
&lt;a href="https://stringr.tidyverse.org/reference/str_order.html" target="_blank" rel="noopener">&lt;code>stringr::str_sort()&lt;/code>&lt;/a>.&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>df&lt;/span>, &lt;span class='nv'>x&lt;/span>, .locale &lt;span class='o'>=&lt;/span> &lt;span class='s'>"en"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 4 × 1&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; x &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> a &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> A &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> b &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> B&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>To use this optional &lt;code>.locale&lt;/code> feature, you must have the stringi package installed, but you likely already do because it is installed with the tidyverse by default.&lt;/p>
&lt;p>It is also worth noting that using &lt;code>.locale&lt;/code> is still much faster than relying on the system locale.&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='c'># Compare with ~5 seconds above with dplyr 1.0.10&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nf'>bench&lt;/span>&lt;span class='nf'>::&lt;/span>&lt;span class='nf'>&lt;a href='http://bench.r-lib.org/reference/mark.html'>mark&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>str&lt;/span>, &lt;span class='nv'>x&lt;/span>, .locale &lt;span class='o'>=&lt;/span> &lt;span class='s'>"en"&lt;/span>&lt;span class='o'>)&lt;/span>, iterations &lt;span class='o'>=&lt;/span> &lt;span class='m'>100&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; # A tibble: 1 × 6&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; expression min median `itr/sec` mem_alloc&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &amp;lt;bch:expr&amp;gt; &amp;lt;bch:tm&amp;gt; &amp;lt;bch:&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;bch:byt&amp;gt;&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; 1 arrange(str, x, .locale = "en") 377ms 430ms 2.21 27.9MB&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; # … with 1 more variable: `gc/sec` &amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>For non-English Latin script languages, such as Spanish, you may see more of a change, as characters such as &lt;code>ñ&lt;/code> are ordered after &lt;code>z&lt;/code> rather than before &lt;code>n&lt;/code> in the C locale:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>df&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>x &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"\u00F1"&lt;/span>, &lt;span class='s'>"n"&lt;/span>, &lt;span class='s'>"z"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='nv'>df&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 3 × 1&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; x &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> ñ &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> n &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> z&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;span>&lt;/span>
&lt;span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>df&lt;/span>, &lt;span class='nv'>x&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 3 × 1&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; x &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> n &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> z &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> ñ&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;span>&lt;/span>
&lt;span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>df&lt;/span>, &lt;span class='nv'>x&lt;/span>, .locale &lt;span class='o'>=&lt;/span> &lt;span class='s'>"es"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 3 × 1&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; x &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> n &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> ñ &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> z&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>We are optimistic that this change is an overall net positive. We anticipate that many users use
&lt;a href="https://dplyr.tidyverse.org/reference/arrange.html" target="_blank" rel="noopener">&lt;code>arrange()&lt;/code>&lt;/a> to simply group similar looking observations together, and we expect that the main places you&amp;rsquo;ll need to care about localized ordering are the few places when you are generating human readable output, such as a table or a chart, at which point you might consider using &lt;code>.locale&lt;/code>.&lt;/p>
&lt;p>If you are having trouble converting an existing script over to the new behavior, you can set the temporary global option &lt;code>options(dplyr.legacy_locale = TRUE)&lt;/code>, which will revert to the pre-1.1.0 behavior of using the system locale. We expect to remove this option in a future release.&lt;/p>
&lt;p>To learn more low-level details about this change, you can read our
&lt;a href="https://github.com/tidyverse/tidyups/blob/main/003-dplyr-radix-ordering.md" target="_blank" rel="noopener">tidyup&lt;/a>.&lt;/p>
&lt;h2 id="reframe-a-generalization-of-summarise">&lt;code>reframe()&lt;/code>, a generalization of &lt;code>summarise()&lt;/code>
&lt;a href="#reframe-a-generalization-of-summarise">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>In dplyr 1.0.0, we introduced a powerful new feature:
&lt;a href="https://dplyr.tidyverse.org/reference/summarise.html" target="_blank" rel="noopener">&lt;code>summarise()&lt;/code>&lt;/a> could return per-group results of any length, rather than just length 1. For example:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>table&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"a"&lt;/span>, &lt;span class='s'>"b"&lt;/span>, &lt;span class='s'>"d"&lt;/span>, &lt;span class='s'>"f"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>df&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> g &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>1&lt;/span>, &lt;span class='m'>1&lt;/span>, &lt;span class='m'>1&lt;/span>, &lt;span class='m'>2&lt;/span>, &lt;span class='m'>2&lt;/span>, &lt;span class='m'>2&lt;/span>, &lt;span class='m'>2&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> x &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"e"&lt;/span>, &lt;span class='s'>"a"&lt;/span>, &lt;span class='s'>"b"&lt;/span>, &lt;span class='s'>"c"&lt;/span>, &lt;span class='s'>"f"&lt;/span>, &lt;span class='s'>"d"&lt;/span>, &lt;span class='s'>"a"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>df&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>x &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://generics.r-lib.org/reference/setops.html'>intersect&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>x&lt;/span>, &lt;span class='nv'>table&lt;/span>&lt;span class='o'>)&lt;/span>, .by &lt;span class='o'>=&lt;/span> &lt;span class='nv'>g&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 5 × 2&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; g x &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 1 a &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 1 b &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> 2 f &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> 2 d &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>5&lt;/span> 2 a&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>While extremely powerful, community feedback has raised the valid concern that allowing
&lt;a href="https://dplyr.tidyverse.org/reference/summarise.html" target="_blank" rel="noopener">&lt;code>summarise()&lt;/code>&lt;/a> to return any number of rows per group:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Increases the chance for accidental bugs&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Is against the spirit of a &amp;ldquo;summary,&amp;rdquo; which implies 1 row per group&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Makes translation to dbplyr very difficult&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>We agree! In response to this, we&amp;rsquo;ve decided to walk back that change to
&lt;a href="https://dplyr.tidyverse.org/reference/summarise.html" target="_blank" rel="noopener">&lt;code>summarise()&lt;/code>&lt;/a>, which will now throw a warning when either 0 or &amp;gt;1 rows are returned per group:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>df&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>x &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://generics.r-lib.org/reference/setops.html'>intersect&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>x&lt;/span>, &lt;span class='nv'>table&lt;/span>&lt;span class='o'>)&lt;/span>, .by &lt;span class='o'>=&lt;/span> &lt;span class='nv'>g&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; Warning: Returning more (or less) than 1 row per `summarise()` group was deprecated in&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; dplyr 1.1.0.&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #00BBBB;'>ℹ&lt;/span> Please use `reframe()` instead.&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #00BBBB;'>ℹ&lt;/span> When switching from `summarise()` to `reframe()`, remember that `reframe()`&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; always returns an ungrouped data frame and adjust accordingly.&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 5 × 2&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; g x &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 1 a &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 1 b &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> 2 f &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> 2 d &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>5&lt;/span> 2 a&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>That said, we still believe that this is a powerful tool, so we&amp;rsquo;ve moved these features to a new verb,
&lt;a href="https://dplyr.tidyverse.org/reference/reframe.html" target="_blank" rel="noopener">&lt;code>reframe()&lt;/code>&lt;/a>. Think of
&lt;a href="https://dplyr.tidyverse.org/reference/reframe.html" target="_blank" rel="noopener">&lt;code>reframe()&lt;/code>&lt;/a> as a generic tool for &amp;ldquo;doing something to each group,&amp;rdquo; with no restrictions on the number of rows returned per group.&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>df&lt;/span> &lt;span class='o'>|&amp;gt;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/reframe.html'>reframe&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>x &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://generics.r-lib.org/reference/setops.html'>intersect&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>x&lt;/span>, &lt;span class='nv'>table&lt;/span>&lt;span class='o'>)&lt;/span>, .by &lt;span class='o'>=&lt;/span> &lt;span class='nv'>g&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 5 × 2&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; g x &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 1 a &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 1 b &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> 2 f &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> 2 d &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>5&lt;/span> 2 a&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>One big difference between
&lt;a href="https://dplyr.tidyverse.org/reference/summarise.html" target="_blank" rel="noopener">&lt;code>summarise()&lt;/code>&lt;/a> and
&lt;a href="https://dplyr.tidyverse.org/reference/reframe.html" target="_blank" rel="noopener">&lt;code>reframe()&lt;/code>&lt;/a> is that
&lt;a href="https://dplyr.tidyverse.org/reference/reframe.html" target="_blank" rel="noopener">&lt;code>reframe()&lt;/code>&lt;/a> always returns an ungrouped data frame, even if the input was a grouped data frame with multiple group columns. This simplifies
&lt;a href="https://dplyr.tidyverse.org/reference/reframe.html" target="_blank" rel="noopener">&lt;code>reframe()&lt;/code>&lt;/a> immensely, as it doesn&amp;rsquo;t need to inherit the &lt;code>.groups&lt;/code> argument of
&lt;a href="https://dplyr.tidyverse.org/reference/summarise.html" target="_blank" rel="noopener">&lt;code>summarise()&lt;/code>&lt;/a>, and never emits any messages.&lt;/p>
&lt;p>We expect that you&amp;rsquo;ll continue to use
&lt;a href="https://dplyr.tidyverse.org/reference/summarise.html" target="_blank" rel="noopener">&lt;code>summarise()&lt;/code>&lt;/a> much more often than
&lt;a href="https://dplyr.tidyverse.org/reference/reframe.html" target="_blank" rel="noopener">&lt;code>reframe()&lt;/code>&lt;/a>, but if you ever find yourself applying a function to each group that returns an arbitrary number of rows,
&lt;a href="https://dplyr.tidyverse.org/reference/reframe.html" target="_blank" rel="noopener">&lt;code>reframe()&lt;/code>&lt;/a> should be your go-to tool!&lt;/p>
&lt;p>
&lt;a href="https://dplyr.tidyverse.org/reference/reframe.html" target="_blank" rel="noopener">&lt;code>reframe()&lt;/code>&lt;/a> is one of the places we could use your feedback! We aren&amp;rsquo;t completely confident about this function name yet, so if you have any feedback about it or suggestions for an alternate one, please leave a comment on this
&lt;a href="https://github.com/tidyverse/dplyr/issues/6565" target="_blank" rel="noopener">issue&lt;/a>.&lt;/p></description></item></channel></rss>