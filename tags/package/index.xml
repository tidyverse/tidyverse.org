<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>package | Tidyverse</title><link>https://www.tidyverse.org/tags/package/</link><atom:link href="https://www.tidyverse.org/tags/package/index.xml" rel="self" type="application/rss+xml"/><description>package</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Wed, 18 Feb 2026 00:00:00 +0000</lastBuildDate><item><title>Rapp 0.3.0</title><link>https://www.tidyverse.org/blog/2026/02/rapp-0-3-0/</link><pubDate>Wed, 18 Feb 2026 00:00:00 +0000</pubDate><guid>https://www.tidyverse.org/blog/2026/02/rapp-0-3-0/</guid><description>&lt;p>We&amp;rsquo;re excited to share our first tidyverse blog post for Rapp, alongside the &lt;code>0.3.0&lt;/code> release. Rapp helps you turn R scripts into polished command-line tools, with argument parsing and help generation built in.&lt;/p>
&lt;h2 id="why-a-command-line-interface-for-r">Why a command-line interface for R?
&lt;a href="#why-a-command-line-interface-for-r">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>A command-line interface (CLI) lets you run programs from a terminal, without opening an IDE or starting an interactive R session. This is useful when you want to:&lt;/p>
&lt;ul>
&lt;li>automate tasks via cron jobs, scheduled tasks, or CI/CD pipelines&lt;/li>
&lt;li>chain R scripts together with other tools in data pipelines&lt;/li>
&lt;li>let others run your R code without needing to know R&lt;/li>
&lt;li>package reusable tools that feel native to the terminal&lt;/li>
&lt;li>expose specific actions through a clean interface that LLM agents can invoke&lt;/li>
&lt;/ul>
&lt;p>There are several established packages for building CLIs in R, including argparse, optparse, and docopt, where you explicitly parse and handle command-line arguments in code. Rapp takes a different approach: it derives the CLI surface from the structure of your R script and injects values at runtime, so you never need to handle CLI arguments manually.&lt;/p>
&lt;h2 id="how-rapp-works">How Rapp works
&lt;a href="#how-rapp-works">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>At its core, Rapp is an alternative front-end to R: a drop-in replacement for &lt;code>Rscript&lt;/code> that automatically turns common R expression patterns into command-line options, switches, positional arguments, and subcommands. You write normal R code and Rapp handles the CLI surface.&lt;/p>
&lt;p>Rapp also uses special &lt;code>#|&lt;/code> comments (similar to Quarto&amp;rsquo;s YAML-in-comments syntax) to add metadata such as help descriptions and short aliases.&lt;/p>
&lt;h2 id="a-tiny-example">A tiny example
&lt;a href="#a-tiny-example">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>Here&amp;rsquo;s a complete Rapp script (from the package examples), a coin flipper:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="c1">#!/usr/bin/env Rapp&lt;/span>
&lt;span class="c1">#| name: flip-coin&lt;/span>
&lt;span class="c1">#| description: |&lt;/span>
&lt;span class="c1">#| Flip a coin.&lt;/span>
&lt;span class="c1">#| description: Number of coin flips&lt;/span>
&lt;span class="c1">#| short: &amp;#39;n&amp;#39;&lt;/span>
&lt;span class="n">flips&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="m">1L&lt;/span>
&lt;span class="n">sep&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="s">&amp;#34; &amp;#34;&lt;/span>
&lt;span class="n">wrap&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="kc">TRUE&lt;/span>
&lt;span class="n">seed&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="kc">NA_integer_&lt;/span>
&lt;span class="nf">if &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="nf">is.na&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">seed&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nf">set.seed&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">seed&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nf">cat&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">sample&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">c&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;heads&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;tails&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">flips&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">TRUE&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">sep&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">sep&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">fill&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">wrap&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Let&amp;rsquo;s break down how Rapp interprets this script:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>R code&lt;/th>
&lt;th>Generated CLI option&lt;/th>
&lt;th>What it does&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>flips &amp;lt;- 1L&lt;/code>&lt;/td>
&lt;td>&lt;code>--flips&lt;/code> or &lt;code>-n&lt;/code>&lt;/td>
&lt;td>Integer option with default of 1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>sep &amp;lt;- &amp;quot; &amp;quot;&lt;/code>&lt;/td>
&lt;td>&lt;code>--sep&lt;/code>&lt;/td>
&lt;td>String option with default of &lt;code>&amp;quot; &amp;quot;&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>wrap &amp;lt;- TRUE&lt;/code>&lt;/td>
&lt;td>&lt;code>--wrap&lt;/code> / &lt;code>--no-wrap&lt;/code>&lt;/td>
&lt;td>Boolean toggle (TRUE/FALSE becomes on/off)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>seed &amp;lt;- NA_integer_&lt;/code>&lt;/td>
&lt;td>&lt;code>--seed&lt;/code>&lt;/td>
&lt;td>Optional integer (NA means &amp;ldquo;not set&amp;rdquo;)&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>The &lt;code>#| short: 'n'&lt;/code> comment adds &lt;code>-n&lt;/code> as a short alias for &lt;code>--flips&lt;/code>. The &lt;code>#!/usr/bin/env Rapp&lt;/code> line (called a &amp;ldquo;shebang&amp;rdquo;) lets you run the script directly on macOS and Linux without typing &lt;code>Rapp&lt;/code> first.&lt;/p>
&lt;h3 id="running-the-script">Running the script
&lt;a href="#running-the-script">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h3>&lt;p>With Rapp installed and &lt;code>flip-coin&lt;/code> available on your &lt;code>PATH&lt;/code> (see
&lt;a href="#get-started">Get started&lt;/a> below), you can run the app from the terminal:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">flip-coin -n &lt;span class="m">3&lt;/span>
&lt;span class="c1">#&amp;gt; heads tails heads&lt;/span>
flip-coin --seed &lt;span class="m">42&lt;/span> -n &lt;span class="m">5&lt;/span>
&lt;span class="c1">#&amp;gt; tails heads tails tails heads&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>
&lt;h3 id="auto-generated-help">Auto-generated help
&lt;a href="#auto-generated-help">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h3>&lt;p>Rapp generates &lt;code>--help&lt;/code> from your script (and &lt;code>--help-yaml&lt;/code> if you want a machine-readable spec):&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">flip-coin --help
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-text" data-lang="text">Usage: flip-coin [OPTIONS]
Flip a coin.
Options:
-n, --flips &amp;lt;FLIPS&amp;gt; Number of coin flips [default: 1] [type: integer]
--sep &amp;lt;SEP&amp;gt; [default: &amp;#34; &amp;#34;] [type: string]
--wrap / --no-wrap [default: true] Disable with `--no-wrap`.
--seed &amp;lt;SEED&amp;gt; [default: NA] [type: integer]
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="callout-warning">
&lt;h2 id="breaking-change-in-030-positional-arguments-are-now-required-by-default">Breaking change in 0.3.0: positional arguments are now required by default
&lt;a href="#breaking-change-in-030-positional-arguments-are-now-required-by-default">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>If you&amp;rsquo;re upgrading from an earlier version of Rapp, note that positional arguments are now &lt;strong>required&lt;/strong> unless explicitly marked optional.&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="c1"># Before 0.3.0: this positional was optional&lt;/span>
&lt;span class="n">name&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="kc">NULL&lt;/span>
&lt;span class="c1"># In 0.3.0+: add this comment to keep it optional&lt;/span>
&lt;span class="c1">#| required: false&lt;/span>
&lt;span class="n">name&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="kc">NULL&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>If your scripts use positional arguments with &lt;code>NULL&lt;/code> defaults that should remain optional, add &lt;code>#| required: false&lt;/code> above them.&lt;/p>
&lt;/div>
&lt;h2 id="highlights-in-030">Highlights in 0.3.0
&lt;a href="#highlights-in-030">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>Rapp will be new to most readers, so rather than listing every change, here are the main ideas (and what&amp;rsquo;s improved in 0.3.0).&lt;/p>
&lt;h3 id="options-switches-and-repeatable-flags-from-plain-r">Options, switches, and repeatable flags from plain R
&lt;a href="#options-switches-and-repeatable-flags-from-plain-r">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h3>&lt;p>Rapp recognizes a small set of &amp;ldquo;declarative&amp;rdquo; patterns at the top level of your script:&lt;/p>
&lt;ul>
&lt;li>Scalar literals like &lt;code>flips &amp;lt;- 1L&lt;/code> become options like &lt;code>--flips 10&lt;/code>.&lt;/li>
&lt;li>Logical defaults like &lt;code>wrap &amp;lt;- TRUE&lt;/code> become toggles like &lt;code>--wrap&lt;/code> / &lt;code>--no-wrap&lt;/code>.&lt;/li>
&lt;li>&lt;code>#| short: n&lt;/code> adds a short alias like &lt;code>-n&lt;/code> (new in 0.3.0).&lt;/li>
&lt;li>
&lt;a href="https://rdrr.io/r/base/c.html" target="_blank" rel="noopener">&lt;code>c()&lt;/code>&lt;/a> and
&lt;a href="https://rdrr.io/r/base/list.html" target="_blank" rel="noopener">&lt;code>list()&lt;/code>&lt;/a> defaults declare repeatable options (new in 0.3.0): callers can supply the same flag multiple times and values are appended.&lt;/li>
&lt;/ul>
&lt;h3 id="subcommands-with-switch">Subcommands with &lt;code>switch()&lt;/code>
&lt;a href="#subcommands-with-switch">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h3>&lt;p>Rapp can now turn a
&lt;a href="https://rdrr.io/r/base/switch.html" target="_blank" rel="noopener">&lt;code>switch()&lt;/code>&lt;/a> block into subcommands (and you can nest
&lt;a href="https://rdrr.io/r/base/switch.html" target="_blank" rel="noopener">&lt;code>switch()&lt;/code>&lt;/a> blocks for nested commands). Here&amp;rsquo;s a small sketch of a &lt;code>todo&lt;/code>-style app:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="c1">#!/usr/bin/env Rapp&lt;/span>
&lt;span class="c1">#| name: todo&lt;/span>
&lt;span class="c1">#| description: Manage a simple todo list.&lt;/span>
&lt;span class="c1">#| description: Path to the todo list file.&lt;/span>
&lt;span class="c1">#| short: s&lt;/span>
&lt;span class="n">store&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="s">&amp;#34;.todo.yml&amp;#34;&lt;/span>
&lt;span class="nf">switch&lt;/span>&lt;span class="p">(&lt;/span>
&lt;span class="n">command&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="c1">#| description: Display the todos&lt;/span>
&lt;span class="n">list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="n">limit&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="m">30L&lt;/span>
&lt;span class="c1"># ...&lt;/span>
&lt;span class="p">},&lt;/span>
&lt;span class="c1">#| description: Add a new todo&lt;/span>
&lt;span class="n">add&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="n">task&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="kc">NULL&lt;/span>
&lt;span class="c1"># ...&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Help is scoped to the command you&amp;rsquo;re asking about, so &lt;code>todo --help&lt;/code> lists the commands, and &lt;code>todo list --help&lt;/code> shows just the options/arguments for &lt;code>list&lt;/code> (plus any parent/global options).&lt;/p>
&lt;h3 id="installable-launchers-for-package-clis">Installable launchers for package CLIs
&lt;a href="#installable-launchers-for-package-clis">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h3>&lt;p>A big part of sharing CLI tools is making them easy to run after installation. In &lt;code>0.3.0&lt;/code>, &lt;code>install_pkg_cli_apps()&lt;/code> installs lightweight launchers for scripts in a package&amp;rsquo;s &lt;code>exec/&lt;/code> directory that use either &lt;code>#!/usr/bin/env Rapp&lt;/code> or &lt;code>#!/usr/bin/env Rscript&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="n">Rapp&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="nf">install_pkg_cli_apps&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;mypackage&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>(There&amp;rsquo;s also &lt;code>uninstall_pkg_cli_apps()&lt;/code> to remove a package&amp;rsquo;s launchers.)&lt;/p>
&lt;h2 id="get-started">Get started
&lt;a href="#get-started">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>Here&amp;rsquo;s the quickest path to your first Rapp script:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="c1"># 1. Install the package&lt;/span>
&lt;span class="nf">install.packages&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Rapp&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="c1"># 2. Install the command-line launcher&lt;/span>
&lt;span class="n">Rapp&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="nf">install_pkg_cli_apps&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Rapp&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Then create a script (e.g., &lt;code>hello.R&lt;/code>):&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="c1">#!/usr/bin/env Rapp&lt;/span>
&lt;span class="c1">#| name: hello&lt;/span>
&lt;span class="c1">#| description: Say hello&lt;/span>
&lt;span class="n">name&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="s">&amp;#34;world&amp;#34;&lt;/span>
&lt;span class="nf">cat&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Hello,&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;\n&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>And run it:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">Rapp hello.R --name &lt;span class="s2">&amp;#34;R users&amp;#34;&lt;/span>
&lt;span class="c1">#&amp;gt; Hello, R users&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>
&lt;h3 id="learn-more">Learn more
&lt;a href="#learn-more">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h3>&lt;p>To dig deeper into Rapp:&lt;/p>
&lt;ul>
&lt;li>browse examples in the package: &lt;code>system.file(&amp;quot;examples&amp;quot;, package = &amp;quot;Rapp&amp;quot;)&lt;/code>&lt;/li>
&lt;li>read the full documentation: &lt;a href="https://github.com/r-lib/Rapp">https://github.com/r-lib/Rapp&lt;/a>&lt;/li>
&lt;li>note that Rapp requires R ≥ 4.1.0&lt;/li>
&lt;/ul>
&lt;p>If you try Rapp, we&amp;rsquo;d love feedback! We especially want to hear about your experiences with edge cases in argument parsing, help output, and how commands should feel. Issues and ideas are welcome at &lt;a href="https://github.com/r-lib/Rapp/issues">https://github.com/r-lib/Rapp/issues&lt;/a>.&lt;/p></description></item><item><title>Writing performant code with tidy tools</title><link>https://www.tidyverse.org/blog/2023/04/performant-packages/</link><pubDate>Tue, 18 Apr 2023 00:00:00 +0000</pubDate><guid>https://www.tidyverse.org/blog/2023/04/performant-packages/</guid><description>&lt;p>The tidyverse packages provide safe, powerful, and expressive interfaces to solve data science problems. Behind the scenes of the tidyverse is a set of lower-level tools that its developers use to build these interfaces. While these lower-level approaches are more performant than their tidy analogues, their interfaces are often less readable and safe. For most use cases in interactive data analysis, the advantages of tidyverse interfaces far outweigh the drawback in computational speed. When speed becomes an issue, though, transitioning tidy code to use these lower-level interfaces in their backend can offer substantial increases in computational performance.&lt;/p>
&lt;p>This post will outline alternatives to tools I love from packages like dplyr and tidyr that I use to speed up computational bottlenecks. These recommendations come from my experiences developing the
&lt;a href="https://www.tidymodels.org/" target="_blank" rel="noopener">tidymodels&lt;/a> packages, a collection of packages for modeling and machine learning using tidyverse principles. As such, most of these suggestions are best suited to package code, as the noted trade-off is more likely to be worth it in those settings&amp;mdash;however, there may also be cases in analytical code, especially in production and/or with very large data sets, where these tips will be helpful. I&amp;rsquo;ve included a number of &amp;ldquo;worked examples&amp;rdquo; with each proposed alternative, showing how the tidymodels team has used these same tricks to
&lt;a href="https://www.simonpcouch.com/blog/speedups-2023/" target="_blank" rel="noopener">speed up our code&lt;/a> quite a bit. Before I do that, though, let&amp;rsquo;s make friends with some new R packages.&lt;/p>
&lt;h2 id="tools-of-the-trade">Tools of the trade
&lt;a href="#tools-of-the-trade">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>First, loading the tidyverse:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='kr'>&lt;a href='https://rdrr.io/r/base/library.html'>library&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>&lt;a href='https://tidyverse.tidyverse.org'>tidyverse&lt;/a>&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>The most important tools to help you understand what&amp;rsquo;s slowing your code down have little to do with the tidyverse at all!&lt;/p>
&lt;h3 id="profvis">profvis
&lt;a href="#profvis">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h3>&lt;p>The profvis package is an R package for collecting and visualizing profiling data.&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='kr'>&lt;a href='https://rdrr.io/r/base/library.html'>library&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>&lt;a href='https://rstudio.github.io/profvis/'>profvis&lt;/a>&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>Profiling is the process of determining how long different portions of a chunk of code take to run. For example, in this next function &lt;code>slow_function()&lt;/code>, it&amp;rsquo;s somewhat straightforward to tell how long different portions of the following code run for if you know what
&lt;a href="https://rdrr.io/pkg/profvis/man/pause.html" target="_blank" rel="noopener">&lt;code>pause()&lt;/code>&lt;/a> does. (
&lt;a href="https://rdrr.io/pkg/profvis/man/pause.html" target="_blank" rel="noopener">&lt;code>pause()&lt;/code>&lt;/a> is a function from the profvis package that just chills out for the specified amount of time. For example, &lt;code>pause(1)&lt;/code> will wait for 1 second before finishing running.)&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>step_1&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='kr'>function&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>&amp;#123;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://rdrr.io/pkg/profvis/man/pause.html'>pause&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>1&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>&amp;#125;&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>step_2&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='kr'>function&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>&amp;#123;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://rdrr.io/pkg/profvis/man/pause.html'>pause&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>2&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>&amp;#125;&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>slow_function&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='kr'>function&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>&amp;#123;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>step_1&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span> &lt;/span>
&lt;span> &lt;span class='nf'>step_2&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span> &lt;/span>
&lt;span> &lt;span class='kc'>TRUE&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>&amp;#125;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>Profiling tools would help us see that &lt;code>step_1()&lt;/code> takes one second, while &lt;code>step_2()&lt;/code> takes two. In practice, this is usually much harder to intuit visually. To profile code with profvis, use the
&lt;a href="https://rdrr.io/pkg/profvis/man/profvis.html" target="_blank" rel="noopener">&lt;code>profvis()&lt;/code>&lt;/a> function:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>result&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/pkg/profvis/man/profvis.html'>profvis&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>slow_function&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>Printing the &lt;code>result&lt;/code>ing object out will visualize the time different calls within &lt;code>slow_function()&lt;/code> took:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>result&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>&lt;img src="slow-function-profvis.png" alt="A screenshot of profvis output. A stack of grey bars sit atop a timeline that ranges from zero to three seconds. The bottom rectangle of the stack is labeled &amp;ldquo;slow_function&amp;rdquo; and stretches across the whole timeline. Two rectangles labeled &amp;ldquo;step_1&amp;rdquo; and &amp;ldquo;step_2&amp;rdquo; lie on top of the bottom rectangle, where the first stretches one-third of the way across the timeline and the second covers the remaining two-thirds.">&lt;/p>
&lt;p>This output shows that, inside of &lt;code>slow_function()&lt;/code>, &lt;code>step_1()&lt;/code> took about a third of the total time and &lt;code>step_2()&lt;/code> took two-thirds. All of the time in both of those functions was due to calling
&lt;a href="https://rdrr.io/pkg/profvis/man/pause.html" target="_blank" rel="noopener">&lt;code>pause()&lt;/code>&lt;/a>.&lt;/p>
&lt;p>Profiling should be your first line of defense against slow-running code. Often, profiling will surface slowdowns in unexpected places, and solutions to address those slowdowns may have little to do with usage of tidy tools. To learn more about profiling, the
&lt;a href="https://adv-r.hadley.nz/perf-measure.html" target="_blank" rel="noopener">Measuring performance&lt;/a> chapter in Hadley Wickham&amp;rsquo;s book
&lt;a href="https://adv-r.hadley.nz/index.html" target="_blank" rel="noopener">Advanced R&lt;/a> is a great place to start.&lt;/p>
&lt;h3 id="bench">bench
&lt;a href="#bench">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h3>&lt;p>profvis is a powerful tool to surface code slowdowns. Often, though, it may not be immediately clear how to &lt;em>fix&lt;/em> that slowdown. The bench package allows users to quickly test out how long different approaches to solving a problem take.&lt;/p>
&lt;p>For example, say we want to take the sum of the numbers in a list, but we&amp;rsquo;ve identified via profiling that this operation is slowing our code down:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>numbers&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/list.html'>as.list&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>1&lt;/span>&lt;span class='o'>:&lt;/span>&lt;span class='m'>5&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>numbers&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; [[1]]&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; [1] 1&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; [[2]]&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; [1] 2&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; [[3]]&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; [1] 3&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; [[4]]&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; [1] 4&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; [[5]]&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; [1] 5&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>One approach could be using the
&lt;a href="https://rdrr.io/r/base/funprog.html" target="_blank" rel="noopener">&lt;code>Reduce()&lt;/code>&lt;/a> function:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/funprog.html'>Reduce&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>sum&lt;/span>, &lt;span class='nv'>numbers&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; [1] 15&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>Another could involve converting to a vector with
&lt;a href="https://rdrr.io/r/base/unlist.html" target="_blank" rel="noopener">&lt;code>unlist()&lt;/code>&lt;/a> and then using
&lt;a href="https://rdrr.io/r/base/sum.html" target="_blank" rel="noopener">&lt;code>sum()&lt;/code>&lt;/a>:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/sum.html'>sum&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/unlist.html'>unlist&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>numbers&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; [1] 15&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>You may have some other ideas of how to solve this problem! How do we figure out which one is fastest, though? The
&lt;a href="http://bench.r-lib.org/reference/mark.html" target="_blank" rel="noopener">&lt;code>bench::mark()&lt;/code>&lt;/a> function from bench takes in different proposals to solve the same problem and returns a tibble with information about how long they took (among other things.)&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>res&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>bench&lt;/span>&lt;span class='nf'>::&lt;/span>&lt;span class='nf'>&lt;a href='http://bench.r-lib.org/reference/mark.html'>mark&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> approach_1 &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/funprog.html'>Reduce&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>sum&lt;/span>, &lt;span class='nv'>numbers&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> approach_2 &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/sum.html'>sum&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/unlist.html'>unlist&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>numbers&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span> &lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>res&lt;/span> &lt;span class='o'>&lt;a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&amp;gt;%&lt;/a>&lt;/span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/select.html'>select&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>expression&lt;/span>, &lt;span class='nv'>median&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 2 × 2&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; expression median&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;bch:expr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;bch:tm&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> approach_1 2.25µs&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> approach_2 491.97ns&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>The other nice part about
&lt;a href="http://bench.r-lib.org/reference/mark.html" target="_blank" rel="noopener">&lt;code>bench::mark()&lt;/code>&lt;/a> is that it will check that each approach gives the same output, so that you don&amp;rsquo;t mistakenly compare apples and oranges.&lt;/p>
&lt;p>There are two important lessons to take in from this output:&lt;/p>
&lt;ul>
&lt;li>The &lt;code>sum(unlist())&lt;/code> approach was wicked fast compared to
&lt;a href="https://rdrr.io/r/base/funprog.html" target="_blank" rel="noopener">&lt;code>Reduce()&lt;/code>&lt;/a>.&lt;/li>
&lt;li>Both of these expressions were fast. Even the slower of the two took 2.25µs&amp;mdash;to put that in perspective, that expression could complete 443454 iterations in a second! Keeping this bigger picture in mind is always important when benchmarking; if code runs fast enough to not be an issue in practical situations, then it need not be optimized in favor of less readable or safe code.&lt;/li>
&lt;/ul>
&lt;p>The results of little experiments like this one can be surprising at first. Over time, though, you will develop intuition for the fastest way to solve problems you commonly solve, and will write fast code the first time around!&lt;/p>
&lt;p>In this case, using
&lt;a href="https://rdrr.io/r/base/funprog.html" target="_blank" rel="noopener">&lt;code>Reduce()&lt;/code>&lt;/a> means calling
&lt;a href="https://rdrr.io/r/base/sum.html" target="_blank" rel="noopener">&lt;code>sum()&lt;/code>&lt;/a> many times, approximately once for each element of the list, and while
&lt;a href="https://rdrr.io/r/base/sum.html" target="_blank" rel="noopener">&lt;code>sum()&lt;/code>&lt;/a> isn&amp;rsquo;t particularly slow, calling an R function many times tends to have non-negligible overhead. With the &lt;code>sum(unlist())&lt;/code> approach, there are only 2 R function calls&amp;mdash;one for
&lt;a href="https://rdrr.io/r/base/unlist.html" target="_blank" rel="noopener">&lt;code>unlist()&lt;/code>&lt;/a> and one for
&lt;a href="https://rdrr.io/r/base/sum.html" target="_blank" rel="noopener">&lt;code>sum()&lt;/code>&lt;/a>&amp;mdash;which both immediately drop into C code.&lt;/p>
&lt;h3 id="vctrs">vctrs
&lt;a href="#vctrs">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h3>&lt;p>The problems I commonly solve&amp;mdash;and possibly you as well, as a reader of this post&amp;mdash;often involve lots of dplyr and tidyr. When profiling the tidymodels packages, I&amp;rsquo;ve come across many places where calls to dplyr and tidyr took more time than I&amp;rsquo;d like them to, but had a lot to learn about how to speed up those operations. &lt;em>Enter the vctrs package!&lt;/em>&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='kr'>&lt;a href='https://rdrr.io/r/base/library.html'>library&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>&lt;a href='https://vctrs.r-lib.org/'>vctrs&lt;/a>&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>If you use dplyr and tidyr like I do, turns out you&amp;rsquo;re also a vctrs user! dplyr and tidyr rely on vctrs to handle all sorts of elementary operations behind the scenes, and the package is a core part of a tidy developer&amp;rsquo;s toolkit. Taken together with some functions from the tibble package, these tools provide a super efficient, albeit bare-bones, alternative interface to common data manipulation tasks like
&lt;a href="https://dplyr.tidyverse.org/reference/filter.html" target="_blank" rel="noopener">&lt;code>filter()&lt;/code>&lt;/a>ing and
&lt;a href="https://dplyr.tidyverse.org/reference/select.html" target="_blank" rel="noopener">&lt;code>select()&lt;/code>&lt;/a>ing.&lt;/p>
&lt;h2 id="rewriting-tidy-code">Rewriting tidy code
&lt;a href="#rewriting-tidy-code">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>For every performance improvement I make by rewriting dplyr and tidyr code to instead use vctrs and tibble, I make probably two or three simpler optimizations.
&lt;a href="https://adv-r.hadley.nz/perf-improve.html" target="_blank" rel="noopener">Tool-agnostic practices&lt;/a> such as reducing duplicated computations, implementing early returns where possible, and using vectorized implementations will likely take you far when optimizing R code. Profiling is your ground truth! When profiling indicates that otherwise well-factored code is slowed by tidy interfaces, though, all is not lost.&lt;/p>
&lt;p>We&amp;rsquo;ll demonstrate different ways to speed up tidy code using a version of the base R data frame &lt;code>mtcars&lt;/code> converted to a tibble:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>mtcars_tbl&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/as_tibble.html'>as_tibble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>mtcars&lt;/span>, rownames &lt;span class='o'>=&lt;/span> &lt;span class='s'>"make_model"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>mtcars_tbl&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 32 × 12&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; make_model mpg cyl disp hp drat wt qsec vs am gear carb&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 1&lt;/span> Mazda RX4 21 6 160 110 3.9 2.62 16.5 0 1 4 4&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 2&lt;/span> Mazda RX4 … 21 6 160 110 3.9 2.88 17.0 0 1 4 4&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 3&lt;/span> Datsun 710 22.8 4 108 93 3.85 2.32 18.6 1 1 4 1&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 4&lt;/span> Hornet 4 D… 21.4 6 258 110 3.08 3.22 19.4 1 0 3 1&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 5&lt;/span> Hornet Spo… 18.7 8 360 175 3.15 3.44 17.0 0 0 3 2&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 6&lt;/span> Valiant 18.1 6 225 105 2.76 3.46 20.2 1 0 3 1&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 7&lt;/span> Duster 360 14.3 8 360 245 3.21 3.57 15.8 0 0 3 4&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 8&lt;/span> Merc 240D 24.4 4 147. 62 3.69 3.19 20 1 0 4 2&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'> 9&lt;/span> Merc 230 22.8 4 141. 95 3.92 3.15 22.9 1 0 4 2&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>10&lt;/span> Merc 280 19.2 6 168. 123 3.92 3.44 18.3 1 0 4 4&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># ℹ 22 more rows&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;h3 id="one-for-one-replacements">One-for-one replacements
&lt;a href="#one-for-one-replacements">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h3>&lt;p>Many of the core functions in dplyr have alternatives in vctrs and tibble that can be quickly transitioned. There are a couple considerations associated with each, though, and some of them make piping a bit more awkward&amp;mdash;most of the time, when I switch these out, I remove the pipe &lt;code>%&amp;gt;%&lt;/code> as well.&lt;/p>
&lt;h4 id="filter">&lt;code>filter()&lt;/code>
&lt;a href="#filter">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h4>&lt;p>The dplyr code:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>mtcars_tbl&lt;/span> &lt;span class='o'>&lt;a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&amp;gt;%&lt;/a>&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/filter.html'>filter&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>hp&lt;/span> &lt;span class='o'>&amp;gt;&lt;/span> &lt;span class='m'>100&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>&amp;hellip;can be replaced by:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>&lt;a href='https://vctrs.r-lib.org/reference/vec_slice.html'>vec_slice&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>mtcars_tbl&lt;/span>, &lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>$&lt;/span>&lt;span class='nv'>hp&lt;/span> &lt;span class='o'>&amp;gt;&lt;/span> &lt;span class='m'>100&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>Note that the second argument that determines which rows to keep requires you to actually pass the column &lt;code>mtcars_tbl$hp&lt;/code> rather than its reference &lt;code>hp&lt;/code>. If you feel cozier with square brackets, you can also use &lt;code>[.tbl_df&lt;/code>:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>[&lt;/span>&lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>$&lt;/span>&lt;span class='nv'>hp&lt;/span> &lt;span class='o'>&amp;gt;&lt;/span> &lt;span class='m'>100&lt;/span>, &lt;span class='o'>]&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>&lt;code>[.tbl_df&lt;/code> is the
&lt;a href="https://tibble.tidyverse.org/reference/subsetting.html" target="_blank" rel="noopener">method for subsetting with a single square bracket when applied to tibbles&lt;/a>. Tibbles have their own methods for extracting and replacing subsets of data frames. They generally behave similarly to the analogous methods for &lt;code>data.frame&lt;/code>s, but have small differences to improve consistency and safety.&lt;/p>
&lt;p>The benchmarks for these different approaches are:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>res&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>bench&lt;/span>&lt;span class='nf'>::&lt;/span>&lt;span class='nf'>&lt;a href='http://bench.r-lib.org/reference/mark.html'>mark&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> dplyr &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/filter.html'>filter&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>mtcars_tbl&lt;/span>, &lt;span class='nv'>hp&lt;/span> &lt;span class='o'>&amp;gt;&lt;/span> &lt;span class='m'>100&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> vctrs &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://vctrs.r-lib.org/reference/vec_slice.html'>vec_slice&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>mtcars_tbl&lt;/span>, &lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>$&lt;/span>&lt;span class='nv'>hp&lt;/span> &lt;span class='o'>&amp;gt;&lt;/span> &lt;span class='m'>100&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> `[.tbl_df` &lt;span class='o'>=&lt;/span> &lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>[&lt;/span>&lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>$&lt;/span>&lt;span class='nv'>hp&lt;/span> &lt;span class='o'>&amp;gt;&lt;/span> &lt;span class='m'>100&lt;/span>, &lt;span class='o'>]&lt;/span>&lt;/span>
&lt;span> &lt;span class='o'>)&lt;/span> &lt;span class='o'>&lt;a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&amp;gt;%&lt;/a>&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/select.html'>select&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>expression&lt;/span>, &lt;span class='nv'>median&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>res&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 3 × 2&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; expression median&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;bch:expr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;bch:tm&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> dplyr 289.93µs&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> vctrs 4.63µs&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> [.tbl_df 23.74µs&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>The bigger picture of benchmarking is worth re-iterating here. While the &lt;code>filter()&lt;/code> approach was by far the slowest expression of the three, it still only took 290µs&amp;mdash;able to complete 3449 iterations in a second. If I&amp;rsquo;m interactively analyzing data, I won&amp;rsquo;t even notice the difference in evaluation time between these expressions, let alone care about it; the benefits of expressiveness and safety that &lt;code>filter()&lt;/code> provide far outweigh the drawback of this slowdown. If &lt;code>filter()&lt;/code> is called 3449 times in the backend of a machine learning pipeline, though, these alternatives may be worth transitioning to.&lt;/p>
&lt;p>Some examples of changes like this made to tidymodels packages:
&lt;a href="https://github.com/tidymodels/parsnip/pull/935" target="_blank" rel="noopener">tidymodels/parsnip#935&lt;/a>,
&lt;a href="https://github.com/tidymodels/parsnip/pull/933" target="_blank" rel="noopener">tidymodels/parsnip#933&lt;/a>,
&lt;a href="https://github.com/tidymodels/parsnip/pull/901" target="_blank" rel="noopener">tidymodels/parsnip#901&lt;/a>.&lt;/p>
&lt;h4 id="mutate">&lt;code>mutate()&lt;/code>
&lt;a href="#mutate">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h4>&lt;p>The dplyr code:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>mtcars_tbl&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>mtcars_tbl&lt;/span>, year &lt;span class='o'>=&lt;/span> &lt;span class='m'>1974L&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>&amp;hellip;can be replaced by:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>$&lt;/span>&lt;span class='nv'>year&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='m'>1974L&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>&amp;hellip;with benchmarks:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>bench&lt;/span>&lt;span class='nf'>::&lt;/span>&lt;span class='nf'>&lt;a href='http://bench.r-lib.org/reference/mark.html'>mark&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> dplyr &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>mtcars_tbl&lt;/span>, year &lt;span class='o'>=&lt;/span> &lt;span class='m'>1974L&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> `$&amp;lt;-.tbl_df` &lt;span class='o'>=&lt;/span> &lt;span class='o'>&amp;#123;&lt;/span>&lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>$&lt;/span>&lt;span class='nv'>year&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='m'>1974L&lt;/span>; &lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>&amp;#125;&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>&lt;a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&amp;gt;%&lt;/a>&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/select.html'>select&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>expression&lt;/span>, &lt;span class='nv'>median&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 2 × 2&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; expression median&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;bch:expr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;bch:tm&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> dplyr 302.5µs&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> $&amp;lt;-.tbl_df 12.8µs&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>By default, both &lt;code>mutate()&lt;/code> and &lt;code>$&amp;lt;-.tbl_df&lt;/code> append the new column at the right-most position. The &lt;code>.before&lt;/code> and &lt;code>.after&lt;/code> arguments to &lt;code>mutate()&lt;/code> are a really nice interface to adjust that behavior, and I miss it often when using &lt;code>$&amp;lt;-.tbl_df&lt;/code>. In those cases, &lt;code>select()&lt;/code> and its alternatives (see next section!) can be helpful.&lt;/p>
&lt;p>Some examples of changes like this made to tidymodels packages:
&lt;a href="https://github.com/tidymodels/parsnip/pull/933" target="_blank" rel="noopener">tidymodels/parsnip#933&lt;/a>,
&lt;a href="https://github.com/tidymodels/parsnip/pull/921" target="_blank" rel="noopener">tidymodels/parsnip#921&lt;/a>, and
&lt;a href="https://github.com/tidymodels/parsnip/pull/901" target="_blank" rel="noopener">tidymodels/parsnip#901&lt;/a>.&lt;/p>
&lt;h4 id="select">&lt;code>select()&lt;/code>
&lt;a href="#select">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h4>&lt;p>The dplyr code:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/select.html'>select&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>mtcars_tbl&lt;/span>, &lt;span class='nv'>hp&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>&amp;hellip;can be replaced by:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>[&lt;/span>&lt;span class='s'>"hp"&lt;/span>&lt;span class='o'>]&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>&amp;hellip;with benchmarks:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>bench&lt;/span>&lt;span class='nf'>::&lt;/span>&lt;span class='nf'>&lt;a href='http://bench.r-lib.org/reference/mark.html'>mark&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> dplyr &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/select.html'>select&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>mtcars_tbl&lt;/span>, &lt;span class='nv'>hp&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> `[.tbl_df` &lt;span class='o'>=&lt;/span> &lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>[&lt;/span>&lt;span class='s'>"hp"&lt;/span>&lt;span class='o'>]&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>&lt;a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&amp;gt;%&lt;/a>&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/select.html'>select&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>expression&lt;/span>, &lt;span class='nv'>median&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 2 × 2&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; expression median&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;bch:expr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;bch:tm&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> dplyr 527.01µs&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> [.tbl_df 8.08µs&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>Of course, the nice part about &lt;code>select()&lt;/code>, and something we make use of in tidymodels quite a bit, is tidyselect. I&amp;rsquo;ve often found that we lean heavily on selecting via external vectors, i.e. character vectors, i.e. things that can be inputted to &lt;code>[.tbl_df&lt;/code> directly. That is:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>cols&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"hp"&lt;/span>, &lt;span class='s'>"wt"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nf'>bench&lt;/span>&lt;span class='nf'>::&lt;/span>&lt;span class='nf'>&lt;a href='http://bench.r-lib.org/reference/mark.html'>mark&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> dplyr &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/select.html'>select&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>mtcars_tbl&lt;/span>, &lt;span class='nf'>&lt;a href='https://tidyselect.r-lib.org/reference/all_of.html'>all_of&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>cols&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> `[.tbl_df` &lt;span class='o'>=&lt;/span> &lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>[&lt;/span>&lt;span class='nv'>cols&lt;/span>&lt;span class='o'>]&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>&lt;a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&amp;gt;%&lt;/a>&lt;/span> &lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/select.html'>select&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>expression&lt;/span>, &lt;span class='nv'>median&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 2 × 2&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; expression median&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;bch:expr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;bch:tm&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> dplyr 548.74µs&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> [.tbl_df 8.53µs&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>Note that &lt;code>[.tbl_df&lt;/code> always sets &lt;code>drop = FALSE&lt;/code>.&lt;/p>
&lt;p>&lt;code>[.tbl_df&lt;/code> can also be used as an alternative interface to &lt;code>select()&lt;/code> or &lt;code>relocate()&lt;/code> with a &lt;code>.before&lt;/code> or &lt;code>.after&lt;/code> argument. For instance, to place that column &lt;code>year&lt;/code> we made in the last section as the second column, we could write:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>left_cols&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"make_model"&lt;/span>, &lt;span class='s'>"year"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>[&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>left_cols&lt;/span>, &lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://generics.r-lib.org/reference/setops.html'>setdiff&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/colnames.html'>colnames&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>)&lt;/span>, &lt;span class='nv'>left_cols&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span> &lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>]&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>No, thanks, but it is a good bit faster than tidyselect-based alternatives:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>bench&lt;/span>&lt;span class='nf'>::&lt;/span>&lt;span class='nf'>&lt;a href='http://bench.r-lib.org/reference/mark.html'>mark&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> mutate &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>mtcars_tbl&lt;/span>, year &lt;span class='o'>=&lt;/span> &lt;span class='m'>1974L&lt;/span>, .after &lt;span class='o'>=&lt;/span> &lt;span class='nv'>make_model&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> relocate &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/relocate.html'>relocate&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>mtcars_tbl&lt;/span>, &lt;span class='nv'>year&lt;/span>, .after &lt;span class='o'>=&lt;/span> &lt;span class='nv'>make_model&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> `[.tbl_df` &lt;span class='o'>=&lt;/span> &lt;/span>
&lt;span> &lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>[&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>left_cols&lt;/span>, &lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/colnames.html'>colnames&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>[&lt;/span>&lt;span class='o'>!&lt;/span>&lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/colnames.html'>colnames&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>&lt;a href='https://rdrr.io/r/base/match.html'>%in%&lt;/a>&lt;/span> &lt;span class='nv'>left_cols&lt;/span>&lt;span class='o'>]&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span> &lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span> &lt;span class='o'>]&lt;/span>,&lt;/span>
&lt;span> check &lt;span class='o'>=&lt;/span> &lt;span class='kc'>FALSE&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>&lt;a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&amp;gt;%&lt;/a>&lt;/span> &lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/select.html'>select&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>expression&lt;/span>, &lt;span class='nv'>median&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 3 × 2&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; expression median&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;bch:expr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;bch:tm&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> mutate 1.2ms&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> relocate 804.3µs&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> [.tbl_df 19.1µs&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>Some examples of changes like this made to tidymodels packages:
&lt;a href="https://github.com/tidymodels/parsnip/pull/935" target="_blank" rel="noopener">tidymodels/parsnip#935&lt;/a>,
&lt;a href="https://github.com/tidymodels/parsnip/pull/933" target="_blank" rel="noopener">tidymodels/parsnip#933&lt;/a>,
&lt;a href="https://github.com/tidymodels/parsnip/pull/921" target="_blank" rel="noopener">tidymodels/parsnip#921&lt;/a>, and
&lt;a href="https://github.com/tidymodels/tune/pull/635" target="_blank" rel="noopener">tidymodels/tune#635&lt;/a>.&lt;/p>
&lt;h4 id="pull">&lt;code>pull()&lt;/code>
&lt;a href="#pull">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h4>&lt;p>The dplyr code:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/pull.html'>pull&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>mtcars_tbl&lt;/span>, &lt;span class='nv'>hp&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>&amp;hellip;can be replaced by:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>$&lt;/span>&lt;span class='nv'>hp&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>&amp;hellip;or:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>[[&lt;/span>&lt;span class='s'>"hp"&lt;/span>&lt;span class='o'>]&lt;/span>&lt;span class='o'>]&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>Note that, for tibbles, &lt;code>$&lt;/code> will raise a warning if the subsetted column doesn&amp;rsquo;t exist, while &lt;code>[[&lt;/code> will silently return &lt;code>NULL&lt;/code>.&lt;/p>
&lt;p>With benchmarks:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>bench&lt;/span>&lt;span class='nf'>::&lt;/span>&lt;span class='nf'>&lt;a href='http://bench.r-lib.org/reference/mark.html'>mark&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> dplyr &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/pull.html'>pull&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>mtcars_tbl&lt;/span>, &lt;span class='nv'>hp&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> `$.tbl_df` &lt;span class='o'>=&lt;/span> &lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>$&lt;/span>&lt;span class='nv'>hp&lt;/span>,&lt;/span>
&lt;span> `[[.tbl_df` &lt;span class='o'>=&lt;/span> &lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>[[&lt;/span>&lt;span class='s'>"hp"&lt;/span>&lt;span class='o'>]&lt;/span>&lt;span class='o'>]&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>&lt;a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&amp;gt;%&lt;/a>&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/select.html'>select&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>expression&lt;/span>, &lt;span class='nv'>median&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 3 × 2&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; expression median&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;bch:expr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;bch:tm&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> dplyr 101.19µs&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> $.tbl_df 615.02ns&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> [[.tbl_df 2.25µs&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>Some examples of changes like this made to tidymodels packages:
&lt;a href="https://github.com/tidymodels/parsnip/pull/935" target="_blank" rel="noopener">tidymodels/parsnip#935&lt;/a> and
&lt;a href="https://github.com/tidymodels/tune/pull/635" target="_blank" rel="noopener">tidymodels/tune#635&lt;/a>.&lt;/p>
&lt;h4 id="bind_">&lt;code>bind_*()&lt;/code>
&lt;a href="#bind_">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h4>&lt;p>&lt;code>bind_rows()&lt;/code> and &lt;code>bind_cols()&lt;/code> can be substituted for &lt;code>vec_rbind()&lt;/code> and &lt;code>vec_cbind()&lt;/code>, respectively. First, row-binding:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>bench&lt;/span>&lt;span class='nf'>::&lt;/span>&lt;span class='nf'>&lt;a href='http://bench.r-lib.org/reference/mark.html'>mark&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> dplyr &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/bind_rows.html'>bind_rows&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>mtcars_tbl&lt;/span>, &lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> vctrs &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://vctrs.r-lib.org/reference/vec_bind.html'>vec_rbind&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>mtcars_tbl&lt;/span>, &lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>&lt;a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&amp;gt;%&lt;/a>&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/select.html'>select&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>expression&lt;/span>, &lt;span class='nv'>median&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 2 × 2&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; expression median&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;bch:expr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;bch:tm&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> dplyr 44µs&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> vctrs 14.3µs&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>As for column-binding:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>tbl&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>year &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/rep.html'>rep&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='m'>1974L&lt;/span>, &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/nrow.html'>nrow&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nf'>bench&lt;/span>&lt;span class='nf'>::&lt;/span>&lt;span class='nf'>&lt;a href='http://bench.r-lib.org/reference/mark.html'>mark&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> dplyr &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/bind_cols.html'>bind_cols&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>mtcars_tbl&lt;/span>, &lt;span class='nv'>tbl&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> vctrs &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://vctrs.r-lib.org/reference/vec_bind.html'>vec_cbind&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>mtcars_tbl&lt;/span>, &lt;span class='nv'>tbl&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>&lt;a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&amp;gt;%&lt;/a>&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/select.html'>select&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>expression&lt;/span>, &lt;span class='nv'>median&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 2 × 2&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; expression median&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;bch:expr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;bch:tm&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> dplyr 60.7µs&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> vctrs 26.2µs&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>Some examples of changes like this made to tidymodels packages:
&lt;a href="https://github.com/tidymodels/tune/pull/636" target="_blank" rel="noopener">tidymodels/tune#636&lt;/a>.&lt;/p>
&lt;h4 id="grouping">Grouping
&lt;a href="#grouping">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h4>&lt;p>In general, the introduction of groups makes these substitutions much trickier. In those cases, it&amp;rsquo;s likely best to weigh (via profiling) how significant the slowdown is and, if it&amp;rsquo;s not too bad, opt not to make any changes. For code that relies on &lt;code>group_by()&lt;/code> and sees heavy traffic, see &lt;code>vctrs::list_unchop()&lt;/code>, &lt;code>vctrs::vec_chop()&lt;/code>, and &lt;code>vctrs::vec_rep_each()&lt;/code>.&lt;/p>
&lt;h3 id="tibbles">Tibbles
&lt;a href="#tibbles">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h3>&lt;p>Tibbles are great, and I don&amp;rsquo;t want to interface with any other data frame-y thing. Some notes:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>as_tibble()&lt;/code> on a tibble is not &amp;ldquo;free&amp;rdquo;:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>bench&lt;/span>&lt;span class='nf'>::&lt;/span>&lt;span class='nf'>&lt;a href='http://bench.r-lib.org/reference/mark.html'>mark&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> on_tbl_df &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/as_tibble.html'>as_tibble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> on_data.frame &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/as_tibble.html'>as_tibble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>mtcars&lt;/span>, rownames &lt;span class='o'>=&lt;/span> &lt;span class='s'>"make_model"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>&lt;a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&amp;gt;%&lt;/a>&lt;/span> &lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/select.html'>select&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>expression&lt;/span>, &lt;span class='nv'>median&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 2 × 2&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; expression median&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;bch:expr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;bch:tm&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> on_tbl_df 51.2µs&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> on_data.frame 238.6µs&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>Note that the time to coerce data frames and tibbles doesn&amp;rsquo;t depend on the size of the data being coerced, in most situations.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Building a tibble from scratch using &lt;code>tibble()&lt;/code> actually takes quite a while as well. &lt;code>tibble()&lt;/code> handles vector recycling and name checking, builds columns sequentially, all that good stuff. If you need that, use &lt;code>tibble()&lt;/code>, but if you&amp;rsquo;re building a tibble from well-understood inputs, use &lt;code>new_tibble()&lt;/code>, which minimizes validation checks. For a middle ground between &lt;code>tibble()&lt;/code> and &lt;code>new_tibble(list())&lt;/code> in terms of both performance and safety, use the &lt;code>df_list()&lt;/code> function from the vctrs package in place of &lt;code>list()&lt;/code>.&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>bench&lt;/span>&lt;span class='nf'>::&lt;/span>&lt;span class='nf'>&lt;a href='http://bench.r-lib.org/reference/mark.html'>mark&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> tibble &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>a &lt;span class='o'>=&lt;/span> &lt;span class='m'>1&lt;/span>&lt;span class='o'>:&lt;/span>&lt;span class='m'>2&lt;/span>, b &lt;span class='o'>=&lt;/span> &lt;span class='m'>3&lt;/span>&lt;span class='o'>:&lt;/span>&lt;span class='m'>4&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> new_tibble_df_list &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/new_tibble.html'>new_tibble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>&lt;a href='https://vctrs.r-lib.org/reference/df_list.html'>df_list&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>a &lt;span class='o'>=&lt;/span> &lt;span class='m'>1&lt;/span>&lt;span class='o'>:&lt;/span>&lt;span class='m'>2&lt;/span>, b &lt;span class='o'>=&lt;/span> &lt;span class='m'>3&lt;/span>&lt;span class='o'>:&lt;/span>&lt;span class='m'>4&lt;/span>&lt;span class='o'>)&lt;/span>, nrow &lt;span class='o'>=&lt;/span> &lt;span class='m'>2&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> new_tibble_list &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/new_tibble.html'>new_tibble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/list.html'>list&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>a &lt;span class='o'>=&lt;/span> &lt;span class='m'>1&lt;/span>&lt;span class='o'>:&lt;/span>&lt;span class='m'>2&lt;/span>, b &lt;span class='o'>=&lt;/span> &lt;span class='m'>3&lt;/span>&lt;span class='o'>:&lt;/span>&lt;span class='m'>4&lt;/span>&lt;span class='o'>)&lt;/span>, nrow &lt;span class='o'>=&lt;/span> &lt;span class='m'>2&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>&lt;a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&amp;gt;%&lt;/a>&lt;/span> &lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/select.html'>select&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>expression&lt;/span>, &lt;span class='nv'>median&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 3 × 2&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; expression median&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;bch:expr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;bch:tm&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> tibble 165.97µs&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> new_tibble_df_list 16.69µs&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> new_tibble_list 4.96µs&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>Note that &lt;code>new_tibble()&lt;/code> &lt;em>will not check the lengths of its inputs.&lt;/em> Carry out simple recycling yourself, and be sure to use the &lt;code>nrow&lt;/code> argument to get basic length checks.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>Some examples of changes like this made to tidymodels packages:
&lt;a href="https://github.com/tidymodels/parsnip/pull/932" target="_blank" rel="noopener">tidymodels/parsnip#945&lt;/a>,
&lt;a href="https://github.com/tidymodels/parsnip/pull/934" target="_blank" rel="noopener">tidymodels/parsnip#934&lt;/a>,
&lt;a href="https://github.com/tidymodels/parsnip/pull/929" target="_blank" rel="noopener">tidymodels/parsnip#929&lt;/a>,
&lt;a href="https://github.com/tidymodels/parsnip/pull/923" target="_blank" rel="noopener">tidymodels/parsnip#923&lt;/a>,
&lt;a href="https://github.com/tidymodels/parsnip/pull/902" target="_blank" rel="noopener">tidymodels/parsnip#902&lt;/a>,
&lt;a href="https://github.com/tidymodels/dials/pull/277" target="_blank" rel="noopener">tidymodels/dials#277&lt;/a>, and
&lt;a href="https://github.com/tidymodels/tune/pull/637" target="_blank" rel="noopener">tidymodels/tune#637&lt;/a>.&lt;/p>
&lt;h3 id="becoming-join-critical">Becoming join-critical
&lt;a href="#becoming-join-critical">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h3>&lt;p>Two truths:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>dplyr joins are a remarkably safe and powerful way to synthesize data sources.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>One ought to ask themselves &amp;ldquo;does this really need to be a join?&amp;rdquo; when combining data sources in package code.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>Some ways to intuit about join efficiency:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>If this join happens multiple times, is it possible to express it as one join and then subset it when needed? i.e. if a join happens inside of a loop but the elements of the join are not indices of the loop, it&amp;rsquo;s likely possible to pull that join outside of the loop and then &lt;code>vec_slice()&lt;/code> its results inside of the loop.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Am I using the complete outputted join result or just a portion? If I end up only making use of column names, or values in one column (as with joins approximating
&lt;a href="https://adv-r.hadley.nz/subsetting.html?q=lookup#lookup-tables" target="_blank" rel="noopener">lookup tables&lt;/a>), or pairings between two columns, I may be able to instead use &lt;code>$.tbl_df&lt;/code> or &lt;code>[.tbl_df&lt;/code>.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>As an example, imagine we have another tibble that tells us additional information about the &lt;code>make_model&lt;/code>s that I&amp;rsquo;ve driven:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>my_cars&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> make_model &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"Honda Civic"&lt;/span>, &lt;span class='s'>"Subaru Forester"&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> color &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"Grey"&lt;/span>, &lt;span class='s'>"White"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span> &lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>my_cars&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 2 × 2&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; make_model color&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> Honda Civic Grey &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> Subaru Forester White&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>I &lt;em>could&lt;/em> use a join to subset down to cars in &lt;code>mtcars_tbl&lt;/code> and add this information on the cars I&amp;rsquo;ve driven:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>inner_join&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>mtcars_tbl&lt;/span>, &lt;span class='nv'>my_cars&lt;/span>, &lt;span class='s'>"make_model"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 1 × 13&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; make_model mpg cyl disp hp drat wt qsec vs am gear carb&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> Honda Civic 30.4 4 75.7 52 4.93 1.62 18.5 1 1 4 2&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># ℹ 1 more variable: color &amp;lt;chr&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>Another way to express this, though, if I can safely assume that each of my cars would have only one or zero matches in &lt;code>mtcars_tbl&lt;/code>, is to find entries in &lt;code>mtcars_tbl$make_model&lt;/code> that match entries in &lt;code>my_cars$make_model&lt;/code>, subset down to those matches, and then bind columns:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>supplement_my_cars&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='kr'>function&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>&amp;#123;&lt;/span>&lt;/span>
&lt;span> &lt;span class='c'># locate matches, assuming only 0 or 1 matches possible&lt;/span>&lt;/span>
&lt;span> &lt;span class='nv'>loc&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://vctrs.r-lib.org/reference/vec_match.html'>vec_match&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>my_cars&lt;/span>&lt;span class='o'>$&lt;/span>&lt;span class='nv'>make_model&lt;/span>, &lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>$&lt;/span>&lt;span class='nv'>make_model&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span> &lt;/span>
&lt;span> &lt;span class='c'># keep only the matches&lt;/span>&lt;/span>
&lt;span> &lt;span class='nv'>loc_mine&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/which.html'>which&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='o'>!&lt;/span>&lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/NA.html'>is.na&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>loc&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span> &lt;span class='nv'>loc_mtcars&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://vctrs.r-lib.org/reference/vec_slice.html'>vec_slice&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>loc&lt;/span>, &lt;span class='o'>!&lt;/span>&lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/NA.html'>is.na&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>loc&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span> &lt;/span>
&lt;span> &lt;span class='c'># drop duplicated join column&lt;/span>&lt;/span>
&lt;span> &lt;span class='nv'>my_cars_join&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nv'>my_cars&lt;/span>&lt;span class='o'>[&lt;/span>&lt;span class='nf'>&lt;a href='https://generics.r-lib.org/reference/setops.html'>setdiff&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/names.html'>names&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>my_cars&lt;/span>&lt;span class='o'>)&lt;/span>, &lt;span class='s'>"make_model"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>]&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://vctrs.r-lib.org/reference/vec_bind.html'>vec_cbind&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://vctrs.r-lib.org/reference/vec_slice.html'>vec_slice&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>mtcars_tbl&lt;/span>, &lt;span class='nv'>loc_mtcars&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://vctrs.r-lib.org/reference/vec_slice.html'>vec_slice&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>my_cars_join&lt;/span>, &lt;span class='nv'>loc_mine&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span> &lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>&amp;#125;&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nf'>supplement_my_cars&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 1 × 13&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; make_model mpg cyl disp hp drat wt qsec vs am gear carb&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;chr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> Honda Civic 30.4 4 75.7 52 4.93 1.62 18.5 1 1 4 2&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># ℹ 1 more variable: color &amp;lt;chr&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>This is indeed quite a bit faster:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>bench&lt;/span>&lt;span class='nf'>::&lt;/span>&lt;span class='nf'>&lt;a href='http://bench.r-lib.org/reference/mark.html'>mark&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> inner_join &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>inner_join&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>mtcars_tbl&lt;/span>, &lt;span class='nv'>my_cars&lt;/span>, &lt;span class='s'>"make_model"&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> manual &lt;span class='o'>=&lt;/span> &lt;span class='nf'>supplement_my_cars&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>&lt;a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&amp;gt;%&lt;/a>&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/select.html'>select&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>expression&lt;/span>, &lt;span class='nv'>median&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 2 × 2&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; expression median&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;bch:expr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;bch:tm&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> inner_join 438µs&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> manual 50.7µs&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>At the same time, if either of these problems were even a little bit more complex, e.g. if there were possibly multiple matching &lt;code>make_models&lt;/code> in &lt;code>mtcars_tbl&lt;/code> or if I wanted to keep all rows in &lt;code>mtcars_tbl&lt;/code> regardless of whether I had driven the car, then expressing this join with more bare-bones operations quickly becomes less readable and more error-prone. In those cases, too, joins in dplyr have a relatively small amount of overhead when compared to the vctrs backends underlying them. So, optimize carefully!&lt;/p>
&lt;p>Some examples of writing out joins in tidymodels packages:
&lt;a href="https://github.com/tidymodels/parsnip/pull/932" target="_blank" rel="noopener">tidymodels/parsnip#932&lt;/a>,
&lt;a href="https://github.com/tidymodels/parsnip/pull/931" target="_blank" rel="noopener">tidymodels/parsnip#931&lt;/a>,
&lt;a href="https://github.com/tidymodels/parsnip/pull/921" target="_blank" rel="noopener">tidymodels/parsnip#921&lt;/a>, and
&lt;a href="https://github.com/tidymodels/recipes/pull/1121" target="_blank" rel="noopener">tidymodels/recipes#1121&lt;/a>.&lt;/p>
&lt;h3 id="nest">&lt;code>nest()&lt;/code>
&lt;a href="#nest">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h3>&lt;p>&lt;code>nest()&lt;/code>s are subject to similar considerations as joins. When they allow for expressive or principled user interfaces, use them, but manipulate them sparingly in backends. Writing out &lt;code>nest()&lt;/code> calls &lt;em>can&lt;/em> result in substantial speedups, though, and the process is not quite as gnarly as writing out a join. For code that relies on &lt;code>nest()&lt;/code>s and sees heavy traffic, rewriting with vctrs may be worth the effort.&lt;/p>
&lt;p>For example, consider nesting &lt;code>mtcars_tbl&lt;/code> by &lt;code>cyl&lt;/code> and &lt;code>am&lt;/code>:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>&lt;a href='https://tidyr.tidyverse.org/reference/nest.html'>nest&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>mtcars_tbl&lt;/span>, .by &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>cyl&lt;/span>, &lt;span class='nv'>am&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 6 × 3&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; cyl am data &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;list&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 6 1 &lt;span style='color: #555555;'>&amp;lt;tibble [3 × 10]&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 4 1 &lt;span style='color: #555555;'>&amp;lt;tibble [8 × 10]&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> 6 0 &lt;span style='color: #555555;'>&amp;lt;tibble [4 × 10]&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> 8 0 &lt;span style='color: #555555;'>&amp;lt;tibble [12 × 10]&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>5&lt;/span> 4 0 &lt;span style='color: #555555;'>&amp;lt;tibble [3 × 10]&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>6&lt;/span> 8 1 &lt;span style='color: #555555;'>&amp;lt;tibble [2 × 10]&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>For some basic nests, &lt;code>vec_split()&lt;/code> can do the trick.&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>nest_cols&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"cyl"&lt;/span>, &lt;span class='s'>"am"&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nv'>res&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://vctrs.r-lib.org/reference/vec_split.html'>vec_split&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> x &lt;span class='o'>=&lt;/span> &lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>[&lt;/span>&lt;span class='nf'>&lt;a href='https://generics.r-lib.org/reference/setops.html'>setdiff&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/colnames.html'>colnames&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>)&lt;/span>, &lt;span class='nv'>nest_cols&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>]&lt;/span>,&lt;/span>
&lt;span> by &lt;span class='o'>=&lt;/span> &lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>[&lt;/span>&lt;span class='nv'>nest_cols&lt;/span>&lt;span class='o'>]&lt;/span>&lt;/span>
&lt;span> &lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nf'>&lt;a href='https://vctrs.r-lib.org/reference/vec_bind.html'>vec_cbind&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>res&lt;/span>&lt;span class='o'>$&lt;/span>&lt;span class='nv'>key&lt;/span>, &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/new_tibble.html'>new_tibble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/list.html'>list&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>data &lt;span class='o'>=&lt;/span> &lt;span class='nv'>res&lt;/span>&lt;span class='o'>$&lt;/span>&lt;span class='nv'>val&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 6 × 3&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; cyl am data &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;dbl&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;list&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> 6 1 &lt;span style='color: #555555;'>&amp;lt;tibble [3 × 10]&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> 4 1 &lt;span style='color: #555555;'>&amp;lt;tibble [8 × 10]&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> 6 0 &lt;span style='color: #555555;'>&amp;lt;tibble [4 × 10]&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>4&lt;/span> 8 0 &lt;span style='color: #555555;'>&amp;lt;tibble [12 × 10]&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>5&lt;/span> 4 0 &lt;span style='color: #555555;'>&amp;lt;tibble [3 × 10]&amp;gt;&lt;/span> &lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>6&lt;/span> 8 1 &lt;span style='color: #555555;'>&amp;lt;tibble [2 × 10]&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>The performance improvement in these situations can be quite substantial:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nf'>bench&lt;/span>&lt;span class='nf'>::&lt;/span>&lt;span class='nf'>&lt;a href='http://bench.r-lib.org/reference/mark.html'>mark&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> nest &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://tidyr.tidyverse.org/reference/nest.html'>nest&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>mtcars_tbl&lt;/span>, .by &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/c.html'>c&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>cyl&lt;/span>, &lt;span class='nv'>am&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> vctrs &lt;span class='o'>=&lt;/span> &lt;span class='o'>&amp;#123;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nv'>res&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://vctrs.r-lib.org/reference/vec_split.html'>vec_split&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> x &lt;span class='o'>=&lt;/span> &lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>[&lt;/span>&lt;span class='nf'>&lt;a href='https://generics.r-lib.org/reference/setops.html'>setdiff&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/colnames.html'>colnames&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>)&lt;/span>, &lt;span class='nv'>nest_cols&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>]&lt;/span>,&lt;/span>
&lt;span> by &lt;span class='o'>=&lt;/span> &lt;span class='nv'>mtcars_tbl&lt;/span>&lt;span class='o'>[&lt;/span>&lt;span class='nv'>nest_cols&lt;/span>&lt;span class='o'>]&lt;/span>&lt;/span>
&lt;span> &lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span> &lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://vctrs.r-lib.org/reference/vec_bind.html'>vec_cbind&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>res&lt;/span>&lt;span class='o'>$&lt;/span>&lt;span class='nv'>key&lt;/span>, &lt;span class='nf'>&lt;a href='https://tibble.tidyverse.org/reference/new_tibble.html'>new_tibble&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/list.html'>list&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>data &lt;span class='o'>=&lt;/span> &lt;span class='nv'>res&lt;/span>&lt;span class='o'>$&lt;/span>&lt;span class='nv'>val&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span> &lt;span class='o'>&amp;#125;&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>&lt;a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&amp;gt;%&lt;/a>&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/select.html'>select&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>expression&lt;/span>, &lt;span class='nv'>median&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 2 × 2&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; expression median&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;bch:expr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;bch:tm&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> nest 1.81ms&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> vctrs 67.61µs&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>More complex nests require a good bit of facility with the vctrs package. &lt;code>vec_split()&lt;/code>, &lt;code>list_unchop()&lt;/code>, and &lt;code>vec_chop()&lt;/code> are all good places to start, and these examples of writing out nests in tidymodels packages make use of other vctrs patterns:
&lt;a href="https://github.com/tidymodels/tune/pull/657" target="_blank" rel="noopener">tidymodels/tune#657&lt;/a>,
&lt;a href="https://github.com/tidymodels/tune/pull/656" target="_blank" rel="noopener">tidymodels/tune#657&lt;/a>,
&lt;a href="https://github.com/tidymodels/tune/pull/640" target="_blank" rel="noopener">tidymodels/tune#640&lt;/a>, and
&lt;a href="https://github.com/tidymodels/recipes/pull/1121" target="_blank" rel="noopener">tidymodels/recipes#1121&lt;/a>.&lt;/p>
&lt;h3 id="combining-strings">Combining strings
&lt;a href="#combining-strings">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h3>&lt;p>The glue package is super helpful for writing expressive and correct strings with data, though it is quite a bit slower than &lt;code>paste0()&lt;/code>. At the same time, &lt;code>paste0()&lt;/code> has some tricky recycling behavior. For a middle ground in terms of both performance and safety, this short wrapper has been quite helpful:&lt;/p>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>vec_paste0&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='kr'>function&lt;/span> &lt;span class='o'>(&lt;/span>&lt;span class='nv'>...&lt;/span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>&amp;#123;&lt;/span>&lt;/span>
&lt;span> &lt;span class='nv'>args&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='nf'>&lt;a href='https://vctrs.r-lib.org/reference/vec_recycle.html'>vec_recycle_common&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>...&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://rlang.r-lib.org/reference/exec.html'>exec&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>paste0&lt;/span>, &lt;span class='o'>!&lt;/span>&lt;span class='o'>!&lt;/span>&lt;span class='o'>!&lt;/span>&lt;span class='nv'>args&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>&amp;#125;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;div class="highlight">
&lt;pre class='chroma'>&lt;code class='language-r' data-lang='r'>&lt;span>&lt;span class='nv'>name&lt;/span> &lt;span class='o'>&amp;lt;-&lt;/span> &lt;span class='s'>"Simon"&lt;/span>&lt;/span>
&lt;span>&lt;/span>
&lt;span>&lt;span class='nf'>bench&lt;/span>&lt;span class='nf'>::&lt;/span>&lt;span class='nf'>&lt;a href='http://bench.r-lib.org/reference/mark.html'>mark&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;/span>
&lt;span> glue &lt;span class='o'>=&lt;/span> &lt;span class='nf'>glue&lt;/span>&lt;span class='nf'>::&lt;/span>&lt;span class='nf'>&lt;a href='https://glue.tidyverse.org/reference/glue.html'>glue&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"My name is &amp;#123;name&amp;#125;."&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> vec_paste0 &lt;span class='o'>=&lt;/span> &lt;span class='nf'>vec_paste0&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"My name is "&lt;/span>, &lt;span class='nv'>name&lt;/span>, &lt;span class='s'>"."&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> paste0 &lt;span class='o'>=&lt;/span> &lt;span class='nf'>&lt;a href='https://rdrr.io/r/base/paste.html'>paste0&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='s'>"My name is "&lt;/span>, &lt;span class='nv'>name&lt;/span>, &lt;span class='s'>"."&lt;/span>&lt;span class='o'>)&lt;/span>,&lt;/span>
&lt;span> check &lt;span class='o'>=&lt;/span> &lt;span class='kc'>FALSE&lt;/span>&lt;/span>
&lt;span>&lt;span class='o'>)&lt;/span> &lt;span class='o'>&lt;a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&amp;gt;%&lt;/a>&lt;/span> &lt;/span>
&lt;span> &lt;span class='nf'>&lt;a href='https://dplyr.tidyverse.org/reference/select.html'>select&lt;/a>&lt;/span>&lt;span class='o'>(&lt;/span>&lt;span class='nv'>expression&lt;/span>, &lt;span class='nv'>median&lt;/span>&lt;span class='o'>)&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'># A tibble: 3 × 2&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; expression median&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555; font-style: italic;'>&amp;lt;bch:expr&amp;gt;&lt;/span> &lt;span style='color: #555555; font-style: italic;'>&amp;lt;bch:tm&amp;gt;&lt;/span>&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>1&lt;/span> glue 38.99µs&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>2&lt;/span> vec_paste0 3.98µs&lt;/span>&lt;/span>
&lt;span>&lt;span class='c'>#&amp;gt; &lt;span style='color: #555555;'>3&lt;/span> paste0 861.01ns&lt;/span>&lt;/span>
&lt;span>&lt;/span>&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>My rule of thumb is to use &lt;code>glue()&lt;/code> for errors, when the function will stop executing anyway. For simple pastes that are intended to be called repeatedly, use &lt;code>vec_paste0()&lt;/code>. There&amp;rsquo;s a lot of gray area in between those two contexts&amp;mdash;intuit (or profile) as you will.&lt;/p>
&lt;h2 id="wrapping-up">Wrapping up
&lt;a href="#wrapping-up">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>This post contains a number of tricks that offer especially performant alternatives to interfaces from dplyr and tidyr. Making use of these backend tools is certainly a trade-off; what is gained in computational performance is also offset by a decline in readability and safety, so developers ought to consider carefully when optimizations are worth the effort and risk.&lt;/p>
&lt;p>Thanks to Davis Vaughan for the guidance in getting started with vctrs. Also, thanks to both Davis Vaughan and Lionel Henry for their efforts in helping the tidymodels team address the bottlenecks that have been surfaced by our work on optimizations in tidyverse packages.&lt;/p></description></item><item><title>Tidy eval now supports glue strings</title><link>https://www.tidyverse.org/blog/2020/02/glue-strings-and-tidy-eval/</link><pubDate>Tue, 11 Feb 2020 00:00:00 +0000</pubDate><guid>https://www.tidyverse.org/blog/2020/02/glue-strings-and-tidy-eval/</guid><description>&lt;p>
&lt;a href="https://www.tidyverse.org/blog/2019/06/rlang-0-4-0/" target="_blank" rel="noopener">rlang 0.4.0&lt;/a> introduced the curly-curly &lt;code>{{&lt;/code> operator to simplify writing functions around tidyverse pipelines. The minor update 0.4.3 of rlang makes it possible to use &lt;code>{&lt;/code> and &lt;code>{{&lt;/code> to create result names in tidyverse verbs taking pairs of names and expressions.&lt;/p>
&lt;p>Install the latest version of rlang to make the new feature globally available throughout the tidyverse:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="nf">install.packages&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;rlang&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>
&lt;h2 id="tunnelling-data-variables-with-curly-curly">Tunnelling data-variables with curly-curly
&lt;a href="#tunnelling-data-variables-with-curly-curly">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>With the &lt;code>{{&lt;/code> operator you can &lt;strong>tunnel&lt;/strong> data-variables (i.e. columns from the data frames) through arg-variables (function arguments):&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="nf">library&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">tidyverse&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">mean_by&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">by&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">var&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="n">data&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;span class="nf">group_by&lt;/span>&lt;span class="p">({{&lt;/span> &lt;span class="n">by&lt;/span> &lt;span class="p">}})&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;span class="nf">summarise&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">avg&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">mean&lt;/span>&lt;span class="p">({{&lt;/span> &lt;span class="n">var&lt;/span> &lt;span class="p">}},&lt;/span> &lt;span class="n">na.rm&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">TRUE&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>The tunnel makes it possible to supply variables from the data frame to your wrapper function:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="n">iris&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span> &lt;span class="nf">mean_by&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Species&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Sepal.Width&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="c1">#&amp;gt; # A tibble: 3 x 2&lt;/span>
&lt;span class="c1">#&amp;gt; Species avg&lt;/span>
&lt;span class="c1">#&amp;gt; &amp;lt;fct&amp;gt; &amp;lt;dbl&amp;gt;&lt;/span>
&lt;span class="c1">#&amp;gt; 1 setosa 3.43&lt;/span>
&lt;span class="c1">#&amp;gt; 2 versicolor 2.77&lt;/span>
&lt;span class="c1">#&amp;gt; 3 virginica 2.97&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Without a tunnel, the ambiguity between data-variables and arg-variables causes R to complain about objects not found:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="n">mean_by_no_tunnel&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">by&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">var&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="n">data&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;span class="nf">group_by&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">by&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;span class="nf">summarise&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">avg&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">mean&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">var&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">na.rm&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">TRUE&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="n">iris&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span> &lt;span class="nf">mean_by_no_tunnel&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Species&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Sepal.Width&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="c1">#&amp;gt; Error: Must group by variables found in `.data`&lt;/span>
&lt;span class="c1">#&amp;gt; * Column `by` is not found&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>That&amp;rsquo;s because of the ambiguity between the function argument &lt;code>by&lt;/code> and the data-variable &lt;code>Species&lt;/code>. R has no way of knowing that you meant the variable from the data frame.&lt;/p>
&lt;h2 id="custom-result-names">Custom result names
&lt;a href="#custom-result-names">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>In the example above, the result name is hard-coded to &lt;code>avg&lt;/code>. This is an informative generic name, but returning a more specific name that reflects the context might make the function more helpful. For this reason, tidy eval functions taking dots (like &lt;code>dplyr::mutate()&lt;/code>, &lt;code>dplyr::group_by()&lt;/code>, or &lt;code>dplyr::summarise()&lt;/code>) now support glue strings as result names.&lt;/p>
&lt;p>Glue strings are implemented in the
&lt;a href="https://glue.tidyverse.org/" target="_blank" rel="noopener">glue package&lt;/a>. They are a flexible way of composing a string from components, interpolating R code within the string:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="nf">library&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">glue&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="c1">#&amp;gt; &lt;/span>
&lt;span class="c1">#&amp;gt; Attaching package: &amp;#39;glue&amp;#39;&lt;/span>
&lt;span class="c1">#&amp;gt; The following object is masked from &amp;#39;package:dplyr&amp;#39;:&lt;/span>
&lt;span class="c1">#&amp;gt; &lt;/span>
&lt;span class="c1">#&amp;gt; collapse&lt;/span>
&lt;span class="n">name&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="s">&amp;#34;Bianca&amp;#34;&lt;/span>
&lt;span class="nf">glue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;The result of `1 + 2` is {1 + 2}, so says {name}.&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="c1">#&amp;gt; The result of `1 + 2` is 3, so says Bianca.&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>You can now use glue strings in result names. Note that for technical reasons you need the Walrus operator &lt;code>:=&lt;/code> instead of the usual &lt;code>=&lt;/code>.&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="n">suffix&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="s">&amp;#34;foo&amp;#34;&lt;/span>
&lt;span class="n">iris&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span> &lt;span class="nf">summarise&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;prefix_{suffix}&amp;#34;&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">mean&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Sepal.Width&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="c1">#&amp;gt; prefix_foo&lt;/span>
&lt;span class="c1">#&amp;gt; 1 3.057333&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>In addition to normal glue interpolation with &lt;code>{&lt;/code>, you can also tunnel data-variables through function arguments with &lt;code>{{&lt;/code> inside the string:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="n">mean_by&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">by&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">var&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="n">data&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;span class="nf">group_by&lt;/span>&lt;span class="p">({{&lt;/span> &lt;span class="n">by&lt;/span> &lt;span class="p">}})&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;span class="nf">summarise&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;{{ var }}&amp;#34;&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">mean&lt;/span>&lt;span class="p">({{&lt;/span> &lt;span class="n">var&lt;/span> &lt;span class="p">}},&lt;/span> &lt;span class="n">na.rm&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">TRUE&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="n">iris&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span> &lt;span class="nf">mean_by&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Species&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Sepal.Width&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="c1">#&amp;gt; # A tibble: 3 x 2&lt;/span>
&lt;span class="c1">#&amp;gt; Species Sepal.Width&lt;/span>
&lt;span class="c1">#&amp;gt; &amp;lt;fct&amp;gt; &amp;lt;dbl&amp;gt;&lt;/span>
&lt;span class="c1">#&amp;gt; 1 setosa 3.43&lt;/span>
&lt;span class="c1">#&amp;gt; 2 versicolor 2.77&lt;/span>
&lt;span class="c1">#&amp;gt; 3 virginica 2.97&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>And you can combine both forms of interpolation in a same glue string:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="n">mean_by&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">by&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">var&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">prefix&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;avg&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="n">data&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;span class="nf">group_by&lt;/span>&lt;span class="p">({{&lt;/span> &lt;span class="n">by&lt;/span> &lt;span class="p">}})&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;span class="nf">summarise&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;{prefix}_{{ var }}&amp;#34;&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">mean&lt;/span>&lt;span class="p">({{&lt;/span> &lt;span class="n">var&lt;/span> &lt;span class="p">}},&lt;/span> &lt;span class="n">na.rm&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">TRUE&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="n">iris&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span> &lt;span class="nf">mean_by&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Species&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Sepal.Width&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="c1">#&amp;gt; # A tibble: 3 x 2&lt;/span>
&lt;span class="c1">#&amp;gt; Species avg_Sepal.Width&lt;/span>
&lt;span class="c1">#&amp;gt; &amp;lt;fct&amp;gt; &amp;lt;dbl&amp;gt;&lt;/span>
&lt;span class="c1">#&amp;gt; 1 setosa 3.43&lt;/span>
&lt;span class="c1">#&amp;gt; 2 versicolor 2.77&lt;/span>
&lt;span class="c1">#&amp;gt; 3 virginica 2.97&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>You can learn more about tunnelling variables in
&lt;a href="https://speakerdeck.com/lionelhenry/interactivity-and-programming-in-the-tidyverse" target="_blank" rel="noopener">this RStudio::conf 2020 talk&lt;/a>.&lt;/p>
&lt;h2 id="acknowledgements">Acknowledgements
&lt;a href="#acknowledgements">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>Read about other bugfixes and features from the 0.4.3 release in the
&lt;a href="https://github.com/r-lib/rlang/blob/master/NEWS.md#rlang-043" target="_blank" rel="noopener">changelog&lt;/a>. Many thanks to all the contributors for this release!&lt;/p>
&lt;p>
&lt;a href="https://github.com/chendaniely" target="_blank" rel="noopener">@chendaniely&lt;/a>,
&lt;a href="https://github.com/clauswilke" target="_blank" rel="noopener">@clauswilke&lt;/a>,
&lt;a href="https://github.com/DavisVaughan" target="_blank" rel="noopener">@DavisVaughan&lt;/a>,
&lt;a href="https://github.com/enoshliang" target="_blank" rel="noopener">@enoshliang&lt;/a>,
&lt;a href="https://github.com/hadley" target="_blank" rel="noopener">@hadley&lt;/a>,
&lt;a href="https://github.com/ianmcook" target="_blank" rel="noopener">@ianmcook&lt;/a>,
&lt;a href="https://github.com/jennybc" target="_blank" rel="noopener">@jennybc&lt;/a>,
&lt;a href="https://github.com/krlmlr" target="_blank" rel="noopener">@krlmlr&lt;/a>,
&lt;a href="https://github.com/lionel-" target="_blank" rel="noopener">@lionel-&lt;/a>,
&lt;a href="https://github.com/moodymudskipper" target="_blank" rel="noopener">@moodymudskipper&lt;/a>,
&lt;a href="https://github.com/neelan29" target="_blank" rel="noopener">@neelan29&lt;/a>,
&lt;a href="https://github.com/nick-youngblut" target="_blank" rel="noopener">@nick-youngblut&lt;/a>,
&lt;a href="https://github.com/nteetor" target="_blank" rel="noopener">@nteetor&lt;/a>,
&lt;a href="https://github.com/romainfrancois" target="_blank" rel="noopener">@romainfrancois&lt;/a>,
&lt;a href="https://github.com/TylerGrantSmith" target="_blank" rel="noopener">@TylerGrantSmith&lt;/a>,
&lt;a href="https://github.com/vspinu" target="_blank" rel="noopener">@vspinu&lt;/a>, and
&lt;a href="https://github.com/yutannihilation" target="_blank" rel="noopener">@yutannihilation&lt;/a>&lt;/p></description></item><item><title>vroom 1.1.0</title><link>https://www.tidyverse.org/blog/2020/01/vroom-1-1-0/</link><pubDate>Wed, 15 Jan 2020 00:00:00 +0000</pubDate><guid>https://www.tidyverse.org/blog/2020/01/vroom-1-1-0/</guid><description>&lt;p>I&amp;rsquo;m excited to announce that
&lt;a href="http://vroom.r-lib.org" target="_blank" rel="noopener">vroom 1.1.0&lt;/a> is now
available on CRAN!&lt;/p>
&lt;p>vroom reads rectangular data, such as comma separated (csv), tab separated (tsv) or fixed width files (fwf) into R.
It performs similar roles to functions like
&lt;a href="http://readr.r-lib.org" target="_blank" rel="noopener">&lt;code>readr::read_csv()&lt;/code>&lt;/a>,
&lt;a href="http://r-datatable.com" target="_blank" rel="noopener">&lt;code>data.table::fread()&lt;/code>&lt;/a> or &lt;code>read.csv()&lt;/code>.
But for many datasets &lt;code>vroom::vroom()&lt;/code> can read them much, much faster (hence the name).
Get the latest version with:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="nf">install.packages&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;vroom&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>And attach the package by running&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="nf">library&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">vroom&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Improvements in this release include: a hex logo, support for big integer data, improved delimiter guessing, including delimiters in specifications, and streamlined reading from standard input.&lt;/p>
&lt;p>See the
&lt;a href="https://vroom.r-lib.org/news/index.html" target="_blank" rel="noopener">change log&lt;/a> for a full list of changes and bug fixes in this version.&lt;/p>
&lt;h2 id="hex-logo">Hex logo
&lt;a href="#hex-logo">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>Thanks to
&lt;a href="https://github.com/allisonhorst/stats-illustrations" target="_blank" rel="noopener">Allison Horst&lt;/a> we now have an awesome hex logo for vroom!&lt;/p>
&lt;p>&lt;img src="logo.png" alt="">&lt;/p>
&lt;h2 id="big-integer-support">Big integer support
&lt;a href="#big-integer-support">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>R&amp;rsquo;s standard integers are stored in 32 bits of binary data, which means that the largest value they can store is 2,147,483,647 (&lt;code>2^31 - 1&lt;/code>).
R implicitly converts integers for most operations with doubles to 64-bit floating point values, which is why you may not have noticed this limitation before.&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="nf">options&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">digits&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">22&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">x&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="m">2147483647L&lt;/span>
&lt;span class="nf">str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="c1">#&amp;gt; int 2147483647&lt;/span>
&lt;span class="nf">str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="m">1L&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="c1">#&amp;gt; Warning in x + 1L: NAs produced by integer overflow&lt;/span>
&lt;span class="c1">#&amp;gt; int NA&lt;/span>
&lt;span class="nf">str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="c1">#&amp;gt; num 2.15e+09&lt;/span>
&lt;span class="n">x&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="m">1&lt;/span>
&lt;span class="c1">#&amp;gt; [1] 2147483648&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>However, even 64-bit floating point values can only store consecutive integers up to 9,007,199,254,740,992 (&lt;code>2^53&lt;/code>) without losing precision.
You can observe this because if you try adding 1 to this number you will get the same number.&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="n">y&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="m">9007199254740992&lt;/span>
&lt;span class="n">z&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">y&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="m">1&lt;/span>
&lt;span class="n">z&lt;/span>
&lt;span class="c1">#&amp;gt; [1] 9007199254740992&lt;/span>
&lt;span class="n">y&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">z&lt;/span>
&lt;span class="c1">#&amp;gt; [1] TRUE&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>To store consecutive integers bigger than this you need to use a 64-bit integer type.
R does not have native support for 64-bit integers, however the
&lt;a href="https://cran.r-project.org/package=bit64" target="_blank" rel="noopener">bit64&lt;/a> package provides support for them.
Because these integers are so large, they rarely occur in real world data, however they can often be obtained from generated data, such as database identifiers.&lt;/p>
&lt;p>vroom 1.1.0 now supports reading these big integers into the &lt;code>integer64&lt;/code> type provided by bit64 with a new &lt;code>col_big_integer()&lt;/code> column type (shortcut &amp;lsquo;I&amp;rsquo;).&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="n">x&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">vroom&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;id\n9007199254740993\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">col_type&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;I&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">delim&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;,&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">x&lt;/span>
&lt;span class="c1">#&amp;gt; # A tibble: 1 x 1&lt;/span>
&lt;span class="c1">#&amp;gt; id &lt;/span>
&lt;span class="c1">#&amp;gt; &amp;lt;int64&amp;gt; &lt;/span>
&lt;span class="c1">#&amp;gt; 1 9007199254740993&lt;/span>
&lt;span class="n">x&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">id&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="m">1&lt;/span>
&lt;span class="c1">#&amp;gt; integer64&lt;/span>
&lt;span class="c1">#&amp;gt; [1] 9007199254740994&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>
&lt;h2 id="improved-delimiter-guessing">Improved delimiter guessing
&lt;a href="#improved-delimiter-guessing">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>The code to guess delimiters has been rewritten, which should make it more robust to most inputs.
Previous versions of vroom would fall back to using a newline delimiter if a delimiter could not be guessed.
vroom 1.1.0 instead throws an error.&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="nf">vroom&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;x\n1\n&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="c1">#&amp;gt; Error: Could not guess the delimiter.&lt;/span>
&lt;span class="c1">#&amp;gt; &lt;/span>
&lt;span class="c1">#&amp;gt; Use `vroom(delim =)` to specify one explicitly.&lt;/span>
&lt;span class="nf">vroom&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;x\n1\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">delim&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;,&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="c1">#&amp;gt; Rows: 1&lt;/span>
&lt;span class="c1">#&amp;gt; Columns: 1&lt;/span>
&lt;span class="c1">#&amp;gt; Delimiter: &amp;#34;,&amp;#34;&lt;/span>
&lt;span class="c1">#&amp;gt; dbl [1]: x&lt;/span>
&lt;span class="c1">#&amp;gt; &lt;/span>
&lt;span class="c1">#&amp;gt; Use `spec()` to retrieve the guessed column specification&lt;/span>
&lt;span class="c1">#&amp;gt; Pass a specification to the `col_types` argument to quiet this message&lt;/span>
&lt;span class="c1">#&amp;gt; # A tibble: 1 x 1&lt;/span>
&lt;span class="c1">#&amp;gt; x&lt;/span>
&lt;span class="c1">#&amp;gt; &amp;lt;dbl&amp;gt;&lt;/span>
&lt;span class="c1">#&amp;gt; 1 1&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>
&lt;h2 id="delimiters-in-the-specification">Delimiters in the specification
&lt;a href="#delimiters-in-the-specification">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>vroom now includes the delimiter in the specification object, which means you no longer have to separately provide the delimiter if you are using an existing specification.&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="c1"># read a csv file, the delimiter is provided as &amp;#39;,&amp;#39;&lt;/span>
&lt;span class="n">x&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">vroom&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">vroom_example&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;mtcars.csv&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">delim&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#39;,&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="c1">#&amp;gt; Rows: 32&lt;/span>
&lt;span class="c1">#&amp;gt; Columns: 12&lt;/span>
&lt;span class="c1">#&amp;gt; Delimiter: &amp;#34;,&amp;#34;&lt;/span>
&lt;span class="c1">#&amp;gt; chr [ 1]: model&lt;/span>
&lt;span class="c1">#&amp;gt; dbl [11]: mpg, cyl, disp, hp, drat, wt, qsec, vs, am, gear, carb&lt;/span>
&lt;span class="c1">#&amp;gt; &lt;/span>
&lt;span class="c1">#&amp;gt; Use `spec()` to retrieve the guessed column specification&lt;/span>
&lt;span class="c1">#&amp;gt; Pass a specification to the `col_types` argument to quiet this message&lt;/span>
&lt;span class="n">mtcars_spec&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">spec&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="c1"># If the file is read again with the spec, no need to provide the delimiter&lt;/span>
&lt;span class="n">y&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">vroom&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">vroom_example&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;mtcars.csv&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">col_types&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">mtcars_spec&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>
&lt;h2 id="reading-from-standard-input">Reading from standard input
&lt;a href="#reading-from-standard-input">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>vroom makes it straightforward to read from the C standard input, like you would do when calling R from the terminal command line.
Simply use &lt;code>stdin()&lt;/code> as your input. Let&amp;rsquo;s say you want to take the first few lines the mtcars file and find the average horsepower.&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">head mtcars.tsv &lt;span class="p">|&lt;/span> Rscript -e &lt;span class="s1">&amp;#39;hp &amp;lt;- vroom::vroom(stdin(), col_types = list())$hp; mean(hp)&amp;#39;&lt;/span>
&lt;span class="c1">#&amp;gt; [1] 122.7778&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>
&lt;h2 id="acknowledgements">Acknowledgements
&lt;a href="#acknowledgements">
&lt;svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
&lt;path d="M0 0h24v24H0z" fill="currentColor">&lt;/path>
&lt;path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z">&lt;/path>
&lt;/svg>
&lt;/a>
&lt;/h2>&lt;p>This release also contains a number of bug fixes and improvements which should make it more robust than previous releases. See the
&lt;a href="https://vroom.r-lib.org/news/index.html" target="_blank" rel="noopener">change log&lt;/a> for full details.&lt;/p>
&lt;p>A big thanks to all contributors of code, issues and documentation to this release, including many who helped out at the tidyverse developer day in Toulouse, France!&lt;/p>
&lt;p>
&lt;a href="https://github.com/2005m" target="_blank" rel="noopener">@2005m&lt;/a>,
&lt;a href="https://github.com/atomman" target="_blank" rel="noopener">@atomman&lt;/a>,
&lt;a href="https://github.com/batpigandme" target="_blank" rel="noopener">@batpigandme&lt;/a>,
&lt;a href="https://github.com/blairj09" target="_blank" rel="noopener">@blairj09&lt;/a>,
&lt;a href="https://github.com/Chris-M-P" target="_blank" rel="noopener">@Chris-M-P&lt;/a>,
&lt;a href="https://github.com/chsafouane" target="_blank" rel="noopener">@chsafouane&lt;/a>,
&lt;a href="https://github.com/CriscelyLP" target="_blank" rel="noopener">@CriscelyLP&lt;/a>,
&lt;a href="https://github.com/DyfanJones" target="_blank" rel="noopener">@DyfanJones&lt;/a>,
&lt;a href="https://github.com/ecoquant" target="_blank" rel="noopener">@ecoquant&lt;/a>,
&lt;a href="https://github.com/edzer" target="_blank" rel="noopener">@edzer&lt;/a>,
&lt;a href="https://github.com/ericbrownaustin" target="_blank" rel="noopener">@ericbrownaustin&lt;/a>,
&lt;a href="https://github.com/estroger34" target="_blank" rel="noopener">@estroger34&lt;/a>,
&lt;a href="https://github.com/frm1789" target="_blank" rel="noopener">@frm1789&lt;/a>,
&lt;a href="https://github.com/georgevbsantiago" target="_blank" rel="noopener">@georgevbsantiago&lt;/a>,
&lt;a href="https://github.com/guiastrennec" target="_blank" rel="noopener">@guiastrennec&lt;/a>,
&lt;a href="https://github.com/hadley" target="_blank" rel="noopener">@hadley&lt;/a>,
&lt;a href="https://github.com/HenrikBengtsson" target="_blank" rel="noopener">@HenrikBengtsson&lt;/a>,
&lt;a href="https://github.com/henry090" target="_blank" rel="noopener">@henry090&lt;/a>,
&lt;a href="https://github.com/jaapwalhout" target="_blank" rel="noopener">@jaapwalhout&lt;/a>,
&lt;a href="https://github.com/jimhester" target="_blank" rel="noopener">@jimhester&lt;/a>,
&lt;a href="https://github.com/jonaszierer" target="_blank" rel="noopener">@jonaszierer&lt;/a>,
&lt;a href="https://github.com/kiernann" target="_blank" rel="noopener">@kiernann&lt;/a>,
&lt;a href="https://github.com/martindut" target="_blank" rel="noopener">@martindut&lt;/a>,
&lt;a href="https://github.com/meta00" target="_blank" rel="noopener">@meta00&lt;/a>,
&lt;a href="https://github.com/mgirlich" target="_blank" rel="noopener">@mgirlich&lt;/a>,
&lt;a href="https://github.com/mllg" target="_blank" rel="noopener">@mllg&lt;/a>,
&lt;a href="https://github.com/osiris08" target="_blank" rel="noopener">@osiris08&lt;/a>,
&lt;a href="https://github.com/Plebejer" target="_blank" rel="noopener">@Plebejer&lt;/a>,
&lt;a href="https://github.com/R3myG" target="_blank" rel="noopener">@R3myG&lt;/a>,
&lt;a href="https://github.com/randomgambit" target="_blank" rel="noopener">@randomgambit&lt;/a>,
&lt;a href="https://github.com/sanromd" target="_blank" rel="noopener">@sanromd&lt;/a>,
&lt;a href="https://github.com/Shians" target="_blank" rel="noopener">@Shians&lt;/a>,
&lt;a href="https://github.com/stephen-hayne" target="_blank" rel="noopener">@stephen-hayne&lt;/a>,
&lt;a href="https://github.com/vjcitn" target="_blank" rel="noopener">@vjcitn&lt;/a>,
&lt;a href="https://github.com/wlattner" target="_blank" rel="noopener">@wlattner&lt;/a>, and
&lt;a href="https://github.com/xiaodaigh" target="_blank" rel="noopener">@xiaodaigh&lt;/a>.&lt;/p></description></item></channel></rss>