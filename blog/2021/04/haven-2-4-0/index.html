<!doctype html><html><head><!doctype html><html lang=en-us><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/css/main-site.css><link rel=stylesheet href=/css/fa5-all.css><style type=text/css>body{background-color:#fff;color:#1a1917}a{color:#38577f}a:hover{color:#42709b}a:focus{outline-color:#42709b}.column25-left .sectionTitle a:hover:not(.current),.column16-left .sectionTitle a:hover:not(.current){color:#1a1917}.icon-attribution,.icon-attribution a{color:#1a1917;opacity:75%}#homeContent .band.first{background-color:#fff}#homeContent .band.second{background-color:#fdeba4}#homeContent .band.third{background-color:#fff}#rStudioHeader{background-color:#1a162d;color:#fff}#rStudioHeader .productName{color:#fff}#rStudioHeader .productName:hover,#rStudioHeader .productName:focus{color:#fdeba4}#rStudioHeader #menu .menuItem.a{background-color:#75aadb;color:#fff}#rStudioHeader #menu .menuItem:hover{background-color:#484557;color:#fff}#rStudioHeader #menu .menuItem.current{background-color:#fff;color:#1a162d;text-decoration:none}#rStudioFooter.band{background-color:#767381}#rStudioFooter .bandContent #copyright{color:#e3eef8}table tbody tr:nth-child(even){background-color:#f7faff}table tbody tr:nth-child(odd){background-color:#fff}.latest{border-top:.5em solid <no value>}.event{-moz-box-shadow:0 0 0 0 rgba(0,0,0,.1);-webkit-box-shadow:0 0 0 0 rgba(0,0,0,.1);box-shadow:0 0 0 0 rgba(0,0,0,.1)}.section .event{background-color:#eab0c41a}.section .event{border-top:7pt solid #a19ea936}.section .event a{color:#1a162d}.section .event{color:#404040}</style><link rel=stylesheet href=/css/tidyverse.css><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.71.1"><title>haven 2.4.0</title><meta property="og:title" content="haven 2.4.0"><meta property="og:description" content="This version provides much improved `labelled_spss()` support, improved date-time handling, the latest ReadStat, and a bunch of other small  improvements."><meta property="og:type" content="article"><meta property="og:url" content="https://www.tidyverse.org/blog/2021/04/haven-2-4-0/"><meta property="twitter:card" content="summary_large_image"><meta property="og:title" content="haven 2.4.0 - Tidyverse"><meta property="description" content="This version provides much improved `labelled_spss()` support, improved date-time handling, the latest ReadStat, and a bunch of other small  improvements."><meta property="og:description" content="This version provides much improved `labelled_spss()` support, improved date-time handling, the latest ReadStat, and a bunch of other small  improvements."><meta property="og:image" content="https://www.tidyverse.org/blog/2021/04/haven-2-4-0/thumbnail-sq.jpg"><meta name=twitter:image content="https://www.tidyverse.org/blog/2021/04/haven-2-4-0/thumbnail-wd.jpg"><link rel=apple-touch-icon sizes=180x180 href=/images/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicons/favicon-16x16.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg><link rel="shortcut icon" href=/images/favicons/favicon.ico><meta name=msapplication-TileColor content="#da532c"><meta name=msapplication-config href=/images/favicons/browserconfig.xml><script type=text/javascript src=/js/jquery-3.5.1.min.js></script><script type=text/javascript src=/js/site.js></script><link rel=icon href=/images/favicon.ico><script type=text/javascript src=/js/clipboard.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin=anonymous></script><script defer data-domain=tidyverse.org,all.tidyverse.org src=https://plausible.io/js/plausible.js></script></head><body><div id=appTidyverseSite class="shrinkHeader alwaysShrinkHeader"><div id=main><div id=rStudioHeader><nav class=band><div class="innards bandContent"><div><a class=productName href=/%20/>Tidyverse</a></div><div id=menu><div id=menuToggler></div><div id=menuItems><a class=menuItem href=/packages/>Packages</a>
<a class="menuItem current" href=/blog/>Blog</a>
<a class=menuItem href=/learn/>Learn</a>
<a class=menuItem href=/help/>Help</a>
<a class=menuItem href=/contribute/>Contribute</a></div></div></div></nav></div><main><div class="band padForHeader pushFooter"><div class=bandContent><div class="full splitColumns withMobileMargins"><div class=column75><h1 class=article-title>haven 2.4.0</h1><div class=article-header aria-hidden=true><div class=photo><img src=/blog/2021/04/haven-2-4-0/thumbnail-wd.jpg></div><div class=photoCredit>Photo by <a href=https://unsplash.com/photos/SHA85I0G8K4>Evgeni Tcherkasski</a></div></div><span class=article-date><i class="fas fa-calendar-day fa-fw"></i>&nbsp;&nbsp;2021/04/24</span><p style=margin-bottom:.5em;margin-top:.85em><i class="fas fa-tags"></i>&nbsp;
<a href=/tags/haven/>haven</a></p><p style=margin-top:.5em><i class="fas fa-user-circle fa-fw"></i>&nbsp;
Hadley Wickham</p><div class=article-content><p>We&rsquo;re delighted to announce the release of
<a href=https://haven.tidyverse.org target=_blank rel=noopener>haven</a> 2.4.0. haven allows you to read and write SAS, SPSS, and Stata data formats from R, thanks to the wonderful
<a href=https://github.com/WizardMac/ReadStat target=_blank rel=noopener>ReadStat</a> C library written by
<a href=https://www.evanmiller.org/ target=_blank rel=noopener>Evan Miller</a>.</p><p>You can install it from CRAN with:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf><a href=https://rdrr.io/r/utils/install.packages.html>install.packages</a></span><span class=o>(</span><span class=s>"haven"</span><span class=o>)</span></code></pre></div><p>This blog post will show off the most important changes to the package; you can see a full list of changes in the
<a href=https://github.com/tidyverse/haven/releases/tag/v2.4.0 target=_blank rel=noopener>release notes</a>.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=https://haven.tidyverse.org>haven</a></span><span class=o>)</span></code></pre></div><h2 id=labelled_spss-and-labelled><code>labelled_spss()</code> and <code>labelled()</code>
<a href=#labelled_spss-and-labelled><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p><a href=https://haven.tidyverse.org/reference/labelled_spss.html target=_blank rel=noopener><code>labelled_spss()</code></a> gains full vctrs support thanks to the hard work of
<a href=https://github.com/gorcha target=_blank rel=noopener>Danny Smith</a>. This means that
<a href=https://haven.tidyverse.org/reference/labelled_spss.html target=_blank rel=noopener><code>labelled_spss()</code></a> objects should now work seamlessly with dplyr 1.0.0, tidyr 1.0.0.</p><p>I&rsquo;ve also made
<a href=https://haven.tidyverse.org/reference/labelled.html target=_blank rel=noopener><code>labelled()</code></a> vectors are more permissive when concatenating. Now, output labels will be a combination of the left-hand and the right-hand side, and if there are duplicate labels, the left-hand side (first assigned) will win:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nv>x1</span> <span class=o>&lt;-</span> <span class=nf><a href=https://haven.tidyverse.org/reference/labelled.html>labelled</a></span><span class=o>(</span><span class=m>1</span>, labels <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span>USA <span class=o>=</span> <span class=m>1</span><span class=o>)</span><span class=o>)</span>
<span class=nv>x2</span> <span class=o>&lt;-</span> <span class=nf><a href=https://haven.tidyverse.org/reference/labelled.html>labelled</a></span><span class=o>(</span><span class=m>64</span>, labels <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span>NZ <span class=o>=</span> <span class=m>64</span><span class=o>)</span><span class=o>)</span>
<span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=nv>x1</span>, <span class=nv>x2</span><span class=o>)</span>
<span class=c>#&gt; &lt;labelled&lt;double&gt;[2]&gt;</span>
<span class=c>#&gt; [1]  1 64</span>
<span class=c>#&gt; </span>
<span class=c>#&gt; Labels:</span>
<span class=c>#&gt;  value label</span>
<span class=c>#&gt;      1   USA</span>
<span class=c>#&gt;     64    NZ</span>

<span class=c># It's now your responsibility to only combine things that make sense</span>
<span class=nv>x3</span> <span class=o>&lt;-</span> <span class=nf><a href=https://haven.tidyverse.org/reference/labelled.html>labelled</a></span><span class=o>(</span><span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=m>1</span>, <span class=m>2</span>, <span class=m>5</span>, <span class=m>3</span>, <span class=m>2</span><span class=o>)</span>, labels <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span>Good <span class=o>=</span> <span class=m>5</span>, Bad <span class=o>=</span> <span class=m>1</span><span class=o>)</span><span class=o>)</span>
<span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=nv>x1</span>, <span class=nv>x3</span><span class=o>)</span>
<span class=c>#&gt; &lt;labelled&lt;double&gt;[6]&gt;</span>
<span class=c>#&gt; [1] 1 1 2 5 3 2</span>
<span class=c>#&gt; </span>
<span class=c>#&gt; Labels:</span>
<span class=c>#&gt;  value label</span>
<span class=c>#&gt;      1   USA</span>
<span class=c>#&gt;      5  Good</span></code></pre></div><h2 id=other-improvements>Other improvements
<a href=#other-improvements><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><ul><li><p>Date-times are no longer converted to UTC. This should ensure that you <em>see</em> the same date-time in R and in Stata/SPSS/SAS. (But the underlying time point might be different because Stata/SPSS/SAS don&rsquo;t appear to support time zones.)</p></li><li><p>Bundleed ReadStat has been updated to version 1.1.5 from 1.1.3 so includes ReadStat improvements in
<a href=https://github.com/WizardMac/ReadStat/releases/tag/v1.1.5 target=_blank rel=noopener>v1.1.5</a> and
<a href=https://github.com/WizardMac/ReadStat/releases/tag/v1.1.4 target=_blank rel=noopener>v1.1.4</a>. Probably the biggest improvement is support for SAS-binary (aka Ross) compression.</p></li><li><p><code>write_*()</code> now validates file and variable metadata with ReadStat, and validation failures now provide more details about the source of the problem (e.g.Â the column name), making it easier to track down issues.</p></li></ul><h2 id=acknowledgements>Acknowledgements
<a href=#acknowledgements><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>A big thanks to everyone who helped make this release possible by asking questions, providing reprexes, writing code and more!
<a href=https://github.com/Ales-G target=_blank rel=noopener>@Ales-G</a>,
<a href=https://github.com/atungate target=_blank rel=noopener>@atungate</a>,
<a href=https://github.com/batpigandme target=_blank rel=noopener>@batpigandme</a>,
<a href=https://github.com/bergen288 target=_blank rel=noopener>@bergen288</a>,
<a href=https://github.com/bergsmat target=_blank rel=noopener>@bergsmat</a>,
<a href=https://github.com/BernhardClemm target=_blank rel=noopener>@BernhardClemm</a>,
<a href=https://github.com/bhaney22 target=_blank rel=noopener>@bhaney22</a>,
<a href=https://github.com/cimentadaj target=_blank rel=noopener>@cimentadaj</a>,
<a href=https://github.com/copernican target=_blank rel=noopener>@copernican</a>,
<a href=https://github.com/DanChaltiel target=_blank rel=noopener>@DanChaltiel</a>,
<a href=https://github.com/DavidLukeThiessen target=_blank rel=noopener>@DavidLukeThiessen</a>,
<a href=https://github.com/deschen1 target=_blank rel=noopener>@deschen1</a>,
<a href=https://github.com/drag05 target=_blank rel=noopener>@drag05</a>,
<a href=https://github.com/drevanzyl target=_blank rel=noopener>@drevanzyl</a>,
<a href=https://github.com/dsteuer target=_blank rel=noopener>@dsteuer</a>,
<a href=https://github.com/dswpg target=_blank rel=noopener>@dswpg</a>,
<a href=https://github.com/dusadrian target=_blank rel=noopener>@dusadrian</a>,
<a href=https://github.com/elfatherbrown target=_blank rel=noopener>@elfatherbrown</a>,
<a href=https://github.com/gorcha target=_blank rel=noopener>@gorcha</a>,
<a href=https://github.com/gowerc target=_blank rel=noopener>@gowerc</a>,
<a href=https://github.com/hadley target=_blank rel=noopener>@hadley</a>,
<a href=https://github.com/hhchang0210 target=_blank rel=noopener>@hhchang0210</a>,
<a href=https://github.com/hjvdwijk target=_blank rel=noopener>@hjvdwijk</a>,
<a href=https://github.com/iamforerunner target=_blank rel=noopener>@iamforerunner</a>,
<a href=https://github.com/j-sirgo target=_blank rel=noopener>@j-sirgo</a>,
<a href=https://github.com/jacciz target=_blank rel=noopener>@jacciz</a>,
<a href=https://github.com/jackobailey target=_blank rel=noopener>@jackobailey</a>,
<a href=https://github.com/jaydennord target=_blank rel=noopener>@jaydennord</a>,
<a href=https://github.com/jimhester target=_blank rel=noopener>@jimhester</a>,
<a href=https://github.com/jkhanson1970 target=_blank rel=noopener>@jkhanson1970</a>,
<a href=https://github.com/kambanane target=_blank rel=noopener>@kambanane</a>,
<a href=https://github.com/krlmlr target=_blank rel=noopener>@krlmlr</a>,
<a href=https://github.com/kwainfan target=_blank rel=noopener>@kwainfan</a>,
<a href=https://github.com/larmarange target=_blank rel=noopener>@larmarange</a>,
<a href=https://github.com/lionel- target=_blank rel=noopener>@lionel-</a>,
<a href=https://github.com/MartinLBarron target=_blank rel=noopener>@MartinLBarron</a>,
<a href=https://github.com/oliverbock target=_blank rel=noopener>@oliverbock</a>,
<a href=https://github.com/ookiiwani target=_blank rel=noopener>@ookiiwani</a>,
<a href=https://github.com/peterolejua target=_blank rel=noopener>@peterolejua</a>,
<a href=https://github.com/realrbird target=_blank rel=noopener>@realrbird</a>,
<a href=https://github.com/resuf target=_blank rel=noopener>@resuf</a>,
<a href=https://github.com/rpruim target=_blank rel=noopener>@rpruim</a>,
<a href=https://github.com/rubenarslan target=_blank rel=noopener>@rubenarslan</a>,
<a href=https://github.com/sclewis23 target=_blank rel=noopener>@sclewis23</a>,
<a href=https://github.com/shannonpileggi target=_blank rel=noopener>@shannonpileggi</a>,
<a href=https://github.com/sjkiss target=_blank rel=noopener>@sjkiss</a>,
<a href=https://github.com/toerpe target=_blank rel=noopener>@toerpe</a>,
<a href=https://github.com/tslumley target=_blank rel=noopener>@tslumley</a>,
<a href=https://github.com/xlejx-rodsxn target=_blank rel=noopener>@xlejx-rodsxn</a>,
<a href=https://github.com/xmatic target=_blank rel=noopener>@xmatic</a>, and
<a href=https://github.com/zahlenzauber target=_blank rel=noopener>@zahlenzauber</a>.</p></div></div><div class=column25><div class="section hideOnMobile"><div class=sectionTitle>Contents</div><nav id=TableOfContents><ul><li><a href=#labelled_spss-and-labelled><code>labelled_spss()</code> and <code>labelled()</code></a></li><li><a href=#other-improvements>Other improvements</a></li><li><a href=#acknowledgements>Acknowledgements</a></li></ul></nav></div><div class=section></div></div></div></div></div><div id=rStudioFooter class=band><div class=bandContent><div id=copyright>The tidyverse is proudly supported by <a class=rstudioLogo href=https://posit.co/ aria-label="Posit Homepage"></a></div><div id=logos><a href=https://www.tidyverse.org/google_privacy_policy>Privacy policy</a>
<a href=https://github.com/tidyverse class="footerLogo gitHub" aria-label="Tidyverse GitHub organization"></a><a href=https://twitter.com/hashtag/rstats class="footerLogo twitter" aria-label="rstats hashtag on twitter.com"></a></div></div></div></div></div><script type=application/javascript>var dnt=(navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack);var doNotTrack=(dnt=="1"||dnt=="yes");if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');if(window.sessionStorage){var GA_SESSION_STORAGE_KEY='ga:clientId';ga('create','UA-115082821-1',{'storage':'none','clientId':sessionStorage.getItem(GA_SESSION_STORAGE_KEY)});ga(function(tracker){sessionStorage.setItem(GA_SESSION_STORAGE_KEY,tracker.get('clientId'));});}
ga('set','anonymizeIp',true);ga('send','pageview');}</script></body></html></div></div></body></html>