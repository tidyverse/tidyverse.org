<!doctype html><html><head><!doctype html><html lang=en-us><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/css/main-site.css><link rel=stylesheet href=/css/fa5-all.css><style type=text/css>body{background-color:#fff;color:#1a1917}a{color:#38577f}a:hover{color:#42709b}a:focus{outline-color:#42709b}.column25-left .sectionTitle a:hover:not(.current),.column16-left .sectionTitle a:hover:not(.current){color:#1a1917}.icon-attribution,.icon-attribution a{color:#1a1917;opacity:75%}#homeContent .band.first{background-color:#fff}#homeContent .band.second{background-color:#fdeba4}#homeContent .band.third{background-color:#fff}#rStudioHeader{background-color:#1a162d;color:#fff}#rStudioHeader .productName{color:#fff}#rStudioHeader .productName:hover,#rStudioHeader .productName:focus{color:#fdeba4}#rStudioHeader #menu .menuItem.a{background-color:#75aadb;color:#fff}#rStudioHeader #menu .menuItem:hover{background-color:#484557;color:#fff}#rStudioHeader #menu .menuItem.current{background-color:#fff;color:#1a162d;text-decoration:none}#rStudioFooter.band{background-color:#767381}#rStudioFooter .bandContent #copyright{color:#e3eef8}table tbody tr:nth-child(even){background-color:#f7faff}table tbody tr:nth-child(odd){background-color:#fff}.latest{border-top:.5em solid <no value>}.event{-moz-box-shadow:0 0 0 0 rgba(0,0,0,.1);-webkit-box-shadow:0 0 0 0 rgba(0,0,0,.1);box-shadow:0 0 0 0 rgba(0,0,0,.1)}.section .event{background-color:#eab0c41a}.section .event{border-top:7pt solid #a19ea936}.section .event a{color:#1a162d}.section .event{color:#404040}</style><link rel=stylesheet href=/css/tidyverse.css><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.71.1"><title>Comprehensive Date-Time Handling for R</title><meta property="og:title" content="Comprehensive Date-Time Handling for R"><meta property="og:description" content="Introducing, clock, a new package for working with date-times."><meta property="og:type" content="article"><meta property="og:url" content="https://www.tidyverse.org/blog/2021/03/clock-0-1-0/"><meta property="twitter:card" content="summary_large_image"><meta property="og:title" content="Comprehensive Date-Time Handling for R - Tidyverse"><meta property="description" content="Introducing, clock, a new package for working with date-times."><meta property="og:description" content="Introducing, clock, a new package for working with date-times."><meta property="og:image" content="https://www.tidyverse.org/blog/2021/03/clock-0-1-0/thumbnail-sq.jpg"><meta name=twitter:image content="https://www.tidyverse.org/blog/2021/03/clock-0-1-0/thumbnail-wd.jpg"><link rel=apple-touch-icon sizes=180x180 href=/images/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicons/favicon-16x16.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg><link rel="shortcut icon" href=/images/favicons/favicon.ico><meta name=msapplication-TileColor content="#da532c"><meta name=msapplication-config href=/images/favicons/browserconfig.xml><script type=text/javascript src=/js/jquery-3.5.1.min.js></script><script type=text/javascript src=/js/site.js></script><link rel=icon href=/images/favicon.ico><script type=text/javascript src=/js/clipboard.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin=anonymous></script><script defer data-domain=tidyverse.org,all.tidyverse.org src=https://plausible.io/js/plausible.js></script></head><body><div id=appTidyverseSite class="shrinkHeader alwaysShrinkHeader"><div id=main><div id=rStudioHeader><nav class=band><div class="innards bandContent"><div><a class=productName href=/%20/>Tidyverse</a></div><div id=menu><div id=menuToggler></div><div id=menuItems><a class=menuItem href=/packages/>Packages</a>
<a class="menuItem current" href=/blog/>Blog</a>
<a class=menuItem href=/learn/>Learn</a>
<a class=menuItem href=/help/>Help</a>
<a class=menuItem href=/contribute/>Contribute</a></div></div></div></nav></div><main><div class="band padForHeader pushFooter"><div class=bandContent><div class="full splitColumns withMobileMargins"><div class=column75><h1 class=article-title>Comprehensive Date-Time Handling for R</h1><div class=article-header aria-hidden=true><div class=photo><img src=/blog/2021/03/clock-0-1-0/thumbnail-wd.jpg></div><div class=photoCredit>Photo by <a href=https://unsplash.com/photos/FlHdnPO6dlw>Jon Tyson</a></div></div><span class=article-date><i class="fas fa-calendar-day fa-fw"></i>&nbsp;&nbsp;2021/03/31</span><p style=margin-bottom:.5em;margin-top:.85em><i class="fas fa-tags"></i>&nbsp;
<a href=/tags/r-lib/>r-lib</a></p><p style=margin-top:.5em><i class="fas fa-user-circle fa-fw"></i>&nbsp;
Davis Vaughan</p><div class=article-content><div class=highlight></div><p>We&rsquo;re thrilled to announce the first release of
<a href=https://clock.r-lib.org/index.html target=_blank rel=noopener>clock</a>. clock is a new package providing a comprehensive set of tools for working with date-times. It is packed with features, including utilities for: parsing, formatting, arithmetic, rounding, and extraction/updating of individual components. In addition to these tools for manipulating date-times, clock provides entirely new date-time types which are structured to reduce the agony of working with time zones as much as possible. At a high-level, clock:</p><ul><li><p>Provides a new family of date-time classes (durations, time points, zoned-times, and calendars) that partition responsibilities so that you only have to think about time zones when you need them.</p></li><li><p>Implements a
<a href=https://clock.r-lib.org/reference/index.html#section-high-level-api target=_blank rel=noopener>high level API</a> for Date and POSIXct classes that lets you get productive quickly without having to learn the details of clock&rsquo;s new date-time types.</p></li><li><p>Requires explicit handling of invalid dates (e.g.Â what date is one month after January 31st?) and nonexistent or ambiguous times (caused by daylight saving time issues).</p></li><li><p>Is built on the C++
<a href=https://github.com/HowardHinnant/date target=_blank rel=noopener>date</a> library, which provides a correct and high-performance backend. In general, operations on Dates are <em>much</em> faster with clock than with lubridate. Currently, operations on POSIXct have roughly the same performance between clock and lubridate (clock&rsquo;s performance with POSIXct will improve greatly in a future release, once a few upstream changes in date are accepted).</p></li></ul><p>You can install it from CRAN with:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf><a href=https://rdrr.io/r/utils/install.packages.html>install.packages</a></span><span class=o>(</span><span class=s>"clock"</span><span class=o>)</span></code></pre></div><p>This blog post will show off a few of clock&rsquo;s unique features. To learn more, you&rsquo;ll want to take a look at clock&rsquo;s vignettes:</p><ul><li><p><a href=https://clock.r-lib.org/articles/clock.html target=_blank rel=noopener>Getting Started</a></p></li><li><p><a href=https://clock.r-lib.org/articles/articles/motivations.html target=_blank rel=noopener>Motivations for clock</a></p></li><li><p><a href=https://clock.r-lib.org/articles/recipes.html target=_blank rel=noopener>Examples and Recipes</a></p></li><li><p><a href=https://clock.r-lib.org/articles/faq.html target=_blank rel=noopener>Frequently Asked Questions</a></p></li></ul><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=https://github.com/r-lib/clock>clock</a></span><span class=o>)</span>
<span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=http://github.com/hadley/nycflights13>nycflights13</a></span><span class=o>)</span>
<span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=http://tidyverse.tidyverse.org>tidyverse</a></span><span class=o>)</span>
<span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=https://lubridate.tidyverse.org>lubridate</a></span><span class=o>)</span></code></pre></div><h2 id=logo>Logo
<a href=#logo><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Thanks to
<a href=https://www.jungjulie.com/ target=_blank rel=noopener>Julie Jung</a>, clock has an amazing logo:</p><p><img src=clock.png width=250><br></br></p><h2 id=what-about-lubridate>What about lubridate?
<a href=#what-about-lubridate><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>If you&rsquo;ve ever worked with dates or date-times in R, you&rsquo;ve probably used
<a href=https://lubridate.tidyverse.org/ target=_blank rel=noopener>lubridate</a>. lubridate has powerful capabilities for working with this kind of data. So, why clock?</p><p>One of the primary motivations for creating clock was to improve on lubridate&rsquo;s handling of invalid dates and daylight saving time. As you&rsquo;ll see in the following sections, clock tries extremely hard to guard you from unexpected problems that can arise from these two complex concepts.</p><p>Additionally, clock provides a variety of new types for working with date-times. While lubridate is solely focused on working with R&rsquo;s native Date and POSIXct classes, clock goes many steps further with types such as: date-times without an implied time zone, nanosecond precision date-times, built-in granular types such as year-month and year-quarter, and a type for representing a weekday.</p><p>lubridate will never go away, and is not being deprecated or superseded. As of now, we consider clock to be an <em>alternative</em> to lubridate. You can stick with one or the other, or use them together, as there are no name conflicts between the two. Keep in mind that clock is a young package, with plenty of room to grow. If you have any feedback about clock, or questions about its design, we&rsquo;d love for you to
<a href=https://github.com/r-lib/clock/issues target=_blank rel=noopener>open an issue</a>.</p><h2 id=first-steps>First steps
<a href=#first-steps><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>The best place to start learning about clock is by checking out the
<a href=https://clock.r-lib.org/reference/index.html#section-high-level-api target=_blank rel=noopener>High-Level API</a>. This lists all of the utilities in clock that work with R&rsquo;s native date (Date) and date-time (POSIXct) types. You&rsquo;ll notice that all of these helpers start with one of the following prefixes:</p><ul><li><p><code>get_*()</code>: Get a component</p></li><li><p><code>set_*()</code>: Set a component</p></li><li><p><code>add_*()</code>: Add a unit of time</p></li><li><p><code>date_*()</code>: General date manipulation</p></li></ul><p>We&rsquo;ll explore some of these with a trimmed down version of the <code>flights</code> dataset from the nycflights13 package.</p><div class=highlight></div><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nv>flights</span>
<span class=c>#&gt; <span style=color:#555># A tibble: 100 x 5</span></span>
<span class=c>#&gt;     year month   day dep_time dep_delay</span>
<span class=c>#&gt;    <span style=color:#555;font-style:italic>&lt;int&gt;</span><span> </span><span style=color:#555;font-style:italic>&lt;int&gt;</span><span> </span><span style=color:#555;font-style:italic>&lt;int&gt;</span><span>    </span><span style=color:#555;font-style:italic>&lt;int&gt;</span><span>     </span><span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span>
<span class=c>#&gt; <span style=color:#555> 1</span><span>  </span><span style=text-decoration:underline>2</span><span>013     1     6     </span><span style=text-decoration:underline>1</span><span>827        -</span><span style=color:#b00>3</span></span>
<span class=c>#&gt; <span style=color:#555> 2</span><span>  </span><span style=text-decoration:underline>2</span><span>013     1     8     </span><span style=text-decoration:underline>1</span><span>458        -</span><span style=color:#b00>2</span></span>
<span class=c>#&gt; <span style=color:#555> 3</span><span>  </span><span style=text-decoration:underline>2</span><span>013     1    17     </span><span style=text-decoration:underline>1</span><span>823        80</span></span>
<span class=c>#&gt; <span style=color:#555> 4</span><span>  </span><span style=text-decoration:underline>2</span><span>013     1    26     </span><span style=text-decoration:underline>1</span><span>052        13</span></span>
<span class=c>#&gt; <span style=color:#555> 5</span><span>  </span><span style=text-decoration:underline>2</span><span>013     1    29      448       -</span><span style=color:#b00>12</span></span>
<span class=c>#&gt; <span style=color:#555> 6</span><span>  </span><span style=text-decoration:underline>2</span><span>013     1    30        3       124</span></span>
<span class=c>#&gt; <span style=color:#555> 7</span><span>  </span><span style=text-decoration:underline>2</span><span>013     2     1      816        -</span><span style=color:#b00>9</span></span>
<span class=c>#&gt; <span style=color:#555> 8</span><span>  </span><span style=text-decoration:underline>2</span><span>013     2     4     </span><span style=text-decoration:underline>1</span><span>943         3</span></span>
<span class=c>#&gt; <span style=color:#555> 9</span><span>  </span><span style=text-decoration:underline>2</span><span>013     2    10     </span><span style=text-decoration:underline>1</span><span>508        36</span></span>
<span class=c>#&gt; <span style=color:#555>10</span><span>  </span><span style=text-decoration:underline>2</span><span>013     2    13     </span><span style=text-decoration:underline>2</span><span>033        33</span></span>
<span class=c>#&gt; <span style=color:#555># â¦ with 90 more rows</span></span></code></pre></div><p>The flight departure date is separated into year, month, and day fields. We can combine these together into a Date with
<a href=https://rdrr.io/pkg/clock/man/date_build.html target=_blank rel=noopener><code>date_build()</code></a>.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nv>flights</span> <span class=o>&lt;-</span> <span class=nv>flights</span> <span class=o>%&gt;%</span>
  <span class=nf>mutate</span><span class=o>(</span>
    date <span class=o>=</span> <span class=nf><a href=https://rdrr.io/pkg/clock/man/date_build.html>date_build</a></span><span class=o>(</span><span class=nv>year</span>, <span class=nv>month</span>, <span class=nv>day</span><span class=o>)</span>, 
    .keep <span class=o>=</span> <span class=s>"unused"</span>, 
    .before <span class=o>=</span> <span class=m>1</span>
  <span class=o>)</span>

<span class=nv>flights</span>
<span class=c>#&gt; <span style=color:#555># A tibble: 100 x 3</span></span>
<span class=c>#&gt;    date       dep_time dep_delay</span>
<span class=c>#&gt;    <span style=color:#555;font-style:italic>&lt;date&gt;</span><span>        </span><span style=color:#555;font-style:italic>&lt;int&gt;</span><span>     </span><span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span>
<span class=c>#&gt; <span style=color:#555> 1</span><span> 2013-01-06     </span><span style=text-decoration:underline>1</span><span>827        -</span><span style=color:#b00>3</span></span>
<span class=c>#&gt; <span style=color:#555> 2</span><span> 2013-01-08     </span><span style=text-decoration:underline>1</span><span>458        -</span><span style=color:#b00>2</span></span>
<span class=c>#&gt; <span style=color:#555> 3</span><span> 2013-01-17     </span><span style=text-decoration:underline>1</span><span>823        80</span></span>
<span class=c>#&gt; <span style=color:#555> 4</span><span> 2013-01-26     </span><span style=text-decoration:underline>1</span><span>052        13</span></span>
<span class=c>#&gt; <span style=color:#555> 5</span><span> 2013-01-29      448       -</span><span style=color:#b00>12</span></span>
<span class=c>#&gt; <span style=color:#555> 6</span><span> 2013-01-30        3       124</span></span>
<span class=c>#&gt; <span style=color:#555> 7</span><span> 2013-02-01      816        -</span><span style=color:#b00>9</span></span>
<span class=c>#&gt; <span style=color:#555> 8</span><span> 2013-02-04     </span><span style=text-decoration:underline>1</span><span>943         3</span></span>
<span class=c>#&gt; <span style=color:#555> 9</span><span> 2013-02-10     </span><span style=text-decoration:underline>1</span><span>508        36</span></span>
<span class=c>#&gt; <span style=color:#555>10</span><span> 2013-02-13     </span><span style=text-decoration:underline>2</span><span>033        33</span></span>
<span class=c>#&gt; <span style=color:#555># â¦ with 90 more rows</span></span></code></pre></div><p>If you need to get those individual components back, extract them with the corresponding <code>get_*()</code> function.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>mutate</span><span class=o>(</span><span class=nv>flights</span>, year <span class=o>=</span> <span class=nf><a href=https://rdrr.io/pkg/clock/man/clock-getters.html>get_year</a></span><span class=o>(</span><span class=nv>date</span><span class=o>)</span>, month <span class=o>=</span> <span class=nf><a href=https://rdrr.io/pkg/clock/man/clock-getters.html>get_month</a></span><span class=o>(</span><span class=nv>date</span><span class=o>)</span><span class=o>)</span>
<span class=c>#&gt; <span style=color:#555># A tibble: 100 x 5</span></span>
<span class=c>#&gt;    date       dep_time dep_delay  year month</span>
<span class=c>#&gt;    <span style=color:#555;font-style:italic>&lt;date&gt;</span><span>        </span><span style=color:#555;font-style:italic>&lt;int&gt;</span><span>     </span><span style=color:#555;font-style:italic>&lt;dbl&gt;</span><span> </span><span style=color:#555;font-style:italic>&lt;int&gt;</span><span> </span><span style=color:#555;font-style:italic>&lt;int&gt;</span></span>
<span class=c>#&gt; <span style=color:#555> 1</span><span> 2013-01-06     </span><span style=text-decoration:underline>1</span><span>827        -</span><span style=color:#b00>3</span><span>  </span><span style=text-decoration:underline>2</span><span>013     1</span></span>
<span class=c>#&gt; <span style=color:#555> 2</span><span> 2013-01-08     </span><span style=text-decoration:underline>1</span><span>458        -</span><span style=color:#b00>2</span><span>  </span><span style=text-decoration:underline>2</span><span>013     1</span></span>
<span class=c>#&gt; <span style=color:#555> 3</span><span> 2013-01-17     </span><span style=text-decoration:underline>1</span><span>823        80  </span><span style=text-decoration:underline>2</span><span>013     1</span></span>
<span class=c>#&gt; <span style=color:#555> 4</span><span> 2013-01-26     </span><span style=text-decoration:underline>1</span><span>052        13  </span><span style=text-decoration:underline>2</span><span>013     1</span></span>
<span class=c>#&gt; <span style=color:#555> 5</span><span> 2013-01-29      448       -</span><span style=color:#b00>12</span><span>  </span><span style=text-decoration:underline>2</span><span>013     1</span></span>
<span class=c>#&gt; <span style=color:#555> 6</span><span> 2013-01-30        3       124  </span><span style=text-decoration:underline>2</span><span>013     1</span></span>
<span class=c>#&gt; <span style=color:#555> 7</span><span> 2013-02-01      816        -</span><span style=color:#b00>9</span><span>  </span><span style=text-decoration:underline>2</span><span>013     2</span></span>
<span class=c>#&gt; <span style=color:#555> 8</span><span> 2013-02-04     </span><span style=text-decoration:underline>1</span><span>943         3  </span><span style=text-decoration:underline>2</span><span>013     2</span></span>
<span class=c>#&gt; <span style=color:#555> 9</span><span> 2013-02-10     </span><span style=text-decoration:underline>1</span><span>508        36  </span><span style=text-decoration:underline>2</span><span>013     2</span></span>
<span class=c>#&gt; <span style=color:#555>10</span><span> 2013-02-13     </span><span style=text-decoration:underline>2</span><span>033        33  </span><span style=text-decoration:underline>2</span><span>013     2</span></span>
<span class=c>#&gt; <span style=color:#555># â¦ with 90 more rows</span></span></code></pre></div><p>To summarize the average departure delay by month, one option is to use
<a href=https://rdrr.io/pkg/clock/man/date_group.html target=_blank rel=noopener><code>date_group()</code></a> to group by the current month of the year. For Dates, this ends up setting every day of the month to <code>1</code>.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nv>flights</span> <span class=o>%&gt;%</span>
  <span class=nf>mutate</span><span class=o>(</span>date <span class=o>=</span> <span class=nf><a href=https://rdrr.io/pkg/clock/man/date_group.html>date_group</a></span><span class=o>(</span><span class=nv>date</span>, <span class=s>"month"</span><span class=o>)</span><span class=o>)</span> <span class=o>%&gt;%</span>
  <span class=nf>group_by</span><span class=o>(</span><span class=nv>date</span><span class=o>)</span> <span class=o>%&gt;%</span>
  <span class=nf>summarise</span><span class=o>(</span>avg_delay <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/mean.html>mean</a></span><span class=o>(</span><span class=nv>dep_delay</span>, na.rm <span class=o>=</span> <span class=kc>TRUE</span><span class=o>)</span>, .groups <span class=o>=</span> <span class=s>"drop"</span><span class=o>)</span>
<span class=c>#&gt; <span style=color:#555># A tibble: 12 x 2</span></span>
<span class=c>#&gt;    date       avg_delay</span>
<span class=c>#&gt;    <span style=color:#555;font-style:italic>&lt;date&gt;</span><span>         </span><span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span>
<span class=c>#&gt; <span style=color:#555> 1</span><span> 2013-01-01     33.3 </span></span>
<span class=c>#&gt; <span style=color:#555> 2</span><span> 2013-02-01     16   </span></span>
<span class=c>#&gt; <span style=color:#555> 3</span><span> 2013-03-01     41.8 </span></span>
<span class=c>#&gt; <span style=color:#555> 4</span><span> 2013-04-01     -</span><span style=color:#b00>3.14</span></span>
<span class=c>#&gt; <span style=color:#555> 5</span><span> 2013-05-01     -</span><span style=color:#b00>1.14</span></span>
<span class=c>#&gt; <span style=color:#555> 6</span><span> 2013-06-01     12.2 </span></span>
<span class=c>#&gt; <span style=color:#555> 7</span><span> 2013-07-01     15.2 </span></span>
<span class=c>#&gt; <span style=color:#555> 8</span><span> 2013-08-01     26.2 </span></span>
<span class=c>#&gt; <span style=color:#555> 9</span><span> 2013-09-01     10.2 </span></span>
<span class=c>#&gt; <span style=color:#555>10</span><span> 2013-10-01     21   </span></span>
<span class=c>#&gt; <span style=color:#555>11</span><span> 2013-11-01     -</span><span style=color:#b00>4.14</span></span>
<span class=c>#&gt; <span style=color:#555>12</span><span> 2013-12-01      6.2</span></span></code></pre></div><p>If you&rsquo;ve used lubridate before, you would have probably used
<a href=http://lubridate.tidyverse.org/reference/round_date.html target=_blank rel=noopener><code>lubridate::floor_date()</code></a> for this. In clock, date summarization is broken into three groups: grouping, shifting, and rounding. This separation leads to code that is both less surprising, and more powerful, giving you the ability to summarize in new ways, such as: flooring by multiple weeks, grouping by day of the quarter, and flooring by rolling sets of, say, 60 days.</p><p>Be sure to check out the many other high-level tools for working with dates, including powerful utilities for formatting (
<a href=https://clock.r-lib.org/reference/date_format.html target=_blank rel=noopener><code>date_format()</code></a>) and parsing (
<a href=https://clock.r-lib.org/reference/date_parse.html target=_blank rel=noopener><code>date_parse()</code></a> and
<a href=https://clock.r-lib.org/reference/date-time-parse.html target=_blank rel=noopener><code>date_time_parse()</code></a>).</p><p>As a lubridate user, none of the above should seem particularly revolutionary, and that&rsquo;s the entire idea of the high-level API. We&rsquo;ve tried to make transitioning over to clock as easy as possible. In the following sections, you&rsquo;ll see some of the benefits you&rsquo;ll get from doing so.</p><h2 id=invalid-dates>Invalid dates
<a href=#invalid-dates><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Using our <code>flights</code> data, imagine we want to add 1 month to <code>date</code>, perhaps to set up some kind of forward looking variable. With lubridate, we can use <code>+ months(1)</code>.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>mutate</span><span class=o>(</span><span class=nv>flights</span>, date2 <span class=o>=</span> <span class=nv>date</span> <span class=o>+</span> <span class=nf><a href=https://rdrr.io/r/base/weekday.POSIXt.html>months</a></span><span class=o>(</span><span class=m>1</span><span class=o>)</span><span class=o>)</span>
<span class=c>#&gt; <span style=color:#555># A tibble: 100 x 4</span></span>
<span class=c>#&gt;    date       dep_time dep_delay date2     </span>
<span class=c>#&gt;    <span style=color:#555;font-style:italic>&lt;date&gt;</span><span>        </span><span style=color:#555;font-style:italic>&lt;int&gt;</span><span>     </span><span style=color:#555;font-style:italic>&lt;dbl&gt;</span><span> </span><span style=color:#555;font-style:italic>&lt;date&gt;</span><span>    </span></span>
<span class=c>#&gt; <span style=color:#555> 1</span><span> 2013-01-06     </span><span style=text-decoration:underline>1</span><span>827        -</span><span style=color:#b00>3</span><span> 2013-02-06</span></span>
<span class=c>#&gt; <span style=color:#555> 2</span><span> 2013-01-08     </span><span style=text-decoration:underline>1</span><span>458        -</span><span style=color:#b00>2</span><span> 2013-02-08</span></span>
<span class=c>#&gt; <span style=color:#555> 3</span><span> 2013-01-17     </span><span style=text-decoration:underline>1</span><span>823        80 2013-02-17</span></span>
<span class=c>#&gt; <span style=color:#555> 4</span><span> 2013-01-26     </span><span style=text-decoration:underline>1</span><span>052        13 2013-02-26</span></span>
<span class=c>#&gt; <span style=color:#555> 5</span><span> 2013-01-29      448       -</span><span style=color:#b00>12</span><span> </span><span style=color:#b00>NA</span><span>        </span></span>
<span class=c>#&gt; <span style=color:#555> 6</span><span> 2013-01-30        3       124 </span><span style=color:#b00>NA</span><span>        </span></span>
<span class=c>#&gt; <span style=color:#555> 7</span><span> 2013-02-01      816        -</span><span style=color:#b00>9</span><span> 2013-03-01</span></span>
<span class=c>#&gt; <span style=color:#555> 8</span><span> 2013-02-04     </span><span style=text-decoration:underline>1</span><span>943         3 2013-03-04</span></span>
<span class=c>#&gt; <span style=color:#555> 9</span><span> 2013-02-10     </span><span style=text-decoration:underline>1</span><span>508        36 2013-03-10</span></span>
<span class=c>#&gt; <span style=color:#555>10</span><span> 2013-02-13     </span><span style=text-decoration:underline>2</span><span>033        33 2013-03-13</span></span>
<span class=c>#&gt; <span style=color:#555># â¦ with 90 more rows</span></span></code></pre></div><p>Huh, what&rsquo;s up with those <code>NA</code> values? Let&rsquo;s try with clock:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>mutate</span><span class=o>(</span><span class=nv>flights</span>, date2 <span class=o>=</span> <span class=nf><a href=https://rdrr.io/pkg/clock/man/clock-arithmetic.html>add_months</a></span><span class=o>(</span><span class=nv>date</span>, <span class=m>1</span><span class=o>)</span><span class=o>)</span>
<span class=c>#&gt; Error: Problem with `mutate()` input `date2`.</span>
<span class=c>#&gt; <span style=color:#b00>â</span><span> Invalid date found at location 5. Resolve invalid date issues by specifying the `invalid` argument.</span></span>
<span class=c>#&gt; <span style=color:#00b>â¹</span><span> Input `date2` is `add_months(date, 1)`.</span></span></code></pre></div><p>What&rsquo;s this about an invalid date? Location 5? Taking a closer look, we can see that adding 1 month to <code>2013-01-29</code> theoretically results in <code>2013-02-29</code>, which doesn&rsquo;t exist. In clock, this is known as an <em>invalid date</em>. With lubridate, invalid dates result in a silent <code>NA</code>. With clock, an error is raised.</p><p>So, how do we handle this? Well, there are a number of things that you could do:</p><ul><li><p>Return <code>NA</code></p></li><li><p>Return the previous valid moment in time</p></li><li><p>Return the next valid moment in time</p></li><li><p>Overflow our invalid date into March by the number of days past the true end of February that it landed at</p></li></ul><p>With lubridate,
<a href=http://lubridate.tidyverse.org/reference/mplus.html target=_blank rel=noopener><code>%m+%</code></a> (i.e.Â 
<a href=http://lubridate.tidyverse.org/reference/mplus.html target=_blank rel=noopener><code>add_with_rollback()</code></a>) can help with the second and third bullets. The hardest part about
<a href=http://lubridate.tidyverse.org/reference/mplus.html target=_blank rel=noopener><code>%m+%</code></a> is just remembering to use it. It is a common bug to forget to use this helper until <em>after</em> you have been bitten by an invalid date issue with an unexpected <code>NA</code>.</p><p>With clock, the error message advised us to use the <code>invalid</code> argument to
<a href=https://rdrr.io/pkg/clock/man/clock-arithmetic.html target=_blank rel=noopener><code>add_months()</code></a>. This allows for explicitly specifying one of many invalid date resolution strategies.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nv>problems</span> <span class=o>&lt;-</span> <span class=nv>flights</span> <span class=o>%&gt;%</span>
  <span class=nf>select</span><span class=o>(</span><span class=nv>date</span><span class=o>)</span> <span class=o>%&gt;%</span>
  <span class=nf>slice</span><span class=o>(</span><span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=m>5</span>, <span class=m>6</span><span class=o>)</span><span class=o>)</span>

<span class=nv>problems</span> <span class=o>%&gt;%</span>
  <span class=nf>mutate</span><span class=o>(</span>
    date2 <span class=o>=</span> <span class=nf><a href=https://rdrr.io/pkg/clock/man/clock-arithmetic.html>add_months</a></span><span class=o>(</span><span class=nv>date</span>, <span class=m>1</span>, invalid <span class=o>=</span> <span class=s>"previous"</span><span class=o>)</span>,
    date3 <span class=o>=</span> <span class=nf><a href=https://rdrr.io/pkg/clock/man/clock-arithmetic.html>add_months</a></span><span class=o>(</span><span class=nv>date</span>, <span class=m>1</span>, invalid <span class=o>=</span> <span class=s>"next"</span><span class=o>)</span>,
    date4 <span class=o>=</span> <span class=nf><a href=https://rdrr.io/pkg/clock/man/clock-arithmetic.html>add_months</a></span><span class=o>(</span><span class=nv>date</span>, <span class=m>1</span>, invalid <span class=o>=</span> <span class=s>"overflow"</span><span class=o>)</span>,
    date5 <span class=o>=</span> <span class=nf><a href=https://rdrr.io/pkg/clock/man/clock-arithmetic.html>add_months</a></span><span class=o>(</span><span class=nv>date</span>, <span class=m>1</span>, invalid <span class=o>=</span> <span class=s>"NA"</span><span class=o>)</span>
  <span class=o>)</span>
<span class=c>#&gt; <span style=color:#555># A tibble: 2 x 5</span></span>
<span class=c>#&gt;   date       date2      date3      date4      date5     </span>
<span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;date&gt;</span><span>     </span><span style=color:#555;font-style:italic>&lt;date&gt;</span><span>     </span><span style=color:#555;font-style:italic>&lt;date&gt;</span><span>     </span><span style=color:#555;font-style:italic>&lt;date&gt;</span><span>     </span><span style=color:#555;font-style:italic>&lt;date&gt;</span><span>    </span></span>
<span class=c>#&gt; <span style=color:#555>1</span><span> 2013-01-29 2013-02-28 2013-03-01 2013-03-01 </span><span style=color:#b00>NA</span><span>        </span></span>
<span class=c>#&gt; <span style=color:#555>2</span><span> 2013-01-30 2013-02-28 2013-03-01 2013-03-02 </span><span style=color:#b00>NA</span></span></code></pre></div><p>The overarching goal of clock is to protect you from issues like invalid dates by erroring early and often, rather than letting them slip through unnoticed, only to cause hard to debug issues down the line. If you&rsquo;re thinking, &ldquo;That would never happen to me!", consider that if you had a daily sequence of every date in a particular year, and added 1 month to each date in that sequence, you would immediately generate <em>7 invalid dates</em> (6 if you chose a leap year).</p><h2 id=daylight-saving-time>Daylight saving time
<a href=#daylight-saving-time><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>The <code>dep_time</code> column of <code>flights</code> contains the hour and minute of the actual departure time, encoded together into a single integer. Let&rsquo;s extract that.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nv>flights_hm</span> <span class=o>&lt;-</span> <span class=nv>flights</span> <span class=o>%&gt;%</span>
  <span class=nf>select</span><span class=o>(</span><span class=nv>date</span>, <span class=nv>dep_time</span><span class=o>)</span> <span class=o>%&gt;%</span>
  <span class=nf>mutate</span><span class=o>(</span>
    hour <span class=o>=</span> <span class=nv>dep_time</span> <span class=o>%/%</span> <span class=m>100L</span>,
    minute <span class=o>=</span> <span class=nv>dep_time</span> <span class=o>%%</span> <span class=m>100L</span>,
    .keep <span class=o>=</span> <span class=s>"unused"</span>
  <span class=o>)</span>

<span class=nf><a href=https://rdrr.io/r/utils/head.html>head</a></span><span class=o>(</span><span class=nv>flights_hm</span>, n <span class=o>=</span> <span class=m>2</span><span class=o>)</span>
<span class=c>#&gt; <span style=color:#555># A tibble: 2 x 3</span></span>
<span class=c>#&gt;   date        hour minute</span>
<span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;date&gt;</span><span>     </span><span style=color:#555;font-style:italic>&lt;int&gt;</span><span>  </span><span style=color:#555;font-style:italic>&lt;int&gt;</span></span>
<span class=c>#&gt; <span style=color:#555>1</span><span> 2013-01-06    18     27</span></span>
<span class=c>#&gt; <span style=color:#555>2</span><span> 2013-01-08    14     58</span></span></code></pre></div><p>We&rsquo;d like to be able to add this time of day information to our <code>date</code> column. This flight information was recorded in the America/New_York time zone, so our resulting date-time should have that time zone as well. However, converting Date -> POSIXct will <em>always</em> assume that Date starts as UTC, rather than being naive to any time zones, and the result will use your system&rsquo;s local time zone. This can have unintended side effects:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=c># My local time zone is actually America/New_York.</span>
<span class=c># The conversion to POSIXct retains the underlying UTC instant, but</span>
<span class=c># the printed time changes unexpectedly, showing the equivalent time</span>
<span class=c># in the local time zone.</span>
<span class=nv>flights_hm</span> <span class=o>%&gt;%</span>
  <span class=nf>select</span><span class=o>(</span><span class=nv>date</span><span class=o>)</span> <span class=o>%&gt;%</span>
  <span class=nf>mutate</span><span class=o>(</span>
    datetime <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/as.POSIXlt.html>as.POSIXct</a></span><span class=o>(</span><span class=nv>date</span><span class=o>)</span>,
    datetime_utc <span class=o>=</span> <span class=nf><a href=https://rdrr.io/pkg/clock/man/date-zone.html>date_set_zone</a></span><span class=o>(</span><span class=nv>datetime</span>, <span class=s>"UTC"</span><span class=o>)</span>
  <span class=o>)</span> <span class=o>%&gt;%</span>
  <span class=nf><a href=https://rdrr.io/r/utils/head.html>head</a></span><span class=o>(</span>n <span class=o>=</span> <span class=m>3</span><span class=o>)</span>
<span class=c>#&gt; <span style=color:#555># A tibble: 3 x 3</span></span>
<span class=c>#&gt;   date       datetime            datetime_utc       </span>
<span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;date&gt;</span><span>     </span><span style=color:#555;font-style:italic>&lt;dttm&gt;</span><span>              </span><span style=color:#555;font-style:italic>&lt;dttm&gt;</span><span>             </span></span>
<span class=c>#&gt; <span style=color:#555>1</span><span> 2013-01-06 2013-01-05 </span><span style=color:#555>19:00:00</span><span> 2013-01-06 </span><span style=color:#555>00:00:00</span></span>
<span class=c>#&gt; <span style=color:#555>2</span><span> 2013-01-08 2013-01-07 </span><span style=color:#555>19:00:00</span><span> 2013-01-08 </span><span style=color:#555>00:00:00</span></span>
<span class=c>#&gt; <span style=color:#555>3</span><span> 2013-01-17 2013-01-16 </span><span style=color:#555>19:00:00</span><span> 2013-01-17 </span><span style=color:#555>00:00:00</span></span></code></pre></div><p>To get what we want, we need to convince the <code>date</code> column to &ldquo;forget&rdquo; that it is UTC, then add on the America/New_York time zone. With clock, we&rsquo;ll do this by going through a new intermediate type called naive-time, a date-time type with a yet-to-be-specified time zone. The ability to separate a date-time from its associated time zone is one of clock&rsquo;s most powerful features, which we&rsquo;ll explore more in the Time Points section below. For now, the important thing is that this retains the printed time as we expected.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nv>flights_dt</span> <span class=o>&lt;-</span> <span class=nv>flights_hm</span> <span class=o>%&gt;%</span>
  <span class=nf>mutate</span><span class=o>(</span>
    datetime <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/as.POSIXlt.html>as.POSIXct</a></span><span class=o>(</span><span class=nf><a href=https://rdrr.io/pkg/clock/man/as_naive_time.html>as_naive_time</a></span><span class=o>(</span><span class=nv>date</span><span class=o>)</span>, <span class=s>"America/New_York"</span><span class=o>)</span>,
    .keep <span class=o>=</span> <span class=s>"unused"</span>,
    .before <span class=o>=</span> <span class=m>1</span>
  <span class=o>)</span>

<span class=nv>flights_dt</span>
<span class=c>#&gt; <span style=color:#555># A tibble: 100 x 3</span></span>
<span class=c>#&gt;    datetime             hour minute</span>
<span class=c>#&gt;    <span style=color:#555;font-style:italic>&lt;dttm&gt;</span><span>              </span><span style=color:#555;font-style:italic>&lt;int&gt;</span><span>  </span><span style=color:#555;font-style:italic>&lt;int&gt;</span></span>
<span class=c>#&gt; <span style=color:#555> 1</span><span> 2013-01-06 </span><span style=color:#555>00:00:00</span><span>    18     27</span></span>
<span class=c>#&gt; <span style=color:#555> 2</span><span> 2013-01-08 </span><span style=color:#555>00:00:00</span><span>    14     58</span></span>
<span class=c>#&gt; <span style=color:#555> 3</span><span> 2013-01-17 </span><span style=color:#555>00:00:00</span><span>    18     23</span></span>
<span class=c>#&gt; <span style=color:#555> 4</span><span> 2013-01-26 </span><span style=color:#555>00:00:00</span><span>    10     52</span></span>
<span class=c>#&gt; <span style=color:#555> 5</span><span> 2013-01-29 </span><span style=color:#555>00:00:00</span><span>     4     48</span></span>
<span class=c>#&gt; <span style=color:#555> 6</span><span> 2013-01-30 </span><span style=color:#555>00:00:00</span><span>     0      3</span></span>
<span class=c>#&gt; <span style=color:#555> 7</span><span> 2013-02-01 </span><span style=color:#555>00:00:00</span><span>     8     16</span></span>
<span class=c>#&gt; <span style=color:#555> 8</span><span> 2013-02-04 </span><span style=color:#555>00:00:00</span><span>    19     43</span></span>
<span class=c>#&gt; <span style=color:#555> 9</span><span> 2013-02-10 </span><span style=color:#555>00:00:00</span><span>    15      8</span></span>
<span class=c>#&gt; <span style=color:#555>10</span><span> 2013-02-13 </span><span style=color:#555>00:00:00</span><span>    20     33</span></span>
<span class=c>#&gt; <span style=color:#555># â¦ with 90 more rows</span></span></code></pre></div><p>We can now add on our hours and minutes.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nv>flights_dt</span> <span class=o>&lt;-</span> <span class=nv>flights_dt</span> <span class=o>%&gt;%</span>
  <span class=nf>mutate</span><span class=o>(</span>
    datetime <span class=o>=</span> <span class=nv>datetime</span> <span class=o>%&gt;%</span>
      <span class=nf><a href=https://rdrr.io/pkg/clock/man/clock-arithmetic.html>add_hours</a></span><span class=o>(</span><span class=nv>hour</span><span class=o>)</span> <span class=o>%&gt;%</span>
      <span class=nf><a href=https://rdrr.io/pkg/clock/man/clock-arithmetic.html>add_minutes</a></span><span class=o>(</span><span class=nv>minute</span><span class=o>)</span>,
    .keep <span class=o>=</span> <span class=s>"unused"</span>
  <span class=o>)</span>

<span class=nv>flights_dt</span>
<span class=c>#&gt; <span style=color:#555># A tibble: 100 x 1</span></span>
<span class=c>#&gt;    datetime           </span>
<span class=c>#&gt;    <span style=color:#555;font-style:italic>&lt;dttm&gt;</span><span>             </span></span>
<span class=c>#&gt; <span style=color:#555> 1</span><span> 2013-01-06 </span><span style=color:#555>18:27:00</span></span>
<span class=c>#&gt; <span style=color:#555> 2</span><span> 2013-01-08 </span><span style=color:#555>14:58:00</span></span>
<span class=c>#&gt; <span style=color:#555> 3</span><span> 2013-01-17 </span><span style=color:#555>18:23:00</span></span>
<span class=c>#&gt; <span style=color:#555> 4</span><span> 2013-01-26 </span><span style=color:#555>10:52:00</span></span>
<span class=c>#&gt; <span style=color:#555> 5</span><span> 2013-01-29 </span><span style=color:#555>04:48:00</span></span>
<span class=c>#&gt; <span style=color:#555> 6</span><span> 2013-01-30 </span><span style=color:#555>00:03:00</span></span>
<span class=c>#&gt; <span style=color:#555> 7</span><span> 2013-02-01 </span><span style=color:#555>08:16:00</span></span>
<span class=c>#&gt; <span style=color:#555> 8</span><span> 2013-02-04 </span><span style=color:#555>19:43:00</span></span>
<span class=c>#&gt; <span style=color:#555> 9</span><span> 2013-02-10 </span><span style=color:#555>15:08:00</span></span>
<span class=c>#&gt; <span style=color:#555>10</span><span> 2013-02-13 </span><span style=color:#555>20:33:00</span></span>
<span class=c>#&gt; <span style=color:#555># â¦ with 90 more rows</span></span></code></pre></div><p>Now assume that we want to add two days to this <code>datetime</code> column, again to construct some forward looking variable.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nv>flights_dt_lubridate</span> <span class=o>&lt;-</span> <span class=nv>flights_dt</span> <span class=o>%&gt;%</span>
  <span class=nf>mutate</span><span class=o>(</span>datetime2 <span class=o>=</span> <span class=nv>datetime</span> <span class=o>+</span> <span class=nf><a href=http://lubridate.tidyverse.org/reference/period.html>days</a></span><span class=o>(</span><span class=m>2</span><span class=o>)</span><span class=o>)</span>

<span class=nv>flights_dt_lubridate</span>
<span class=c>#&gt; <span style=color:#555># A tibble: 100 x 2</span></span>
<span class=c>#&gt;    datetime            datetime2          </span>
<span class=c>#&gt;    <span style=color:#555;font-style:italic>&lt;dttm&gt;</span><span>              </span><span style=color:#555;font-style:italic>&lt;dttm&gt;</span><span>             </span></span>
<span class=c>#&gt; <span style=color:#555> 1</span><span> 2013-01-06 </span><span style=color:#555>18:27:00</span><span> 2013-01-08 </span><span style=color:#555>18:27:00</span></span>
<span class=c>#&gt; <span style=color:#555> 2</span><span> 2013-01-08 </span><span style=color:#555>14:58:00</span><span> 2013-01-10 </span><span style=color:#555>14:58:00</span></span>
<span class=c>#&gt; <span style=color:#555> 3</span><span> 2013-01-17 </span><span style=color:#555>18:23:00</span><span> 2013-01-19 </span><span style=color:#555>18:23:00</span></span>
<span class=c>#&gt; <span style=color:#555> 4</span><span> 2013-01-26 </span><span style=color:#555>10:52:00</span><span> 2013-01-28 </span><span style=color:#555>10:52:00</span></span>
<span class=c>#&gt; <span style=color:#555> 5</span><span> 2013-01-29 </span><span style=color:#555>04:48:00</span><span> 2013-01-31 </span><span style=color:#555>04:48:00</span></span>
<span class=c>#&gt; <span style=color:#555> 6</span><span> 2013-01-30 </span><span style=color:#555>00:03:00</span><span> 2013-02-01 </span><span style=color:#555>00:03:00</span></span>
<span class=c>#&gt; <span style=color:#555> 7</span><span> 2013-02-01 </span><span style=color:#555>08:16:00</span><span> 2013-02-03 </span><span style=color:#555>08:16:00</span></span>
<span class=c>#&gt; <span style=color:#555> 8</span><span> 2013-02-04 </span><span style=color:#555>19:43:00</span><span> 2013-02-06 </span><span style=color:#555>19:43:00</span></span>
<span class=c>#&gt; <span style=color:#555> 9</span><span> 2013-02-10 </span><span style=color:#555>15:08:00</span><span> 2013-02-12 </span><span style=color:#555>15:08:00</span></span>
<span class=c>#&gt; <span style=color:#555>10</span><span> 2013-02-13 </span><span style=color:#555>20:33:00</span><span> 2013-02-15 </span><span style=color:#555>20:33:00</span></span>
<span class=c>#&gt; <span style=color:#555># â¦ with 90 more rows</span></span></code></pre></div><p>Looks reasonable. Now with clock:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nv>flights_dt</span> <span class=o>%&gt;%</span>
  <span class=nf>mutate</span><span class=o>(</span>datetime2 <span class=o>=</span> <span class=nf><a href=https://rdrr.io/pkg/clock/man/clock-arithmetic.html>add_days</a></span><span class=o>(</span><span class=nv>datetime</span>, <span class=m>2</span><span class=o>)</span><span class=o>)</span>
<span class=c>#&gt; Error: Problem with `mutate()` input `datetime2`.</span>
<span class=c>#&gt; <span style=color:#b00>â</span><span> Nonexistent time due to daylight saving time at location 18. Resolve nonexistent time issues by specifying the `nonexistent` argument.</span></span>
<span class=c>#&gt; <span style=color:#00b>â¹</span><span> Input `datetime2` is `add_days(datetime, 2)`.</span></span></code></pre></div><p>Another problem! This time a <em>nonexistent time</em> at row 18. Let&rsquo;s investigate what lubridate gave us here:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nv>flights_dt_lubridate</span><span class=o>[</span><span class=m>18</span>,<span class=o>]</span>
<span class=c>#&gt; <span style=color:#555># A tibble: 1 x 2</span></span>
<span class=c>#&gt;   datetime            datetime2          </span>
<span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;dttm&gt;</span><span>              </span><span style=color:#555;font-style:italic>&lt;dttm&gt;</span><span>             </span></span>
<span class=c>#&gt; <span style=color:#555>1</span><span> 2013-03-08 </span><span style=color:#555>02:23:00</span><span> </span><span style=color:#b00>NA</span></span></code></pre></div><p>An <code>NA</code>? But why?</p><p>As it turns out, in the America/New_York time zone, on 2013-03-10 the clocks jumped forward from 01:59:59 -> 03:00:00, creating a daylight saving time gap, and a <em>nonexistent</em> 2 o&rsquo;clock hour. By adding two days, we&rsquo;ve landed right in that gap (at 02:23:00). With nonexistent times like this, lubridate silently returns <code>NA</code>, while clock errors.</p><p>Like with invalid dates, clock tries to guard you from these issues by erroring as soon as they occur. You can resolve these particular issues with the <code>nonexistent</code> argument to
<a href=https://rdrr.io/pkg/clock/man/clock-arithmetic.html target=_blank rel=noopener><code>add_days()</code></a>. In this case, we could:</p><ul><li><p>Roll forward to the next valid moment in time</p></li><li><p>Roll backward to the previous valid moment in time</p></li><li><p>Shift forward by the size of the gap</p></li><li><p>Shift backward by the size of the gap</p></li><li><p>Return <code>NA</code></p></li></ul><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nv>problem</span> <span class=o>&lt;-</span> <span class=nv>flights_dt</span><span class=o>$</span><span class=nv>datetime</span><span class=o>[</span><span class=m>18</span><span class=o>]</span>
<span class=nv>problem</span>
<span class=c>#&gt; [1] "2013-03-08 02:23:00 EST"</span>

<span class=c># 02:23:00 -&gt; 03:00:00</span>
<span class=nf><a href=https://rdrr.io/pkg/clock/man/clock-arithmetic.html>add_days</a></span><span class=o>(</span><span class=nv>problem</span>, <span class=m>2</span>, nonexistent <span class=o>=</span> <span class=s>"roll-forward"</span><span class=o>)</span>
<span class=c>#&gt; [1] "2013-03-10 03:00:00 EDT"</span>

<span class=c># 02:23:00 -&gt; 01:59:59</span>
<span class=nf><a href=https://rdrr.io/pkg/clock/man/clock-arithmetic.html>add_days</a></span><span class=o>(</span><span class=nv>problem</span>, <span class=m>2</span>, nonexistent <span class=o>=</span> <span class=s>"roll-backward"</span><span class=o>)</span>
<span class=c>#&gt; [1] "2013-03-10 01:59:59 EST"</span>

<span class=c># 02:23:00 -&gt; 03:23:00</span>
<span class=nf><a href=https://rdrr.io/pkg/clock/man/clock-arithmetic.html>add_days</a></span><span class=o>(</span><span class=nv>problem</span>, <span class=m>2</span>, nonexistent <span class=o>=</span> <span class=s>"shift-forward"</span><span class=o>)</span>
<span class=c>#&gt; [1] "2013-03-10 03:23:00 EDT"</span>

<span class=c># 02:23:00 -&gt; 01:23:00</span>
<span class=nf><a href=https://rdrr.io/pkg/clock/man/clock-arithmetic.html>add_days</a></span><span class=o>(</span><span class=nv>problem</span>, <span class=m>2</span>, nonexistent <span class=o>=</span> <span class=s>"shift-backward"</span><span class=o>)</span>
<span class=c>#&gt; [1] "2013-03-10 01:23:00 EST"</span>

<span class=c># 02:23:00 -&gt; NA</span>
<span class=nf><a href=https://rdrr.io/pkg/clock/man/clock-arithmetic.html>add_days</a></span><span class=o>(</span><span class=nv>problem</span>, <span class=m>2</span>, nonexistent <span class=o>=</span> <span class=s>"NA"</span><span class=o>)</span>
<span class=c>#&gt; [1] NA</span></code></pre></div><p>I recommend <code>"roll-forward"</code> or <code>"roll-backward"</code>, as these retain the <em>relative ordering</em> of <code>datetime</code>, an issue that you can read about
<a href=https://clock.r-lib.org/articles/articles/motivations.html#nonexistent-time-1 target=_blank rel=noopener>here</a>.</p><p>Unlike with invalid dates, lubridate does not provide any tools for resolving nonexistent times.</p><p>There are another class of daylight saving time issues related to <em>ambiguous times</em>. These generally result from daylight saving fallbacks, where your clock might show two 1 AM hours. You resolve them in a similar way to what was done with nonexistent times. If you&rsquo;re interested, you can read more about ambiguous times
<a href=https://clock.r-lib.org/articles/articles/motivations.html#ambiguous-time-1 target=_blank rel=noopener>here</a>.</p><p>Nonexistent and ambiguous times are particularly nasty issues because they occur relatively infrequently. If your time zone uses daylight saving time, these issues each come up once per year, generally for a duration of 1 hour (but not always!). This can be incredibly frustrating in production, where an analysis that has been working fine suddenly crashes on new data due to a daylight saving time issue. Which brings me to&mldr;</p><h2 id=production>Production
<a href=#production><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>This new invalid date and daylight saving time behavior might sound great to you, but you might be wondering about usage of clock in production. What happens if
<a href=https://rdrr.io/pkg/clock/man/clock-arithmetic.html target=_blank rel=noopener><code>add_months()</code></a> worked in interactive development, but then you put your analysis into production, gathered new data, and all of the sudden it started failing?</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nv>dates</span> <span class=o>&lt;-</span> <span class=nv>flights</span><span class=o>$</span><span class=nv>date</span>

<span class=c># All good! Ship it!</span>
<span class=nf><a href=https://rdrr.io/pkg/clock/man/clock-arithmetic.html>add_months</a></span><span class=o>(</span><span class=nv>dates</span><span class=o>[</span><span class=m>1</span><span class=o>:</span><span class=m>4</span><span class=o>]</span>, <span class=m>1</span><span class=o>)</span> 
<span class=c>#&gt; [1] "2013-02-06" "2013-02-08" "2013-02-17" "2013-02-26"</span>

<span class=c># Failed in production with new data! Oh no!</span>
<span class=nf><a href=https://rdrr.io/pkg/clock/man/clock-arithmetic.html>add_months</a></span><span class=o>(</span><span class=nv>dates</span><span class=o>[</span><span class=m>1</span><span class=o>:</span><span class=m>10</span><span class=o>]</span>, <span class=m>1</span><span class=o>)</span>
<span class=c>#&gt; Error: Invalid date found at location 5. Resolve invalid date issues by specifying the `invalid` argument.</span></code></pre></div><p>To balance the usefulness of clock in interactive development with the strict requirements of production, you can set the <code>clock.strict</code> global option to <code>TRUE</code> to turn <code>invalid</code>, <code>nonexistent</code>, and <code>ambiguous</code> from optional arguments into required ones.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>rlang</span><span class=nf>::</span><span class=nf><a href=https://rlang.r-lib.org/reference/local_options.html>with_options</a></span><span class=o>(</span>clock.strict <span class=o>=</span> <span class=kc>TRUE</span>, .expr <span class=o>=</span> <span class=o>&#123;</span>
  <span class=nf><a href=https://rdrr.io/pkg/clock/man/clock-arithmetic.html>add_months</a></span><span class=o>(</span><span class=nv>dates</span><span class=o>[</span><span class=m>1</span><span class=o>:</span><span class=m>4</span><span class=o>]</span>, <span class=m>1</span><span class=o>)</span>
<span class=o>&#125;</span><span class=o>)</span>
<span class=c>#&gt; Error: The global option, `clock.strict`, is currently set to `TRUE`. In this mode, `invalid` must be set and cannot be left as `NULL`.</span></code></pre></div><p>Forcing yourself to specify these arguments up front during interactive development is a great way to explicitly document your assumptions about these possible issues, while also guarding against future problems in production.</p><h2 id=advanced-features>Advanced features
<a href=#advanced-features><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>This blog post has only scratched the surface of what clock can do. Up until now, we&rsquo;ve only explored clock&rsquo;s high-level API. There exists an entire world of more powerful utilities in the low-level API that powers clock. We&rsquo;ll briefly explore a few of those in the next few sections, but I&rsquo;d encourage checking out the rest of the
<a href=https://clock.r-lib.org/reference/index.html target=_blank rel=noopener>reference page</a> to get a bird&rsquo;s-eye view of all that clock can do.</p><h3 id=calendars>Calendars
<a href=#calendars><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>Calendars allow you to represent a date using an alternative format. Rather than using a typical year, month, and day of the month format, you might want to specify the fiscal year, quarter, and day of the quarter. In the end, these point to the same moment in time, just in different ways. For example:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nv>ymd</span> <span class=o>&lt;-</span> <span class=nf><a href=https://rdrr.io/pkg/clock/man/year_month_day.html>year_month_day</a></span><span class=o>(</span><span class=m>2019</span>, <span class=m>2</span>, <span class=m>25</span><span class=o>)</span>

<span class=c># Fiscal year starting in January</span>
<span class=nf><a href=https://rdrr.io/pkg/clock/man/as_year_quarter_day.html>as_year_quarter_day</a></span><span class=o>(</span><span class=nv>ymd</span><span class=o>)</span>
<span class=c>#&gt; &lt;year_quarter_day&lt;January&gt;&lt;day&gt;[1]&gt;</span>
<span class=c>#&gt; [1] "2019-Q1-56"</span>

<span class=c># Fiscal year starting in April</span>
<span class=nf><a href=https://rdrr.io/pkg/clock/man/as_year_quarter_day.html>as_year_quarter_day</a></span><span class=o>(</span><span class=nv>ymd</span>, start <span class=o>=</span> <span class=nv>clock_months</span><span class=o>$</span><span class=nv>april</span><span class=o>)</span>
<span class=c>#&gt; &lt;year_quarter_day&lt;April&gt;&lt;day&gt;[1]&gt;</span>
<span class=c>#&gt; [1] "2019-Q4-56"</span></code></pre></div><p>There are 5 calendars that come with clock. The neat part about these is that they have <em>varying precision</em>, from year to nanosecond. This provides built-in granular types like year-month and year-quarter.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=c># Gregorian year, month, and day of the month</span>
<span class=nf><a href=https://rdrr.io/pkg/clock/man/year_month_day.html>year_month_day</a></span><span class=o>(</span><span class=m>2019</span>, <span class=m>1</span>, <span class=m>14</span><span class=o>)</span>
<span class=c>#&gt; &lt;year_month_day&lt;day&gt;[1]&gt;</span>
<span class=c>#&gt; [1] "2019-01-14"</span>
<span class=nf><a href=https://rdrr.io/pkg/clock/man/year_month_day.html>year_month_day</a></span><span class=o>(</span><span class=m>2019</span>, <span class=m>2</span><span class=o>)</span>
<span class=c>#&gt; &lt;year_month_day&lt;month&gt;[1]&gt;</span>
<span class=c>#&gt; [1] "2019-02"</span>
<span class=nf><a href=https://rdrr.io/pkg/clock/man/year_month_day.html>year_month_day</a></span><span class=o>(</span><span class=m>2019</span>, <span class=m>2</span>, <span class=m>14</span>, <span class=m>2</span>, <span class=m>30</span>, <span class=m>25</span>, <span class=m>12345</span>, subsecond_precision <span class=o>=</span> <span class=s>"nanosecond"</span><span class=o>)</span>
<span class=c>#&gt; &lt;year_month_day&lt;nanosecond&gt;[1]&gt;</span>
<span class=c>#&gt; [1] "2019-02-14 02:30:25.000012345"</span>

<span class=c># Gregorian year, month, and indexed weekday of the month</span>
<span class=c># (i.e. the 2nd Wednesday)</span>
<span class=nf><a href=https://rdrr.io/pkg/clock/man/year_month_weekday.html>year_month_weekday</a></span><span class=o>(</span><span class=m>2019</span>, <span class=m>2</span>, day <span class=o>=</span> <span class=nv>clock_weekdays</span><span class=o>$</span><span class=nv>wednesday</span>, index <span class=o>=</span> <span class=m>2</span><span class=o>)</span>
<span class=c>#&gt; &lt;year_month_weekday&lt;day&gt;[1]&gt;</span>
<span class=c>#&gt; [1] "2019-02-Wed[2]"</span>

<span class=c># Gregorian year and day of the year</span>
<span class=nf><a href=https://rdrr.io/pkg/clock/man/year_day.html>year_day</a></span><span class=o>(</span><span class=m>2019</span>, <span class=m>105</span><span class=o>)</span>
<span class=c>#&gt; &lt;year_day&lt;day&gt;[1]&gt;</span>
<span class=c>#&gt; [1] "2019-105"</span>

<span class=c># Fiscal year, quarter, and day of the quarter</span>
<span class=nf><a href=https://rdrr.io/pkg/clock/man/year_quarter_day.html>year_quarter_day</a></span><span class=o>(</span><span class=m>2019</span>, <span class=m>1</span>, <span class=m>14</span><span class=o>)</span>
<span class=c>#&gt; &lt;year_quarter_day&lt;January&gt;&lt;day&gt;[1]&gt;</span>
<span class=c>#&gt; [1] "2019-Q1-14"</span>
<span class=nf><a href=https://rdrr.io/pkg/clock/man/year_quarter_day.html>year_quarter_day</a></span><span class=o>(</span><span class=m>2019</span>, <span class=m>1</span>, <span class=m>14</span>, start <span class=o>=</span> <span class=nv>clock_months</span><span class=o>$</span><span class=nv>april</span><span class=o>)</span>
<span class=c>#&gt; &lt;year_quarter_day&lt;April&gt;&lt;day&gt;[1]&gt;</span>
<span class=c>#&gt; [1] "2019-Q1-14"</span>
<span class=nf><a href=https://rdrr.io/pkg/clock/man/year_quarter_day.html>year_quarter_day</a></span><span class=o>(</span><span class=m>2019</span>, <span class=m>2</span><span class=o>:</span><span class=m>4</span><span class=o>)</span>
<span class=c>#&gt; &lt;year_quarter_day&lt;January&gt;&lt;quarter&gt;[3]&gt;</span>
<span class=c>#&gt; [1] "2019-Q2" "2019-Q3" "2019-Q4"</span>

<span class=c># ISO year, week, and day of the week</span>
<span class=nf><a href=https://rdrr.io/pkg/clock/man/iso_year_week_day.html>iso_year_week_day</a></span><span class=o>(</span><span class=m>2019</span>, <span class=m>2</span>, <span class=nv>clock_iso_weekdays</span><span class=o>$</span><span class=nv>friday</span><span class=o>)</span>
<span class=c>#&gt; &lt;iso_year_week_day&lt;day&gt;[1]&gt;</span>
<span class=c>#&gt; [1] "2019-W02-5"</span></code></pre></div><p>As shown above, you can convert from one calendar to another with functions like
<a href=https://rdrr.io/pkg/clock/man/as_year_quarter_day.html target=_blank rel=noopener><code>as_year_quarter_day()</code></a>, and to Date or POSIXct with the standard
<a href=https://rdrr.io/r/base/as.Date.html target=_blank rel=noopener><code>as.Date()</code></a> and
<a href=https://rdrr.io/r/base/as.POSIXlt.html target=_blank rel=noopener><code>as.POSIXct()</code></a> functions.</p><p>One of the most unique features of calendars is the ability to represent invalid dates directly. In a previous section, we added 1 month to a Date and used the <code>invalid</code> argument to resolve invalid date issues. Let&rsquo;s swap to a year-month-day and try again. We can also use the cleaner <code>+ duration_months()</code> syntax here, which we can&rsquo;t use with Dates.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nv>invalids</span> <span class=o>&lt;-</span> <span class=nv>flights</span> <span class=o>%&gt;%</span>
  <span class=nf>select</span><span class=o>(</span><span class=nv>date</span><span class=o>)</span> <span class=o>%&gt;%</span>
  <span class=nf>mutate</span><span class=o>(</span>
    ymd <span class=o>=</span> <span class=nf><a href=https://rdrr.io/pkg/clock/man/as_year_month_day.html>as_year_month_day</a></span><span class=o>(</span><span class=nv>date</span><span class=o>)</span>,
    ymd2 <span class=o>=</span> <span class=nv>ymd</span> <span class=o>+</span> <span class=nf><a href=https://rdrr.io/pkg/clock/man/duration-helper.html>duration_months</a></span><span class=o>(</span><span class=m>1</span><span class=o>)</span>
  <span class=o>)</span>

<span class=nv>invalids</span>
<span class=c>#&gt; <span style=color:#555># A tibble: 100 x 3</span></span>
<span class=c>#&gt;    date       ymd        ymd2      </span>
<span class=c>#&gt;    <span style=color:#555;font-style:italic>&lt;date&gt;</span><span>     </span><span style=color:#555;font-style:italic>&lt;ymd&lt;day&gt;&gt;</span><span> </span><span style=color:#555;font-style:italic>&lt;ymd&lt;day&gt;&gt;</span></span>
<span class=c>#&gt; <span style=color:#555> 1</span><span> 2013-01-06 2013-01-06 2013-02-06</span></span>
<span class=c>#&gt; <span style=color:#555> 2</span><span> 2013-01-08 2013-01-08 2013-02-08</span></span>
<span class=c>#&gt; <span style=color:#555> 3</span><span> 2013-01-17 2013-01-17 2013-02-17</span></span>
<span class=c>#&gt; <span style=color:#555> 4</span><span> 2013-01-26 2013-01-26 2013-02-26</span></span>
<span class=c>#&gt; <span style=color:#555> 5</span><span> 2013-01-29 2013-01-29 2013-02-29</span></span>
<span class=c>#&gt; <span style=color:#555> 6</span><span> 2013-01-30 2013-01-30 2013-02-30</span></span>
<span class=c>#&gt; <span style=color:#555> 7</span><span> 2013-02-01 2013-02-01 2013-03-01</span></span>
<span class=c>#&gt; <span style=color:#555> 8</span><span> 2013-02-04 2013-02-04 2013-03-04</span></span>
<span class=c>#&gt; <span style=color:#555> 9</span><span> 2013-02-10 2013-02-10 2013-03-10</span></span>
<span class=c>#&gt; <span style=color:#555>10</span><span> 2013-02-13 2013-02-13 2013-03-13</span></span>
<span class=c>#&gt; <span style=color:#555># â¦ with 90 more rows</span></span></code></pre></div><p>The <code>ymd2</code> column directly contains the invalid dates, <code>2013-02-29</code> and <code>2013-02-30</code>! You can resolve these dates at any time using
<a href=https://rdrr.io/pkg/clock/man/clock-invalid.html target=_blank rel=noopener><code>invalid_resolve()</code></a>, providing an invalid resolution strategy like we did earlier. Or, you can ignore them if you expect them to be resolved naturally in some other way. For example, if our end goal was to add 1 month, then fix the day of the month to the 15th, then these invalid dates would naturally resolve themselves:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>mutate</span><span class=o>(</span><span class=nv>invalids</span>, ymd3 <span class=o>=</span> <span class=nf><a href=https://rdrr.io/pkg/clock/man/clock-setters.html>set_day</a></span><span class=o>(</span><span class=nv>ymd2</span>, <span class=m>15</span><span class=o>)</span><span class=o>)</span>
<span class=c>#&gt; <span style=color:#555># A tibble: 100 x 4</span></span>
<span class=c>#&gt;    date       ymd        ymd2       ymd3      </span>
<span class=c>#&gt;    <span style=color:#555;font-style:italic>&lt;date&gt;</span><span>     </span><span style=color:#555;font-style:italic>&lt;ymd&lt;day&gt;&gt;</span><span> </span><span style=color:#555;font-style:italic>&lt;ymd&lt;day&gt;&gt;</span><span> </span><span style=color:#555;font-style:italic>&lt;ymd&lt;day&gt;&gt;</span></span>
<span class=c>#&gt; <span style=color:#555> 1</span><span> 2013-01-06 2013-01-06 2013-02-06 2013-02-15</span></span>
<span class=c>#&gt; <span style=color:#555> 2</span><span> 2013-01-08 2013-01-08 2013-02-08 2013-02-15</span></span>
<span class=c>#&gt; <span style=color:#555> 3</span><span> 2013-01-17 2013-01-17 2013-02-17 2013-02-15</span></span>
<span class=c>#&gt; <span style=color:#555> 4</span><span> 2013-01-26 2013-01-26 2013-02-26 2013-02-15</span></span>
<span class=c>#&gt; <span style=color:#555> 5</span><span> 2013-01-29 2013-01-29 2013-02-29 2013-02-15</span></span>
<span class=c>#&gt; <span style=color:#555> 6</span><span> 2013-01-30 2013-01-30 2013-02-30 2013-02-15</span></span>
<span class=c>#&gt; <span style=color:#555> 7</span><span> 2013-02-01 2013-02-01 2013-03-01 2013-03-15</span></span>
<span class=c>#&gt; <span style=color:#555> 8</span><span> 2013-02-04 2013-02-04 2013-03-04 2013-03-15</span></span>
<span class=c>#&gt; <span style=color:#555> 9</span><span> 2013-02-10 2013-02-10 2013-03-10 2013-03-15</span></span>
<span class=c>#&gt; <span style=color:#555>10</span><span> 2013-02-13 2013-02-13 2013-03-13 2013-03-15</span></span>
<span class=c>#&gt; <span style=color:#555># â¦ with 90 more rows</span></span></code></pre></div><p>To detect which dates are invalid, use
<a href=https://rdrr.io/pkg/clock/man/clock-invalid.html target=_blank rel=noopener><code>invalid_detect()</code></a>, which returns a logical vector that can be useful for filtering:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf><a href=https://rdrr.io/r/stats/filter.html>filter</a></span><span class=o>(</span><span class=nv>invalids</span>, <span class=nf><a href=https://rdrr.io/pkg/clock/man/clock-invalid.html>invalid_detect</a></span><span class=o>(</span><span class=nv>ymd2</span><span class=o>)</span><span class=o>)</span>
<span class=c>#&gt; <span style=color:#555># A tibble: 3 x 3</span></span>
<span class=c>#&gt;   date       ymd        ymd2      </span>
<span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;date&gt;</span><span>     </span><span style=color:#555;font-style:italic>&lt;ymd&lt;day&gt;&gt;</span><span> </span><span style=color:#555;font-style:italic>&lt;ymd&lt;day&gt;&gt;</span></span>
<span class=c>#&gt; <span style=color:#555>1</span><span> 2013-01-29 2013-01-29 2013-02-29</span></span>
<span class=c>#&gt; <span style=color:#555>2</span><span> 2013-01-30 2013-01-30 2013-02-30</span></span>
<span class=c>#&gt; <span style=color:#555>3</span><span> 2013-10-31 2013-10-31 2013-11-31</span></span></code></pre></div><p>With invalid dates, the important thing is that they <em>eventually</em> get resolved. You must resolve them before converting to another calendar or to a Date / POSIXct.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf><a href=https://rdrr.io/r/base/as.Date.html>as.Date</a></span><span class=o>(</span><span class=nv>invalids</span><span class=o>$</span><span class=nv>ymd2</span><span class=o>)</span>
<span class=c>#&gt; Error: Conversion from a calendar requires that all dates are valid. Resolve invalid dates by calling `invalid_resolve()`.</span></code></pre></div><h3 id=time-points-and-zoned-times>Time points and zoned-times
<a href=#time-points-and-zoned-times><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>The daylight saving time section of this post was complicated by the need to work around time zones. If your analysis doesn&rsquo;t actually require time zones, you can represent a date or date-time using a <em>naive-time</em>. This date-time type makes no assumption about the current time zone, instead assuming that there is a yet-to-be-specified time zone that hasn&rsquo;t been declared yet.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nv>flights_nt</span> <span class=o>&lt;-</span> <span class=nv>flights_hm</span> <span class=o>%&gt;%</span>
  <span class=nf>mutate</span><span class=o>(</span>
    naive_day <span class=o>=</span> <span class=nf><a href=https://rdrr.io/pkg/clock/man/as_naive_time.html>as_naive_time</a></span><span class=o>(</span><span class=nv>date</span><span class=o>)</span>,
    naive_time <span class=o>=</span> <span class=nv>naive_day</span> <span class=o>+</span> <span class=nf><a href=https://rdrr.io/pkg/clock/man/duration-helper.html>duration_hours</a></span><span class=o>(</span><span class=nv>hour</span><span class=o>)</span> <span class=o>+</span> <span class=nf><a href=https://rdrr.io/pkg/clock/man/duration-helper.html>duration_minutes</a></span><span class=o>(</span><span class=nv>minute</span><span class=o>)</span>
  <span class=o>)</span> <span class=o>%&gt;%</span>
  <span class=nf>select</span><span class=o>(</span><span class=nv>date</span>, <span class=nf>starts_with</span><span class=o>(</span><span class=s>"naive"</span><span class=o>)</span><span class=o>)</span>

<span class=nv>flights_nt</span>
<span class=c>#&gt; <span style=color:#555># A tibble: 100 x 3</span></span>
<span class=c>#&gt;    date       naive_day        naive_time         </span>
<span class=c>#&gt;    <span style=color:#555;font-style:italic>&lt;date&gt;</span><span>     </span><span style=color:#555;font-style:italic>&lt;tp&lt;naive&gt;&lt;day&gt;&gt;</span><span> </span><span style=color:#555;font-style:italic>&lt;tp&lt;naive&gt;&lt;minute&gt;&gt;</span></span>
<span class=c>#&gt; <span style=color:#555> 1</span><span> 2013-01-06 2013-01-06       2013-01-06 18:27   </span></span>
<span class=c>#&gt; <span style=color:#555> 2</span><span> 2013-01-08 2013-01-08       2013-01-08 14:58   </span></span>
<span class=c>#&gt; <span style=color:#555> 3</span><span> 2013-01-17 2013-01-17       2013-01-17 18:23   </span></span>
<span class=c>#&gt; <span style=color:#555> 4</span><span> 2013-01-26 2013-01-26       2013-01-26 10:52   </span></span>
<span class=c>#&gt; <span style=color:#555> 5</span><span> 2013-01-29 2013-01-29       2013-01-29 04:48   </span></span>
<span class=c>#&gt; <span style=color:#555> 6</span><span> 2013-01-30 2013-01-30       2013-01-30 00:03   </span></span>
<span class=c>#&gt; <span style=color:#555> 7</span><span> 2013-02-01 2013-02-01       2013-02-01 08:16   </span></span>
<span class=c>#&gt; <span style=color:#555> 8</span><span> 2013-02-04 2013-02-04       2013-02-04 19:43   </span></span>
<span class=c>#&gt; <span style=color:#555> 9</span><span> 2013-02-10 2013-02-10       2013-02-10 15:08   </span></span>
<span class=c>#&gt; <span style=color:#555>10</span><span> 2013-02-13 2013-02-13       2013-02-13 20:33   </span></span>
<span class=c>#&gt; <span style=color:#555># â¦ with 90 more rows</span></span></code></pre></div><p>Going from Date -> naive-time has dropped the UTC time zone assumption altogether, while keeping the printed time. This allowed us to convert back to POSIXct in an earlier example. Essentially, all that we were doing was declaring that yet-to-be-specified time zone as America/New_York, keeping the printed time where possible. We could have easily chosen a different time zone, like Europe/London.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nv>flights_nt</span> <span class=o>%&gt;%</span>
  <span class=nf>select</span><span class=o>(</span><span class=nv>naive_time</span><span class=o>)</span> <span class=o>%&gt;%</span>
  <span class=nf>mutate</span><span class=o>(</span>
    datetime_ny <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/as.POSIXlt.html>as.POSIXct</a></span><span class=o>(</span><span class=nv>naive_time</span>, <span class=s>"America/New_York"</span><span class=o>)</span>,
    datetime_lo <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/as.POSIXlt.html>as.POSIXct</a></span><span class=o>(</span><span class=nv>naive_time</span>, <span class=s>"Europe/London"</span><span class=o>)</span>
  <span class=o>)</span>
<span class=c>#&gt; <span style=color:#555># A tibble: 100 x 3</span></span>
<span class=c>#&gt;    naive_time          datetime_ny         datetime_lo        </span>
<span class=c>#&gt;    <span style=color:#555;font-style:italic>&lt;tp&lt;naive&gt;&lt;minute&gt;&gt;</span><span> </span><span style=color:#555;font-style:italic>&lt;dttm&gt;</span><span>              </span><span style=color:#555;font-style:italic>&lt;dttm&gt;</span><span>             </span></span>
<span class=c>#&gt; <span style=color:#555> 1</span><span> 2013-01-06 18:27    2013-01-06 </span><span style=color:#555>18:27:00</span><span> 2013-01-06 </span><span style=color:#555>18:27:00</span></span>
<span class=c>#&gt; <span style=color:#555> 2</span><span> 2013-01-08 14:58    2013-01-08 </span><span style=color:#555>14:58:00</span><span> 2013-01-08 </span><span style=color:#555>14:58:00</span></span>
<span class=c>#&gt; <span style=color:#555> 3</span><span> 2013-01-17 18:23    2013-01-17 </span><span style=color:#555>18:23:00</span><span> 2013-01-17 </span><span style=color:#555>18:23:00</span></span>
<span class=c>#&gt; <span style=color:#555> 4</span><span> 2013-01-26 10:52    2013-01-26 </span><span style=color:#555>10:52:00</span><span> 2013-01-26 </span><span style=color:#555>10:52:00</span></span>
<span class=c>#&gt; <span style=color:#555> 5</span><span> 2013-01-29 04:48    2013-01-29 </span><span style=color:#555>04:48:00</span><span> 2013-01-29 </span><span style=color:#555>04:48:00</span></span>
<span class=c>#&gt; <span style=color:#555> 6</span><span> 2013-01-30 00:03    2013-01-30 </span><span style=color:#555>00:03:00</span><span> 2013-01-30 </span><span style=color:#555>00:03:00</span></span>
<span class=c>#&gt; <span style=color:#555> 7</span><span> 2013-02-01 08:16    2013-02-01 </span><span style=color:#555>08:16:00</span><span> 2013-02-01 </span><span style=color:#555>08:16:00</span></span>
<span class=c>#&gt; <span style=color:#555> 8</span><span> 2013-02-04 19:43    2013-02-04 </span><span style=color:#555>19:43:00</span><span> 2013-02-04 </span><span style=color:#555>19:43:00</span></span>
<span class=c>#&gt; <span style=color:#555> 9</span><span> 2013-02-10 15:08    2013-02-10 </span><span style=color:#555>15:08:00</span><span> 2013-02-10 </span><span style=color:#555>15:08:00</span></span>
<span class=c>#&gt; <span style=color:#555>10</span><span> 2013-02-13 20:33    2013-02-13 </span><span style=color:#555>20:33:00</span><span> 2013-02-13 </span><span style=color:#555>20:33:00</span></span>
<span class=c>#&gt; <span style=color:#555># â¦ with 90 more rows</span></span></code></pre></div><p>If you&rsquo;re used to lubridate, converting to naive-time and back with a different time zone is similar to using
<a href=http://lubridate.tidyverse.org/reference/force_tz.html target=_blank rel=noopener><code>lubridate::force_tz()</code></a>, but with more control over possible daylight saving time issues (again using <code>nonexistent</code> and <code>ambiguous</code>, but supplied directly to
<a href=https://rdrr.io/r/base/as.POSIXlt.html target=_blank rel=noopener><code>as.POSIXct()</code></a>).</p><p>In clock, a naive-time is a particular kind of <em>time point</em>, a type that counts units of time with respect to some origin. Time points are extremely efficient at daily and sub-daily arithmetic, but calendars are better suited for monthly and yearly arithmetic. Time points are also efficient at <em>rounding</em> and <em>shifting</em>, through
<a href=https://rdrr.io/pkg/clock/man/time-point-rounding.html target=_blank rel=noopener><code>time_point_floor()</code></a> and
<a href=https://rdrr.io/pkg/clock/man/time_point_shift.html target=_blank rel=noopener><code>time_point_shift()</code></a>, but calendars are better at <em>grouping</em>, through
<a href=https://rdrr.io/pkg/clock/man/calendar_group.html target=_blank rel=noopener><code>calendar_group()</code></a>. In the high-level API for Date and POSIXct, we gloss over these details and internally switch between these two types for you.</p><p>There is a second type of time point in clock, the sys-time, which works exactly like a naive-time <em>except</em> that it is assumed to be in UTC. If you never use a time zone aware class like POSIXct, then sys-time and naive-time are equivalent. However, once you start adding in time zones, the way you interpret each of them becomes extremely important.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nv>ymd</span> <span class=o>&lt;-</span> <span class=nf><a href=https://rdrr.io/pkg/clock/man/year_month_day.html>year_month_day</a></span><span class=o>(</span><span class=m>2019</span>, <span class=m>1</span>, <span class=m>1</span><span class=o>)</span>

<span class=c># Yet-to-be-specified time zone</span>
<span class=nv>naive</span> <span class=o>&lt;-</span> <span class=nf><a href=https://rdrr.io/pkg/clock/man/as_naive_time.html>as_naive_time</a></span><span class=o>(</span><span class=nv>ymd</span><span class=o>)</span>
<span class=nv>naive</span>
<span class=c>#&gt; &lt;time_point&lt;naive&gt;&lt;day&gt;[1]&gt;</span>
<span class=c>#&gt; [1] "2019-01-01"</span>

<span class=c># UTC time zone</span>
<span class=nv>sys</span> <span class=o>&lt;-</span> <span class=nf><a href=https://rdrr.io/pkg/clock/man/as_sys_time.html>as_sys_time</a></span><span class=o>(</span><span class=nv>ymd</span><span class=o>)</span>
<span class=nv>sys</span>
<span class=c>#&gt; &lt;time_point&lt;sys&gt;&lt;day&gt;[1]&gt;</span>
<span class=c>#&gt; [1] "2019-01-01"</span>

<span class=c># - Keeps printed time</span>
<span class=c># - Changes underlying duration</span>
<span class=nf><a href=https://rdrr.io/r/base/as.POSIXlt.html>as.POSIXct</a></span><span class=o>(</span><span class=nv>naive</span>, <span class=s>"America/New_York"</span><span class=o>)</span>
<span class=c>#&gt; [1] "2019-01-01 EST"</span>

<span class=c># - Changes printed time</span>
<span class=c># - Keeps underlying duration</span>
<span class=nf><a href=https://rdrr.io/r/base/as.POSIXlt.html>as.POSIXct</a></span><span class=o>(</span><span class=nv>sys</span>, <span class=s>"America/New_York"</span><span class=o>)</span>
<span class=c>#&gt; [1] "2018-12-31 19:00:00 EST"</span></code></pre></div><p>clock also provides its own time zone aware date-time type, the zoned-time. Converting to a zoned-time from a sys-time or naive-time works the same as converting to a POSIXct, but zoned-times can have up to nanosecond precision.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nv>naive</span> <span class=o>%&gt;%</span>
  <span class=nf><a href=https://rdrr.io/pkg/clock/man/clock-arithmetic.html>add_nanoseconds</a></span><span class=o>(</span><span class=m>100</span><span class=o>)</span> <span class=o>%&gt;%</span>
  <span class=nf><a href=https://rdrr.io/pkg/clock/man/clock-arithmetic.html>add_hours</a></span><span class=o>(</span><span class=m>2</span><span class=o>)</span> <span class=o>%&gt;%</span>
  <span class=nf><a href=https://rdrr.io/pkg/clock/man/as_zoned_time.html>as_zoned_time</a></span><span class=o>(</span><span class=s>"America/New_York"</span><span class=o>)</span>
<span class=c>#&gt; &lt;zoned_time&lt;nanosecond&gt;&lt;America/New_York&gt;[1]&gt;</span>
<span class=c>#&gt; [1] "2019-01-01 02:00:00.000000100-05:00"</span></code></pre></div><p>There isn&rsquo;t actually a lot you can do with zoned-times directly. Generally, zoned-times are the start or end points of an analysis meant for humans to interpret. In the middle, you&rsquo;ll convert to naive-time, sys-time, or to a calendar type to perform any date-time specific manipulations.</p><div class=highlight></div></div></div><div class=column25><div class="section hideOnMobile"><div class=sectionTitle>Contents</div><nav id=TableOfContents><ul><li><a href=#logo>Logo</a></li><li><a href=#what-about-lubridate>What about lubridate?</a></li><li><a href=#first-steps>First steps</a></li><li><a href=#invalid-dates>Invalid dates</a></li><li><a href=#daylight-saving-time>Daylight saving time</a></li><li><a href=#production>Production</a></li><li><a href=#advanced-features>Advanced features</a></li></ul></nav></div><div class=section></div></div></div></div></div><div id=rStudioFooter class=band><div class=bandContent><div id=copyright>The tidyverse is proudly supported by <a class=rstudioLogo href=https://posit.co/ aria-label="Posit Homepage"></a></div><div id=logos><a href=https://www.tidyverse.org/google_privacy_policy>Privacy policy</a>
<a href=https://github.com/tidyverse class="footerLogo gitHub" aria-label="Tidyverse GitHub organization"></a><a href=https://twitter.com/hashtag/rstats class="footerLogo twitter" aria-label="rstats hashtag on twitter.com"></a></div></div></div></div></div><script src=/js/math-code.js></script><script type=text/x-mathjax-config>
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script><script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script type=application/javascript>var dnt=(navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack);var doNotTrack=(dnt=="1"||dnt=="yes");if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');if(window.sessionStorage){var GA_SESSION_STORAGE_KEY='ga:clientId';ga('create','UA-115082821-1',{'storage':'none','clientId':sessionStorage.getItem(GA_SESSION_STORAGE_KEY)});ga(function(tracker){sessionStorage.setItem(GA_SESSION_STORAGE_KEY,tracker.get('clientId'));});}
ga('set','anonymizeIp',true);ga('send','pageview');}</script></body></html></div></div></body></html>