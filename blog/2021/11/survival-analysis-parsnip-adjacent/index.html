<!doctype html><html><head><!doctype html><html lang=en-us><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/css/main-site.css><link rel=stylesheet href=/css/fa5-all.css><style type=text/css>body{background-color:#fff;color:#1a1917}a{color:#38577f}a:hover{color:#42709b}a:focus{outline-color:#42709b}.column25-left .sectionTitle a:hover:not(.current),.column16-left .sectionTitle a:hover:not(.current){color:#1a1917}.icon-attribution,.icon-attribution a{color:#1a1917;opacity:75%}#homeContent .band.first{background-color:#fff}#homeContent .band.second{background-color:#fdeba4}#homeContent .band.third{background-color:#fff}#rStudioHeader{background-color:#1a162d;color:#fff}#rStudioHeader .productName{color:#fff}#rStudioHeader .productName:hover,#rStudioHeader .productName:focus{color:#fdeba4}#rStudioHeader #menu .menuItem.a{background-color:#75aadb;color:#fff}#rStudioHeader #menu .menuItem:hover{background-color:#484557;color:#fff}#rStudioHeader #menu .menuItem.current{background-color:#fff;color:#1a162d;text-decoration:none}#rStudioFooter.band{background-color:#767381}#rStudioFooter .bandContent #copyright{color:#e3eef8}table tbody tr:nth-child(even){background-color:#f7faff}table tbody tr:nth-child(odd){background-color:#fff}.latest{border-top:.5em solid <no value>}.event{-moz-box-shadow:0 0 0 0 rgba(0,0,0,.1);-webkit-box-shadow:0 0 0 0 rgba(0,0,0,.1);box-shadow:0 0 0 0 rgba(0,0,0,.1)}.section .event{background-color:#eab0c41a}.section .event{border-top:7pt solid #a19ea936}.section .event a{color:#1a162d}.section .event{color:#404040}</style><link rel=stylesheet href=/css/tidyverse.css><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.71.1"><title>Survival Analysis in tidymodels</title><meta property="og:title" content="Survival Analysis in tidymodels"><meta property="og:description" content="We are working on extending support for survival analysis in tidymodels. We are looking for early adopters to try out the new package called censored  and give feedback."><meta property="og:type" content="article"><meta property="og:url" content="https://www.tidyverse.org/blog/2021/11/survival-analysis-parsnip-adjacent/"><meta property="twitter:card" content="summary_large_image"><meta property="og:title" content="Survival Analysis in tidymodels - Tidyverse"><meta property="description" content="We are working on extending support for survival analysis in tidymodels. We are looking for early adopters to try out the new package called censored  and give feedback."><meta property="og:description" content="We are working on extending support for survival analysis in tidymodels. We are looking for early adopters to try out the new package called censored  and give feedback."><meta property="og:image" content="https://www.tidyverse.org/blog/2021/11/survival-analysis-parsnip-adjacent/thumbnail-sq.jpg"><meta name=twitter:image content="https://www.tidyverse.org/blog/2021/11/survival-analysis-parsnip-adjacent/thumbnail-wd.jpg"><link rel=apple-touch-icon sizes=180x180 href=/images/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicons/favicon-16x16.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg><link rel="shortcut icon" href=/images/favicons/favicon.ico><meta name=msapplication-TileColor content="#da532c"><meta name=msapplication-config href=/images/favicons/browserconfig.xml><script type=text/javascript src=/js/jquery-3.5.1.min.js></script><script type=text/javascript src=/js/site.js></script><link rel=icon href=/images/favicon.ico><script type=text/javascript src=/js/clipboard.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin=anonymous></script><script defer data-domain=tidyverse.org,all.tidyverse.org src=https://plausible.io/js/plausible.js></script></head><body><div id=appTidyverseSite class="shrinkHeader alwaysShrinkHeader"><div id=main><div id=rStudioHeader><nav class=band><div class="innards bandContent"><div><a class=productName href=/>Tidyverse</a></div><div id=menu><div id=menuToggler></div><div id=menuItems><a class=menuItem href=/packages/>Packages</a>
<a class="menuItem current" href=/blog/>Blog</a>
<a class=menuItem href=/learn/>Learn</a>
<a class=menuItem href=/help/>Help</a>
<a class=menuItem href=/contribute/>Contribute</a></div></div></div></nav></div><main><div class="band padForHeader pushFooter"><div class=bandContent><div class="full splitColumns withMobileMargins"><div class=column75><h1 class=article-title>Survival Analysis in tidymodels</h1><div class=article-header aria-hidden=true><div class=photo><img src=/blog/2021/11/survival-analysis-parsnip-adjacent/thumbnail-wd.jpg></div><div class=photoCredit>Photo by <a href=https://unsplash.com/photos/A-fubu9QJxE>Luca Bravo</a></div></div><span class=article-date><i class="fas fa-calendar-day fa-fw"></i>&nbsp;&nbsp;2021/11/02</span><p style=margin-bottom:.5em;margin-top:.85em><i class="fas fa-tags"></i>&nbsp;
<a href=/tags/tidymodels/>tidymodels</a>,
<a href=/tags/parsnip/>parsnip</a></p><p style=margin-top:.5em><i class="fas fa-user-circle fa-fw"></i>&nbsp;
Hannah Frick</p><div class=article-content><p>Survival analysis is an important field in modeling and there are many R packages available which implement various models, from &ldquo;classic&rdquo; parametric models to boosted trees. While they cover a great variety of model types, they also come with considerable amounts of heterogeneity in syntax and levels of documentation. The
<a href=https://www.tidymodels.org/ target=_blank rel=noopener>tidymodels</a> framework is a collection of R packages for modeling and machine learning using tidyverse principles. It provides a consistent interface to a variety of modelling functions along with tools for resampling, assessing performance, and hyperparameter tuning.</p><p>In terms of survival analysis, however, tidymodels so far hasn&rsquo;t been as feature-rich as we&rsquo;d like it to be, e.g., the available models only covered parametric survival models. With this post we&rsquo;d like to provide an update on recent work to extend the tooling for survival analysis in tidymodels and gather feedback on future plans.</p><p>Making survival analysis a first-class citizen in tidymodels requires touching several aspects across the collection of packages:</p><ul><li>Pre-processing to accommodate the data structure of censored data.</li><li>A bigger selection of models which can be specified, fitted, and used for prediction.</li><li>Additional performance metrics tailored to survival data.</li></ul><p>The new
<a href=https://censored.tidymodels.org/ target=_blank rel=noopener>censored</a> package along with
<a href=https://parsnip.tidymodels.org/ target=_blank rel=noopener>parsnip</a> offers several new models, engines, and prediction types. The censored package is not on CRAN yet but we are looking for early adopters to try it out and give us feedback! You can install it via</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>devtools</span><span class=nf>::</span><span class=nf><a href=https://devtools.r-lib.org//reference/remote-reexports.html>install_github</a></span><span class=o>(</span><span class=s>"tidymodels/censored"</span><span class=o>)</span></code></pre></div><h3 id=a-new-mode-for-parsnip>A new mode for parsnip
<a href=#a-new-mode-for-parsnip><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>Some model types can be used for multiple purposes with the same computation engine, e.g. a
<a href=https://parsnip.tidymodels.org/reference/decision_tree.html target=_blank rel=noopener><code>decision_tree()</code></a> model can be used for either classification or regression with the <code>rpart</code> engine. This distinction is made in parsnip by
<a href=https://parsnip.tidymodels.org/articles/parsnip_Intro.html#motivation target=_blank rel=noopener>specifying the mode of a model</a>. We have now introduced a new <code>"censored regression"</code> mode in parsnip for models which can be used for survival analysis. The aforementioned
<a href=https://parsnip.tidymodels.org/reference/decision_tree.html target=_blank rel=noopener><code>decision_tree()</code></a> with the <code>rpart</code> engine can also be used to fit a survival decision tree:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=https://github.com/tidymodels/censored>censored</a></span><span class=o>)</span>

<span class=nf><a href=https://parsnip.tidymodels.org/reference/decision_tree.html>decision_tree</a></span><span class=o>(</span><span class=o>)</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span> 
  <span class=nf><a href=https://parsnip.tidymodels.org/reference/set_engine.html>set_engine</a></span><span class=o>(</span><span class=s>"rpart"</span><span class=o>)</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span> 
  <span class=nf><a href=https://parsnip.tidymodels.org/reference/set_args.html>set_mode</a></span><span class=o>(</span><span class=s>"censored regression"</span><span class=o>)</span>
<span class=c>#&gt; Decision Tree Model Specification (censored regression)</span>
<span class=c>#&gt; </span>
<span class=c>#&gt; Computational engine: rpart</span></code></pre></div><h3 id=model-fitting>Model fitting
<a href=#model-fitting><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>For fitting a model, parsnip typically supports a formula and a matrix interface, regardless of the interface of the engine. For censored regression models, we are currently only supporting a formula interface. Most engines already support this type of interface, and a formula allows us to specify the outcome via the standard
<a href=https://rdrr.io/pkg/survival/man/Surv.html target=_blank rel=noopener><code>survival::Surv()</code></a> function, tying together event time and status.</p><p>A formula also let&rsquo;s us specify stratification for a proportional hazards model. For the
<a href=https://rdrr.io/pkg/survival/man/coxph.html target=_blank rel=noopener><code>survival::coxph()</code></a> function, which powers the <code>survival</code> engine for
<a href=https://parsnip.tidymodels.org/reference/proportional_hazards.html target=_blank rel=noopener><code>proportional_hazards()</code></a>, this may look like</p><div align=center><p><code>Surv(time, event) ~ x + z + strata(s)</code></p></div><p>Some other packages can fit this model, let&rsquo;s use the glmnet package. However,
<a href=https://glmnet.stanford.edu/reference/glmnet.html target=_blank rel=noopener><code>glmnet::glmnet()</code></a>, does not have a formula interface and it requires us to specify the strata by stratifying the response via <code>stratifySurv(y, s)</code>. The response is typically a <code>Surv</code> object, so you could end up with a formula like this:</p><div align=center><p><code>stratifySurv(Surv(time, event), strata) ~ x + z</code></p></div><p>This works for fitting the model but the syntax is rather convoluted on the left-hand side of the formula. The specification of the stratification is inconsistent with the approach taken by the survival package. Additionally, without further modification, prediction fails because variables on the left-hand side of the formula are treated as response variables by parsnip and are not available at prediction time.</p><p>We already need to translate from formula interface to matrix interface for this engine, and we like interfaces to be as consistent as possible here in tidymodels so we decided to go with the specification of stratification through a
<a href=https://rdrr.io/pkg/survival/man/strata.html target=_blank rel=noopener><code>strata()</code></a> term on the right-hand side of the formula for proportional hazards models, regardless of the engine.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=https://github.com/therneau/survival>survival</a></span><span class=o>)</span>

<span class=nv>bladder_train</span> <span class=o>&lt;-</span> <span class=nv>bladder</span><span class=o>[</span><span class=o>-</span><span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=m>1</span><span class=o>:</span><span class=m>3</span><span class=o>)</span>,<span class=o>]</span>
<span class=nv>bladder_test</span> <span class=o>&lt;-</span> <span class=nv>bladder</span><span class=o>[</span><span class=m>1</span><span class=o>:</span><span class=m>3</span>,<span class=o>]</span>

<span class=nv>cox_spec</span> <span class=o>&lt;-</span> <span class=nf><a href=https://parsnip.tidymodels.org/reference/proportional_hazards.html>proportional_hazards</a></span><span class=o>(</span>penalty <span class=o>=</span> <span class=m>0.123</span><span class=o>)</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span>
    <span class=nf><a href=https://parsnip.tidymodels.org/reference/set_engine.html>set_engine</a></span><span class=o>(</span><span class=s>"glmnet"</span><span class=o>)</span>

<span class=nv>f_fit</span> <span class=o>&lt;-</span> <span class=nf><a href=https://generics.r-lib.org/reference/fit.html>fit</a></span><span class=o>(</span><span class=nv>cox_spec</span>,
             <span class=nf><a href=https://rdrr.io/pkg/survival/man/Surv.html>Surv</a></span><span class=o>(</span><span class=nv>stop</span>, <span class=nv>event</span><span class=o>)</span> <span class=o>~</span> <span class=nv>rx</span> <span class=o>+</span> <span class=nv>size</span> <span class=o>+</span> <span class=nv>number</span> <span class=o>+</span> <span class=nf><a href=https://rdrr.io/pkg/survival/man/strata.html>strata</a></span><span class=o>(</span><span class=nv>enum</span><span class=o>)</span>,
             data <span class=o>=</span> <span class=nv>bladder_train</span><span class=o>)</span></code></pre></div><h3 id=prediction>Prediction
<a href=#prediction><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>We have introduced several new prediction types: time to event (<code>time</code>), linear predictor (<code>linear_pred</code>), survival probability (<code>survival</code>), and hazard (<code>hazard</code>). Some of these types are time-dependent, e.g., the survival probability is the probability to survive beyond a certain time point. In keeping with the tidymodels design principle that each row of the data set you&rsquo;re predicting on should give you exactly one row in the dataset of predictions, <code>predict(type = "survival", time)</code> returns a nested tibble if <code>time</code> contains multiple time points. This can be used to approximate survival curves.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nv>f_pred</span> <span class=o>&lt;-</span> <span class=nf><a href=https://rdrr.io/r/stats/predict.html>predict</a></span><span class=o>(</span><span class=nv>f_fit</span>, new_data <span class=o>=</span> <span class=nv>bladder_test</span>,
                  type <span class=o>=</span> <span class=s>"survival"</span>, time <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/seq.html>seq</a></span><span class=o>(</span><span class=m>0</span>, <span class=m>20</span>, <span class=m>1</span><span class=o>)</span><span class=o>)</span>

<span class=nv>f_pred</span> <span class=o>&lt;-</span> <span class=nv>f_pred</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span> 
  <span class=nf>mutate</span><span class=o>(</span>id <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/factor.html>factor</a></span><span class=o>(</span><span class=m>1</span><span class=o>:</span><span class=m>3</span><span class=o>)</span><span class=o>)</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span> 
  <span class=nf>unnest</span><span class=o>(</span>cols <span class=o>=</span> <span class=nv>.pred</span><span class=o>)</span>

<span class=nv>f_pred</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span> 
  <span class=nf>ggplot</span><span class=o>(</span><span class=nf>aes</span><span class=o>(</span>x <span class=o>=</span> <span class=nv>.time</span>, y <span class=o>=</span> <span class=nv>.pred_survival</span>, col <span class=o>=</span> <span class=nv>id</span><span class=o>)</span><span class=o>)</span> <span class=o>+</span>
  <span class=nf>geom_step</span><span class=o>(</span><span class=o>)</span>
</code></pre><p><img src=figs/predict-1.png width=700px style=display:block;margin:auto></p></div><p>Usually, the linear predictor is the linear combination of the predictors, weighted with the coefficients, often denoted as $x^{T} \beta$. This is what is being returned by the <code>glmnet</code> engine for
<a href=https://parsnip.tidymodels.org/reference/proportional_hazards.html target=_blank rel=noopener><code>proportional_hazards()</code></a> models and by the <code>mboost</code> engine for
<a href=https://parsnip.tidymodels.org/reference/boost_tree.html target=_blank rel=noopener><code>boost_tree()</code></a> models (e.g., with mode <code>"censored regression"</code>). For proportional hazards models, the linear predictor describes <em>relative</em> risk, i.e., it refers to a pair of observations: the observation $x$ and a reference observation of predictors with value 0.</p><p>The survival package implements different choices for the reference observation. As a default it uses the mean predictor, i.e., the observation $x$ is centered with the mean predictor before the usual weighted linear combination is calculated. What makes a useful reference observation is context-dependent and can be more complex than just 0 or the average. In a medical setting with predictors age and drug concentration, one might be interested in the effect relative to mean age but a drug concentration of 0 (the control group). While we think through a more general approach to specifying such a reference observation or baseline hazard, we ensure that all engines in censored use the same approach: a reference observation of 0.</p><p>Let&rsquo;s illustrate the difference in (default) predictions derived from the survival and censored packages and their relationship with the linear predictor. The prodlim package lets us simulate survival data with two predictors <code>X1</code> (binary) and <code>X2</code> (numeric) which both have an effect of $exp(1)$ on the hazard of the unobserved event time.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=https://tidymodels.tidymodels.org>tidymodels</a></span><span class=o>)</span>
<span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=https://ggplot2.tidyverse.org>ggplot2</a></span><span class=o>)</span>
<span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv>prodlim</span><span class=o>)</span>
<span class=nf><a href=https://rdrr.io/r/base/Random.html>set.seed</a></span><span class=o>(</span><span class=m>43500</span><span class=o>)</span>

<span class=c># add 0.5 to X2 (with mean 0) to demonstrate the effect of centering</span>
<span class=nv>train_dat</span> <span class=o>&lt;-</span> <span class=nf><a href=https://rdrr.io/pkg/prodlim/man/SimSurv.html>SimSurv</a></span><span class=o>(</span><span class=m>2000</span><span class=o>)</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span> <span class=nf>mutate</span><span class=o>(</span>X2 <span class=o>=</span> <span class=nv>X2</span> <span class=o>+</span> <span class=m>0.5</span><span class=o>)</span>
<span class=nv>test_dat</span> <span class=o>&lt;-</span> <span class=nf><a href=https://rdrr.io/pkg/prodlim/man/SimSurv.html>SimSurv</a></span><span class=o>(</span><span class=m>20</span><span class=o>)</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span> <span class=nf>mutate</span><span class=o>(</span>X2 <span class=o>=</span> <span class=nv>X2</span> <span class=o>+</span> <span class=m>0.5</span><span class=o>)</span>
<span class=nv>test_pred</span> <span class=o>&lt;-</span> <span class=nv>test_dat</span><span class=o>[</span>, <span class=m>5</span><span class=o>:</span><span class=m>6</span><span class=o>]</span></code></pre></div><p>We can compare the value of the linear predictor using the true coefficients of 1 with the predictions from the survival package. Plotting them against each other shows the offset of the mean of <code>X2</code>.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nv>fit_survival</span> <span class=o>&lt;-</span> <span class=nf><a href=https://rdrr.io/pkg/survival/man/coxph.html>coxph</a></span><span class=o>(</span><span class=nf><a href=https://rdrr.io/pkg/survival/man/Surv.html>Surv</a></span><span class=o>(</span><span class=nv>time</span>, <span class=nv>status</span><span class=o>)</span> <span class=o>~</span> <span class=nv>X1</span> <span class=o>+</span> <span class=nv>X2</span>, data <span class=o>=</span> <span class=nv>train_dat</span><span class=o>)</span>
<span class=nv>pred_survival</span> <span class=o>&lt;-</span> <span class=nf><a href=https://rdrr.io/r/stats/predict.html>predict</a></span><span class=o>(</span><span class=nv>fit_survival</span>, newdata <span class=o>=</span> <span class=nv>test_pred</span><span class=o>)</span>

<span class=nv>pred</span> <span class=o>&lt;-</span> <span class=nf>bind_cols</span><span class=o>(</span>
  <span class=nv>test_pred</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span> <span class=nf>mutate</span><span class=o>(</span>linear_pred <span class=o>=</span> <span class=nv>X1</span> <span class=o>*</span> <span class=m>1</span> <span class=o>+</span> <span class=nv>X2</span> <span class=o>*</span> <span class=m>1</span><span class=o>)</span>,
  <span class=nf>tibble</span><span class=o>(</span>pred_survival <span class=o>=</span> <span class=nv>pred_survival</span><span class=o>)</span>
<span class=o>)</span>

<span class=nf><a href=https://rdrr.io/r/base/mean.html>mean</a></span><span class=o>(</span><span class=nv>train_dat</span><span class=o>$</span><span class=nv>X2</span><span class=o>)</span>
<span class=c>#&gt; [1] 0.4683339</span></code></pre></div><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nv>pred</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span> 
  <span class=nf><a href=https://ggplot2.tidyverse.org/reference/ggplot.html>ggplot</a></span><span class=o>(</span><span class=nf><a href=https://ggplot2.tidyverse.org/reference/aes.html>aes</a></span><span class=o>(</span><span class=nv>linear_pred</span>, <span class=nv>pred_survival</span><span class=o>)</span><span class=o>)</span> <span class=o>+</span> 
  <span class=nf><a href=https://ggplot2.tidyverse.org/reference/geom_point.html>geom_point</a></span><span class=o>(</span><span class=o>)</span> <span class=o>+</span>
  <span class=nf><a href=https://ggplot2.tidyverse.org/reference/geom_abline.html>geom_abline</a></span><span class=o>(</span>slope <span class=o>=</span> <span class=m>1</span>, intercept <span class=o>=</span> <span class=m>0</span><span class=o>)</span>
</code></pre><p><img src=figs/lp-center-plot-1.png width=700px style=display:block;margin:auto></p></div><p>Measuring performance is a key element of predictive modelling. Our design philosophy in tidymodels is that the calculation of performance metrics should be agnostic to ancillary information such as the model type or the training set. Essentially all you need are the observations and the predictions. For proportional hazards models, the observation and the prediction actually describe different aspects of survival: the observation is the survival time while the prediction describes the risk; the two have an inverse relationship. To help us standardize the assessment modules, we change the sign of the linear predictor. This may be opposite to the sign of predictions obtained using the underlying engine directly. You can opt out of this by setting the <code>increasing</code> argument of
<a href=https://rdrr.io/r/stats/predict.html target=_blank rel=noopener><code>predict()</code></a> to <code>FALSE</code>.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nv>fit_censored</span> <span class=o>&lt;-</span> <span class=nf><a href=https://parsnip.tidymodels.org/reference/proportional_hazards.html>proportional_hazards</a></span><span class=o>(</span><span class=o>)</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span> 
  <span class=nf><a href=https://parsnip.tidymodels.org/reference/set_engine.html>set_engine</a></span><span class=o>(</span><span class=s>"survival"</span><span class=o>)</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span> 
  <span class=nf><a href=https://generics.r-lib.org/reference/fit.html>fit</a></span><span class=o>(</span><span class=nf><a href=https://rdrr.io/pkg/survival/man/Surv.html>Surv</a></span><span class=o>(</span><span class=nv>time</span>, <span class=nv>status</span><span class=o>)</span> <span class=o>~</span> <span class=nv>X1</span> <span class=o>+</span> <span class=nv>X2</span>, data <span class=o>=</span> <span class=nv>train_dat</span><span class=o>)</span>
<span class=nv>pred_censored</span> <span class=o>&lt;-</span> <span class=nf><a href=https://rdrr.io/r/stats/predict.html>predict</a></span><span class=o>(</span><span class=nv>fit_censored</span>, type <span class=o>=</span> <span class=s>"linear_pred"</span>, new_data <span class=o>=</span> <span class=nv>test_pred</span><span class=o>)</span>

<span class=nv>pred</span> <span class=o>&lt;-</span> <span class=nf>bind_cols</span><span class=o>(</span>
  <span class=nv>pred</span>,
  <span class=nv>pred_censored</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span> <span class=nf>rename</span><span class=o>(</span>pred_censored <span class=o>=</span> <span class=nv>.pred_linear_pred</span><span class=o>)</span>
<span class=o>)</span>

<span class=nv>pred</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span> 
  <span class=nf><a href=https://ggplot2.tidyverse.org/reference/ggplot.html>ggplot</a></span><span class=o>(</span><span class=nf><a href=https://ggplot2.tidyverse.org/reference/aes.html>aes</a></span><span class=o>(</span><span class=nv>linear_pred</span>, <span class=nv>pred_censored</span><span class=o>)</span><span class=o>)</span> <span class=o>+</span> 
  <span class=nf><a href=https://ggplot2.tidyverse.org/reference/geom_point.html>geom_point</a></span><span class=o>(</span><span class=o>)</span> <span class=o>+</span>
  <span class=nf><a href=https://ggplot2.tidyverse.org/reference/geom_abline.html>geom_abline</a></span><span class=o>(</span>slope <span class=o>=</span> <span class=o>-</span><span class=m>1</span>, intercept <span class=o>=</span> <span class=m>0</span><span class=o>)</span>
</code></pre><p><img src=figs/lp-sign-1.png width=700px style=display:block;margin:auto></p></div><h3 id=model-and-prediction-types-available-in-censored>Model and prediction types available in censored
<a href=#model-and-prediction-types-available-in-censored><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>Currently, censored contains the following models, engine, and prediction types with ✔ indicating &ldquo;available&rdquo;, ✖ indicating &ldquo;unavailable&rdquo;, and ◯ indicating &ldquo;to do&rdquo;.</p><div class=highlight><table><thead><tr><th align=left>model</th><th align=left>engine</th><th align=left>time</th><th align=left>survival</th><th align=left>linear_pred</th><th align=left>raw</th><th align=left>quantile</th><th align=left>hazard</th></tr></thead><tbody><tr><td align=left>bag_tree</td><td align=left>rpart</td><td align=left>✔</td><td align=left>✔</td><td align=left>✖</td><td align=left>✖</td><td align=left>✖</td><td align=left>✖</td></tr><tr><td align=left>boost_tree</td><td align=left>mboost</td><td align=left>◯</td><td align=left>✔</td><td align=left>✔</td><td align=left>✖</td><td align=left>✖</td><td align=left>✖</td></tr><tr><td align=left>decision_tree</td><td align=left>party</td><td align=left>✔</td><td align=left>✔</td><td align=left>✖</td><td align=left>✖</td><td align=left>✖</td><td align=left>✖</td></tr><tr><td align=left>decision_tree</td><td align=left>rpart</td><td align=left>✔</td><td align=left>✔</td><td align=left>✖</td><td align=left>✖</td><td align=left>✖</td><td align=left>✖</td></tr><tr><td align=left>proportional_hazards</td><td align=left>glmnet</td><td align=left>◯</td><td align=left>✔</td><td align=left>✔</td><td align=left>✔</td><td align=left>✖</td><td align=left>✖</td></tr><tr><td align=left>proportional_hazards</td><td align=left>survival</td><td align=left>✔</td><td align=left>✔</td><td align=left>✔</td><td align=left>✖</td><td align=left>✖</td><td align=left>✖</td></tr><tr><td align=left>rand_forest</td><td align=left>party</td><td align=left>✔</td><td align=left>✔</td><td align=left>✖</td><td align=left>✖</td><td align=left>✖</td><td align=left>✖</td></tr><tr><td align=left>rand_forest</td><td align=left>randomForestSRC</td><td align=left>◯</td><td align=left>◯</td><td align=left>✖</td><td align=left>✖</td><td align=left>✖</td><td align=left>✖</td></tr><tr><td align=left>rand_forest</td><td align=left>ranger</td><td align=left>◯</td><td align=left>◯</td><td align=left>✖</td><td align=left>✖</td><td align=left>✖</td><td align=left>✖</td></tr><tr><td align=left>survival_reg</td><td align=left>flexsurv</td><td align=left>✔</td><td align=left>✔</td><td align=left>◯</td><td align=left>✖</td><td align=left>✔</td><td align=left>✔</td></tr><tr><td align=left>survival_reg</td><td align=left>survival</td><td align=left>✔</td><td align=left>✔</td><td align=left>◯</td><td align=left>✖</td><td align=left>✔</td><td align=left>✔</td></tr></tbody></table></div><h3 id=whats-next>What&rsquo;s next?
<a href=#whats-next><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>We want survival analysis to be a first-class citizen in tidymodels which means having access to preprocessing, resampling, models, metrics, and tuning. The next steps on that path are:</p><ul><li>A role for censoring indicator columns and a step <code>step_surv()</code> in recipes.</li><li>A new ROC metric for survival models in yardstick.</li><li>An adaption of workflows and tune is to follow after that.</li></ul><p>Additionally, we are in the process of figuring out how different types of censoring and time-dependent effects fit into our API.</p><p>We&rsquo;d love to hear from you! Some questions we have include: Would you find this useful? Are there particular models/methods you&rsquo;d like to see? Do you use time-dependent effects? Do you use interactions? Which types of censoring do you use?</p><p>We&rsquo;d greatly appreciate feedback, ideally in the replies to the
<a href=https://community.rstudio.com/t/feedback-on-the-censored-package-for-survival-analysis-with-tidymodels/119674 target=_blank rel=noopener>corresponding post on RStudio Community</a>!</p></div></div><div class=column25><div class="section hideOnMobile"><div class=sectionTitle>Contents</div><nav id=TableOfContents><ul><li></li></ul></nav></div><div class=section></div></div></div></div></div><div id=rStudioFooter class=band><div class=bandContent><div id=copyright>The tidyverse is proudly supported by <a class=rstudioLogo href=https://posit.co/ aria-label="Posit Homepage"></a></div><div id=logos><a href=https://www.tidyverse.org/google_privacy_policy>Privacy policy</a>
<a href=https://github.com/tidyverse class="footerLogo gitHub" aria-label="Tidyverse GitHub organization"></a><a href=https://twitter.com/hashtag/rstats class="footerLogo twitter" aria-label="rstats hashtag on twitter.com"></a></div></div></div></div></div><script src=/js/math-code.js></script><script type=text/x-mathjax-config>
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script><script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script type=application/javascript>var dnt=(navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack);var doNotTrack=(dnt=="1"||dnt=="yes");if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');if(window.sessionStorage){var GA_SESSION_STORAGE_KEY='ga:clientId';ga('create','UA-115082821-1',{'storage':'none','clientId':sessionStorage.getItem(GA_SESSION_STORAGE_KEY)});ga(function(tracker){sessionStorage.setItem(GA_SESSION_STORAGE_KEY,tracker.get('clientId'));});}
ga('set','anonymizeIp',true);ga('send','pageview');}</script></body></html></div></div></body></html>