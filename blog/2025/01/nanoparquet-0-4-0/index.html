<!doctype html><html><head><!doctype html><html lang=en-us><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/css/main-site.css><link rel=stylesheet href=/css/fa5-all.css><style type=text/css>body{background-color:#fff;color:#1a1917}a{color:#38577f}a:hover{color:#42709b}a:focus{outline-color:#42709b}.column25-left .sectionTitle a:hover:not(.current),.column16-left .sectionTitle a:hover:not(.current){color:#1a1917}.icon-attribution,.icon-attribution a{color:#1a1917;opacity:75%}#homeContent .band.first{background-color:#fff}#homeContent .band.second{background-color:#fdeba4}#homeContent .band.third{background-color:#fff}#rStudioHeader{background-color:#1a162d;color:#fff}#rStudioHeader .productName{color:#fff}#rStudioHeader .productName:hover,#rStudioHeader .productName:focus{color:#fdeba4}#rStudioHeader #menu .menuItem.a{background-color:#75aadb;color:#fff}#rStudioHeader #menu .menuItem:hover{background-color:#484557;color:#fff}#rStudioHeader #menu .menuItem.current{background-color:#fff;color:#1a162d;text-decoration:none}#rStudioFooter.band{background-color:#767381}#rStudioFooter .bandContent #copyright{color:#e3eef8}table tbody tr:nth-child(even){background-color:#f7faff}table tbody tr:nth-child(odd){background-color:#fff}.latest{border-top:.5em solid <no value>}.event{-moz-box-shadow:0 0 0 0 rgba(0,0,0,.1);-webkit-box-shadow:0 0 0 0 rgba(0,0,0,.1);box-shadow:0 0 0 0 rgba(0,0,0,.1)}.section .event{background-color:#eab0c41a}.section .event{border-top:7pt solid #a19ea936}.section .event a{color:#1a162d}.section .event{color:#404040}</style><link rel=stylesheet href=/css/tidyverse.css><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.71.1"><title>nanoparquet 0.4.0</title><meta property="og:title" content="nanoparquet 0.4.0"><meta property="og:description" content="nanoparquet 0.4.0 comes with a new and much faster `read_parquet()`, configurable type mappings in `write_parquet()`, and a new `append_parquet()`."><meta property="og:type" content="article"><meta property="og:url" content="https://www.tidyverse.org/blog/2025/01/nanoparquet-0-4-0/"><meta property="twitter:card" content="summary_large_image"><meta property="og:title" content="nanoparquet 0.4.0 - Tidyverse"><meta property="description" content="nanoparquet 0.4.0 comes with a new and much faster `read_parquet()`, configurable type mappings in `write_parquet()`, and a new `append_parquet()`."><meta property="og:description" content="nanoparquet 0.4.0 comes with a new and much faster `read_parquet()`, configurable type mappings in `write_parquet()`, and a new `append_parquet()`."><meta property="og:image" content="https://www.tidyverse.org/blog/2025/01/nanoparquet-0-4-0/thumbnail-sq.jpg"><meta name=twitter:image content="https://www.tidyverse.org/blog/2025/01/nanoparquet-0-4-0/thumbnail-wd.jpg"><link rel=apple-touch-icon sizes=180x180 href=/images/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicons/favicon-16x16.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg><link rel="shortcut icon" href=/images/favicons/favicon.ico><meta name=msapplication-TileColor content="#da532c"><meta name=msapplication-config href=/images/favicons/browserconfig.xml><script type=text/javascript src=/js/jquery-3.5.1.min.js></script><script type=text/javascript src=/js/site.js></script><link rel=icon href=/images/favicon.ico><script type=text/javascript src=/js/clipboard.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin=anonymous></script><script defer data-domain=tidyverse.org,all.tidyverse.org src=https://plausible.io/js/plausible.js></script></head><body><div id=appTidyverseSite class="shrinkHeader alwaysShrinkHeader"><div id=main><div id=rStudioHeader><nav class=band><div class="innards bandContent"><div><a class=productName href=/%20/>Tidyverse</a></div><div id=menu><div id=menuToggler></div><div id=menuItems><a class=menuItem href=/packages/>Packages</a>
<a class="menuItem current" href=/blog/>Blog</a>
<a class=menuItem href=/learn/>Learn</a>
<a class=menuItem href=/help/>Help</a>
<a class=menuItem href=/contribute/>Contribute</a></div></div></div></nav></div><main><div class="band padForHeader pushFooter"><div class=bandContent><div class="full splitColumns withMobileMargins"><div class=column75><h1 class=article-title>nanoparquet 0.4.0</h1><div class=article-header aria-hidden=true><div class=photo><img src=/blog/2025/01/nanoparquet-0-4-0/thumbnail-wd.jpg></div><div class=photoCredit>Photo by <a href=https://www.pexels.com/photo/person-running-in-the-hallway-796545/>Michael Foster</a></div></div><span class=article-date><i class="fas fa-calendar-day fa-fw"></i>&nbsp;&nbsp;2025/01/28</span><p style=margin-bottom:.5em;margin-top:.85em><i class="fas fa-tags"></i>&nbsp;
<a href=/tags/parquet/>parquet</a></p><p style=margin-top:.5em><i class="fas fa-user-circle fa-fw"></i>&nbsp;
Gábor Csárdi</p><div class=article-content><p>We&rsquo;re thrilled to announce the release of
<a href=https://nanoparquet.r-lib.org/ target=_blank rel=noopener>nanoparquet</a> 0.4.0. nanoparquet is an R package that reads and writes Parquet files.</p><p>You can install it from CRAN with:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>install.packages</span><span class=p>(</span><span class=s>&#34;nanoparquet&#34;</span><span class=p>)</span>
</code></pre></div><p>This blog post will show the most important new features of nanoparquet 0.4.0: You can see a full list of changes in the
<a href=https://nanoparquet.r-lib.org/news/index.html#nanoparquet-040 target=_blank rel=noopener>release notes</a>.</p><h2 id=brand-new-read_parquet>Brand new <code>read_parquet()</code>
<a href=#brand-new-read_parquet><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>nanoparquet 0.4.0 comes with a completely rewritten Parquet reader. The new version has an architecture that is easier to embed into R, and facilitates fantastic new features, like
<a href=https://nanoparquet.r-lib.org/reference/append_parquet.html target=_blank rel=noopener><code>append_parquet()</code></a> and the new <code>col_select</code> argument. (More to come!) The new reader is also much faster, see the &ldquo;Benchmarks&rdquo; chapter.</p><h2 id=read-a-subset-of-columns>Read a subset of columns
<a href=#read-a-subset-of-columns><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p><a href=https://nanoparquet.r-lib.org/reference/read_parquet.html target=_blank rel=noopener><code>read_parquet()</code></a> now has a new argument called <code>col_select</code>, that lets you read a subset of the columns from the Parquet file. Unlike for row oriented file formats like CSV, this means that the reader never needs to touch the columns that are not needed for. The time required for reading a subset of columns is independent of how many more columns the Parquet file might have!</p><p>You can either use column indices or column names to specify the columns to read. Here is an example.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=https://github.com/r-lib/nanoparquet>nanoparquet</a></span><span class=o>)</span></span>
<span><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=https://pillar.r-lib.org/>pillar</a></span><span class=o>)</span></span></code></pre></div><p>This is the
<a href=https://rdrr.io/pkg/nycflights13/man/flights.html target=_blank rel=noopener><code>nycflights13::flights</code></a> data set:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://nanoparquet.r-lib.org/reference/read_parquet.html>read_parquet</a></span><span class=o>(</span></span>
<span>  <span class=s>"flights.parquet"</span>,</span>
<span>  col_select <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=s>"dep_time"</span>, <span class=s>"arr_time"</span>, <span class=s>"carrier"</span><span class=o>)</span></span>
<span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A data frame: 336,776 × 3</span></span></span>
<span><span class=c>#&gt;    dep_time arr_time carrier</span></span>
<span><span class=c>#&gt;       <span style=color:#555;font-style:italic>&lt;int&gt;</span>    <span style=color:#555;font-style:italic>&lt;int&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>  </span></span>
<span><span class=c>#&gt; <span style=color:#555> 1</span>      517      830 UA     </span></span>
<span><span class=c>#&gt; <span style=color:#555> 2</span>      533      850 UA     </span></span>
<span><span class=c>#&gt; <span style=color:#555> 3</span>      542      923 AA     </span></span>
<span><span class=c>#&gt; <span style=color:#555> 4</span>      544     <span style=text-decoration:underline>1</span>004 B6     </span></span>
<span><span class=c>#&gt; <span style=color:#555> 5</span>      554      812 DL     </span></span>
<span><span class=c>#&gt; <span style=color:#555> 6</span>      554      740 UA     </span></span>
<span><span class=c>#&gt; <span style=color:#555> 7</span>      555      913 B6     </span></span>
<span><span class=c>#&gt; <span style=color:#555> 8</span>      557      709 EV     </span></span>
<span><span class=c>#&gt; <span style=color:#555> 9</span>      557      838 B6     </span></span>
<span><span class=c>#&gt; <span style=color:#555>10</span>      558      753 AA     </span></span>
<span><span class=c>#&gt; <span style=color:#555># ℹ 336,766 more rows</span></span></span>
<span></span></code></pre></div><p>Use
<a href=https://nanoparquet.r-lib.org/reference/read_parquet_schema.html target=_blank rel=noopener><code>read_parquet_schema()</code></a> if you want to see the structure of the Parquet file first:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://nanoparquet.r-lib.org/reference/read_parquet_schema.html>read_parquet_schema</a></span><span class=o>(</span><span class=s>"flights.parquet"</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A data frame: 20 × 12</span></span></span>
<span><span class=c>#&gt;    file_name       name  r_type type  type_length repetition_type converted_type</span></span>
<span><span class=c>#&gt;    <span style=color:#555;font-style:italic>&lt;chr&gt;</span>           <span style=color:#555;font-style:italic>&lt;chr&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>  <span style=color:#555;font-style:italic>&lt;chr&gt;</span>       <span style=color:#555;font-style:italic>&lt;int&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>           <span style=color:#555;font-style:italic>&lt;chr&gt;</span>         </span></span>
<span><span class=c>#&gt; <span style=color:#555> 1</span> flights.parquet sche… <span style=color:#b00>NA</span>     <span style=color:#b00>NA</span>             <span style=color:#b00>NA</span> <span style=color:#b00>NA</span>              <span style=color:#b00>NA</span>            </span></span>
<span><span class=c>#&gt; <span style=color:#555> 2</span> flights.parquet year  integ… INT32          <span style=color:#b00>NA</span> REQUIRED        INT_32        </span></span>
<span><span class=c>#&gt; <span style=color:#555> 3</span> flights.parquet month integ… INT32          <span style=color:#b00>NA</span> REQUIRED        INT_32        </span></span>
<span><span class=c>#&gt; <span style=color:#555> 4</span> flights.parquet day   integ… INT32          <span style=color:#b00>NA</span> REQUIRED        INT_32        </span></span>
<span><span class=c>#&gt; <span style=color:#555> 5</span> flights.parquet dep_… integ… INT32          <span style=color:#b00>NA</span> OPTIONAL        INT_32        </span></span>
<span><span class=c>#&gt; <span style=color:#555> 6</span> flights.parquet sche… integ… INT32          <span style=color:#b00>NA</span> REQUIRED        INT_32        </span></span>
<span><span class=c>#&gt; <span style=color:#555> 7</span> flights.parquet dep_… double DOUB…          <span style=color:#b00>NA</span> OPTIONAL        <span style=color:#b00>NA</span>            </span></span>
<span><span class=c>#&gt; <span style=color:#555> 8</span> flights.parquet arr_… integ… INT32          <span style=color:#b00>NA</span> OPTIONAL        INT_32        </span></span>
<span><span class=c>#&gt; <span style=color:#555> 9</span> flights.parquet sche… integ… INT32          <span style=color:#b00>NA</span> REQUIRED        INT_32        </span></span>
<span><span class=c>#&gt; <span style=color:#555>10</span> flights.parquet arr_… double DOUB…          <span style=color:#b00>NA</span> OPTIONAL        <span style=color:#b00>NA</span>            </span></span>
<span><span class=c>#&gt; <span style=color:#555>11</span> flights.parquet carr… chara… BYTE…          <span style=color:#b00>NA</span> REQUIRED        UTF8          </span></span>
<span><span class=c>#&gt; <span style=color:#555>12</span> flights.parquet flig… integ… INT32          <span style=color:#b00>NA</span> REQUIRED        INT_32        </span></span>
<span><span class=c>#&gt; <span style=color:#555>13</span> flights.parquet tail… chara… BYTE…          <span style=color:#b00>NA</span> OPTIONAL        UTF8          </span></span>
<span><span class=c>#&gt; <span style=color:#555>14</span> flights.parquet orig… chara… BYTE…          <span style=color:#b00>NA</span> REQUIRED        UTF8          </span></span>
<span><span class=c>#&gt; <span style=color:#555>15</span> flights.parquet dest  chara… BYTE…          <span style=color:#b00>NA</span> REQUIRED        UTF8          </span></span>
<span><span class=c>#&gt; <span style=color:#555>16</span> flights.parquet air_… double DOUB…          <span style=color:#b00>NA</span> OPTIONAL        <span style=color:#b00>NA</span>            </span></span>
<span><span class=c>#&gt; <span style=color:#555>17</span> flights.parquet dist… double DOUB…          <span style=color:#b00>NA</span> REQUIRED        <span style=color:#b00>NA</span>            </span></span>
<span><span class=c>#&gt; <span style=color:#555>18</span> flights.parquet hour  double DOUB…          <span style=color:#b00>NA</span> REQUIRED        <span style=color:#b00>NA</span>            </span></span>
<span><span class=c>#&gt; <span style=color:#555>19</span> flights.parquet minu… double DOUB…          <span style=color:#b00>NA</span> REQUIRED        <span style=color:#b00>NA</span>            </span></span>
<span><span class=c>#&gt; <span style=color:#555>20</span> flights.parquet time… POSIX… INT64          <span style=color:#b00>NA</span> REQUIRED        TIMESTAMP_MIC…</span></span>
<span><span class=c>#&gt; <span style=color:#555># ℹ 5 more variables: logical_type &lt;I&lt;list&gt;&gt;, num_children &lt;int&gt;, scale &lt;int&gt;,</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>#   precision &lt;int&gt;, field_id &lt;int&gt;</span></span></span>
<span></span></code></pre></div><p>The output of
<a href=https://nanoparquet.r-lib.org/reference/read_parquet_schema.html target=_blank rel=noopener><code>read_parquet_schema()</code></a> also shows you the R type that nanoparquet will use for each column.</p><h2 id=appending-to-parquet-files>Appending to Parquet files
<a href=#appending-to-parquet-files><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>The new
<a href=https://nanoparquet.r-lib.org/reference/append_parquet.html target=_blank rel=noopener><code>append_parquet()</code></a> function makes it easy to append new data to a Parquet file, without first reading the whole file into memory. The schema of the file and the schema new data must match of course. Lets merge
<a href=https://rdrr.io/pkg/nycflights13/man/flights.html target=_blank rel=noopener><code>nycflights13::flights</code></a> and
<a href=https://moderndive.github.io/nycflights23/reference/flights.html target=_blank rel=noopener><code>nycflights23::flights</code></a>:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://rdrr.io/r/base/files.html>file.copy</a></span><span class=o>(</span><span class=s>"flights.parquet"</span>, <span class=s>"allflights.parquet"</span>, overwrite <span class=o>=</span> <span class=kc>TRUE</span><span class=o>)</span></span>
<span><span class=c>#&gt; [1] TRUE</span></span>
<span></span><span><span class=nf><a href=https://nanoparquet.r-lib.org/reference/append_parquet.html>append_parquet</a></span><span class=o>(</span><span class=nf>nycflights23</span><span class=nf>::</span><span class=nv><a href=https://moderndive.github.io/nycflights23/reference/flights.html>flights</a></span>, <span class=s>"allflights.parquet"</span><span class=o>)</span></span></code></pre></div><p><a href=https://nanoparquet.r-lib.org/reference/read_parquet_info.html target=_blank rel=noopener><code>read_parquet_info()</code></a> returns the most basic information about a Parquet file:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://nanoparquet.r-lib.org/reference/read_parquet_info.html>read_parquet_info</a></span><span class=o>(</span><span class=s>"flights.parquet"</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A data frame: 1 × 7</span></span></span>
<span><span class=c>#&gt;   file_name       num_cols num_rows num_row_groups file_size parquet_version</span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;chr&gt;</span>              <span style=color:#555;font-style:italic>&lt;int&gt;</span>    <span style=color:#555;font-style:italic>&lt;dbl&gt;</span>          <span style=color:#555;font-style:italic>&lt;int&gt;</span>     <span style=color:#555;font-style:italic>&lt;dbl&gt;</span>           <span style=color:#555;font-style:italic>&lt;int&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span> flights.parquet       19   <span style=text-decoration:underline>336</span>776              1   5<span style=text-decoration:underline>687</span>737               1</span></span>
<span><span class=c>#&gt; <span style=color:#555># ℹ 1 more variable: created_by &lt;chr&gt;</span></span></span>
<span></span><span><span class=nf><a href=https://nanoparquet.r-lib.org/reference/read_parquet_info.html>read_parquet_info</a></span><span class=o>(</span><span class=s>"allflights.parquet"</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A data frame: 1 × 7</span></span></span>
<span><span class=c>#&gt;   file_name          num_cols num_rows num_row_groups file_size parquet_version</span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;chr&gt;</span>                 <span style=color:#555;font-style:italic>&lt;int&gt;</span>    <span style=color:#555;font-style:italic>&lt;dbl&gt;</span>          <span style=color:#555;font-style:italic>&lt;int&gt;</span>     <span style=color:#555;font-style:italic>&lt;dbl&gt;</span>           <span style=color:#555;font-style:italic>&lt;int&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span> allflights.parquet       19   <span style=text-decoration:underline>772</span>128              1  13<span style=text-decoration:underline>490</span>997               1</span></span>
<span><span class=c>#&gt; <span style=color:#555># ℹ 1 more variable: created_by &lt;chr&gt;</span></span></span>
<span></span></code></pre></div><p>Note that you should probably still create a backup copy of the original file when using
<a href=https://nanoparquet.r-lib.org/reference/append_parquet.html target=_blank rel=noopener><code>append_parquet()</code></a>. If the appending process is interrupted by a power failure, then you might end up with an incomplete and invalid Parquet file.</p><h2 id=schemas-and-type-conversions>Schemas and type conversions
<a href=#schemas-and-type-conversions><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>In nanoparquet 0.4.0
<a href=https://nanoparquet.r-lib.org/reference/write_parquet.html target=_blank rel=noopener><code>write_parquet()</code></a> takes a <code>schema</code> argument that can customize the R to Parquet type mappings. For example by default
<a href=https://nanoparquet.r-lib.org/reference/write_parquet.html target=_blank rel=noopener><code>write_parquet()</code></a> writes an R character vector as a <code>STRING</code> Parquet type. If you&rsquo;d like to write a certain character column as an <code>ENUM</code> type<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> instead, you&rsquo;ll need to specify that in <code>schema</code>:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://nanoparquet.r-lib.org/reference/write_parquet.html>write_parquet</a></span><span class=o>(</span></span>
<span>  <span class=nf>nycflights13</span><span class=nf>::</span><span class=nv><a href=https://rdrr.io/pkg/nycflights13/man/flights.html>flights</a></span>,</span>
<span>  <span class=s>"newflights.parquet"</span>,</span>
<span>  schema <span class=o>=</span> <span class=nf><a href=https://nanoparquet.r-lib.org/reference/parquet_schema.html>parquet_schema</a></span><span class=o>(</span>carrier <span class=o>=</span> <span class=s>"ENUM"</span><span class=o>)</span></span>
<span><span class=o>)</span></span>
<span><span class=nf><a href=https://nanoparquet.r-lib.org/reference/read_parquet_schema.html>read_parquet_schema</a></span><span class=o>(</span><span class=s>"newflights.parquet"</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A data frame: 20 × 12</span></span></span>
<span><span class=c>#&gt;    file_name       name  r_type type  type_length repetition_type converted_type</span></span>
<span><span class=c>#&gt;    <span style=color:#555;font-style:italic>&lt;chr&gt;</span>           <span style=color:#555;font-style:italic>&lt;chr&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>  <span style=color:#555;font-style:italic>&lt;chr&gt;</span>       <span style=color:#555;font-style:italic>&lt;int&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>           <span style=color:#555;font-style:italic>&lt;chr&gt;</span>         </span></span>
<span><span class=c>#&gt; <span style=color:#555> 1</span> newflights.par… sche… <span style=color:#b00>NA</span>     <span style=color:#b00>NA</span>             <span style=color:#b00>NA</span> <span style=color:#b00>NA</span>              <span style=color:#b00>NA</span>            </span></span>
<span><span class=c>#&gt; <span style=color:#555> 2</span> newflights.par… year  integ… INT32          <span style=color:#b00>NA</span> REQUIRED        INT_32        </span></span>
<span><span class=c>#&gt; <span style=color:#555> 3</span> newflights.par… month integ… INT32          <span style=color:#b00>NA</span> REQUIRED        INT_32        </span></span>
<span><span class=c>#&gt; <span style=color:#555> 4</span> newflights.par… day   integ… INT32          <span style=color:#b00>NA</span> REQUIRED        INT_32        </span></span>
<span><span class=c>#&gt; <span style=color:#555> 5</span> newflights.par… dep_… integ… INT32          <span style=color:#b00>NA</span> OPTIONAL        INT_32        </span></span>
<span><span class=c>#&gt; <span style=color:#555> 6</span> newflights.par… sche… integ… INT32          <span style=color:#b00>NA</span> REQUIRED        INT_32        </span></span>
<span><span class=c>#&gt; <span style=color:#555> 7</span> newflights.par… dep_… double DOUB…          <span style=color:#b00>NA</span> OPTIONAL        <span style=color:#b00>NA</span>            </span></span>
<span><span class=c>#&gt; <span style=color:#555> 8</span> newflights.par… arr_… integ… INT32          <span style=color:#b00>NA</span> OPTIONAL        INT_32        </span></span>
<span><span class=c>#&gt; <span style=color:#555> 9</span> newflights.par… sche… integ… INT32          <span style=color:#b00>NA</span> REQUIRED        INT_32        </span></span>
<span><span class=c>#&gt; <span style=color:#555>10</span> newflights.par… arr_… double DOUB…          <span style=color:#b00>NA</span> OPTIONAL        <span style=color:#b00>NA</span>            </span></span>
<span><span class=c>#&gt; <span style=color:#555>11</span> newflights.par… carr… chara… BYTE…          <span style=color:#b00>NA</span> REQUIRED        ENUM          </span></span>
<span><span class=c>#&gt; <span style=color:#555>12</span> newflights.par… flig… integ… INT32          <span style=color:#b00>NA</span> REQUIRED        INT_32        </span></span>
<span><span class=c>#&gt; <span style=color:#555>13</span> newflights.par… tail… chara… BYTE…          <span style=color:#b00>NA</span> OPTIONAL        UTF8          </span></span>
<span><span class=c>#&gt; <span style=color:#555>14</span> newflights.par… orig… chara… BYTE…          <span style=color:#b00>NA</span> REQUIRED        UTF8          </span></span>
<span><span class=c>#&gt; <span style=color:#555>15</span> newflights.par… dest  chara… BYTE…          <span style=color:#b00>NA</span> REQUIRED        UTF8          </span></span>
<span><span class=c>#&gt; <span style=color:#555>16</span> newflights.par… air_… double DOUB…          <span style=color:#b00>NA</span> OPTIONAL        <span style=color:#b00>NA</span>            </span></span>
<span><span class=c>#&gt; <span style=color:#555>17</span> newflights.par… dist… double DOUB…          <span style=color:#b00>NA</span> REQUIRED        <span style=color:#b00>NA</span>            </span></span>
<span><span class=c>#&gt; <span style=color:#555>18</span> newflights.par… hour  double DOUB…          <span style=color:#b00>NA</span> REQUIRED        <span style=color:#b00>NA</span>            </span></span>
<span><span class=c>#&gt; <span style=color:#555>19</span> newflights.par… minu… double DOUB…          <span style=color:#b00>NA</span> REQUIRED        <span style=color:#b00>NA</span>            </span></span>
<span><span class=c>#&gt; <span style=color:#555>20</span> newflights.par… time… POSIX… INT64          <span style=color:#b00>NA</span> REQUIRED        TIMESTAMP_MIC…</span></span>
<span><span class=c>#&gt; <span style=color:#555># ℹ 5 more variables: logical_type &lt;I&lt;list&gt;&gt;, num_children &lt;int&gt;, scale &lt;int&gt;,</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>#   precision &lt;int&gt;, field_id &lt;int&gt;</span></span></span>
<span></span></code></pre></div><p>Here we wrote the <code>carrier</code> column as <code>ENUM</code>, and left the other other columns to use the default type mappings.</p><p>See the
<a href=https://nanoparquet.r-lib.org/reference/nanoparquet-types.html#r-s-data-types target=_blank rel=noopener><code>?nanoparquet-types</code></a> manual page for the possible type mappings (lots of new ones!) and also for the default ones.</p><h2 id=encodings>Encodings
<a href=#encodings><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>It is now also possible to customize the encoding of each column in
<a href=https://nanoparquet.r-lib.org/reference/write_parquet.html target=_blank rel=noopener><code>write_parquet()</code></a>, via the <code>encoding</code> argument. By default
<a href=https://nanoparquet.r-lib.org/reference/write_parquet.html target=_blank rel=noopener><code>write_parquet()</code></a> tries to choose a good encoding based on the type and the values of a column. E.g. it checks a small sample for repeated values to decide if it is worth using a dictionary encoding (<code>RLE_DICTIONARY</code>).</p><p>If
<a href=https://nanoparquet.r-lib.org/reference/write_parquet.html target=_blank rel=noopener><code>write_parquet()</code></a> gets it wrong, use the <code>encoding</code> argument to force an encoding. The following forces the <code>PLAIN</code> encoding for all columns. This encoding is very fast to write, but creates a larger file. You can also specify different encodings for different columns, see the
<a href=https://nanoparquet.r-lib.org/reference/write_parquet.html target=_blank rel=noopener><code>write_parquet()</code> manual page</a>.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://nanoparquet.r-lib.org/reference/write_parquet.html>write_parquet</a></span><span class=o>(</span></span>
<span>  <span class=nf>nycflights13</span><span class=nf>::</span><span class=nv><a href=https://rdrr.io/pkg/nycflights13/man/flights.html>flights</a></span>,</span>
<span>  <span class=s>"plainflights.parquet"</span>,</span>
<span>  encoding <span class=o>=</span> <span class=s>"PLAIN"</span></span>
<span><span class=o>)</span></span>
<span><span class=nf><a href=https://rdrr.io/r/base/file.info.html>file.size</a></span><span class=o>(</span><span class=s>"flights.parquet"</span><span class=o>)</span></span>
<span><span class=c>#&gt; [1] 5687737</span></span>
<span></span><span><span class=nf><a href=https://rdrr.io/r/base/file.info.html>file.size</a></span><span class=o>(</span><span class=s>"plainflights.parquet"</span><span class=o>)</span></span>
<span><span class=c>#&gt; [1] 11954574</span></span>
<span></span></code></pre></div><p>See more about the implemented encodings and how the defaults are selected in the
<a href=https://nanoparquet.r-lib.org/reference/parquet-encodings.html target=_blank rel=noopener><code>parquet-encodings</code> manual page</a>.</p><h2 id=api-changes>API changes
<a href=#api-changes><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Some nanoparquet functions have new, better names in nanoparquet 0.4.0. In particular, all functions that read from a Parquet file have a <code>read_parquet</code> prefix now. The old functions still work, with a warning.</p><p>Also, the
<a href=https://nanoparquet.r-lib.org/reference/parquet_schema.html target=_blank rel=noopener><code>parquet_schema()</code></a> function is now for creating a new Parquet schema from scratch, and not for inferring a schema from a data frame (use
<a href=https://nanoparquet.r-lib.org/reference/infer_parquet_schema.html target=_blank rel=noopener><code>infer_parquet_schema()</code></a>) or for reading the schema from a Parquet file (use
<a href=https://nanoparquet.r-lib.org/reference/read_parquet_schema.html target=_blank rel=noopener><code>read_parquet_schema()</code></a>).
<a href=https://nanoparquet.r-lib.org/reference/parquet_schema.html target=_blank rel=noopener><code>parquet_schema()</code></a> falls back to the old behaviour when called with a file name, with a warning, so this is not a breaking change (yet), and old code still works.</p><p>See the complete list of API changes in the
<a href=https://nanoparquet.r-lib.org/news/index.html target=_blank rel=noopener>Changelog</a>.</p><h2 id=benchmarks>Benchmarks
<a href=#benchmarks><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>We are very excited about the performance of the new Parquet reader, and the Parquet writer was always quite speedy, so we ran a simple benchmark.</p><p>We compared nanoparquet to the Parquet implementations in Apache Arrow and DuckDB, and also to CSV readers and writers, on a real data set, for samples of 330k, 6.7 million and 67.4 million rows (40MB, 800MB and 8GB in memory). For these data nanoparquet is indeed very competitive with both Arrow and DuckDB.</p><p>You can see the full results
<a href=https://nanoparquet.r-lib.org/articles/benchmarks.html target=_blank rel=noopener>on the website</a>.</p><h2 id=other-changes>Other changes
<a href=#other-changes><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Other important changes in nanoparquet 0.4.0 include:</p><ul><li><p><a href=https://nanoparquet.r-lib.org/reference/write_parquet.html target=_blank rel=noopener><code>write_parquet()</code></a> can now write multiple row groups. By default it puts at most 10 million rows in a single row group. (This is subject to <a href=https://nanoparquet.r-lib.org/references/parquet_options.html>https://nanoparquet.r-lib.org/references/parquet_options.html</a> ) on how to change the default.</p></li><li><p><a href=https://nanoparquet.r-lib.org/reference/write_parquet.html target=_blank rel=noopener><code>write_parquet()</code></a> now writes minimum and maximum statistics (by default) for most Parquet types. See the
<a href=https://nanoparquet.r-lib.org/reference/parquet_options.html target=_blank rel=noopener><code>parquet_options()</code> manual page</a> on how to turn this off, which will probably make the writer faster.</p></li><li><p><a href=https://nanoparquet.r-lib.org/reference/write_parquet.html target=_blank rel=noopener><code>write_parquet()</code></a> can now write version 2 data pages. The default is still version 1, but it might change in the future.</p></li><li><p>New <code>compression_level</code> option to select the compression level manually.</p></li><li><p><a href=https://nanoparquet.r-lib.org/reference/read_parquet.html target=_blank rel=noopener><code>read_parquet()</code></a> can now read from an R connection.</p></li></ul><h2 id=acknowledgements>Acknowledgements
<a href=#acknowledgements><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p><a href=https://github.com/alvarocombo target=_blank rel=noopener>@alvarocombo</a>,
<a href=https://github.com/D3SL target=_blank rel=noopener>@D3SL</a>,
<a href=https://github.com/gaborcsardi target=_blank rel=noopener>@gaborcsardi</a>, and
<a href=https://github.com/RealTYPICAL target=_blank rel=noopener>@RealTYPICAL</a>.</p><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>A Parquet <code>ENUM</code> type is very similar to a factor in R. <a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></div></div><div class=column25><div class="section hideOnMobile"><div class=sectionTitle>Contents</div><nav id=TableOfContents><ul><li><a href=#brand-new-read_parquet>Brand new <code>read_parquet()</code></a></li><li><a href=#read-a-subset-of-columns>Read a subset of columns</a></li><li><a href=#appending-to-parquet-files>Appending to Parquet files</a></li><li><a href=#schemas-and-type-conversions>Schemas and type conversions</a></li><li><a href=#encodings>Encodings</a></li><li><a href=#api-changes>API changes</a></li><li><a href=#benchmarks>Benchmarks</a></li><li><a href=#other-changes>Other changes</a></li><li><a href=#acknowledgements>Acknowledgements</a></li></ul></nav></div><div class=section></div></div></div></div></div><div id=rStudioFooter class=band><div class=bandContent><div id=copyright>The tidyverse is proudly supported by <a class=rstudioLogo href=https://posit.co/ aria-label="Posit Homepage"></a></div><div id=logos><a href=https://www.tidyverse.org/google_privacy_policy>Privacy policy</a>
<a href=https://github.com/tidyverse class="footerLogo gitHub" aria-label="Tidyverse GitHub organization"></a><a href=https://twitter.com/hashtag/rstats class="footerLogo twitter" aria-label="rstats hashtag on twitter.com"></a></div></div></div></div></div><script type=application/javascript>var dnt=(navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack);var doNotTrack=(dnt=="1"||dnt=="yes");if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');if(window.sessionStorage){var GA_SESSION_STORAGE_KEY='ga:clientId';ga('create','UA-115082821-1',{'storage':'none','clientId':sessionStorage.getItem(GA_SESSION_STORAGE_KEY)});ga(function(tracker){sessionStorage.setItem(GA_SESSION_STORAGE_KEY,tracker.get('clientId'));});}
ga('set','anonymizeIp',true);ga('send','pageview');}</script></body></html></div></div></body></html>