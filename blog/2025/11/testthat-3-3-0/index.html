<!doctype html><html><head><!doctype html><html lang=en-us><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/css/main-site.css><link rel=stylesheet href=/css/fa5-all.css><style type=text/css>body{background-color:#fff;color:#1a1917}a{color:#38577f}a:hover{color:#42709b}a:focus{outline-color:#42709b}.column25-left .sectionTitle a:hover:not(.current),.column16-left .sectionTitle a:hover:not(.current){color:#1a1917}.icon-attribution,.icon-attribution a{color:#1a1917;opacity:75%}#homeContent .band.first{background-color:#fff}#homeContent .band.second{background-color:#fdeba4}#homeContent .band.third{background-color:#fff}#rStudioHeader{background-color:#1a162d;color:#fff}#rStudioHeader .productName{color:#fff}#rStudioHeader .productName:hover,#rStudioHeader .productName:focus{color:#fdeba4}#rStudioHeader #menu .menuItem.a{background-color:#75aadb;color:#fff}#rStudioHeader #menu .menuItem:hover{background-color:#484557;color:#fff}#rStudioHeader #menu .menuItem.current{background-color:#fff;color:#1a162d;text-decoration:none}#rStudioFooter.band{background-color:#767381}#rStudioFooter .bandContent #copyright{color:#e3eef8}table tbody tr:nth-child(even){background-color:#f7faff}table tbody tr:nth-child(odd){background-color:#fff}.latest{border-top:.5em solid <no value>}.event{-moz-box-shadow:0 0 0 0 rgba(0,0,0,.1);-webkit-box-shadow:0 0 0 0 rgba(0,0,0,.1);box-shadow:0 0 0 0 rgba(0,0,0,.1)}.section .event{background-color:#eab0c41a}.section .event{border-top:7pt solid #a19ea936}.section .event a{color:#1a162d}.section .event{color:#404040}</style><link rel=stylesheet href=/css/tidyverse.css><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.71.1"><title>testthat 3.3.0</title><meta property="og:title" content="testthat 3.3.0"><meta property="og:description" content="testthat 3.3.0 brings improved expectations with better error messages, new expectations for common testing patterns, and lifecycle changes including the removal of `local_mock()` and `with_mock()`. It also includes a write-up of my experience doing package development with Claude Code."><meta property="og:type" content="article"><meta property="og:url" content="https://www.tidyverse.org/blog/2025/11/testthat-3-3-0/"><meta property="twitter:card" content="summary_large_image"><meta property="og:title" content="testthat 3.3.0 - Tidyverse"><meta property="description" content="testthat 3.3.0 brings improved expectations with better error messages, new expectations for common testing patterns, and lifecycle changes including the removal of `local_mock()` and `with_mock()`. It also includes a write-up of my experience doing package development with Claude Code."><meta property="og:description" content="testthat 3.3.0 brings improved expectations with better error messages, new expectations for common testing patterns, and lifecycle changes including the removal of `local_mock()` and `with_mock()`. It also includes a write-up of my experience doing package development with Claude Code."><meta property="og:image" content="https://www.tidyverse.org/blog/2025/11/testthat-3-3-0/thumbnail-sq.jpg"><meta name=twitter:image content="https://www.tidyverse.org/blog/2025/11/testthat-3-3-0/thumbnail-wd.jpg"><link rel=apple-touch-icon sizes=180x180 href=/images/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicons/favicon-16x16.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg><link rel="shortcut icon" href=/images/favicons/favicon.ico><meta name=msapplication-TileColor content="#da532c"><meta name=msapplication-config href=/images/favicons/browserconfig.xml><script type=text/javascript src=/js/jquery-3.5.1.min.js></script><script type=text/javascript src=/js/site.js></script><link rel=icon href=/images/favicon.ico><script type=text/javascript src=/js/clipboard.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin=anonymous></script><script defer data-domain=tidyverse.org,all.tidyverse.org src=https://plausible.io/js/plausible.js></script></head><body><div id=appTidyverseSite class="shrinkHeader alwaysShrinkHeader"><div id=main><div id=rStudioHeader><nav class=band><div class="innards bandContent"><div><a class=productName href=/>Tidyverse</a></div><div id=menu><div id=menuToggler></div><div id=menuItems><a class=menuItem href=/packages/>Packages</a>
<a class="menuItem current" href=/blog/>Blog</a>
<a class=menuItem href=/learn/>Learn</a>
<a class=menuItem href=/help/>Help</a>
<a class=menuItem href=/contribute/>Contribute</a></div></div></div></nav></div><main><div class="band padForHeader pushFooter"><div class=bandContent><div class="full splitColumns withMobileMargins"><div class=column75><h1 class=article-title>testthat 3.3.0</h1><div class=article-header aria-hidden=true><div class=photo><img src=/blog/2025/11/testthat-3-3-0/thumbnail-wd.jpg></div><div class=photoCredit>Photo by <a href=https://unsplash.com/photos/a-rack-filled-with-lots-of-yellow-hard-hats-wp81DxKUd1Ez>Pop & Zebra</a></div></div><span class=article-date><i class="fas fa-calendar-day fa-fw"></i>&nbsp;&nbsp;2025/11/13</span><p style=margin-bottom:.5em;margin-top:.85em><i class="fas fa-tags"></i>&nbsp;
<a href=/tags/devtools/>devtools</a>,
<a href=/tags/testthat/>testthat</a></p><p style=margin-top:.5em><i class="fas fa-user-circle fa-fw"></i>&nbsp;
Hadley Wickham</p><div class=article-content><p>We&rsquo;re chuffed to announce the release of
<a href=https://testthat.r-lib.org target=_blank rel=noopener>testthat</a> 3.3.0. testthat is a testing framework for R that makes it easy to turn your existing informal tests into formal, automated tests that you can rerun quickly and easily.</p><p>You can install it from CRAN with:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://rdrr.io/r/utils/install.packages.html>install.packages</a></span><span class=o>(</span><span class=s>"testthat"</span><span class=o>)</span></span></code></pre></div><p>This blog post highlights the most important changes in this release, including lifecycle changes that removed long-deprecated mocking functions, improvements to expectations and their error messages, and a variety of new features that make testing easier and more robust. You can see a full list of changes in the
<a href=https://github.com/r-lib/testthat/releases/tag/v3.3.0 target=_blank rel=noopener>release notes</a>.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=https://testthat.r-lib.org>testthat</a></span><span class=o>)</span></span></code></pre></div><h2 id=claude-code-experiences>Claude Code experiences
<a href=#claude-code-experiences><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Before we dive into the changes, I wanted to talk a little bit about some changes to my development process, as I used this release as an opportunity to learn
<a href=https://www.claude.com/product/claude-code target=_blank rel=noopener>Claude Code</a>. This is the first package where I&rsquo;ve really used AI to support the development of many features and I thought it might be useful to share my experience.</p><p>Overall it was a successful experiment. It helped me close over 100 issues in what felt like less time than usual. I don&rsquo;t have any hard numbers, but my gut feeling is that it was maybe a 10-20% improvement to my development velocity. This is still significant, especially since I&rsquo;m an experienced R programmer and my workflow has been pretty stable for the last few years. I mostly used Claude for smaller, well-defined tasks where I had a good sense of what was needed. I found it particularly useful for refactoring, where it was easy to say precisely what I wanted, but executing the changes required a bunch of fiddly edits across many files.</p><p>I also found it generally useful for getting over the &ldquo;activation energy hump&rdquo;: there were a few issues that had been stagnating for years because they felt like they were going to be hard to do and with relatively limited payoff. I let Claude Code loose on a few of these and found it super useful. It only produced code I was really happy with a couple of times, but every time it gave me something to react to (often with strong negative feelings!) and that got me started actually engaging with the problem.</p><p>If you&rsquo;re interested in using Claude Code yourself, there are a couple of files you might find useful. My
<a href=https://github.com/r-lib/testthat/blob/main/.claude/CLAUDE.md target=_blank rel=noopener><code>CLAUDE.md</code></a> tells Claude how to execute a devtools-based workflow, along with a few pointers to resolve common issues. My
<a href=https://github.com/r-lib/testthat/blob/main/.claude/settings.json target=_blank rel=noopener><code>settings.json</code></a> allows Claude to run longer without human intervention, doing things that should mostly be safe. One note of caution: these settings do allow Claude to run R code, which does allow it to do practically anything. In my experience, Claude only used R to run tests or documentation.</p><p>I also experimented with using Claude Code to review PRs. It was just barely useful enough that I kept it turned on for my own PRs, but I didn&rsquo;t bother trying to get it to work for contributed PRs. Most of the time it either gave a thumbs up or bad advice, but every now and then it would pick up a small error.</p><p>(I&rsquo;ve also used Claude Code to proofread this blog post!)</p><h2 id=lifecycle-changes>Lifecycle changes
<a href=#lifecycle-changes><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>The biggest change in this release is that
<a href=https://testthat.r-lib.org/reference/with_mock.html target=_blank rel=noopener><code>local_mock()</code></a> and
<a href=https://testthat.r-lib.org/reference/with_mock.html target=_blank rel=noopener><code>with_mock()</code></a> are defunct. They were deprecated in 3.0.0 (2020-10-31) because it was becoming clear that the technique that made them work would be disallowed in a future version of R. This has now happened in R 4.5.0, so the functions have been removed. Removing
<a href=https://testthat.r-lib.org/reference/with_mock.html target=_blank rel=noopener><code>local_mock()</code></a> and
<a href=https://testthat.r-lib.org/reference/with_mock.html target=_blank rel=noopener><code>with_mock()</code></a> was a fairly disruptive change, affecting ~100 CRAN packages, but it had to be done, and I&rsquo;ve been working on notifying package developers since January so everyone had plenty of time to update. Fortunately, the needed changes are generally small, since the newer
<a href=https://testthat.r-lib.org/reference/local_mocked_bindings.html target=_blank rel=noopener><code>local_mocked_bindings()</code></a> and
<a href=https://testthat.r-lib.org/reference/local_mocked_bindings.html target=_blank rel=noopener><code>with_mocked_bindings()</code></a> can solve most additional needs. (If you haven&rsquo;t heard of mocking before, you can read the new <code>vignette("mocking")</code> to learn what it is and why you might want to use it.)</p><p>Other lifecycle changes:</p><ul><li><p>testthat now requires R 4.1. This follows
<a href=https://tidyverse.org/blog/2019/04/r-version-support/ target=_blank rel=noopener>our supported version policy</a>, which documents our commitment to support five versions of R (the current version and four previous versions). We&rsquo;re excited to be able to finally take advantage of the base pipe and compact anonymous functions (i.e. <code>\(x) x + 1</code>)!</p></li><li><p><code>is_null()</code>/<code>matches()</code>, deprecated in 2.0.0 (2017-12-19), and <code>is_true()</code>/<code>is_false()</code>, deprecated in 2.1.0 (2019-04-23), have been removed. These conflicted with other tidyverse functions so we pushed their deprecation through, even though we have generally left the old
<a href=https://testthat.r-lib.org/reference/test_that.html target=_blank rel=noopener><code>test_that()</code></a> API untouched.</p></li><li><p><code>expect_snapshot(binary)</code>, soft deprecated in 3.0.3 (2021-06-16), is now fully deprecated. <code>test_files(wrap)</code>, deprecated in 3.0.0 (2020-10-31), has now been removed.</p></li><li><p>There were a few other changes that broke existing packages. The most impactful change was to start checking the inputs to
<a href=https://testthat.r-lib.org/reference/expect.html target=_blank rel=noopener><code>expect()</code></a> which, despite the name, is actually an internal helper. That revealed a surprising number of packages were accidentally using
<a href=https://testthat.r-lib.org/reference/expect.html target=_blank rel=noopener><code>expect()</code></a> instead of
<a href=https://testthat.r-lib.org/reference/logical-expectations.html target=_blank rel=noopener><code>expect_true()</code></a> or
<a href=https://testthat.r-lib.org/reference/equality-expectations.html target=_blank rel=noopener><code>expect_equal()</code></a>. We don&rsquo;t technically consider this a breaking change because it revealed off-label function usage: the function API hasn&rsquo;t changed; you just now learn when you&rsquo;re using it incorrectly.</p></li></ul><p>If you&rsquo;re interested in the process we use to manage the release of a package that breaks its reverse dependencies, you might like to read
<a href=https://github.com/r-lib/testthat/issues/2021 target=_blank rel=noopener>the issue</a> where I track all the problems and prepare PRs to fix them.</p><h2 id=expectations-and-the-interactive-testing-experience>Expectations and the interactive testing experience
<a href=#expectations-and-the-interactive-testing-experience><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>A lot of work in this release was prompted by an overhaul of <code>vignette("custom-expectations")</code>, which describes how to create your own expectations that work just like testthat&rsquo;s. This is a long time coming, and as I was working on it, I realized that I didn&rsquo;t really know how to write new expectations, which had led to a lot of variation in the existing implementations. This kicked off a bunch of experimentation and iterating, leading to a swath of improvements:</p><ul><li><p>All expectations have new failure messages: they now state what was expected, what was actually received, and, if possible, they clearly illustrate the difference.</p></li><li><p>Expectations now consistently return the value of the first argument, regardless of whether the expectation succeeds or fails (the only exception is
<a href=https://testthat.r-lib.org/reference/expect_error.html target=_blank rel=noopener><code>expect_error()</code></a> and friends which return the captured condition so that you can perform additional checks on the condition object). This is a relatively subtle change that won&rsquo;t affect tests that already pass, but it does improve failures when you pipe together multiple expectations.</p></li><li><p>A new
<a href=https://testthat.r-lib.org/reference/fail.html target=_blank rel=noopener><code>pass()</code></a> function makes it clear how to signal when an expectation succeeds. All existing expectations were rewritten to use
<a href=https://testthat.r-lib.org/reference/fail.html target=_blank rel=noopener><code>pass()</code></a> and (the existing)
<a href=https://testthat.r-lib.org/reference/fail.html target=_blank rel=noopener><code>fail()</code></a> instead of
<a href=https://testthat.r-lib.org/reference/expect.html target=_blank rel=noopener><code>expect()</code></a>, which I think makes the flow of logic easier to understand.</p></li><li><p>Improved
<a href=https://testthat.r-lib.org/reference/expect_success.html target=_blank rel=noopener><code>expect_success()</code></a> and
<a href=https://testthat.r-lib.org/reference/expect_success.html target=_blank rel=noopener><code>expect_failure()</code></a> expectations now test that an expectation always returns exactly one success or failure (this ensures that the counts that you see in the reporters are correct).</p></li></ul><p>This new framework helped us write six new expectations:</p><ul><li><p><a href=https://testthat.r-lib.org/reference/expect_all_equal.html target=_blank rel=noopener><code>expect_all_equal()</code></a>,
<a href=https://testthat.r-lib.org/reference/expect_all_equal.html target=_blank rel=noopener><code>expect_all_true()</code></a>, and
<a href=https://testthat.r-lib.org/reference/expect_all_equal.html target=_blank rel=noopener><code>expect_all_false()</code></a> check that every element of a vector has the same value, giving better error messages than <code>expect_true(all(...))</code>:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://testthat.r-lib.org/reference/test_that.html>test_that</a></span><span class=o>(</span><span class=s>"some test"</span>, <span class=o>&#123;</span></span>
<span>  <span class=nv>x</span> <span class=o>&lt;-</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=m>0.408</span>, <span class=m>0.961</span>, <span class=m>0.883</span>, <span class=m>0.46</span>, <span class=m>0.537</span>, <span class=m>0.961</span>, <span class=m>0.851</span>, <span class=m>0.887</span>, <span class=m>0.023</span><span class=o>)</span></span>
<span>  <span class=nf><a href=https://testthat.r-lib.org/reference/expect_all_equal.html>expect_all_true</a></span><span class=o>(</span><span class=nv>x</span> <span class=o>&lt;</span> <span class=m>0.95</span><span class=o>)</span></span>
<span><span class=o>&#125;</span><span class=o>)</span></span>
<span><span class=c>#&gt; ── <span style=color:#bb0;font-weight:700>Failure</span><span style=font-weight:700>: some test</span> ────────────────────────────────────────────────</span></span>
<span><span class=c>#&gt; Expected every element of `x &lt; 0.95` to equal TRUE.</span></span>
<span><span class=c>#&gt; Differences:</span></span>
<span><span class=c>#&gt; `actual`:   <span style=color:#555>TRUE</span> <span style=color:#0b0>FALSE</span> <span style=color:#555>TRUE</span> <span style=color:#555>TRUE</span> <span style=color:#555>TRUE</span> <span style=color:#0b0>FALSE</span> <span style=color:#555>TRUE</span> <span style=color:#555>TRUE</span> <span style=color:#555>TRUE</span></span></span>
<span><span class=c>#&gt; `expected`: <span style=color:#555>TRUE</span> <span style=color:#0b0>TRUE</span>  <span style=color:#555>TRUE</span> <span style=color:#555>TRUE</span> <span style=color:#555>TRUE</span> <span style=color:#0b0>TRUE</span>  <span style=color:#555>TRUE</span> <span style=color:#555>TRUE</span> <span style=color:#555>TRUE</span></span></span>
<span></span><span><span class=c>#&gt; <span style=color:#bb0;font-weight:700>Error</span><span style=font-weight:700>:</span></span></span>
<span><span class=c>#&gt; <span style=color:#bb0>!</span> Test failed with 1 failure and 0 successes.</span></span>
<span></span></code></pre></div></li><li><p><a href=https://testthat.r-lib.org/reference/expect_setequal.html target=_blank rel=noopener><code>expect_disjoint()</code></a>, by
<a href=https://github.com/stibu81 target=_blank rel=noopener>@stibu81</a>, expects values to be absent:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://testthat.r-lib.org/reference/test_that.html>test_that</a></span><span class=o>(</span><span class=s>""</span>, <span class=o>&#123;</span></span>
<span>  <span class=nf><a href=https://testthat.r-lib.org/reference/expect_setequal.html>expect_disjoint</a></span><span class=o>(</span><span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=s>"a"</span>, <span class=s>"b"</span>, <span class=s>"c"</span><span class=o>)</span>, <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=s>"c"</span>, <span class=s>"d"</span>, <span class=s>"e"</span><span class=o>)</span><span class=o>)</span></span>
<span><span class=o>&#125;</span><span class=o>)</span></span>
<span><span class=c>#&gt; ── <span style=color:#bb0;font-weight:700>Failure</span><span style=font-weight:700>: </span> ─────────────────────────────────────────────────────────</span></span>
<span><span class=c>#&gt; Expected `c("a", "b", "c")` to be disjoint from `c("c", "d", "e")`.</span></span>
<span><span class=c>#&gt; Actual: "a", "b", "c"</span></span>
<span><span class=c>#&gt; Expected: None of "c", "d", "e"</span></span>
<span><span class=c>#&gt; Invalid: "c"</span></span>
<span></span><span><span class=c>#&gt; <span style=color:#bb0;font-weight:700>Error</span><span style=font-weight:700>:</span></span></span>
<span><span class=c>#&gt; <span style=color:#bb0>!</span> Test failed with 1 failure and 0 successes.</span></span>
<span></span></code></pre></div></li><li><p><a href=https://testthat.r-lib.org/reference/inheritance-expectations.html target=_blank rel=noopener><code>expect_r6_class()</code></a> expects an R6 object:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://testthat.r-lib.org/reference/test_that.html>test_that</a></span><span class=o>(</span><span class=s>""</span>, <span class=o>&#123;</span></span>
<span>  <span class=nv>x</span> <span class=o>&lt;-</span> <span class=m>10</span></span>
<span>  <span class=nf><a href=https://testthat.r-lib.org/reference/inheritance-expectations.html>expect_r6_class</a></span><span class=o>(</span><span class=nv>x</span>, <span class=s>"foo"</span><span class=o>)</span></span>
<span></span>
<span>  <span class=nv>x</span> <span class=o>&lt;-</span> <span class=nf>R6</span><span class=nf>::</span><span class=kr><a href=https://r6.r-lib.org/reference/R6Class.html>R6Class</a></span><span class=o>(</span><span class=s>"bar"</span><span class=o>)</span><span class=o>$</span><span class=nf>new</span><span class=o>(</span><span class=o>)</span></span>
<span>  <span class=nf><a href=https://testthat.r-lib.org/reference/inheritance-expectations.html>expect_r6_class</a></span><span class=o>(</span><span class=nv>x</span>, <span class=s>"foo"</span><span class=o>)</span></span>
<span><span class=o>&#125;</span><span class=o>)</span></span>
<span><span class=c>#&gt; ── <span style=color:#bb0;font-weight:700>Failure</span><span style=font-weight:700>: </span> ─────────────────────────────────────────────────────────</span></span>
<span><span class=c>#&gt; Expected `x` to be an R6 object.</span></span>
<span><span class=c>#&gt; Actual OO type: none.</span></span>
<span><span class=c>#&gt; ── <span style=color:#bb0;font-weight:700>Failure</span><span style=font-weight:700>: </span> ─────────────────────────────────────────────────────────</span></span>
<span><span class=c>#&gt; Expected `x` to inherit from "foo".</span></span>
<span><span class=c>#&gt; Actual class: "bar"/"R6".</span></span>
<span></span><span><span class=c>#&gt; <span style=color:#bb0;font-weight:700>Error</span><span style=font-weight:700>:</span></span></span>
<span><span class=c>#&gt; <span style=color:#bb0>!</span> Test failed with 2 failures and 0 successes.</span></span>
<span></span></code></pre></div></li><li><p><a href=https://testthat.r-lib.org/reference/expect_length.html target=_blank rel=noopener><code>expect_shape()</code></a>, by
<a href=https://github.com/michaelchirico target=_blank rel=noopener>@michaelchirico</a>, expects a specific shape (i.e.,
<a href=https://rdrr.io/r/base/nrow.html target=_blank rel=noopener><code>nrow()</code></a>,
<a href=https://rdrr.io/r/base/nrow.html target=_blank rel=noopener><code>ncol()</code></a>, or
<a href=https://rdrr.io/r/base/dim.html target=_blank rel=noopener><code>dim()</code></a>):</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://testthat.r-lib.org/reference/test_that.html>test_that</a></span><span class=o>(</span><span class=s>"show off expect_shape() failure messages"</span>, <span class=o>&#123;</span></span>
<span>  <span class=nv>x</span> <span class=o>&lt;-</span> <span class=nf><a href=https://rdrr.io/r/base/matrix.html>matrix</a></span><span class=o>(</span><span class=m>1</span><span class=o>:</span><span class=m>9</span>, nrow <span class=o>=</span> <span class=m>3</span><span class=o>)</span></span>
<span>  <span class=nf><a href=https://testthat.r-lib.org/reference/expect_length.html>expect_shape</a></span><span class=o>(</span><span class=nv>x</span>, nrow <span class=o>=</span> <span class=m>4</span><span class=o>)</span></span>
<span>  <span class=nf><a href=https://testthat.r-lib.org/reference/expect_length.html>expect_shape</a></span><span class=o>(</span><span class=nv>x</span>, dim <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=m>3</span>, <span class=m>3</span>, <span class=m>3</span><span class=o>)</span><span class=o>)</span></span>
<span>  <span class=nf><a href=https://testthat.r-lib.org/reference/expect_length.html>expect_shape</a></span><span class=o>(</span><span class=nv>x</span>, dim <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=m>3</span>, <span class=m>4</span><span class=o>)</span><span class=o>)</span></span>
<span><span class=o>&#125;</span><span class=o>)</span></span>
<span><span class=c>#&gt; ── <span style=color:#bb0;font-weight:700>Failure</span><span style=font-weight:700>: show off expect_shape() failure messages</span> ─────────────────</span></span>
<span><span class=c>#&gt; Expected `x` to have 4 rows.</span></span>
<span><span class=c>#&gt; Actual rows: 3.</span></span>
<span><span class=c>#&gt; ── <span style=color:#bb0;font-weight:700>Failure</span><span style=font-weight:700>: show off expect_shape() failure messages</span> ─────────────────</span></span>
<span><span class=c>#&gt; Expected `x` to have 3 dimensions.</span></span>
<span><span class=c>#&gt; Actual dimensions: 2.</span></span>
<span><span class=c>#&gt; ── <span style=color:#bb0;font-weight:700>Failure</span><span style=font-weight:700>: show off expect_shape() failure messages</span> ─────────────────</span></span>
<span><span class=c>#&gt; Expected `x` to have dim (3, 4).</span></span>
<span><span class=c>#&gt; Actual dim: (3, 3).</span></span>
<span></span><span><span class=c>#&gt; <span style=color:#bb0;font-weight:700>Error</span><span style=font-weight:700>:</span></span></span>
<span><span class=c>#&gt; <span style=color:#bb0>!</span> Test failed with 3 failures and 0 successes.</span></span>
<span></span></code></pre></div></li></ul><p>As you can see from the examples above, when you run a single test interactively (i.e. not as a part of a test suite) you now see exactly how many expectations succeeded and failed.</p><h2 id=other-new-features>Other new features
<a href=#other-new-features><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><ul><li><p>testthat generally does a better job of handling nested tests, aka subtests, where you put a
<a href=https://testthat.r-lib.org/reference/test_that.html target=_blank rel=noopener><code>test_that()</code></a> inside another
<a href=https://testthat.r-lib.org/reference/test_that.html target=_blank rel=noopener><code>test_that()</code></a>, or more typically
<a href=https://testthat.r-lib.org/reference/describe.html target=_blank rel=noopener><code>it()</code></a> inside of
<a href=https://testthat.r-lib.org/reference/describe.html target=_blank rel=noopener><code>describe()</code></a>. Subtests will now generate more informative failure messages, free from duplication, with more informative skips if any subtests don&rsquo;t contain any expectations.</p></li><li><p>The snapshot experience has been significantly improved, with all known bugs fixed and some new helpers added:
<a href=https://testthat.r-lib.org/reference/snapshot_accept.html target=_blank rel=noopener><code>snapshot_reject()</code></a> rejects all modified snapshots by deleting the <code>.new</code> variants, and
<a href=https://testthat.r-lib.org/reference/snapshot_download_gh.html target=_blank rel=noopener><code>snapshot_download_gh()</code></a> makes it easy to get snapshots off GitHub and into your local package. Additionally,
<a href=https://testthat.r-lib.org/reference/expect_snapshot.html target=_blank rel=noopener><code>expect_snapshot()</code></a> and friends will now fail when creating a new snapshot on CI, as that&rsquo;s usually a signal that you&rsquo;ve forgotten to run the snapshot code locally before committing.</p></li><li><p>On CRAN,
<a href=https://testthat.r-lib.org/reference/test_that.html target=_blank rel=noopener><code>test_that()</code></a> will automatically skip if a package is not installed, which means that you no longer need to check if suggested packages are installed in your tests.</p></li><li><p><code>vignette("mocking")</code> explains mocking in detail, and new
<a href=https://testthat.r-lib.org/reference/local_mocked_s3_method.html target=_blank rel=noopener><code>local_mocked_s3_method()</code></a>,
<a href=https://testthat.r-lib.org/reference/local_mocked_s3_method.html target=_blank rel=noopener><code>local_mocked_s4_method()</code></a>, and
<a href=https://testthat.r-lib.org/reference/local_mocked_r6_class.html target=_blank rel=noopener><code>local_mocked_r6_class()</code></a> make it easier to mock S3 and S4 methods and R6 classes.</p></li><li><p><a href=https://testthat.r-lib.org/reference/test_dir.html target=_blank rel=noopener><code>test_dir()</code></a>,
<a href=https://testthat.r-lib.org/reference/test_package.html target=_blank rel=noopener><code>test_check()</code></a>, and friends gain a <code>shuffle</code> argument that uses
<a href=https://rdrr.io/r/base/sample.html target=_blank rel=noopener><code>sample()</code></a> to randomly reorder the top-level expressions in each test file. This random reordering surfaces dependencies between tests and code outside of any test, as well as dependencies between tests, helping you find and eliminate unintentional dependencies.</p></li><li><p><a href=https://testthat.r-lib.org/reference/try_again.html target=_blank rel=noopener><code>try_again()</code></a> is now publicized, as it&rsquo;s a useful tool for testing flaky code:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>flaky_function</span> <span class=o>&lt;-</span> <span class=kr>function</span><span class=o>(</span><span class=o>)</span> <span class=o>&#123;</span></span>
  <span>  <span class=kr>if</span> <span class=o>(</span><span class=nf><a href=https://rdrr.io/r/stats/Uniform.html>runif</a></span><span class=o>(</span><span class=m>1</span><span class=o>)</span> <span class=o>&lt;</span> <span class=m>0.1</span><span class=o>)</span> <span class=m>0</span> <span class=kr>else</span> <span class=m>1</span></span>
  <span><span class=o>&#125;</span></span>
  <span></span>
  <span><span class=c># 10% chance of failure:</span></span>
  <span><span class=nf><a href=https://testthat.r-lib.org/reference/test_that.html>test_that</a></span><span class=o>(</span><span class=s>"my flaky test is ok"</span>, <span class=o>&#123;</span></span>
  <span>  <span class=nf><a href=https://testthat.r-lib.org/reference/skip.html>skip_on_cran</a></span><span class=o>(</span><span class=o>)</span></span>
  <span>  <span class=nf><a href=https://testthat.r-lib.org/reference/equality-expectations.html>expect_equal</a></span><span class=o>(</span><span class=nf>flaky_function</span><span class=o>(</span><span class=o>)</span>, <span class=m>1</span><span class=o>)</span></span>
  <span><span class=o>&#125;</span><span class=o>)</span></span>
  <span></span>
  <span><span class=c># 1% chance of failure:</span></span>
  <span><span class=nf><a href=https://testthat.r-lib.org/reference/test_that.html>test_that</a></span><span class=o>(</span><span class=s>"my flaky test is ok"</span>, <span class=o>&#123;</span></span>
  <span>  <span class=nf><a href=https://testthat.r-lib.org/reference/skip.html>skip_on_cran</a></span><span class=o>(</span><span class=o>)</span></span>
  <span>  <span class=nf><a href=https://testthat.r-lib.org/reference/try_again.html>try_again</a></span><span class=o>(</span><span class=m>1</span>, <span class=nf><a href=https://testthat.r-lib.org/reference/equality-expectations.html>expect_equal</a></span><span class=o>(</span><span class=nf>flaky_function</span><span class=o>(</span><span class=o>)</span>, <span class=m>1</span><span class=o>)</span><span class=o>)</span></span>
  <span><span class=o>&#125;</span><span class=o>)</span></span>
  <span></span>
  <span><span class=c># 0.1% chance of failure:</span></span>
  <span><span class=nf><a href=https://testthat.r-lib.org/reference/test_that.html>test_that</a></span><span class=o>(</span><span class=s>"my flaky test is ok"</span>, <span class=o>&#123;</span></span>
  <span>  <span class=nf><a href=https://testthat.r-lib.org/reference/skip.html>skip_on_cran</a></span><span class=o>(</span><span class=o>)</span></span>
  <span>  <span class=nf><a href=https://testthat.r-lib.org/reference/try_again.html>try_again</a></span><span class=o>(</span><span class=m>2</span>, <span class=nf><a href=https://testthat.r-lib.org/reference/equality-expectations.html>expect_equal</a></span><span class=o>(</span><span class=nf>flaky_function</span><span class=o>(</span><span class=o>)</span>, <span class=m>1</span><span class=o>)</span><span class=o>)</span></span>
  <span><span class=o>&#125;</span><span class=o>)</span></span></code></pre></div><p>Note that it&rsquo;s still good practice to skip such tests on CRAN.</p></li><li><p>New
<a href=https://testthat.r-lib.org/reference/skip.html target=_blank rel=noopener><code>skip_unless_r()</code></a> skips tests on unsuitable versions of R. It has a convenient syntax so you can use, e.g., <code>skip_unless_r(">= 4.1.0")</code> to skip tests that require
<a href=https://rdrr.io/r/base/dots.html target=_blank rel=noopener><code>...names()</code></a>.</p></li><li><p>New <code>SlowReporter</code> makes it easier to find the slowest tests in your package. You can run it with <code>devtools::test(reporter = "slow")</code>.</p></li><li><p>New <code>vignette("challenging-functions")</code> provides an index to other documentation organized by various challenges.</p></li></ul><h2 id=acknowledgements>Acknowledgements
<a href=#acknowledgements><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>A big thank you to all the folks who helped make this release happen:
<a href=https://github.com/3styleJam target=_blank rel=noopener>@3styleJam</a>,
<a href=https://github.com/afinez target=_blank rel=noopener>@afinez</a>,
<a href=https://github.com/andybeet target=_blank rel=noopener>@andybeet</a>,
<a href=https://github.com/atheriel target=_blank rel=noopener>@atheriel</a>,
<a href=https://github.com/averissimo target=_blank rel=noopener>@averissimo</a>,
<a href=https://github.com/d-morrison target=_blank rel=noopener>@d-morrison</a>,
<a href=https://github.com/DanChaltiel target=_blank rel=noopener>@DanChaltiel</a>,
<a href=https://github.com/DanielHermosilla target=_blank rel=noopener>@DanielHermosilla</a>,
<a href=https://github.com/eitsupi target=_blank rel=noopener>@eitsupi</a>,
<a href=https://github.com/EmilHvitfeldt target=_blank rel=noopener>@EmilHvitfeldt</a>,
<a href=https://github.com/emstruong target=_blank rel=noopener>@emstruong</a>,
<a href=https://github.com/gaborcsardi target=_blank rel=noopener>@gaborcsardi</a>,
<a href=https://github.com/gael-millot target=_blank rel=noopener>@gael-millot</a>,
<a href=https://github.com/hadley target=_blank rel=noopener>@hadley</a>,
<a href=https://github.com/hoeflerb target=_blank rel=noopener>@hoeflerb</a>,
<a href=https://github.com/jamesfowkes target=_blank rel=noopener>@jamesfowkes</a>,
<a href=https://github.com/jan-swissre target=_blank rel=noopener>@jan-swissre</a>,
<a href=https://github.com/jdblischak target=_blank rel=noopener>@jdblischak</a>,
<a href=https://github.com/jennybc target=_blank rel=noopener>@jennybc</a>,
<a href=https://github.com/jeroenjanssens target=_blank rel=noopener>@jeroenjanssens</a>,
<a href=https://github.com/kevinushey target=_blank rel=noopener>@kevinushey</a>,
<a href=https://github.com/krivit target=_blank rel=noopener>@krivit</a>,
<a href=https://github.com/kubajal target=_blank rel=noopener>@kubajal</a>,
<a href=https://github.com/lawalter target=_blank rel=noopener>@lawalter</a>,
<a href=https://github.com/m-muecke target=_blank rel=noopener>@m-muecke</a>,
<a href=https://github.com/maelle target=_blank rel=noopener>@maelle</a>,
<a href=https://github.com/math-mcshane target=_blank rel=noopener>@math-mcshane</a>,
<a href=https://github.com/mcol target=_blank rel=noopener>@mcol</a>,
<a href=https://github.com/metanoid target=_blank rel=noopener>@metanoid</a>,
<a href=https://github.com/MichaelChirico target=_blank rel=noopener>@MichaelChirico</a>,
<a href=https://github.com/moodymudskipper target=_blank rel=noopener>@moodymudskipper</a>,
<a href=https://github.com/njtierney target=_blank rel=noopener>@njtierney</a>,
<a href=https://github.com/nunotexbsd target=_blank rel=noopener>@nunotexbsd</a>,
<a href=https://github.com/pabangan target=_blank rel=noopener>@pabangan</a>,
<a href=https://github.com/pachadotdev target=_blank rel=noopener>@pachadotdev</a>,
<a href=https://github.com/plietar target=_blank rel=noopener>@plietar</a>,
<a href=https://github.com/schloerke target=_blank rel=noopener>@schloerke</a>,
<a href=https://github.com/schuemie target=_blank rel=noopener>@schuemie</a>,
<a href=https://github.com/sebkopf target=_blank rel=noopener>@sebkopf</a>,
<a href=https://github.com/shikokuchuo target=_blank rel=noopener>@shikokuchuo</a>,
<a href=https://github.com/snystrom target=_blank rel=noopener>@snystrom</a>,
<a href=https://github.com/stibu81 target=_blank rel=noopener>@stibu81</a>,
<a href=https://github.com/TimTaylor target=_blank rel=noopener>@TimTaylor</a>, and
<a href=https://github.com/tylermorganwall target=_blank rel=noopener>@tylermorganwall</a>.</p></div></div><div class=column25><div class="section hideOnMobile"><div class=sectionTitle>Contents</div><nav id=TableOfContents><ul><li><a href=#claude-code-experiences>Claude Code experiences</a></li><li><a href=#lifecycle-changes>Lifecycle changes</a></li><li><a href=#expectations-and-the-interactive-testing-experience>Expectations and the interactive testing experience</a></li><li><a href=#other-new-features>Other new features</a></li><li><a href=#acknowledgements>Acknowledgements</a></li></ul></nav></div><div class=section></div></div></div></div></div><div id=rStudioFooter class=band><div class=bandContent><div id=copyright>The tidyverse is proudly supported by <a class=rstudioLogo href=https://posit.co/ aria-label="Posit Homepage"></a></div><div id=logos><a href=https://www.tidyverse.org/google_privacy_policy>Privacy policy</a>
<a href=https://github.com/tidyverse class="footerLogo gitHub" aria-label="Tidyverse GitHub organization"></a><a href=https://twitter.com/hashtag/rstats class="footerLogo twitter" aria-label="rstats hashtag on twitter.com"></a></div></div></div></div></div><script src=/js/math-code.js></script><script type=text/x-mathjax-config>
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script><script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script type=application/javascript>var dnt=(navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack);var doNotTrack=(dnt=="1"||dnt=="yes");if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');if(window.sessionStorage){var GA_SESSION_STORAGE_KEY='ga:clientId';ga('create','UA-115082821-1',{'storage':'none','clientId':sessionStorage.getItem(GA_SESSION_STORAGE_KEY)});ga(function(tracker){sessionStorage.setItem(GA_SESSION_STORAGE_KEY,tracker.get('clientId'));});}
ga('set','anonymizeIp',true);ga('send','pageview');}</script></body></html></div></div></body></html>