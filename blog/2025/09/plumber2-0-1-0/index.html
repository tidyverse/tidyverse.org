<!doctype html><html><head><!doctype html><html lang=en-us><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/css/main-site.css><link rel=stylesheet href=/css/fa5-all.css><style type=text/css>body{background-color:#fff;color:#1a1917}a{color:#38577f}a:hover{color:#42709b}a:focus{outline-color:#42709b}.column25-left .sectionTitle a:hover:not(.current),.column16-left .sectionTitle a:hover:not(.current){color:#1a1917}.icon-attribution,.icon-attribution a{color:#1a1917;opacity:75%}#homeContent .band.first{background-color:#fff}#homeContent .band.second{background-color:#fdeba4}#homeContent .band.third{background-color:#fff}#rStudioHeader{background-color:#1a162d;color:#fff}#rStudioHeader .productName{color:#fff}#rStudioHeader .productName:hover,#rStudioHeader .productName:focus{color:#fdeba4}#rStudioHeader #menu .menuItem.a{background-color:#75aadb;color:#fff}#rStudioHeader #menu .menuItem:hover{background-color:#484557;color:#fff}#rStudioHeader #menu .menuItem.current{background-color:#fff;color:#1a162d;text-decoration:none}#rStudioFooter.band{background-color:#767381}#rStudioFooter .bandContent #copyright{color:#e3eef8}table tbody tr:nth-child(even){background-color:#f7faff}table tbody tr:nth-child(odd){background-color:#fff}.latest{border-top:.5em solid <no value>}.event{-moz-box-shadow:0 0 0 0 rgba(0,0,0,.1);-webkit-box-shadow:0 0 0 0 rgba(0,0,0,.1);box-shadow:0 0 0 0 rgba(0,0,0,.1)}.section .event{background-color:#eab0c41a}.section .event{border-top:7pt solid #a19ea936}.section .event a{color:#1a162d}.section .event{color:#404040}</style><link rel=stylesheet href=/css/tidyverse.css><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.71.1"><title>plumber2 0.1.0</title><meta property="og:title" content="plumber2 0.1.0"><meta property="og:description" content="plumber2, a complete rewrite of plumber, has landed on CRAN, providing a modern, future proof solution for creating web servers in R. Read all about the new features here."><meta property="og:type" content="article"><meta property="og:url" content="https://www.tidyverse.org/blog/2025/09/plumber2-0-1-0/"><meta property="twitter:card" content="summary_large_image"><meta property="og:title" content="plumber2 0.1.0 - Tidyverse"><meta property="description" content="plumber2, a complete rewrite of plumber, has landed on CRAN, providing a modern, future proof solution for creating web servers in R. Read all about the new features here."><meta property="og:description" content="plumber2, a complete rewrite of plumber, has landed on CRAN, providing a modern, future proof solution for creating web servers in R. Read all about the new features here."><meta property="og:image" content="https://www.tidyverse.org/blog/2025/09/plumber2-0-1-0/thumbnail-sq.jpg"><meta name=twitter:image content="https://www.tidyverse.org/blog/2025/09/plumber2-0-1-0/thumbnail-wd.jpg"><link rel=apple-touch-icon sizes=180x180 href=/images/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicons/favicon-16x16.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg><link rel="shortcut icon" href=/images/favicons/favicon.ico><meta name=msapplication-TileColor content="#da532c"><meta name=msapplication-config href=/images/favicons/browserconfig.xml><script type=text/javascript src=/js/jquery-3.5.1.min.js></script><script type=text/javascript src=/js/site.js></script><link rel=icon href=/images/favicon.ico><script type=text/javascript src=/js/clipboard.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin=anonymous></script><script defer data-domain=tidyverse.org,all.tidyverse.org src=https://plausible.io/js/plausible.js></script></head><body><div id=appTidyverseSite class="shrinkHeader alwaysShrinkHeader"><div id=main><div id=rStudioHeader><nav class=band><div class="innards bandContent"><div><a class=productName href=/>Tidyverse</a></div><div id=menu><div id=menuToggler></div><div id=menuItems><a class=menuItem href=/packages/>Packages</a>
<a class="menuItem current" href=/blog/>Blog</a>
<a class=menuItem href=/learn/>Learn</a>
<a class=menuItem href=/help/>Help</a>
<a class=menuItem href=/contribute/>Contribute</a></div></div></div></nav></div><main><div class="band padForHeader pushFooter"><div class=bandContent><div class="full splitColumns withMobileMargins"><div class=column75><h1 class=article-title>plumber2 0.1.0</h1><div class=article-header aria-hidden=true><div class=photo><img src=/blog/2025/09/plumber2-0-1-0/thumbnail-wd.jpg></div><div class=photoCredit>Photo by <a href=https://unsplash.com/photos/a-blue-pipe-laying-on-top-of-a-pile-of-dirt-MzPnzK3prTU>Rose Galloway Green</a></div></div><span class=article-date><i class="fas fa-calendar-day fa-fw"></i>&nbsp;&nbsp;2025/09/23</span><p style=margin-bottom:.5em;margin-top:.85em><i class="fas fa-tags"></i>&nbsp;
<a href=/tags/plumber2/>plumber2</a>,
<a href=/tags/web/>web</a></p><p style=margin-top:.5em><i class="fas fa-user-circle fa-fw"></i>&nbsp;
Thomas Lin Pedersen</p><div class=article-content><p>I&rsquo;m super excited to announce the release of the plumber2 package on CRAN. plumber2 is a package for creating webservers in R based on either an annotation-based or programmatic workflow. It is the successor to the plumber package who has empowered the R community for 10 years and allowed them to share their R based functionalities with their organizations and the world.</p><p>You can install it from CRAN with:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf>pak</span><span class=nf>::</span><span class=nf><a href=https://pak.r-lib.org/reference/pak.html>pak</a></span><span class=o>(</span><span class=s>"plumber2"</span><span class=o>)</span></span></code></pre></div><p>This blog post will go over the new release. Why create a new package? What has changed? What has stayed the same? and, What is new?</p><p>It&rsquo;s a mouthful, so let&rsquo;s get to it!</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=https://posit-dev.github.io/plumber2/>plumber2</a></span><span class=o>)</span></span></code></pre></div><h2 id=waving-goodbye-to-plumber>Waving goodbye to plumber
<a href=#waving-goodbye-to-plumber><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>The first question that may cross your mind is: Why even create a new package instead of continue to build on, and improve, the old one?</p><p>It is always a weighing of pros and cons when such a decision is made, but what largely tipped the scale was that the codebase had accrued so much technical debt that it had become hard to maintain. A lot has happened in 10 years and plumber has had to adapt to it all while maintaining backwards compatibility and in the end it took a toll on the codebase.</p><p>If you end up deciding on a rewrite you might as well take the opportunity to learn from past mistakes and shed some decisions that turned out wrong, without worrying about breaking existing code. This both gives you a chance to improve on the API, but also give you the freedom to create the best possible foundation without artificial boundaries based on existing uses.</p><p>So, in the end, we wanted a complete rewrite, and we wanted breaking changes. Instead of pulling the rug on users and break their deployments we chose to start afresh, leave the old plumber around, and allow users to gradually migrate to the new package.</p><h2 id=familiarity>Familiarity
<a href=#familiarity><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>If you fear that the decisions we outlined above means that you need to start from square one despite being a seasoned plumber user then fear not. plumber2 takes the soul of plumber and carries it on. Annotations are still central to how you use plumber2 and most of them work just as before. There are, however, foundational changes in store for you, so you will have to update some of your habits to suit a new (and better) world.</p><p>Let&rsquo;s start with the core of annotations, which is the parsing of them. In plumber this was handled by an internal parser which tried to mimic how roxygen2 parsed documentation annotation. This led to almost, but not quite, parity with roxygen2 which tripped up users. plumber2 now uses roxygen2 directly for parsing, so any convention you have become used to from writing package documentation can be transferred. Most important of these are support for multi-line annotation (hello 2025), and the conventions around the first line being the title as well as any text between that and the first tag being a long-form description.</p><p>Along with the move to using roxygen2 comes a well-defined way of extending the annotation API, so that other packages more easily can extend plumber2 in a way that feels native without resorting to any unpleasant hacks.</p><p>Enough talk. How does it look? Below you see an annotation for a <code>GET</code> endpoint written for plumber2:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=c>#* Get a weather forecast</span></span>
<span><span class=c>#* </span></span>
<span><span class=c>#* This endpoint will provide the client with a forecast for a </span></span>
<span><span class=c>#* specific city. You can modify the length of the forecast </span></span>
<span><span class=c>#* through the query parameters</span></span>
<span><span class=c>#* </span></span>
<span><span class=c>#* @get /forecast/&lt;city&gt;</span></span>
<span><span class=c>#*</span></span>
<span><span class=c>#*.@param city:string The city to query</span></span>
<span><span class=c>#* @query length:integer|1, 10|(7) How long a forecast</span></span>
<span><span class=c>#*</span></span>
<span><span class=c>#* @response 200:[&#123;day:date, temp:number, rain:boolean&#125;] An array </span></span>
<span><span class=c>#* of objects, each corresponding to a day</span></span>
<span><span class=c>#* </span></span>
<span><span class=c>#* @serializer json</span></span>
<span><span class=c>#* @serializer yaml</span></span>
<span><span class=c>#* </span></span>
<span><span class=kr>function</span><span class=o>(</span><span class=nv>city</span>, <span class=nv>query</span><span class=o>)</span> <span class=o>&#123;</span></span>
<span>  <span class=nf>get_forecast</span><span class=o>(</span><span class=nv>city</span>, <span class=nv>query</span><span class=o>$</span><span class=nv>length</span><span class=o>)</span></span>
<span><span class=o>&#125;</span></span></code></pre></div><p>If you are a plumber user I hope you can agree that it doesn&rsquo;t look totally foreign. Sure, there are new things in there but all of them in the same spirit as what you know. We have already mentioned the support for multi-lines and how the first lines until the first tag are parsed. The first line with a tag, <code>@get</code> is also straight out of the plumber book and so is the following <code>@param</code> line.</p><p>The <code>@query</code> line is new however (in multiple ways). In plumber2 function input can come from 3 places: path parameters (<code>city</code> in the above), the query string (<code>length</code> in the above), or the request body (not shown). This was true in plumber as well, but in plumber2 we have made the distinction explicit. Instead of using <code>@param</code> to document them all we now have dedicated tags for input coming from query and body (<code>@query</code> and <code>@body</code> respectively). This is also reflected in the function signature where only path parameters are provided directly as arguments. Query input is provided through the <code>query</code> argument and body input is provided through the <code>body</code> argument. This means that there is no longer the potential for masking out arguments if e.g. the query string contained an element with the same name as a path parameter. It also means that we can avoid parsing both the query string and the request body if it is not used by the handler function.</p><p>The <code>@query</code> line holds more surprises in the form of richer type annotation. Numbers and integers can now be bounded (here, between 1 and 10), and all input can be provided with a default value (here, 7). plumber2 does automatic input checking and type conversion based on this, and will return early with an error if an input is of the wrong format. There are also even more types to use. Enums, Dates, Datetimes, Bytes, and Patterns are all now possible, along with rich descriptions of objects (as can be seen in the <code>@response</code> line). All of these will be casted to the correct R type and can potentially be provided as arrays by enclosing them in <code>[...]</code>.</p><p>The <code>@response</code> tag is also available in plumber, but in plumber2 you can now annotate the return type as well, using the same type syntax as used for input. Doing so will allow the people using your API to now what kind of return value to expect which is critical to writing robust interfaces.</p><p>The last two annotations are both new an old. plumber had a <code>@serializer</code> tag as well, where you could specify a named serializer. This would then be used to convert the return value of your function into a string or binary representation to send back to the client. In plumber2 this is still the case, but what is new is the possibility of specifying multiples. In fact, the default is to use a collection of common serialization formats and let the client chose which they prefer through the <code>Content-Type</code> header (a process known as content negotiation). While not shown here, the same is true for the <code>@parser</code> tag which allows you to specify how the request body should be parsed into an R object. If content negotiation fails (on either side) plumber2 will send a structured error response to the client so they can see what goes wrong.</p><p>There are of course more to it (we will touch on a range of new tags below), but the above will probably cover 80% of use cases and hopefully that all feels very familiar.</p><h3 id=programmatic-interface>Programmatic interface
<a href=#programmatic-interface><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>While plumber2 promotes the use of annotations as a way to describe your webserver logic, it also provides a programmatic API that gives you all of the same abilities. In plumber, this api was prefixed with <code>pr_</code> which was a an acronym for &ldquo;Plumber Route&rdquo;. In plumber2, both to avoid namespace collision and because not all functions are concerned with creating routes, we use the <code>api_</code> prefix. Many functions in plumber have a counterpart in plumber2 but there has been made no attempt to ensure compatibility between arguments etc. Thus, if you have used the programmatic interface in plumber you may experience a bit more friction in moving over to plumber2. Consult the
<a href=https://plumber2.posit.co/reference/index.html target=_blank rel=noopener>extensive documentation</a> if you are in that boat.</p><h2 id=new-features>New features
<a href=#new-features><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>The rewrite has allowed us to add many new features which would either have been extremely cumbersome or downright unfeasible to add to plumber. While not exhaustive, the following will give you a taste of what is now possible</p><h3 id=multi-file-apis>Multi-file APIs
<a href=#multi-file-apis><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>With plumber2 you are no longer limited to a single file for describing your api. Multiple files can be passed into the constructor (
<a href=https://plumber2.posit.co/reference/api.html target=_blank rel=noopener><code>api()</code></a>) and by default they will each constitute a single route. This implies the plumber2 has support for multiple routes which will be tried in turn, which again implies full middleware support. This extended power replaces the filters and <code>@preempt</code> in plumber.</p><p>The properties of each plumber2 file can be modified with a few specific annotations that must (if present) appear at the top of the file, e.g.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=c>#* @routeName secondary_route</span></span>
<span><span class=c>#* @routeOrder 10</span></span>
<span><span class=c>#* @root /sub/path</span></span>
<span><span class=kc>NULL</span></span></code></pre></div><p>The above sets the name of the route (defaults to the file name), the position in the chain of routes (defaults to the order they are passed to the constructor), as well as provides a root which will be prepended to all endpoints defined in the file. If multiple files has the same <code>@routeName</code> they will be merged into the same route, so even if you only need a single layer of middleware, this is a great way to organize a web server implementation that has grown large.</p><h3 id=websocket-support>Websocket support
<a href=#websocket-support><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>While plumber was born as a way to create REST apis, the web is broader than that and sometimes your web server need to use additional technologies. WebSocket is a bidirectional communication layer that is initiated by the client and, once established, allows both the server and the client to send messages back and forth at any point in time. WebSockets is the technology that powers Shiny&rsquo; reactive capabilities so it is not new in the world of R, and plumber2 gives you access to both receive and send messages at your leisure.</p><p>You can add a websocket listener using the <code>@message</code> tag like so:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=c>#* @message</span></span>
<span><span class=kr>function</span><span class=o>(</span><span class=nv>message</span>, <span class=nv>client_id</span>, <span class=nv>server</span><span class=o>)</span> <span class=o>&#123;</span></span>
<span>  <span class=nf>cli</span><span class=nf>::</span><span class=nf><a href=https://cli.r-lib.org/reference/cli_abort.html>cli_inform</a></span><span class=o>(</span><span class=s>"WS message from &#123;client_id&#125;: &#123;message&#125;"</span><span class=o>)</span></span>
<span>  </span>
<span>  <span class=nv>server</span><span class=o>$</span><span class=nf>time</span><span class=o>(</span></span>
<span>    <span class=nv>server</span><span class=o>$</span><span class=nf>send</span><span class=o>(</span><span class=s>"We got your message, alright!"</span>, <span class=nv>client_id</span><span class=o>)</span>,</span>
<span>    after <span class=o>=</span> <span class=m>5</span></span>
<span>  <span class=o>)</span></span>
<span><span class=o>&#125;</span></span></code></pre></div><p>In the above we set up (a rather nonsensical) WebSocket logic which will log any incoming messages from a client and then, after 5 seconds have passed, send back a message to the client.</p><h3 id=async-evaluation>Async evaluation
<a href=#async-evaluation><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>plumber2 expands on the asynchronous evaluation supported in plumber. Like in plumber it is still possible to return a promise from a handler (both for HTTP and websocket handlers), which will then be evaluated asynchronously and, in the case of a HTTP handler, modify the response once done, before sending it back to the client. What is new is that standard handlers can be converted to asynchronous handlers automatically. All it takes is adding the <code>@async</code> tag to the annotation, and plumber2 takes care of the rest. The functionality is build upon
<a href=https://mirai.r-lib.org target=_blank rel=noopener>mirai</a>, which is a modern framework for async evaluation with very little overhead. However, it is extendible so if a new better framework comes along it is easy to add, either directly in plumber2 or in an extension package.</p><p>To convert the forecast endpoint from our first example into an asynchronous one we just have to add a single line:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=c>#* Get a weather forecast</span></span>
<span><span class=c>#* </span></span>
<span><span class=c>#* This endpoint will provide the client with a forecast for a </span></span>
<span><span class=c>#* specific city. You can modify the length of the forecast </span></span>
<span><span class=c>#* through the query parameters</span></span>
<span><span class=c>#* </span></span>
<span><span class=c>#* @get /forecast/&lt;city&gt;</span></span>
<span><span class=c>#*</span></span>
<span><span class=c>#*.@param city:string The city to query</span></span>
<span><span class=c>#* @query length:integer|1, 10|(7) How long a forecast</span></span>
<span><span class=c>#*</span></span>
<span><span class=c>#* @response 200:[&#123;day:date, temp:number, rain:boolean&#125;] An array </span></span>
<span><span class=c>#* of objects, each corresponding to a day</span></span>
<span><span class=c>#* </span></span>
<span><span class=c>#* @serializer json</span></span>
<span><span class=c>#* @serializer yaml</span></span>
<span><span class=c>#* </span></span>
<span><span class=c>#* @async</span></span>
<span><span class=kr>function</span><span class=o>(</span><span class=nv>city</span>, <span class=nv>query</span><span class=o>)</span> <span class=o>&#123;</span></span>
<span>  <span class=nf>get_forecast</span><span class=o>(</span><span class=nv>city</span>, <span class=nv>query</span><span class=o>$</span><span class=nv>length</span><span class=o>)</span></span>
<span><span class=o>&#125;</span></span></code></pre></div><p>Since async evaluation is happening in a different process they do not have access to the server object, nor the request and response object. All they can do is return a value which will be set to the response body. If you need to work with either of these objects you can chain a function call to the async one which will execute in the main process once the async expression has returned. You can do this by adding a <code>@then</code> block directly after the async one, e.g.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=c>#* ...</span></span>
<span><span class=c>#* of objects, each corresponding to a day</span></span>
<span><span class=c>#* </span></span>
<span><span class=c>#* @serializer json</span></span>
<span><span class=c>#* @serializer yaml</span></span>
<span><span class=c>#* </span></span>
<span><span class=c>#* @async</span></span>
<span><span class=kr>function</span><span class=o>(</span><span class=nv>city</span>, <span class=nv>query</span><span class=o>)</span> <span class=o>&#123;</span></span>
<span>  <span class=nf>get_forecast</span><span class=o>(</span><span class=nv>city</span>, <span class=nv>query</span><span class=o>$</span><span class=nv>length</span><span class=o>)</span></span>
<span><span class=o>&#125;</span></span>
<span><span class=c>#* @then</span></span>
<span><span class=kr>function</span><span class=o>(</span><span class=nv>result</span>, <span class=nv>response</span><span class=o>)</span> <span class=o>&#123;</span></span>
<span>  <span class=nv>response</span><span class=o>$</span><span class=nv>body</span> <span class=o>&lt;-</span> <span class=nv>result</span></span>
<span>  <span class=nv>response</span><span class=o>$</span><span class=nf>set_header</span><span class=o>(</span><span class=s>"cache-control"</span>, <span class=s>"max-age=86400"</span><span class=o>)</span></span>
<span>  <span class=nv>Next</span></span>
<span><span class=o>&#125;</span></span></code></pre></div><p>In the above we set the body to the result of the prior async expression (this would have happened automatically), then we add an additional header to the response which would have been otherwise impossible in the async expression and lastly we return the <code>Next</code> sentinel which signal that the request can move on to the next route/middleware.</p><h3 id=redirection-and-forwarding>Redirection and forwarding
<a href=#redirection-and-forwarding><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>Over the lifetime of a webserver you may end up cleaning up functionality or moving things around. If some functionality ends up at a different path your API will contain dead links unless you do something about it. plumber2 makes it easy to redirect requests to a new location so that users of the API can gracefully migrate to the new location without disruption.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=c>#* @redirect !get /old/data/* /new/data/*</span></span>
<span><span class=c>#* @redirect any /unstable/endpoint /stable/endpoint</span></span>
<span><span class=kc>NULL</span></span></code></pre></div><p>The above adds two different redirects. One is a permanent redirect (denoted by the <code>!</code> in front of the method). It redirects all <code>GET</code> requests from <code>/old/data/*</code> to <code>/new/data/*</code> be returning a <code>308</code> response directing the client to try the new location. The other is a temporary redirect which instead returns a <code>307</code> response.</p><p>You can use wildcards (as shown above) and path parameters in the redirection paths as long as they match between the old and new path (the new path can drop path parameters from old, but can&rsquo;t make up new ones).</p><p>Redirection goes through the client. The server responds with a <code>307</code>/<code>308</code> response that include the new location of the resource and it is up to the client to follow that to the final destination.</p><p>There is another kind of redirection, one that is invisible to the client, where the server forwards the request to another service and returns the response to the client once it receives it. This is called a reverse proxy. A reverse proxy can either forward a request to another service running locally, or to a service running on a separate server. Reverse proxying is implemented with the <code>@forward</code> tag:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=c>#* @forward /proxy http://127.0.0.1:56789</span></span>
<span><span class=c>#* @except /local</span></span>
<span><span class=kc>NULL</span></span></code></pre></div><p>The above sets up a reverse proxy that forwards requests made to <code>/proxy</code> to the service running locally on <code>http://127.0.0.1:56789</code>. It uses the <code>@except</code> tag to preclude requests to <code>/proxy/local/*</code> from being forwarded.</p><h3 id=shiny-support>Shiny support
<a href=#shiny-support><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>Build on top of the reverse proxy capabilities is support for launching and serving one or more shiny applications. The shiny applications are launched in another process and HTTP and WebSocket communication is forwarded to it. Once the plumber2 server stops the shiny applications are stopped as well. Launching a shiny application is very straightforward:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=c>#* @shiny /my_app/</span></span>
<span><span class=nf>shiny</span><span class=nf>::</span><span class=nf><a href=https://rdrr.io/pkg/shiny/man/shinyApp.html>shinyAppDir</a></span><span class=o>(</span><span class=s>"./shiny"</span><span class=o>)</span></span></code></pre></div><p>You use the <code>@shiny</code> tag and provide the path from where you want to serve the shiny app, then, below the annotation where the handler would normally be, you provide a shiny app object.</p><p>You can also use the <code>@except</code> tag here meaning that it is e.g. possible to serve a shiny app from the root, but e.g. let requests to <code>/api/*</code> fall through and be handled by plumber2:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=c>#* @shiny /</span></span>
<span><span class=c>#* @except /api</span></span>
<span><span class=nf>shiny</span><span class=nf>::</span><span class=nf><a href=https://rdrr.io/pkg/shiny/man/shinyApp.html>shinyAppDir</a></span><span class=o>(</span><span class=s>"./frontend"</span><span class=o>)</span></span>
<span></span>
<span><span class=c>#* @get /api</span></span>
<span><span class=c>#* ...</span></span>
<span><span class=kr>function</span><span class=o>(</span><span class=nv>...</span><span class=o>)</span> <span class=o>&#123;</span></span>
<span>  <span class=nv>...</span></span>
<span><span class=o>&#125;</span></span></code></pre></div><h3 id=serving-quarto-and-rmarkdown-documents>Serving Quarto and Rmarkdown documents
<a href=#serving-quarto-and-rmarkdown-documents><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>In the same vein as serving shiny applications, plumber2 also allows you to easily serve quarto or rmarkdown documents. The syntax for this follows that of the shiny functionality closely</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=c>#* @report /quarterly_report</span></span>
<span><span class=s>"./reports/my_amazing_report.qmd"</span></span></code></pre></div><p>You provide the path to serve the report from with the <code>@report</code> tag and then points to the quarto (or rmarkdown) file below the block. If you have a parameterized report you can pass in parameters through the query string, and if your report provides multiple output formats the client can choose between them, either through content negotiation or be appending the correct file extension to the url (e.g. requesting <code>/quarterly_report.pdf</code> in the above will render a PDF version and requesting <code>/quarterly_report.html</code> will render to HTML). Reports are cached so they are only rendered when needed.</p><h3 id=persistent-data-storage>Persistent data storage
<a href=#persistent-data-storage><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>Keeping state between requests to a server can be done in multiple ways. Of course a REST api does away completely with state so if you follow that then it is simply not needed. But not everything is RESTful and sometimes state is required. In plumber, this could be done through an encrypted session cookie. This cookie was passed back and forth at every request ensuring that the same data was available at repeat visits. This is still possible in plumber2 through the <code>session</code> field of the request and response object. However, as noted in the plumber documentation as well, this approach comes with certain downsides. First, the need to pass the data back and forth at every request limits how much data can feasibly be stored. Second, the use of a cookie means that e.g. websocket logic will not have access to the data. Lastly, sending it back and forth is a security liability even if encrypted. If someone got hold of your encryption key they could eavesdrop on everything going on between the server and client.</p><p>The alternative is to keep all the data on the server, in a persistent cross-session way. To that end plumber2 provides a persistent datastore build on the
<a href=https://richfitz.github.io/storr/ target=_blank rel=noopener>storr</a> package. storr provides a unified frontend for a variety of different data stores, such as redis, postgresql, LMDB etc. Neither storr nor plumber2 takes care of setting up the data store so the onus for that is still on the developer. However, once setup plumber2 automatically provides a global and a client-scoped key-value store accessible for handlers.</p><p>The data store cannot be set up through annotations but uses the programmatic interface. However, this can be mixed in with annotations in a <code>@plumber</code> block. Below is an example of setting it up as well as using it in a handler</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=c>#* @plumber</span></span>
<span><span class=kr>function</span><span class=o>(</span><span class=nv>api</span><span class=o>)</span> <span class=o>&#123;</span></span>
<span>  <span class=nv>api</span> <span class=o>|&gt;</span> </span>
<span>    <span class=nf>api_datastore</span><span class=o>(</span><span class=nf>storr</span><span class=nf>::</span><span class=nf><a href=https://richfitz.github.io/storr/reference/storr_environment.html>driver_environment</a></span><span class=o>(</span><span class=o>)</span><span class=o>)</span></span>
<span><span class=o>&#125;</span></span>
<span></span>
<span><span class=c>#* Example of using the datastore</span></span>
<span><span class=c>#* </span></span>
<span><span class=c>#* @get /hello</span></span>
<span><span class=c>#* </span></span>
<span><span class=kr>function</span><span class=o>(</span><span class=nv>datastore</span><span class=o>)</span> <span class=o>&#123;</span></span>
<span>  <span class=kr>if</span> <span class=o>(</span><span class=nf><a href=https://rdrr.io/r/base/length.html>length</a></span><span class=o>(</span><span class=nv>datastore</span><span class=o>$</span><span class=nv>session</span><span class=o>)</span> <span class=o>==</span> <span class=m>0</span><span class=o>)</span> <span class=o>&#123;</span></span>
<span>    <span class=nv>datastore</span><span class=o>$</span><span class=nv>global</span><span class=o>$</span><span class=nv>count</span> <span class=o>&lt;-</span> <span class=o>(</span><span class=nv>datastore</span><span class=o>$</span><span class=nv>global</span><span class=o>$</span><span class=nv>count</span> <span class=o><a href=https://rdrr.io/r/base/Control.html>%||%</a></span> <span class=m>0</span><span class=o>)</span> <span class=o>+</span> <span class=m>1</span></span>
<span>    <span class=nv>datastore</span><span class=o>$</span><span class=nv>session</span><span class=o>$</span><span class=nv>not_first_visit</span> <span class=o>&lt;-</span> <span class=kc>TRUE</span></span>
<span>    <span class=nf><a href=https://rdrr.io/r/base/paste.html>paste0</a></span><span class=o>(</span><span class=s>"Welcome. You are visitor #"</span>, <span class=nv>datastore</span><span class=o>$</span><span class=nv>global</span><span class=o>$</span><span class=nv>count</span><span class=o>)</span></span>
<span>  <span class=o>&#125;</span> <span class=kr>else</span> <span class=o>&#123;</span></span>
<span>    <span class=s>"Welcome back"</span></span>
<span>  <span class=o>&#125;</span></span>
<span><span class=o>&#125;</span></span></code></pre></div><p>Above we set up a datastore based on an R environment. This is of course not a scalable solution but is easy to use for trying things out. The <code>api_datastore()</code> most importantly takes a driver argument which is a storr compliant driver, as well as a number of other configurations that all have sensible defaults. After activating the datastore a new argument will be available in the handlers (the name defaults to <code>datastore</code> but can be changed). This argument contains two elements: <code>global</code> and <code>session</code>. Both of these are list-like interfaces to the underlying datastore and allows you to read and write data, either to the global store or one scoped to the current session.</p><h3 id=security>Security
<a href=#security><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>Whenever you opens up a server to the rest of the world, security should be a concern. This is both true for servers only used internally, but even more so for servers that communicate with the world wide web. plumber2 sets out to be a huge improvement over plumber in this regard. While no amount of tooling can substitute good understanding of the various attack vectors possible on the web, they can make it more ergonomic to have sensible security measures.</p><p>The key takeaway from the above is that the following functionality doesn&rsquo;t negate the need for a security professional if your organization exposes a server to the web, but they can make said security professional more happy in their day-to-day work.</p><h4 id=security-headers>Security headers
<a href=#security-headers><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h4><p>A plumber2 API will predominantly use the HTTP protocol to communicate with the client. Over the cause of the internets existence there have been a cat-and-mouse game going on between bad actors that wish to scam or otherwise harm users, and the people developing the internet into being a safe experience. A lot of the improvements to security have been implemented as specific HTTP headers where the server opt into certain behavior that is safer for the client. plumber2 provides an easy way to set these headers and provides good sensible defaults as well.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>pa</span> <span class=o>&lt;-</span> <span class=nf><a href=https://plumber2.posit.co/reference/api.html>api</a></span><span class=o>(</span><span class=o>)</span> <span class=o>|&gt;</span> </span>
<span>  <span class=nf>api_security_headers</span><span class=o>(</span><span class=o>)</span></span></code></pre></div><p>There are a lot of different headers being set by the above code. Some of it is only relevant if you serve HTML, while other is relevant predominantly if you are serving other assets. Some of it may even stop your web server from working properly because it gets too restricted. The golden path to walk is as tight settings as possible without breaking the api, so always start with tight settings and then gradually relax it (or find alternative ways to implement it) until things work.</p><h4 id=cors>CORS
<a href=#cors><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h4><p>CORS (Cross Origin Resource Sharing) is a way to allow sharing of content across domains, something that is otherwise restricted for safety. If you host your API on one domain and tries to access it from another domain you need to allow CORS. In plumber2 this is fairly straightforward using the <code>@cors</code> tag:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=c>#* Get a weather forecast</span></span>
<span><span class=c>#* </span></span>
<span><span class=c>#* This endpoint will provide the client with a forecast for a </span></span>
<span><span class=c>#* specific city. You can modify the length of the forecast </span></span>
<span><span class=c>#* through the query parameters</span></span>
<span><span class=c>#* </span></span>
<span><span class=c>#* @get /forecast/&lt;city&gt;</span></span>
<span><span class=c>#* </span></span>
<span><span class=c>#* @cors https://my-trusted-weather-app.com</span></span>
<span><span class=c>#* </span></span>
<span><span class=c>#* ...</span></span></code></pre></div><p>Continuing our weather forecast app from before, if we wish to allow a secondary app to use the api, we will need to turn on CORS and allow it for the domain (here, <code>https://my-trusted-weather-app.com</code>). This is easily done with the <code>@cors</code> tag as can be seen above.</p><h4 id=resource-isolation-policies>Resource Isolation Policies
<a href=#resource-isolation-policies><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h4><p>RIP (Resource Isolation Policies) is another way of ensuring that resources from your server is not used by other sites. It is build upon the <code>Sec-Fetch-*</code> suite of request headers and allow you to block a request at the server level if it does not come from a trusted place or is being used for a valid reason. RIP can be configured much like CORS using the <code>@rip</code> tag.</p><h2 id=future>Future
<a href=#future><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>So, plumber2 is here, it is great, and it contains a bunch of new stuff. What now?</p><p>Well, if you are already using plumber I hope you are excited. But, there is no rush. plumber will stay on CRAN in a superseded state and all your servers will continue to work. We hope you&rsquo;ll take part in kicking the tires on plumber2 however, so that it can get some milage under its belt.</p><p>If you haven&rsquo;t used plumber but still managed to reach this point of the blog post I think it is fair to assume that you are quite interested in creating web servers. Welcome! plumber2 will hopefully be a joyful experience for you but we can&rsquo;t wait to learn where it could be even easier to use for a newcomer.</p><p>If you do maintain packages that build on top of plumber, I hope you&rsquo;ll consider augmenting those to also work with plumber2. plumber2 has been build with extensibility in mind so hopefully you&rsquo;ll feel empowered to make your tools even more amazing. If you do come across things that are hard, or impossible, to extend, let us know so we may look into it.</p><p>Happy plumbing!</p></div></div><div class=column25><div class="section hideOnMobile"><div class=sectionTitle>Contents</div><nav id=TableOfContents><ul><li><a href=#waving-goodbye-to-plumber>Waving goodbye to plumber</a></li><li><a href=#familiarity>Familiarity</a></li><li><a href=#new-features>New features</a></li><li><a href=#future>Future</a></li></ul></nav></div><div class=section></div></div></div></div></div><div id=rStudioFooter class=band><div class=bandContent><div id=copyright>The tidyverse is proudly supported by <a class=rstudioLogo href=https://posit.co/ aria-label="Posit Homepage"></a></div><div id=logos><a href=https://www.tidyverse.org/google_privacy_policy>Privacy policy</a>
<a href=https://github.com/tidyverse class="footerLogo gitHub" aria-label="Tidyverse GitHub organization"></a><a href=https://twitter.com/hashtag/rstats class="footerLogo twitter" aria-label="rstats hashtag on twitter.com"></a></div></div></div></div></div><script src=/js/math-code.js></script><script type=text/x-mathjax-config>
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script><script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script type=application/javascript>var dnt=(navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack);var doNotTrack=(dnt=="1"||dnt=="yes");if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');if(window.sessionStorage){var GA_SESSION_STORAGE_KEY='ga:clientId';ga('create','UA-115082821-1',{'storage':'none','clientId':sessionStorage.getItem(GA_SESSION_STORAGE_KEY)});ga(function(tracker){sessionStorage.setItem(GA_SESSION_STORAGE_KEY,tracker.get('clientId'));});}
ga('set','anonymizeIp',true);ga('send','pageview');}</script></body></html></div></div></body></html>