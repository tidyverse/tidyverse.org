<!doctype html><html><head><!doctype html><html lang=en-us><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/css/main-site.css><link rel=stylesheet href=/css/fa5-all.css><style type=text/css>body{background-color:#fff;color:#1a1917}a{color:#38577f}a:hover{color:#42709b}a:focus{outline-color:#42709b}.column25-left .sectionTitle a:hover:not(.current),.column16-left .sectionTitle a:hover:not(.current){color:#1a1917}.icon-attribution,.icon-attribution a{color:#1a1917;opacity:75%}#homeContent .band.first{background-color:#fff}#homeContent .band.second{background-color:#fdeba4}#homeContent .band.third{background-color:#fff}#rStudioHeader{background-color:#1a162d;color:#fff}#rStudioHeader .productName{color:#fff}#rStudioHeader .productName:hover,#rStudioHeader .productName:focus{color:#fdeba4}#rStudioHeader #menu .menuItem.a{background-color:#75aadb;color:#fff}#rStudioHeader #menu .menuItem:hover{background-color:#484557;color:#fff}#rStudioHeader #menu .menuItem.current{background-color:#fff;color:#1a162d;text-decoration:none}#rStudioFooter.band{background-color:#767381}#rStudioFooter .bandContent #copyright{color:#e3eef8}table tbody tr:nth-child(even){background-color:#f7faff}table tbody tr:nth-child(odd){background-color:#fff}.latest{border-top:.5em solid <no value>}.event{-moz-box-shadow:0 0 0 0 rgba(0,0,0,.1);-webkit-box-shadow:0 0 0 0 rgba(0,0,0,.1);box-shadow:0 0 0 0 rgba(0,0,0,.1)}.section .event{background-color:#eab0c41a}.section .event{border-top:7pt solid #a19ea936}.section .event a{color:#1a162d}.section .event{color:#404040}</style><link rel=stylesheet href=/css/tidyverse.css><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.71.1"><title>magrittr 2.0 is coming soon</title><meta property="og:title" content="magrittr 2.0 is coming soon"><meta property="og:description" content="A new version of the magrittr package brings laziness, better performance, and leaner backtraces for debugging errors."><meta property="og:type" content="article"><meta property="og:url" content="https://www.tidyverse.org/blog/2020/08/magrittr-2-0/"><meta property="twitter:card" content="summary_large_image"><meta property="og:title" content="magrittr 2.0 is coming soon - Tidyverse"><meta property="description" content="A new version of the magrittr package brings laziness, better performance, and leaner backtraces for debugging errors."><meta property="og:description" content="A new version of the magrittr package brings laziness, better performance, and leaner backtraces for debugging errors."><meta property="og:image" content="https://www.tidyverse.org/blog/2020/08/magrittr-2-0/thumbnail-sq.jpg"><meta name=twitter:image content="https://www.tidyverse.org/blog/2020/08/magrittr-2-0/thumbnail-wd.jpg"><link rel=apple-touch-icon sizes=180x180 href=/images/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicons/favicon-16x16.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg><link rel="shortcut icon" href=/images/favicons/favicon.ico><meta name=msapplication-TileColor content="#da532c"><meta name=msapplication-config href=/images/favicons/browserconfig.xml><script type=text/javascript src=/js/jquery-3.5.1.min.js></script><script type=text/javascript src=/js/site.js></script><link rel=icon href=/images/favicon.ico><script type=text/javascript src=/js/clipboard.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin=anonymous></script><script defer data-domain=tidyverse.org,all.tidyverse.org src=https://plausible.io/js/plausible.js></script></head><body><div id=appTidyverseSite class="shrinkHeader alwaysShrinkHeader"><div id=main><div id=rStudioHeader><nav class=band><div class="innards bandContent"><div><a class=productName href=/%20/>Tidyverse</a></div><div id=menu><div id=menuToggler></div><div id=menuItems><a class=menuItem href=/packages/>Packages</a>
<a class="menuItem current" href=/blog/>Blog</a>
<a class=menuItem href=/learn/>Learn</a>
<a class=menuItem href=/help/>Help</a>
<a class=menuItem href=/contribute/>Contribute</a></div></div></div></nav></div><main><div class="band padForHeader pushFooter"><div class=bandContent><div class="full splitColumns withMobileMargins"><div class=column75><h1 class=article-title>magrittr 2.0 is coming soon</h1><div class=article-header aria-hidden=true><div class=photo><img src=/blog/2020/08/magrittr-2-0/thumbnail-wd.jpg></div><div class=photoCredit>Photo by <a href=https://unsplash.com/photos/X-NAMq6uP3Q>Mike Benna</a></div></div><span class=article-date><i class="fas fa-calendar-day fa-fw"></i>&nbsp;&nbsp;2020/08/26</span></p><p style=margin-top:.5em><i class="fas fa-user-circle fa-fw"></i>&nbsp;
Lionel Henry</p><div class=article-content><div class=highlight></div><p>It is with unclouded composure that we announce the upcoming release of
<a href=https://magrittr.tidyverse.org/ target=_blank rel=noopener>magrittr</a> 2.0. magrittr is the package home to the
<a href=https://magrittr.tidyverse.org/reference/pipe.html target=_blank rel=noopener><code>%>%</code></a> pipe operator written by Stefan Milton Bache and used throughout the tidyverse.</p><p>This last and likely final version of magrittr resolves the longstanding issues of overhead and backtrace footprint. It also makes the magrittr pipe more compatible with a native pipe that will probably be included in the next version of R.</p><p>This version of magrittr has been completely rewritten in C to give better backtraces and much improved performance. It also uses a different approach in order to support laziness. This enables new uses of the pipe, and ensures magrittr is as similar as possible to the future base pipe. Our analysis and testing suggests that the new version should be a drop-in replacement, but we&rsquo;d really like you to try it out and give us some feedback before we submit to CRAN. You can install the development version from GitHub with:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=c># install.packages("remotes")</span>
<span class=nf>remotes</span><span class=nf>::</span><span class=nf><a href=https://remotes.r-lib.org/reference/install_github.html>install_github</a></span><span class=o>(</span><span class=s>"tidyverse/magrittr"</span><span class=o>)</span>
</code></pre></div><p>If you discover any issues, please let us know by posting issues on the
<a href=https://github.com/tidyverse/magrittr target=_blank rel=noopener>Github repository</a> of magrittr.</p><p>This blog post covers the three main changes in this new version of the magrittr pipe.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=http://magrittr.tidyverse.org>magrittr</a></span><span class=o>)</span>
</code></pre></div><p><strong>Update 2020-09-22:</strong> Some minor issues have arised from the first round of beta testing (see note on visibility and laziness below). We postponed the release to late October to give more time for potential further issues to surface before publication of magrittr 2.0 to CRAN.</p><h2 id=backtraces>Backtraces
<a href=#backtraces><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>The R implementation of the magrittr pipe was rather costly in terms of backtrace clutter. This made it difficult to debug errors with functions using the pipe:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nv>foo</span> <span class=o>&lt;-</span> <span class=kr>function</span><span class=o>(</span><span class=o>)</span> <span class=nf><a href=https://rdrr.io/r/grDevices/plotmath.html>bar</a></span><span class=o>(</span><span class=o>)</span>
<span class=nv>bar</span> <span class=o>&lt;-</span> <span class=kr>function</span><span class=o>(</span><span class=o>)</span> <span class=m>1</span> <span class=o>%&gt;%</span> <span class=nf><a href=https://rdrr.io/r/base/identity.html>identity</a></span><span class=o>(</span><span class=o>)</span> <span class=o>%&gt;%</span> <span class=nf>baz</span><span class=o>(</span><span class=o>)</span>
<span class=nv>baz</span> <span class=o>&lt;-</span> <span class=kr>function</span><span class=o>(</span><span class=nv>x</span><span class=o>)</span> <span class=nf>rlang</span><span class=nf>::</span><span class=nf><a href=https://rlang.r-lib.org/reference/abort.html>abort</a></span><span class=o>(</span><span class=s>"oh no"</span><span class=o>)</span>

<span class=nf>foo</span><span class=o>(</span><span class=o>)</span>
<span class=c>#&gt; Error: oh no</span>

<span class=nf>rlang</span><span class=nf>::</span><span class=nf><a href=https://rlang.r-lib.org/reference/last_error.html>last_trace</a></span><span class=o>(</span><span class=o>)</span>
<span class=c>#&gt; &lt;error/rlang_error&gt;</span>
<span class=c>#&gt; oh no</span>
<span class=c>#&gt; Backtrace:</span>
<span class=c>#&gt;      █</span>
<span class=c>#&gt;   1. └─global::foo()</span>
<span class=c>#&gt;   2.   └─global::bar()</span>
<span class=c>#&gt;   3.     └─1 %&gt;% identity() %&gt;% baz()</span>
<span class=c>#&gt;   4.       ├─base::withVisible(eval(quote(`_fseq`(`_lhs`)), env, env))</span>
<span class=c>#&gt;   5.       └─base::eval(quote(`_fseq`(`_lhs`)), env, env)</span>
<span class=c>#&gt;   6.         └─base::eval(quote(`_fseq`(`_lhs`)), env, env)</span>
<span class=c>#&gt;   7.           └─`_fseq`(`_lhs`)</span>
<span class=c>#&gt;   8.             └─magrittr::freduce(value, `_function_list`)</span>
<span class=c>#&gt;   9.               ├─base::withVisible(function_list[[k]](value))</span>
<span class=c>#&gt;  10.               └─function_list[[k]](value)</span>
<span class=c>#&gt;  11.                 └─global::baz(.)</span>
</code></pre></div><p>This clutter is now completely resolved:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>foo</span><span class=o>(</span><span class=o>)</span>
<span class=c>#&gt; Error: oh no</span>

<span class=nf>rlang</span><span class=nf>::</span><span class=nf><a href=https://rlang.r-lib.org/reference/last_error.html>last_trace</a></span><span class=o>(</span><span class=o>)</span>
<span class=c>#&gt; &lt;error/rlang_error&gt;</span>
<span class=c>#&gt; oh no</span>
<span class=c>#&gt; Backtrace:</span>
<span class=c>#&gt;     █</span>
<span class=c>#&gt;  1. ├─global::foo()</span>
<span class=c>#&gt;  2. │ └─global::bar()</span>
<span class=c>#&gt;  3. │   └─1 %&gt;% identity() %&gt;% baz()</span>
<span class=c>#&gt;  4. └─global::baz(.)</span>
</code></pre></div><h2 id=speed>Speed
<a href=#speed><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>The pipe is now written in C to improve the performance. Here is a benchmark for the old R implementation:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nv>f1</span> <span class=o>&lt;-</span> <span class=kr>function</span><span class=o>(</span><span class=nv>x</span><span class=o>)</span> <span class=nv>x</span>
<span class=nv>f2</span> <span class=o>&lt;-</span> <span class=kr>function</span><span class=o>(</span><span class=nv>x</span><span class=o>)</span> <span class=nv>x</span>
<span class=nv>f3</span> <span class=o>&lt;-</span> <span class=kr>function</span><span class=o>(</span><span class=nv>x</span><span class=o>)</span> <span class=nv>x</span>
<span class=nv>f4</span> <span class=o>&lt;-</span> <span class=kr>function</span><span class=o>(</span><span class=nv>x</span><span class=o>)</span> <span class=nv>x</span>

<span class=nf>bench</span><span class=nf>::</span><span class=nf><a href=http://bench.r-lib.org/reference/mark.html>mark</a></span><span class=o>(</span>
  `1` <span class=o>=</span> <span class=kc>NULL</span> <span class=o>%&gt;%</span> <span class=nf>f1</span><span class=o>(</span><span class=o>)</span>,
  `2` <span class=o>=</span> <span class=kc>NULL</span> <span class=o>%&gt;%</span> <span class=nf>f1</span><span class=o>(</span><span class=o>)</span> <span class=o>%&gt;%</span> <span class=nf>f2</span><span class=o>(</span><span class=o>)</span>,
  `3` <span class=o>=</span> <span class=kc>NULL</span> <span class=o>%&gt;%</span> <span class=nf>f1</span><span class=o>(</span><span class=o>)</span> <span class=o>%&gt;%</span> <span class=nf>f2</span><span class=o>(</span><span class=o>)</span> <span class=o>%&gt;%</span> <span class=nf>f3</span><span class=o>(</span><span class=o>)</span>,
  `4` <span class=o>=</span> <span class=kc>NULL</span> <span class=o>%&gt;%</span> <span class=nf>f1</span><span class=o>(</span><span class=o>)</span> <span class=o>%&gt;%</span> <span class=nf>f2</span><span class=o>(</span><span class=o>)</span> <span class=o>%&gt;%</span> <span class=nf>f3</span><span class=o>(</span><span class=o>)</span> <span class=o>%&gt;%</span> <span class=nf>f4</span><span class=o>(</span><span class=o>)</span>,
<span class=o>)</span>
<span class=c>#&gt;   expression     min  median `itr/sec` mem_alloc `gc/sec` n_itr  n_gc</span>
<span class=c>#&gt;   &lt;bch:expr&gt; &lt;bch:t&gt; &lt;bch:t&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;</span>
<span class=c>#&gt; 1 1           59.4µs  68.9µs    13648.      280B     59.1  6004    26</span>
<span class=c>#&gt; 2 2           82.6µs 101.6µs     9252.      280B     42.8  3894    18</span>
<span class=c>#&gt; 3 3          106.4µs 124.7µs     7693.      280B     18.8  3690     9</span>
<span class=c>#&gt; 4 4          130.9µs 156.1µs     6173.      280B     18.8  2956     9</span>
</code></pre></div><p>The new implementation is less costly, especially with many pipe expressions:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>bench</span><span class=nf>::</span><span class=nf><a href=http://bench.r-lib.org/reference/mark.html>mark</a></span><span class=o>(</span>
  `1` <span class=o>=</span> <span class=kc>NULL</span> <span class=o>%&gt;%</span> <span class=nf>f1</span><span class=o>(</span><span class=o>)</span>,
  `2` <span class=o>=</span> <span class=kc>NULL</span> <span class=o>%&gt;%</span> <span class=nf>f1</span><span class=o>(</span><span class=o>)</span> <span class=o>%&gt;%</span> <span class=nf>f2</span><span class=o>(</span><span class=o>)</span>,
  `3` <span class=o>=</span> <span class=kc>NULL</span> <span class=o>%&gt;%</span> <span class=nf>f1</span><span class=o>(</span><span class=o>)</span> <span class=o>%&gt;%</span> <span class=nf>f2</span><span class=o>(</span><span class=o>)</span> <span class=o>%&gt;%</span> <span class=nf>f3</span><span class=o>(</span><span class=o>)</span>,
  `4` <span class=o>=</span> <span class=kc>NULL</span> <span class=o>%&gt;%</span> <span class=nf>f1</span><span class=o>(</span><span class=o>)</span> <span class=o>%&gt;%</span> <span class=nf>f2</span><span class=o>(</span><span class=o>)</span> <span class=o>%&gt;%</span> <span class=nf>f3</span><span class=o>(</span><span class=o>)</span> <span class=o>%&gt;%</span> <span class=nf>f4</span><span class=o>(</span><span class=o>)</span>,
<span class=o>)</span>
<span class=c>#&gt;   expression      min   median `itr/sec` mem_alloc `gc/sec` n_itr  n_gc</span>
<span class=c>#&gt;   &lt;bch:expr&gt; &lt;bch:tm&gt; &lt;bch:tm&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;</span>
<span class=c>#&gt; 1 1            2.16µs   3.11µs   306145.        0B     61.2  9998     2</span>
<span class=c>#&gt; 2 2            2.68µs   3.85µs   246869.        0B     74.1  9997     3</span>
<span class=c>#&gt; 3 3            3.22µs   4.55µs   207548.        0B     83.1  9996     4</span>
<span class=c>#&gt; 4 4            3.88µs   5.25µs   180807.        0B     72.4  9996     4</span>
</code></pre></div><p>We don&rsquo;t generally except this to have much impact on typical data analysis code, but it might yield meaningful speed ups if you are using the pipe inside very tight loops.</p><h2 id=laziness>Laziness
<a href=#laziness><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>R core has expressed their interest in adding a native pipe in the next version of R and are working on an implementation<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>. The main user-visible change in this release makes magrittr more compatible with the behaviour of the base pipe by evaluating the expressions lazily, only when needed.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nv>ignore_arguments</span> <span class=o>&lt;-</span> <span class=kr>function</span><span class=o>(</span><span class=nv>...</span><span class=o>)</span> <span class=s>"value"</span>

<span class=kr><a href=https://rdrr.io/r/base/stop.html>stop</a></span><span class=o>(</span><span class=s>"foo"</span><span class=o>)</span> <span class=o>%&gt;%</span> <span class=nf>ignore_arguments</span><span class=o>(</span><span class=o>)</span>

<span class=c>#&gt; [1] "value"</span>
</code></pre></div><p>This has subtle implications but should be backward compatible with existing pipelines that run without error. The main source of behaviour change is that some code that previously failed may stop failing if the latter part of the pipeline specifically handled the error.</p><p>Similarly, warnings that were previously issued might now be suppressed by a function you&rsquo;re piping into. That&rsquo;s because the following expressions are now almost completely equivalent:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=c># Piped</span>
<span class=kr><a href=https://rdrr.io/r/base/warning.html>warning</a></span><span class=o>(</span><span class=s>"foo"</span><span class=o>)</span> <span class=o>%&gt;%</span> <span class=nf><a href=https://rdrr.io/r/base/warning.html>suppressWarnings</a></span><span class=o>(</span><span class=o>)</span>

<span class=c># Nested</span>
<span class=nf><a href=https://rdrr.io/r/base/warning.html>suppressWarnings</a></span><span class=o>(</span><span class=kr><a href=https://rdrr.io/r/base/warning.html>warning</a></span><span class=o>(</span><span class=s>"foo"</span><span class=o>)</span><span class=o>)</span>
</code></pre></div><p>Thanks to this change, you will now be able to pipe into testthat error expectations, for instance:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=http://testthat.r-lib.org>testthat</a></span><span class=o>)</span> <span class=o>%&gt;%</span>
  <span class=nf><a href=https://rdrr.io/r/base/message.html>suppressMessages</a></span><span class=o>(</span><span class=o>)</span>

<span class=o>{</span> <span class=m>1</span> <span class=o>+</span> <span class=s>"a"</span> <span class=o>}</span> <span class=o>%&gt;%</span>
  <span class=nf><a href=https://testthat.r-lib.org/reference/expect_error.html>expect_error</a></span><span class=o>(</span><span class=s>"non-numeric argument"</span><span class=o>)</span>
</code></pre></div><p>Note that one consequence of having a lazy pipe is that the whole pipeline will be shown on the call stack before any errors are thrown:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nv>f1</span> <span class=o>&lt;-</span> <span class=kr>function</span><span class=o>(</span><span class=nv>x</span><span class=o>)</span> <span class=nv>x</span>
<span class=nv>f2</span> <span class=o>&lt;-</span> <span class=kr>function</span><span class=o>(</span><span class=nv>x</span><span class=o>)</span> <span class=nv>x</span>
<span class=nv>f3</span> <span class=o>&lt;-</span> <span class=kr>function</span><span class=o>(</span><span class=nv>x</span><span class=o>)</span> <span class=nv>x</span>
<span class=nv>f4</span> <span class=o>&lt;-</span> <span class=kr>function</span><span class=o>(</span><span class=nv>x</span><span class=o>)</span> <span class=nv>x</span>

<span class=kr><a href=https://rdrr.io/r/base/stop.html>stop</a></span><span class=o>(</span><span class=s>"oh no"</span><span class=o>)</span> <span class=o>%&gt;%</span> <span class=nf>f1</span><span class=o>(</span><span class=o>)</span> <span class=o>%&gt;%</span> <span class=nf>f2</span><span class=o>(</span><span class=o>)</span> <span class=o>%&gt;%</span> <span class=nf>f3</span><span class=o>(</span><span class=o>)</span> <span class=o>%&gt;%</span> <span class=nf>f4</span><span class=o>(</span><span class=o>)</span>
<span class=c>#&gt; Error in f1(.) : oh no</span>

<span class=nf>rlang</span><span class=nf>::</span><span class=nf><a href=https://rlang.r-lib.org/reference/last_error.html>last_trace</a></span><span class=o>(</span><span class=o>)</span>
<span class=c>#&gt; &lt;error/rlang_error&gt;</span>
<span class=c>#&gt; oh no</span>
<span class=c>#&gt; Backtrace:</span>
<span class=c>#&gt;     █</span>
<span class=c>#&gt;  1. ├─stop("oh no") %&gt;% f1() %&gt;% f2() %&gt;% f3() %&gt;% f4()</span>
<span class=c>#&gt;  2. ├─global::f4(.)</span>
<span class=c>#&gt;  3. ├─global::f3(.)</span>
<span class=c>#&gt;  4. ├─global::f2(.)</span>
<span class=c>#&gt;  5. └─global::f1(.)</span>
</code></pre></div><p>The last function of the pipeline is <code>f4()</code>, so that&rsquo;s the first one to be run. It evaluates its argument which is provided by <code>f3()</code>, so that&rsquo;s the second function pushed on the stack. And so on until <code>f1()</code> needs the result of
<a href=https://rdrr.io/r/base/stop.html target=_blank rel=noopener><code>stop("oh no")</code></a> which causes an error.</p><p><strong>Update 2020-09-22:</strong> Another issue caused by laziness is that if any function in a pipeline returns invisibly, than the whole pipeline returns invisibly as well.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=m>1</span> <span class=o>%&gt;%</span> <span class=nf>identity</span><span class=p>()</span> <span class=o>%&gt;%</span> <span class=nf>invisible</span><span class=p>()</span>
<span class=m>1</span> <span class=o>%&gt;%</span> <span class=nf>invisible</span><span class=p>()</span> <span class=o>%&gt;%</span> <span class=nf>identity</span><span class=p>()</span>
<span class=m>1</span> <span class=o>%&gt;%</span> <span class=nf>identity</span><span class=p>()</span> <span class=o>%&gt;%</span> <span class=nf>invisible</span><span class=p>()</span> <span class=o>%&gt;%</span> <span class=nf>identity</span><span class=p>()</span>
</code></pre></div><p>This is consistent with the equivalent nested code. This behaviour can be worked around in two ways. You can force visibility by wrapping the pipeline in parentheses:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=n>my_function</span> <span class=o>&lt;-</span> <span class=nf>function</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=p>{</span>
  <span class=p>(</span><span class=n>x</span> <span class=o>%&gt;%</span> <span class=nf>invisible</span><span class=p>()</span> <span class=o>%&gt;%</span> <span class=nf>identity</span><span class=p>())</span>
<span class=p>}</span>
</code></pre></div><p>Or by assigning the result to a variable and return it:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=n>my_function</span> <span class=o>&lt;-</span> <span class=nf>function</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=p>{</span>
  <span class=n>out</span> <span class=o>&lt;-</span> <span class=n>x</span> <span class=o>%&gt;%</span> <span class=nf>invisible</span><span class=p>()</span> <span class=o>%&gt;%</span> <span class=nf>identity</span><span class=p>()</span>
  <span class=n>out</span>
<span class=p>}</span>
</code></pre></div><h2 id=towards-a-release>Towards a release
<a href=#towards-a-release><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Though we have changed the behaviour of the pipe, there should be no impact on your user code. The laziness makes it possible to use the pipe in more situations but is not any stricter. It should only cause problems in very rare corner cases and these should be minor. To confirm our analysis, we ran reverse dependency checks for magrittr, purrr, tidyr, dplyr, and tidymodels. Only a dozen out of the 2800 packages were broken by the new implementation, and fixing them is generally easy (see the breaking changes section of the
<a href=https://github.com/tidyverse/magrittr/blob/master/NEWS.md target=_blank rel=noopener>NEWS file</a>).</p><p><strong>Update 2020-09-22:</strong> The issue you&rsquo;re most likely to encounter is that using
<a href=https://rdrr.io/r/base/function.html target=_blank rel=noopener><code>return()</code></a> inside <code>{</code> inside
<a href=https://magrittr.tidyverse.org/reference/pipe.html target=_blank rel=noopener><code>%>%</code></a> is no longer supported. If you do this, you will see this error:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=m>1</span> <span class=o>%&gt;%</span> <span class=o>{</span>
  <span class=kr>if</span> <span class=o>(</span><span class=nv>.</span> <span class=o>&gt;</span> <span class=m>0</span><span class=o>)</span> <span class=o>{</span>
    <span class=kr><a href=https://rdrr.io/r/base/function.html>return</a></span><span class=o>(</span><span class=nv>.</span><span class=o>)</span>
  <span class=o>}</span>
  <span class=nv>.</span> <span class=o>+</span> <span class=m>1</span>
<span class=o>}</span>

<span class=c>#&gt; Error in 1 %&gt;% {: no function to return from, jumping to top level</span>
</code></pre></div><p>Despite these few corner cases, we are confident that this release should be seamless for the vast majority of users. But, to be extra sure, we&rsquo;d be grateful for any additional testing on real-life scripts with this development version. Please let us know of any issues you find with this new version of the pipe, if any.</p><p>Finally, if you&rsquo;re interested in the design tradeoffs involved in the creation of a pipe operator in R, see the
<a href=https://magrittr.tidyverse.org/articles/tradeoffs.html target=_blank rel=noopener>tradeoffs</a> vignette. Any comments about the choices we have made are welcome.</p><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>See Luke Tierney&rsquo;s
<a href="https://youtu.be/X_eDHNVceCU?t=3099" target=_blank rel=noopener>keynote</a> at the useR! 2020 conference <a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></div></div><div class=column25><div class="section hideOnMobile"><div class=sectionTitle>Contents</div><nav id=TableOfContents><ul><li><a href=#backtraces>Backtraces</a></li><li><a href=#speed>Speed</a></li><li><a href=#laziness>Laziness</a></li><li><a href=#towards-a-release>Towards a release</a></li></ul></nav></div><div class=section></div></div></div></div></div><div id=rStudioFooter class=band><div class=bandContent><div id=copyright>The tidyverse is proudly supported by <a class=rstudioLogo href=https://posit.co/ aria-label="Posit Homepage"></a></div><div id=logos><a href=https://www.tidyverse.org/google_privacy_policy>Privacy policy</a>
<a href=https://github.com/tidyverse class="footerLogo gitHub" aria-label="Tidyverse GitHub organization"></a><a href=https://twitter.com/hashtag/rstats class="footerLogo twitter" aria-label="rstats hashtag on twitter.com"></a></div></div></div></div></div><script type=application/javascript>var dnt=(navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack);var doNotTrack=(dnt=="1"||dnt=="yes");if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');if(window.sessionStorage){var GA_SESSION_STORAGE_KEY='ga:clientId';ga('create','UA-115082821-1',{'storage':'none','clientId':sessionStorage.getItem(GA_SESSION_STORAGE_KEY)});ga(function(tracker){sessionStorage.setItem(GA_SESSION_STORAGE_KEY,tracker.get('clientId'));});}
ga('set','anonymizeIp',true);ga('send','pageview');}</script></body></html></div></div></body></html>