<!doctype html><html><head><!doctype html><html lang=en-us><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/css/main-site.css><link rel=stylesheet href=/css/fa5-all.css><style type=text/css>body{background-color:#fff;color:#1a1917}a{color:#38577f}a:hover{color:#42709b}a:focus{outline-color:#42709b}.column25-left .sectionTitle a:hover:not(.current),.column16-left .sectionTitle a:hover:not(.current){color:#1a1917}.icon-attribution,.icon-attribution a{color:#1a1917;opacity:75%}#homeContent .band.first{background-color:#fff}#homeContent .band.second{background-color:#fdeba4}#homeContent .band.third{background-color:#fff}#rStudioHeader{background-color:#1a162d;color:#fff}#rStudioHeader .productName{color:#fff}#rStudioHeader .productName:hover,#rStudioHeader .productName:focus{color:#fdeba4}#rStudioHeader #menu .menuItem.a{background-color:#75aadb;color:#fff}#rStudioHeader #menu .menuItem:hover{background-color:#484557;color:#fff}#rStudioHeader #menu .menuItem.current{background-color:#fff;color:#1a162d;text-decoration:none}#rStudioFooter.band{background-color:#767381}#rStudioFooter .bandContent #copyright{color:#e3eef8}table tbody tr:nth-child(even){background-color:#f7faff}table tbody tr:nth-child(odd){background-color:#fff}.latest{border-top:.5em solid <no value>}.event{-moz-box-shadow:0 0 0 0 rgba(0,0,0,.1);-webkit-box-shadow:0 0 0 0 rgba(0,0,0,.1);box-shadow:0 0 0 0 rgba(0,0,0,.1)}.section .event{background-color:#eab0c41a}.section .event{border-top:7pt solid #a19ea936}.section .event a{color:#1a162d}.section .event{color:#404040}</style><link rel=stylesheet href=/css/tidyverse.css><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.71.1"><title>Updates to ragg and systemfonts</title><meta property="og:title" content="Updates to ragg and systemfonts"><meta property="og:description" content="We have recently updated some of our low-level graphics packages. Read on 
about what is new in ragg and systemfonts"><meta property="og:type" content="article"><meta property="og:url" content="https://www.tidyverse.org/blog/2020/05/updates-to-ragg-and-systemfonts/"><meta property="twitter:card" content="summary_large_image"><meta property="og:title" content="Updates to ragg and systemfonts - Tidyverse"><meta property="description" content="We have recently updated some of our low-level graphics packages. Read on 
about what is new in ragg and systemfonts"><meta property="og:description" content="We have recently updated some of our low-level graphics packages. Read on 
about what is new in ragg and systemfonts"><meta property="og:image" content="https://www.tidyverse.org/blog/2020/05/updates-to-ragg-and-systemfonts/updates-to-ragg-and-systemfonts-sq.jpg"><meta name=twitter:image content="https://www.tidyverse.org/blog/2020/05/updates-to-ragg-and-systemfonts/updates-to-ragg-and-systemfonts-wd.jpg"><link rel=apple-touch-icon sizes=180x180 href=/images/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicons/favicon-16x16.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg><link rel="shortcut icon" href=/images/favicons/favicon.ico><meta name=msapplication-TileColor content="#da532c"><meta name=msapplication-config href=/images/favicons/browserconfig.xml><script type=text/javascript src=/js/jquery-3.5.1.min.js></script><script type=text/javascript src=/js/site.js></script><link rel=icon href=/images/favicon.ico><script type=text/javascript src=/js/clipboard.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin=anonymous></script><script defer data-domain=tidyverse.org,all.tidyverse.org src=https://plausible.io/js/plausible.js></script></head><body><div id=appTidyverseSite class="shrinkHeader alwaysShrinkHeader"><div id=main><div id=rStudioHeader><nav class=band><div class="innards bandContent"><div><a class=productName href=/%20/>Tidyverse</a></div><div id=menu><div id=menuToggler></div><div id=menuItems><a class=menuItem href=/packages/>Packages</a>
<a class="menuItem current" href=/blog/>Blog</a>
<a class=menuItem href=/learn/>Learn</a>
<a class=menuItem href=/help/>Help</a>
<a class=menuItem href=/contribute/>Contribute</a></div></div></div></nav></div><main><div class="band padForHeader pushFooter"><div class=bandContent><div class="full splitColumns withMobileMargins"><div class=column75><h1 class=article-title>Updates to ragg and systemfonts</h1><div class=article-header aria-hidden=true><div class=photo><img src=/blog/2020/05/updates-to-ragg-and-systemfonts/updates-to-ragg-and-systemfonts-wd.jpg></div><div class=photoCredit>Photo by <a href=https://unsplash.com/photos/BVyNlchWqzs>Amador Loureiro</a></div></div><span class=article-date><i class="fas fa-calendar-day fa-fw"></i>&nbsp;&nbsp;2020/05/15</span><p style=margin-bottom:.5em;margin-top:.85em><i class="fas fa-tags"></i>&nbsp;
<a href=/tags/ragg/>ragg</a>,
<a href=/tags/systemfonts/>systemfonts</a></p><p style=margin-top:.5em><i class="fas fa-user-circle fa-fw"></i>&nbsp;
Thomas Lin Pedersen</p><div class=article-content><p>We&rsquo;re thrilled to announce the new releases of ragg and systemfonts. ragg is a package that provides a modern set of raster devices as alternatives to the ones you know from the grDevices package (e.g. <code>png()</code>). systemfonts is a low level package that provides font-related utilities to graphic devices, most importantly detecting and matching fonts to the correct font files across systems.</p><p>While these are not the most flashy of releases, we thought it would be a good time to discuss some of our thoughts on the future of graphics in R, especially related to fonts.</p><h2 id=ragg-020>ragg 0.2.0
<a href=#ragg-020><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>ragg is our take on a modern set of raster devices for R, based based on the AGG 2D graphics library which provides both
<a href=https://ragg.r-lib.org/articles/ragg_quality.html target=_blank rel=noopener>high quality</a> and
<a href=https://ragg.r-lib.org/articles/ragg_performance.html target=_blank rel=noopener>high performance</a> output (you can read more about it in
<a href=https://www.tidyverse.org/blog/2019/07/ragg-0-1-0/ target=_blank rel=noopener>the 0.1.0 release post</a>). It also provides high quality font support and automatically finds fonts installed on your computer.</p><p>This release has resolved many rendering bugs and include one major new features: the addition of a jpeg device (<code>agg_jpeg()</code>) that produces jpegs. jpeg is a lossy image format (i.e. it decreases the image quality to reduce file size) as opposed to png which uses a lossless compression scheme. That means that jpeg is usually not the best choice for most R graphics, but it does excel in compressing image data, so for this type of plot it can offer a very high compression with almost no noticeable degradation in quality:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>library</span><span class=p>(</span><span class=n>ragg</span><span class=p>)</span>
<span class=c1>#&gt; Warning: package &#39;ragg&#39; was built under R version 3.6.2</span>
<span class=nf>library</span><span class=p>(</span><span class=n>fs</span><span class=p>)</span>
<span class=c1>#&gt; Warning: package &#39;fs&#39; was built under R version 3.6.2</span>

<span class=c1># Creating some image data</span>
<span class=nf>library</span><span class=p>(</span><span class=n>ambient</span><span class=p>)</span>
<span class=nf>library</span><span class=p>(</span><span class=n>dplyr</span><span class=p>)</span>
<span class=n>noise</span> <span class=o>&lt;-</span> <span class=nf>long_grid</span><span class=p>(</span>
    <span class=n>x</span> <span class=o>=</span> <span class=nf>seq</span><span class=p>(</span><span class=m>0</span><span class=p>,</span> <span class=m>1</span><span class=p>,</span> <span class=n>length.out</span> <span class=o>=</span> <span class=m>2000</span><span class=p>),</span> 
    <span class=n>y</span> <span class=o>=</span> <span class=nf>seq</span><span class=p>(</span><span class=m>0</span><span class=p>,</span> <span class=m>1</span><span class=p>,</span> <span class=n>length.out</span> <span class=o>=</span> <span class=m>2000</span><span class=p>)</span>
  <span class=p>)</span> <span class=o>%&gt;%</span> <span class=nf>mutate</span><span class=p>(</span>
    <span class=n>z</span> <span class=o>=</span> <span class=nf>fracture</span><span class=p>(</span>
      <span class=n>noise</span> <span class=o>=</span> <span class=n>gen_worley</span><span class=p>,</span> 
      <span class=n>fractal</span> <span class=o>=</span> <span class=n>billow</span><span class=p>,</span> 
      <span class=n>octaves</span> <span class=o>=</span> <span class=m>4</span><span class=p>,</span> 
      <span class=n>gain</span> <span class=o>=</span> <span class=o>~</span> <span class=n>.x</span> <span class=o>*</span> <span class=m>0.75</span><span class=p>,</span>
      <span class=n>frequency</span> <span class=o>=</span> <span class=o>~</span> <span class=n>.x</span> <span class=o>*</span> <span class=m>3</span><span class=p>,</span>
      <span class=n>x</span> <span class=o>=</span> <span class=n>x</span><span class=p>,</span> 
      <span class=n>y</span> <span class=o>=</span> <span class=n>y</span><span class=p>,</span>
      <span class=n>value</span> <span class=o>=</span> <span class=s>&#34;distance&#34;</span><span class=p>,</span>
      <span class=n>seed</span> <span class=o>=</span> <span class=m>12</span>
    <span class=p>)</span>
  <span class=p>)</span>

<span class=c1># plot using png</span>
<span class=n>pngfile</span> <span class=o>&lt;-</span> <span class=nf>path</span><span class=p>(</span><span class=n>knitr</span><span class=o>::</span><span class=nf>fig_path</span><span class=p>(),</span>  <span class=s>&#34;png_image.png&#34;</span><span class=p>)</span>
<span class=nf>agg_png</span><span class=p>(</span><span class=n>pngfile</span><span class=p>,</span> <span class=m>2000</span><span class=p>,</span> <span class=m>2000</span><span class=p>)</span>
<span class=nf>plot</span><span class=p>(</span><span class=n>noise</span><span class=p>,</span> <span class=n>z</span><span class=p>)</span>
<span class=nf>invisible</span><span class=p>(</span><span class=nf>dev.off</span><span class=p>())</span>
<span class=n>knitr</span><span class=o>::</span><span class=nf>include_graphics</span><span class=p>(</span><span class=n>pngfile</span><span class=p>)</span>
</code></pre></div><p><img src=figs/unnamed-chunk-1-1/png_image.png width=700px style=display:block;margin:auto></p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=c1># plot using jpeg</span>
<span class=n>jpegfile</span> <span class=o>&lt;-</span> <span class=nf>path</span><span class=p>(</span><span class=n>knitr</span><span class=o>::</span><span class=nf>fig_path</span><span class=p>(),</span>  <span class=s>&#34;jpeg_image.jpeg&#34;</span><span class=p>)</span>
<span class=nf>agg_jpeg</span><span class=p>(</span><span class=n>jpegfile</span><span class=p>,</span> <span class=m>2000</span><span class=p>,</span> <span class=m>2000</span><span class=p>)</span>
<span class=nf>plot</span><span class=p>(</span><span class=n>noise</span><span class=p>,</span> <span class=n>z</span><span class=p>)</span>
<span class=nf>invisible</span><span class=p>(</span><span class=nf>dev.off</span><span class=p>())</span>

<span class=n>knitr</span><span class=o>::</span><span class=nf>include_graphics</span><span class=p>(</span><span class=n>jpegfile</span><span class=p>)</span>
</code></pre></div><p><img src=figs/unnamed-chunk-2-1/jpeg_image.jpeg width=700px style=display:block;margin:auto></p><p>As you can hopefully agree on, there is no noticeable quality difference between the two. What about file size?</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>file_size</span><span class=p>(</span><span class=n>pngfile</span><span class=p>)</span>
<span class=c1>#&gt; 944K</span>
<span class=nf>file_size</span><span class=p>(</span><span class=n>jpegfile</span><span class=p>)</span>
<span class=c1>#&gt; 387K</span>
</code></pre></div><p>We observe more than a 50% file size reduction. Again, this is only worth it when saving image-type plots with high-frequency variations. <code>agg_png()</code> should be your go-to device for most data visualizations.</p><h2 id=systemfonts-020>systemfonts 0.2.0
<a href=#systemfonts-020><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>systemfonts is a package that spun out of the development of ragg. Its main claim-to-fame is its ability to find the correct font file for a specific font and style. This release has improved a lot of the underlying implementation and added a bunch of new features that may interest you.</p><h3 id=why-is-text-so-hard>Why is text so hard?
<a href=#why-is-text-so-hard><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>Before we delve into the features of systemfonts it may be good to understand why fonts don&rsquo;t just work. At its core text and fonts are just very messy, with differences between operating systems and font file formats to name some of the challenges. (For a humorous overview consult the
<a href=https://gankra.github.io/blah/text-hates-you/ target=_blank rel=noopener><em>Text Rendering Hates You</em></a>).</p><p>There are simply so many issues related to how finding the font files, reading the content, figuring out the correct glyphs for a character string, and determining the correct position of each glyph, that most applications use high-level solutions such as those provided by the operating system or e.g.
<a href=https://www.pango.org target=_blank rel=noopener>Pango</a>. This is not really an option for graphic devices as text is used in many other ways than the standard &ldquo;text box&rdquo; use that the high-level solutions are tailored to. All-in-all this makes it rather difficult to do fully correct text rendering on graphics device.</p><h3 id=new-features>New features
<a href=#new-features><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>The core functionality of systemfonts (finding font files) has been expanded with this release. It now makes heavy use of caching to speed up the font queries that may happen many hundreds of times for a single plot. This gives a nice speed boost, but comes at a cost: if a font is installed while your R session is running, you&rsquo;ll need to explicitly run <code>systemfonts::reset_font_cache()</code> in order to flush the cache.</p><p>systemfonts has also gained the ability to register fonts that are not installed in the usual place so that e.g. packages can provide a new set of fonts. This is done with the <code>register_font()</code> function. The font registration can also be used to get access to fonts that are not easily targeted with the limited information you can pass through the graphic engine in R (family, bold-or-not, italic-or-not), or if you want to overwrite the system-specific mappings of <code>'sans'</code>, <code>'serif'</code>, and <code>'mono'</code>.</p><p>Apart from font file matching, systemfonts now also provides the basic infrastructure for text shaping, that is, figuring out the placement of glyphs on a page, taking size, kerning, etc. into account. It further provides efficient functions for calculating string widths and glyph dimensions, something needed if you choose to implement a graphic device.</p><p>The text shaping, font information, and glyph metrics are available from R, although the intended use is primarily from C:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>library</span><span class=p>(</span><span class=n>systemfonts</span><span class=p>)</span>
<span class=c1>#&gt; Warning: package &#39;systemfonts&#39; was built under R version 3.6.2</span>

<span class=nf>font_info</span><span class=p>(</span><span class=n>family</span> <span class=o>=</span> <span class=s>&#34;spectral&#34;</span><span class=p>)</span>
<span class=c1>#&gt; # A tibble: 1 x 22</span>
<span class=c1>#&gt;   path  index family style italic bold  monospace kerning color scalable</span>
<span class=c1>#&gt;   &lt;chr&gt; &lt;int&gt; &lt;chr&gt;  &lt;chr&gt; &lt;lgl&gt;  &lt;lgl&gt; &lt;lgl&gt;     &lt;lgl&gt;   &lt;lgl&gt; &lt;lgl&gt;   </span>
<span class=c1>#&gt; 1 /Sys…     0 Helve… Regu… FALSE  FALSE FALSE     FALSE   FALSE TRUE    </span>
<span class=c1>#&gt; # … with 12 more variables: vertical &lt;lgl&gt;, n_glyphs &lt;int&gt;, n_sizes &lt;int&gt;,</span>
<span class=c1>#&gt; #   n_charmaps &lt;int&gt;, bbox &lt;list&gt;, max_ascend &lt;dbl&gt;, max_descend &lt;dbl&gt;,</span>
<span class=c1>#&gt; #   max_advance_width &lt;dbl&gt;, max_advance_height &lt;dbl&gt;, lineheight &lt;dbl&gt;,</span>
<span class=c1>#&gt; #   underline_pos &lt;dbl&gt;, underline_size &lt;dbl&gt;</span>
</code></pre></div><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>glyph_info</span><span class=p>(</span><span class=s>&#34;glyphs&#34;</span><span class=p>,</span> <span class=n>family</span> <span class=o>=</span> <span class=s>&#34;spectral&#34;</span><span class=p>,</span> <span class=n>size</span> <span class=o>=</span> <span class=m>14</span><span class=p>)</span>
<span class=c1>#&gt; # A tibble: 6 x 9</span>
<span class=c1>#&gt;   glyph index width height x_bearing y_bearing x_advance y_advance bbox     </span>
<span class=c1>#&gt;   &lt;chr&gt; &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;list&gt;   </span>
<span class=c1>#&gt; 1 g        74     7     10         0         7         8         0 &lt;dbl [4]&gt;</span>
<span class=c1>#&gt; 2 l        79     3     10         0        10         3         0 &lt;dbl [4]&gt;</span>
<span class=c1>#&gt; 3 y        92     7     10         0         7         7         0 &lt;dbl [4]&gt;</span>
<span class=c1>#&gt; 4 p        83     8     10         0         7         8         0 &lt;dbl [4]&gt;</span>
<span class=c1>#&gt; 5 h        75     7     10         0        10         8         0 &lt;dbl [4]&gt;</span>
<span class=c1>#&gt; 6 s        86     7      7         0         7         7         0 &lt;dbl [4]&gt;</span>
</code></pre></div><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=n>text</span> <span class=o>&lt;-</span> <span class=nf>c</span><span class=p>(</span>
  <span class=s>&#34;This is an example of the current text shaping engine build in to systemfonts. It does automatic text wrapping and support advanced layout features such as first-line and hanging indent. It also support setting &#34;</span><span class=p>,</span>
  <span class=s>&#34;tracking&#34;</span><span class=p>,</span>
  <span class=s>&#34; on some word and generally mixing text with different &#34;</span><span class=p>,</span>
  <span class=s>&#34;fonts, &#34;</span><span class=p>,</span>
  <span class=s>&#34;sizes,&#34;</span><span class=p>,</span> 
  <span class=s>&#34; and styles.&#34;</span>
<span class=p>)</span> 
<span class=n>family</span> <span class=o>&lt;-</span> <span class=nf>c</span><span class=p>(</span>
  <span class=s>&#39;charter&#39;</span><span class=p>,</span> 
  <span class=s>&#39;charter&#39;</span><span class=p>,</span> 
  <span class=s>&#39;charter&#39;</span><span class=p>,</span> 
  <span class=s>&#39;exo 2&#39;</span><span class=p>,</span> 
  <span class=s>&#39;charter&#39;</span><span class=p>,</span> 
  <span class=s>&#39;charter&#39;</span>
<span class=p>)</span>
<span class=n>italic</span> <span class=o>&lt;-</span>  <span class=nf>c</span><span class=p>(</span><span class=nf>rep</span><span class=p>(</span><span class=kc>FALSE</span><span class=p>,</span> <span class=m>5</span><span class=p>),</span> <span class=kc>TRUE</span><span class=p>)</span>
<span class=n>bold</span> <span class=o>&lt;-</span> <span class=nf>c</span><span class=p>(</span><span class=nf>rep</span><span class=p>(</span><span class=kc>FALSE</span><span class=p>,</span> <span class=m>5</span><span class=p>),</span> <span class=kc>TRUE</span><span class=p>)</span>
<span class=n>style</span> <span class=o>&lt;-</span> <span class=nf>c</span><span class=p>(</span><span class=nf>rep</span><span class=p>(</span><span class=s>&#34;plain&#34;</span><span class=p>,</span> <span class=m>5</span><span class=p>),</span> <span class=s>&#34;bold.italic&#34;</span><span class=p>)</span>
<span class=n>size</span> <span class=o>&lt;-</span> <span class=nf>c</span><span class=p>(</span><span class=nf>rep</span><span class=p>(</span><span class=m>14</span><span class=p>,</span> <span class=m>4</span><span class=p>),</span> <span class=m>24</span><span class=p>,</span> <span class=m>14</span><span class=p>)</span>
<span class=n>shape</span> <span class=o>&lt;-</span> <span class=nf>shape_string</span><span class=p>(</span>
  <span class=n>text</span><span class=p>,</span> 
  <span class=n>id</span> <span class=o>=</span> <span class=m>1</span><span class=p>,</span> 
  <span class=n>family</span> <span class=o>=</span> <span class=n>family</span><span class=p>,</span>
  <span class=n>italic</span> <span class=o>=</span> <span class=n>italic</span><span class=p>,</span>
  <span class=n>bold</span> <span class=o>=</span> <span class=n>bold</span><span class=p>,</span>
  <span class=n>size</span> <span class=o>=</span> <span class=n>size</span><span class=p>,</span>
  <span class=n>tracking</span> <span class=o>=</span> <span class=nf>c</span><span class=p>(</span><span class=m>0</span><span class=p>,</span> <span class=m>400</span><span class=p>,</span> <span class=nf>rep</span><span class=p>(</span><span class=m>0</span><span class=p>,</span> <span class=m>4</span><span class=p>)),</span>
  <span class=n>width</span> <span class=o>=</span> <span class=m>4.5</span><span class=p>,</span>
  <span class=n>indent</span> <span class=o>=</span> <span class=m>0.2</span><span class=p>,</span>
  <span class=n>hjust</span> <span class=o>=</span> <span class=m>0.5</span><span class=p>,</span>
  <span class=n>vjust</span> <span class=o>=</span> <span class=m>0.5</span><span class=p>,</span>
  <span class=n>res</span> <span class=o>=</span> <span class=m>300</span>
<span class=p>)</span>

<span class=n>shape</span>
<span class=c1>#&gt; $shape</span>
<span class=c1>#&gt; # A tibble: 299 x 7</span>
<span class=c1>#&gt;    glyph index metric_id string_id x_offset y_offset x_midpoint</span>
<span class=c1>#&gt;    &lt;chr&gt; &lt;int&gt;     &lt;int&gt;     &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;</span>
<span class=c1>#&gt;  1 &#34;T&#34;      55         1         1   -133.      47.7       4.2 </span>
<span class=c1>#&gt;  2 &#34;h&#34;      75         1         1   -125.      47.7       3.96</span>
<span class=c1>#&gt;  3 &#34;i&#34;      76         1         1   -117.      47.7       1.92</span>
<span class=c1>#&gt;  4 &#34;s&#34;      86         1         1   -113.      47.7       2.76</span>
<span class=c1>#&gt;  5 &#34; &#34;       3         1         1   -108.      47.7       1.92</span>
<span class=c1>#&gt;  6 &#34;i&#34;      76         1         1   -104.      47.7       1.92</span>
<span class=c1>#&gt;  7 &#34;s&#34;      86         1         1    -99.8     47.7       2.76</span>
<span class=c1>#&gt;  8 &#34; &#34;       3         1         1    -94.3     47.7       1.92</span>
<span class=c1>#&gt;  9 &#34;a&#34;      68         1         1    -90.5     47.7       3.48</span>
<span class=c1>#&gt; 10 &#34;n&#34;      81         1         1    -83.5     47.7       3.96</span>
<span class=c1>#&gt; # … with 289 more rows</span>
<span class=c1>#&gt; </span>
<span class=c1>#&gt; $metrics</span>
<span class=c1>#&gt; # A tibble: 1 x 11</span>
<span class=c1>#&gt;   string width height left_bearing right_bearing top_bearing bottom_bearing</span>
<span class=c1>#&gt;   &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;        &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;          &lt;dbl&gt;</span>
<span class=c1>#&gt; 1 This …  1350   582.           -1            15        13.8           1.02</span>
<span class=c1>#&gt; # … with 4 more variables: left_border &lt;dbl&gt;, top_border &lt;dbl&gt;, pen_x &lt;dbl&gt;,</span>
<span class=c1>#&gt; #   pen_y &lt;dbl&gt;</span>
</code></pre></div><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>library</span><span class=p>(</span><span class=n>grid</span><span class=p>)</span>

<span class=n>pngfile</span> <span class=o>&lt;-</span> <span class=nf>path</span><span class=p>(</span><span class=n>knitr</span><span class=o>::</span><span class=nf>fig_path</span><span class=p>(),</span>  <span class=s>&#34;png_image.png&#34;</span><span class=p>)</span>
<span class=nf>agg_png</span><span class=p>(</span><span class=n>pngfile</span><span class=p>,</span> <span class=m>6</span><span class=p>,</span> <span class=m>2.5</span><span class=p>,</span> <span class=n>unit</span> <span class=o>=</span> <span class=s>&#39;in&#39;</span><span class=p>,</span> <span class=n>res</span> <span class=o>=</span> <span class=m>300</span><span class=p>)</span>
<span class=c1>#&gt; Warning in agg_png(pngfile, 6, 2.5, unit = &#34;in&#34;, res = 300): partial argument</span>
<span class=c1>#&gt; match of &#39;unit&#39; to &#39;units&#39;</span>
<span class=nf>grid.text</span><span class=p>(</span>
  <span class=n>shape</span><span class=o>$</span><span class=n>shape</span><span class=o>$</span><span class=n>glyph</span><span class=p>,</span> 
  <span class=n>x</span> <span class=o>=</span> <span class=nf>unit</span><span class=p>(</span><span class=m>0.5</span><span class=p>,</span> <span class=s>&#34;npc&#34;</span><span class=p>)</span> <span class=o>+</span> <span class=nf>unit</span><span class=p>(</span><span class=n>shape</span><span class=o>$</span><span class=n>shape</span><span class=o>$</span><span class=n>x_offset</span><span class=p>,</span> <span class=s>&#34;pt&#34;</span><span class=p>),</span> 
  <span class=n>y</span> <span class=o>=</span> <span class=nf>unit</span><span class=p>(</span><span class=m>0.5</span><span class=p>,</span> <span class=s>&#34;npc&#34;</span><span class=p>)</span> <span class=o>+</span> <span class=nf>unit</span><span class=p>(</span><span class=n>shape</span><span class=o>$</span><span class=n>shape</span><span class=o>$</span><span class=n>y_offset</span><span class=p>,</span> <span class=s>&#34;pt&#34;</span><span class=p>),</span>
  <span class=n>hjust</span> <span class=o>=</span> <span class=m>0</span><span class=p>,</span>
  <span class=n>vjust</span> <span class=o>=</span> <span class=m>0</span><span class=p>,</span>
  <span class=n>gp</span> <span class=o>=</span> <span class=nf>gpar</span><span class=p>(</span>
    <span class=n>fontfamily</span> <span class=o>=</span> <span class=n>family[shape</span><span class=o>$</span><span class=n>shape</span><span class=o>$</span><span class=n>string_id]</span><span class=p>,</span>
    <span class=n>fontface</span> <span class=o>=</span> <span class=n>style[shape</span><span class=o>$</span><span class=n>shape</span><span class=o>$</span><span class=n>string_id]</span><span class=p>,</span>
    <span class=n>fontsize</span> <span class=o>=</span> <span class=n>size[shape</span><span class=o>$</span><span class=n>shape</span><span class=o>$</span><span class=n>string_id]</span>
  <span class=p>)</span>
<span class=p>)</span>
<span class=nf>invisible</span><span class=p>(</span><span class=nf>dev.off</span><span class=p>())</span>
<span class=n>knitr</span><span class=o>::</span><span class=nf>include_graphics</span><span class=p>(</span><span class=n>pngfile</span><span class=p>)</span>
</code></pre></div><p><img src=figs/unnamed-chunk-7-1/png_image.png width=700px style=display:block;margin:auto></p><p>When you see this you may immediately think of the work Claus Wilke has done with
<a href=https://wilkelab.org/gridtext/ target=_blank rel=noopener>gridtext</a>. We are both committed to improving the rich text support in R, and are attacking the problem from different directions. Claus has worked on doing per-word shaping, whereas the text shaping done in systemfonts are done glyph-by-glyph. Both approaches have their merits, and we are currently at a stage where we are trying to figure out how to best solve this in R. At the time of writing there is no doubt that gridtext is more complete and stable, but doing glyph-based shaping offers possibilities that are not possible with gridtext, e.g. setting tracking and flowing text along paths. All of this is highly experimental still, and there will need to be some changes in the graphic engine to make glyph-based rendering performant.</p><h3 id=the-font-ier>The font-ier
<a href=#the-font-ier><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>A big (for some) issue that I haven&rsquo;t touched upon is support for ligatures. A <strong>ligature</strong> is a glyph that represents multiple characters, as when &ldquo;f&rdquo; and &ldquo;i&rdquo; are substituted for the single glyph &ldquo;ﬁ&rdquo;. Ligatures are often used as flourishes in Western scripts but are essential for other scripts such as Arabic. Further, ligatures power emojis which have become an integral part of modern communication.</p><p>While we don&rsquo;t currently have support for ligatures, there&rsquo;s no doubt that we need it. The exact mechanism for this is still up in the air because ligatures must be resolved at the font rendering level. Each font file may provide their own unique ligatures and the mapping from multiple characters to a single glyph can be encoded into a number of different substitution table formats in the font file. Because of this complexity it is often handled by a dedicated library such as
<a href=https://www.freedesktop.org/wiki/Software/HarfBuzz/ target=_blank rel=noopener>HarfBuzz</a>. This could of course be wrapped by an R package but since ligatures can not be encoded with unicode (for the most part), there is no way of precomputing the substitution and pass it on to the graphic devices. Whether ligature support can retroactively be added to old graphic devices is thus still up in the air.</p><p>Text rendering in R is a delicate collaboration between graphic devices, the graphic engine, and additional support packages such as systemfonts and gridtext, but thankfully the focus and will is there in all parts to push this forward.</p></div></div><div class=column25><div class="section hideOnMobile"><div class=sectionTitle>Contents</div><nav id=TableOfContents><ul><li><a href=#ragg-020>ragg 0.2.0</a></li><li><a href=#systemfonts-020>systemfonts 0.2.0</a></li></ul></nav></div><div class=section></div></div></div></div></div><div id=rStudioFooter class=band><div class=bandContent><div id=copyright>The tidyverse is proudly supported by <a class=rstudioLogo href=https://posit.co/ aria-label="Posit Homepage"></a></div><div id=logos><a href=https://www.tidyverse.org/google_privacy_policy>Privacy policy</a>
<a href=https://github.com/tidyverse class="footerLogo gitHub" aria-label="Tidyverse GitHub organization"></a><a href=https://twitter.com/hashtag/rstats class="footerLogo twitter" aria-label="rstats hashtag on twitter.com"></a></div></div></div></div></div><script src=/js/math-code.js></script><script type=text/x-mathjax-config>
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script><script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script type=application/javascript>var dnt=(navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack);var doNotTrack=(dnt=="1"||dnt=="yes");if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');if(window.sessionStorage){var GA_SESSION_STORAGE_KEY='ga:clientId';ga('create','UA-115082821-1',{'storage':'none','clientId':sessionStorage.getItem(GA_SESSION_STORAGE_KEY)});ga(function(tracker){sessionStorage.setItem(GA_SESSION_STORAGE_KEY,tracker.get('clientId'));});}
ga('set','anonymizeIp',true);ga('send','pageview');}</script></body></html></div></div></body></html>