<!doctype html><html><head><!doctype html><html lang=en-us><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/css/main-site.css><link rel=stylesheet href=/css/fa5-all.css><style type=text/css>body{background-color:#fff;color:#1a1917}a{color:#38577f}a:hover{color:#42709b}a:focus{outline-color:#42709b}.column25-left .sectionTitle a:hover:not(.current),.column16-left .sectionTitle a:hover:not(.current){color:#1a1917}.icon-attribution,.icon-attribution a{color:#1a1917;opacity:75%}#homeContent .band.first{background-color:#fff}#homeContent .band.second{background-color:#fdeba4}#homeContent .band.third{background-color:#fff}#rStudioHeader{background-color:#1a162d;color:#fff}#rStudioHeader .productName{color:#fff}#rStudioHeader .productName:hover,#rStudioHeader .productName:focus{color:#fdeba4}#rStudioHeader #menu .menuItem.a{background-color:#75aadb;color:#fff}#rStudioHeader #menu .menuItem:hover{background-color:#484557;color:#fff}#rStudioHeader #menu .menuItem.current{background-color:#fff;color:#1a162d;text-decoration:none}#rStudioFooter.band{background-color:#767381}#rStudioFooter .bandContent #copyright{color:#e3eef8}table tbody tr:nth-child(even){background-color:#f7faff}table tbody tr:nth-child(odd){background-color:#fff}.latest{border-top:.5em solid <no value>}.event{-moz-box-shadow:0 0 0 0 rgba(0,0,0,.1);-webkit-box-shadow:0 0 0 0 rgba(0,0,0,.1);box-shadow:0 0 0 0 rgba(0,0,0,.1)}.section .event{background-color:#eab0c41a}.section .event{border-top:7pt solid #a19ea936}.section .event a{color:#1a162d}.section .event{color:#404040}</style><link rel=stylesheet href=/css/tidyverse.css><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.71.1"><title>testthat 2.1.0</title><meta property="og:title" content="testthat 2.1.0"><meta property="og:description" content="Highlights include that `context()` is now optional, and new `expect_invisible()` and `expect_mapequal()` expectations."><meta property="og:type" content="article"><meta property="og:url" content="https://www.tidyverse.org/blog/2019/04/testthat-2-1-0/"><meta property="twitter:card" content="summary_large_image"><meta property="og:title" content="testthat 2.1.0 - Tidyverse"><meta property="description" content="Highlights include that `context()` is now optional, and new `expect_invisible()` and `expect_mapequal()` expectations."><meta property="og:description" content="Highlights include that `context()` is now optional, and new `expect_invisible()` and `expect_mapequal()` expectations."><meta property="og:image" content="https://www.tidyverse.org/blog/2019/04/testthat-2-1-0/testthat-2-1-0-sq.jpg"><meta name=twitter:image content="https://www.tidyverse.org/blog/2019/04/testthat-2-1-0/testthat-2-1-0-wd.jpg"><link rel=apple-touch-icon sizes=180x180 href=/images/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicons/favicon-16x16.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg><link rel="shortcut icon" href=/images/favicons/favicon.ico><meta name=msapplication-TileColor content="#da532c"><meta name=msapplication-config href=/images/favicons/browserconfig.xml><script type=text/javascript src=/js/jquery-3.5.1.min.js></script><script type=text/javascript src=/js/site.js></script><link rel=icon href=/images/favicon.ico><script type=text/javascript src=/js/clipboard.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin=anonymous></script><script defer data-domain=tidyverse.org,all.tidyverse.org src=https://plausible.io/js/plausible.js></script></head><body><div id=appTidyverseSite class="shrinkHeader alwaysShrinkHeader"><div id=main><div id=rStudioHeader><nav class=band><div class="innards bandContent"><div><a class=productName href=/>Tidyverse</a></div><div id=menu><div id=menuToggler></div><div id=menuItems><a class=menuItem href=/packages/>Packages</a>
<a class="menuItem current" href=/blog/>Blog</a>
<a class=menuItem href=/learn/>Learn</a>
<a class=menuItem href=/help/>Help</a>
<a class=menuItem href=/contribute/>Contribute</a></div></div></div></nav></div><main><div class="band padForHeader pushFooter"><div class=bandContent><div class="full splitColumns withMobileMargins"><div class=column75><h1 class=article-title>testthat 2.1.0</h1><div class=article-header aria-hidden=true><div class=photo><img src=/blog/2019/04/testthat-2-1-0/testthat-2-1-0-wd.jpg></div><div class=photoCredit>Photo by <a href=https://www.pexels.com/photo/38070/>Skitterphoto</a></div></div><span class=article-date><i class="fas fa-calendar-day fa-fw"></i>&nbsp;&nbsp;2019/04/23</span><p style=margin-bottom:.5em;margin-top:.85em><i class="fas fa-tags"></i>&nbsp;
<a href=/tags/testthat/>testthat</a>,
<a href=/tags/r-lib/>r-lib</a></p><p style=margin-top:.5em><i class="fas fa-user-circle fa-fw"></i>&nbsp;
Hadley Wickham</p><div class=article-content><html><style>h2 code{font-size:1em}</style></html><p>We&rsquo;re happy to announce that
<a href=http://testthat.r-lib.org target=_blank rel=noopener>testthat 2.1.0</a> is now available on CRAN! testthat makes it easy to turn your existing informal tests into formal automated tests that you can rerun quickly and easily. testthat is the most popular unit-testing package for R, and is used by over 4,000 CRAN and Bioconductor packages. You can learn more about unit testing at <a href=https://r-pkgs.org/tests.html>https://r-pkgs.org/tests.html</a>.</p><p>Install the latest version of testthat with:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>install.packages</span><span class=p>(</span><span class=s>&#34;testthat&#34;</span><span class=p>)</span>
</code></pre></div><p>testthat 2.1.0 mostly contains a large number of minor improvements and bug fixes, as described in the
<a href=https://github.com/r-lib/testthat/releases/tag/v2.1.0 target=_blank rel=noopener>release notes</a>. This blog post discusses the bigger improvements:</p><ul><li><p><code>context()</code>s are now optional.</p></li><li><p>Two new expectations: <code>expect_invisible()</code> and <code>expect_mapequal()</code>.</p></li></ul><h2 id=context-is-now-optional><code>context()</code> is now optional
<a href=#context-is-now-optional><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>The biggest change in this version is that <code>context()</code> is now optional, and in fact we recommend that you no longer use it. <code>context()</code> made sense with the original design of testthat, which supported a very flexible mapping between your R code and the corresponding tests.</p><p>Now, however, we have a stronger recommendation: organise the files in <code>tests/testthat</code> in the same way that you organise the files in <code>R/</code>, so that tests for code in <code>R/my-file.R</code> live in <code>tests/testthat-my-file.R</code>. (This begs the question of how you should organise your <code>R/</code> directory, which we don&rsquo;t have a good answer for yet, but at least you only need to struggle to organise one directory). With this convention, <code>context()</code> tends to end up duplicating the file name, causing needless hassle if you reorganise your code structure.</p><p>The convention that every file in <code>R/</code> has a corresponding file in <code>tests/testthat</code> (and vice versa) is used by two other helpful functions:</p><ul><li><p><code>usethis::use_test()</code>, which, if you use RStudio, will automatically
create and open a test file corresponding to the R file in the right
location. (If you&rsquo;ve written the test file first, you can instead use
<code>usethis::use_r()</code>)</p></li><li><p><code>devtools::test_coverage_file()</code>: again, if you use RStudio, this will look
at the active file, run just the tests for that file, and report the coverage
results. This is a great way to rapidly iterate to ensure that you have
tested all the branches of new code.</p></li></ul><h2 id=new-expectations>New expectations
<a href=#new-expectations><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>library</span><span class=p>(</span><span class=n>testthat</span><span class=p>)</span>
</code></pre></div><p>This version of testthat introduces two important new expectations:</p><ul><li><p><code>expect_invisible()</code> makes it easier to check if a function returns its
results invisibly. This is useful if you are testing a function that is
called primarily for its side-effects, which should (as a general rule)
invisibly return its first argument.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=n>greet</span> <span class=o>&lt;-</span> <span class=nf>function</span><span class=p>(</span><span class=n>name</span><span class=p>)</span> <span class=p>{</span>
  <span class=nf>cat</span><span class=p>(</span><span class=s>&#34;Hello &#34;</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=s>&#34;!\n&#34;</span><span class=p>,</span> <span class=n>sep</span> <span class=o>=</span> <span class=s>&#34;&#34;</span><span class=p>)</span>
  <span class=nf>invisible</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
<span class=p>}</span>
    
<span class=n>x</span> <span class=o>&lt;-</span> <span class=nf>expect_invisible</span><span class=p>(</span><span class=nf>greet</span><span class=p>(</span><span class=s>&#34;Hadley&#34;</span><span class=p>))</span>
<span class=c1>#&gt; Hello Hadley!</span>
<span class=nf>expect_equal</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=s>&#34;Hadley&#34;</span><span class=p>)</span>
</code></pre></div><p>For symmetry, <code>expect_visible()</code> is also available, but you would not
generally test for it, as visible return values are the default.
Only use it if you find a bug related to visibilty and want to
programmatically verify that it&rsquo;s fixed.</p></li><li><p>New <code>expect_mapequal(x, y)</code> checks that <code>x</code> and <code>y</code> have the same names,
and the same value associated with each name (i.e. it compares the values
of the vector standardising the order of the names).</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=n>exp</span> <span class=o>&lt;-</span> <span class=nf>list</span><span class=p>(</span><span class=n>a</span> <span class=o>=</span> <span class=m>1</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=m>2</span><span class=p>)</span>
<span class=nf>expect_mapequal</span><span class=p>(</span><span class=nf>list</span><span class=p>(</span><span class=n>a</span> <span class=o>=</span> <span class=m>1</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=m>2</span><span class=p>),</span> <span class=n>exp</span><span class=p>)</span>
<span class=nf>expect_mapequal</span><span class=p>(</span><span class=nf>list</span><span class=p>(</span><span class=n>b</span> <span class=o>=</span> <span class=m>2</span><span class=p>,</span> <span class=n>a</span> <span class=o>=</span> <span class=m>1</span><span class=p>),</span> <span class=n>exp</span><span class=p>)</span>
    
<span class=nf>expect_mapequal</span><span class=p>(</span><span class=nf>list</span><span class=p>(</span><span class=n>b</span> <span class=o>=</span> <span class=m>2</span><span class=p>),</span> <span class=n>exp</span><span class=p>)</span>
<span class=c1>#&gt; Error: Names absent from `object`: &#34;a&#34;,</span>
<span class=nf>expect_mapequal</span><span class=p>(</span><span class=nf>list</span><span class=p>(</span><span class=n>a</span> <span class=o>=</span> <span class=m>3</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=m>2</span><span class=p>),</span> <span class=n>exp</span><span class=p>)</span>
<span class=c1>#&gt; Error: act$val[exp_nms] not equal to exp$val.</span>
<span class=c1>#&gt; Component &#34;a&#34;: Mean relative difference: 0.6666667</span>
<span class=nf>expect_mapequal</span><span class=p>(</span><span class=nf>list</span><span class=p>(</span><span class=n>a</span> <span class=o>=</span> <span class=m>1</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=m>2</span><span class=p>,</span> <span class=n>c</span> <span class=o>=</span> <span class=m>3</span><span class=p>),</span> <span class=n>exp</span><span class=p>)</span>
<span class=c1>#&gt; Error: Names absent from `expected`: &#34;c&#34;,</span>
</code></pre></div><p><code>expect_mapequal()</code> is related to <code>expect_setequal()</code>, which compares
values, ignoring order and count:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>expect_setequal</span><span class=p>(</span><span class=nf>c</span><span class=p>(</span><span class=s>&#34;a&#34;</span><span class=p>,</span> <span class=s>&#34;b&#34;</span><span class=p>),</span> <span class=nf>c</span><span class=p>(</span><span class=s>&#34;b&#34;</span><span class=p>,</span> <span class=s>&#34;a&#34;</span><span class=p>))</span>
<span class=nf>expect_setequal</span><span class=p>(</span><span class=nf>c</span><span class=p>(</span><span class=s>&#34;a&#34;</span><span class=p>,</span> <span class=s>&#34;b&#34;</span><span class=p>),</span> <span class=nf>c</span><span class=p>(</span><span class=s>&#34;a&#34;</span><span class=p>,</span> <span class=s>&#34;a&#34;</span><span class=p>,</span> <span class=s>&#34;b&#34;</span><span class=p>))</span>
</code></pre></div></li></ul><h2 id=acknowledgements>Acknowledgements
<a href=#acknowledgements><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>A big thanks to all 51 people who helped contribute to this release by reporting bugs, suggesting new features, or creating pull requests:
<a href=https://github.com/aabor target=_blank rel=noopener>@aabor</a>,
<a href=https://github.com/AEBilgrau target=_blank rel=noopener>@AEBilgrau</a>,
<a href=https://github.com/antaldaniel target=_blank rel=noopener>@antaldaniel</a>,
<a href=https://github.com/bflammers target=_blank rel=noopener>@bflammers</a>,
<a href=https://github.com/billdenney target=_blank rel=noopener>@billdenney</a>,
<a href=https://github.com/BillDunlap target=_blank rel=noopener>@BillDunlap</a>,
<a href=https://github.com/Bisaloo target=_blank rel=noopener>@Bisaloo</a>,
<a href=https://github.com/burchill target=_blank rel=noopener>@burchill</a>,
<a href=https://github.com/chasemc target=_blank rel=noopener>@chasemc</a>,
<a href=https://github.com/colearendt target=_blank rel=noopener>@colearendt</a>,
<a href=https://github.com/comicfans target=_blank rel=noopener>@comicfans</a>,
<a href=https://github.com/dmenne target=_blank rel=noopener>@dmenne</a>,
<a href=https://github.com/euklid321 target=_blank rel=noopener>@euklid321</a>,
<a href=https://github.com/flying-sheep target=_blank rel=noopener>@flying-sheep</a>,
<a href=https://github.com/gaborcsardi target=_blank rel=noopener>@gaborcsardi</a>,
<a href=https://github.com/gabrielodom target=_blank rel=noopener>@gabrielodom</a>,
<a href=https://github.com/gvwilson target=_blank rel=noopener>@gvwilson</a>,
<a href=https://github.com/hadley target=_blank rel=noopener>@hadley</a>,
<a href=https://github.com/harvey131 target=_blank rel=noopener>@harvey131</a>,
<a href=https://github.com/Hong-Revo target=_blank rel=noopener>@Hong-Revo</a>,
<a href=https://github.com/HughParsonage target=_blank rel=noopener>@HughParsonage</a>,
<a href=https://github.com/jackhannah95 target=_blank rel=noopener>@jackhannah95</a>,
<a href=https://github.com/jackwasey target=_blank rel=noopener>@jackwasey</a>,
<a href=https://github.com/jarodmeng target=_blank rel=noopener>@jarodmeng</a>,
<a href=https://github.com/jennybc target=_blank rel=noopener>@jennybc</a>,
<a href=https://github.com/jsilve24 target=_blank rel=noopener>@jsilve24</a>,
<a href=https://github.com/kevinushey target=_blank rel=noopener>@kevinushey</a>,
<a href=https://github.com/kforner target=_blank rel=noopener>@kforner</a>,
<a href=https://github.com/lionel- target=_blank rel=noopener>@lionel-</a>,
<a href=https://github.com/maelle target=_blank rel=noopener>@maelle</a>,
<a href=https://github.com/markvanderloo target=_blank rel=noopener>@markvanderloo</a>,
<a href=https://github.com/masaha03 target=_blank rel=noopener>@masaha03</a>,
<a href=https://github.com/mb706 target=_blank rel=noopener>@mb706</a>,
<a href=https://github.com/mbjoseph target=_blank rel=noopener>@mbjoseph</a>,
<a href=https://github.com/merliseclyde target=_blank rel=noopener>@merliseclyde</a>,
<a href=https://github.com/mikejiang target=_blank rel=noopener>@mikejiang</a>,
<a href=https://github.com/Mooskey target=_blank rel=noopener>@Mooskey</a>,
<a href=https://github.com/olsgaard target=_blank rel=noopener>@olsgaard</a>,
<a href=https://github.com/patr1ckm target=_blank rel=noopener>@patr1ckm</a>,
<a href=https://github.com/ramiromagno target=_blank rel=noopener>@ramiromagno</a>,
<a href=https://github.com/randy3k target=_blank rel=noopener>@randy3k</a>,
<a href=https://github.com/renkun-ken target=_blank rel=noopener>@renkun-ken</a>,
<a href=https://github.com/smbache target=_blank rel=noopener>@smbache</a>,
<a href=https://github.com/stevecondylios target=_blank rel=noopener>@stevecondylios</a>,
<a href=https://github.com/topepo target=_blank rel=noopener>@topepo</a>,
<a href=https://github.com/tramontini target=_blank rel=noopener>@tramontini</a>,
<a href=https://github.com/wch target=_blank rel=noopener>@wch</a>,
<a href=https://github.com/wsherwin target=_blank rel=noopener>@wsherwin</a>,
<a href=https://github.com/Yuri-M-Dias target=_blank rel=noopener>@Yuri-M-Dias</a>,
<a href=https://github.com/yutannihilation target=_blank rel=noopener>@yutannihilation</a>, and
<a href=https://github.com/zappingseb target=_blank rel=noopener>@zappingseb</a>.</p></div></div><div class=column25><div class="section hideOnMobile"><div class=sectionTitle>Contents</div><nav id=TableOfContents><ul><li><a href=#context-is-now-optional><code>context()</code> is now optional</a></li><li><a href=#new-expectations>New expectations</a></li><li><a href=#acknowledgements>Acknowledgements</a></li></ul></nav></div><div class=section></div></div></div></div></div><div id=rStudioFooter class=band><div class=bandContent><div id=copyright>The tidyverse is proudly supported by <a class=rstudioLogo href=https://posit.co/ aria-label="Posit Homepage"></a></div><div id=logos><a href=https://www.tidyverse.org/google_privacy_policy>Privacy policy</a>
<a href=https://github.com/tidyverse class="footerLogo gitHub" aria-label="Tidyverse GitHub organization"></a><a href=https://twitter.com/hashtag/rstats class="footerLogo twitter" aria-label="rstats hashtag on twitter.com"></a></div></div></div></div></div><script src=/js/math-code.js></script><script type=text/x-mathjax-config>
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script><script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script type=application/javascript>var dnt=(navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack);var doNotTrack=(dnt=="1"||dnt=="yes");if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');if(window.sessionStorage){var GA_SESSION_STORAGE_KEY='ga:clientId';ga('create','UA-115082821-1',{'storage':'none','clientId':sessionStorage.getItem(GA_SESSION_STORAGE_KEY)});ga(function(tracker){sessionStorage.setItem(GA_SESSION_STORAGE_KEY,tracker.get('clientId'));});}
ga('set','anonymizeIp',true);ga('send','pageview');}</script></body></html></div></div></body></html>