<!doctype html><html><head><!doctype html><html lang=en-us><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/css/main-site.css><link rel=stylesheet href=/css/fa5-all.css><style type=text/css>body{background-color:#fff;color:#1a1917}a{color:#38577f}a:hover{color:#42709b}a:focus{outline-color:#42709b}.column25-left .sectionTitle a:hover:not(.current),.column16-left .sectionTitle a:hover:not(.current){color:#1a1917}.icon-attribution,.icon-attribution a{color:#1a1917;opacity:75%}#homeContent .band.first{background-color:#fff}#homeContent .band.second{background-color:#fdeba4}#homeContent .band.third{background-color:#fff}#rStudioHeader{background-color:#1a162d;color:#fff}#rStudioHeader .productName{color:#fff}#rStudioHeader .productName:hover,#rStudioHeader .productName:focus{color:#fdeba4}#rStudioHeader #menu .menuItem.a{background-color:#75aadb;color:#fff}#rStudioHeader #menu .menuItem:hover{background-color:#484557;color:#fff}#rStudioHeader #menu .menuItem.current{background-color:#fff;color:#1a162d;text-decoration:none}#rStudioFooter.band{background-color:#767381}#rStudioFooter .bandContent #copyright{color:#e3eef8}table tbody tr:nth-child(even){background-color:#f7faff}table tbody tr:nth-child(odd){background-color:#fff}.latest{border-top:.5em solid <no value>}.event{-moz-box-shadow:0 0 0 0 rgba(0,0,0,.1);-webkit-box-shadow:0 0 0 0 rgba(0,0,0,.1);box-shadow:0 0 0 0 rgba(0,0,0,.1)}.section .event{background-color:#eab0c41a}.section .event{border-top:7pt solid #a19ea936}.section .event a{color:#1a162d}.section .event{color:#404040}</style><link rel=stylesheet href=/css/tidyverse.css><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.71.1"><title>testthat 2.3.0</title><meta property="og:title" content="testthat 2.3.0"><meta property="og:description" content="We&rsquo;re pumped to announce that testthat 2.3.0 is now available on CRAN! testthat makes it easy to turn your existing informal tests into formal automated tests that you can rerun quickly and easily. testthat is the most popular unit-testing package for R, and is used by over 4,000 CRAN and Bioconductor packages. You can learn more about unit testing at https://r-pkgs.org/tests.html.
(We didn&rsquo;t write a blog post about testthat 2.2.0 because it only introduced a single, experimental, new feature: verify_output()."><meta property="og:type" content="article"><meta property="og:url" content="https://www.tidyverse.org/blog/2019/11/testthat-2-3-0/"><meta property="twitter:card" content="summary_large_image"><meta property="og:title" content="testthat 2.3.0 - Tidyverse"><meta property="description" content><meta property="og:description" content><meta property="og:image" content="https://www.tidyverse.org/blog/2019/11/testthat-2-3-0/thumb-sq.jpg"><meta name=twitter:image content="https://www.tidyverse.org/blog/2019/11/testthat-2-3-0/thumb-wd.jpg"><link rel=apple-touch-icon sizes=180x180 href=/images/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicons/favicon-16x16.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg><link rel="shortcut icon" href=/images/favicons/favicon.ico><meta name=msapplication-TileColor content="#da532c"><meta name=msapplication-config href=/images/favicons/browserconfig.xml><script type=text/javascript src=/js/jquery-3.5.1.min.js></script><script type=text/javascript src=/js/site.js></script><link rel=icon href=/images/favicon.ico><script type=text/javascript src=/js/clipboard.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin=anonymous></script><script defer data-domain=tidyverse.org,all.tidyverse.org src=https://plausible.io/js/plausible.js></script></head><body><div id=appTidyverseSite class="shrinkHeader alwaysShrinkHeader"><div id=main><div id=rStudioHeader><nav class=band><div class="innards bandContent"><div><a class=productName href=/%20/>Tidyverse</a></div><div id=menu><div id=menuToggler></div><div id=menuItems><a class=menuItem href=/packages/>Packages</a>
<a class="menuItem current" href=/blog/>Blog</a>
<a class=menuItem href=/learn/>Learn</a>
<a class=menuItem href=/help/>Help</a>
<a class=menuItem href=/contribute/>Contribute</a></div></div></div></nav></div><main><div class="band padForHeader pushFooter"><div class=bandContent><div class="full splitColumns withMobileMargins"><div class=column75><h1 class=article-title>testthat 2.3.0</h1><div class=article-header aria-hidden=true><div class=photo><img src=/blog/2019/11/testthat-2-3-0/thumb-wd.jpg></div><div class=photoCredit>Photo by <a href=https://unsplash.com/photos/n_vD-7RxA3Q>Roman Kraft</a></div></div><span class=article-date><i class="fas fa-calendar-day fa-fw"></i>&nbsp;&nbsp;2019/11/06</span><p style=margin-bottom:.5em;margin-top:.85em><i class="fas fa-tags"></i>&nbsp;
<a href=/tags/devtools/>devtools</a>,
<a href=/tags/r-lib/>r-lib</a>,
<a href=/tags/testthat/>testthat</a></p><p style=margin-top:.5em><i class="fas fa-user-circle fa-fw"></i>&nbsp;
Hadley Wickham</p><div class=article-content><p>We&rsquo;re pumped to announce that
<a href=http://testthat.r-lib.org target=_blank rel=noopener>testthat 2.3.0</a> is now available on CRAN!
testthat makes it easy to turn your existing informal tests into formal automated tests that you can rerun quickly and easily.
testthat is the most popular unit-testing package for R, and is used by over 4,000 CRAN and Bioconductor packages.
You can learn more about unit testing at <a href=https://r-pkgs.org/tests.html>https://r-pkgs.org/tests.html</a>.</p><p>(We didn&rsquo;t write a blog post about testthat 2.2.0 because it only introduced a single, experimental, new feature: <code>verify_output()</code>.
It has now matured to the point we think you should also try it out, so it&rsquo;s discussed below.)</p><p>Install the latest version of testthat with:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>install.packages</span><span class=p>(</span><span class=s>&#34;testthat&#34;</span><span class=p>)</span>
</code></pre></div><p>This release features two main improvements:</p><ul><li><p>A general overhaul of condition and error handling.</p></li><li><p>A polished <code>verify_output()</code> that is ready for you to use to test your
print methods and error messages.</p></li></ul><p>For a complete list of changes, please see the
<a href=https://testthat.r-lib.org/news/index.html#testthat-2-3-0 target=_blank rel=noopener>release notes</a>.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>library</span><span class=p>(</span><span class=n>testthat</span><span class=p>)</span>
</code></pre></div><h2 id=errors>Errors
<a href=#errors><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>The main improvements are mostly behind the scenes: we have overhauled the handling of errors and backtraces so that you should get more informative outputs when tests error unexpectedly or fail.
It&rsquo;s hard to authentically demonstrate this in an RMarkdown document, but if you have an error inside a test, like this:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=n>f</span> <span class=o>&lt;-</span> <span class=nf>function</span><span class=p>()</span> <span class=nf>g</span><span class=p>()</span>
<span class=n>g</span> <span class=o>&lt;-</span> <span class=nf>function</span><span class=p>()</span> <span class=nf>h</span><span class=p>()</span>
<span class=n>h</span> <span class=o>&lt;-</span> <span class=nf>function</span><span class=p>()</span> <span class=nf>stop</span><span class=p>(</span><span class=s>&#34;This is an error!&#34;</span><span class=p>)</span>

<span class=nf>test_that</span><span class=p>(</span><span class=s>&#34;f() works as expected&#34;</span><span class=p>,</span> <span class=p>{</span>
  <span class=nf>expect_equal</span><span class=p>(</span><span class=nf>f</span><span class=p>(),</span> <span class=m>10</span><span class=p>)</span>
<span class=p>})</span>
</code></pre></div><p>You&rsquo;ll now get an informative backtrace that should allow you to quickly locate the source of the error:</p><pre><code>test-error.R:6: error: f() works as expected
This is an error!
Backtrace:
 1. testthat::expect_equal(f(), 10) tests/testthat/test-error.R:6:2
 4. testthat:::f()
 5. testthat:::g() tests/testthat/test-catch.R:1:5
 6. testthat:::h() tests/testthat/test-catch.R:2:5
</code></pre><p>The previous version only showed the error message, which wasn&rsquo;t terribly useful!</p><h2 id=verify_output><code>verify_output()</code>
<a href=#verify_output><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p><code>verify_output()</code> is designed to test output aimed at a human, like print methods and error messages.
Here you want to test that the output is useful to a human, but there&rsquo;s obviously no way to do that automatically.
Instead, the best you can do is to check the results with your eyeballs every time the results change.
<code>verify_output()</code> is designed to help you do this, making it a type of visual regression test.</p><p>You&rsquo;ll need to use <code>verify_output()</code> in concert with git.
Whenever the output changes, you&rsquo;ll get a test failure, but to see the change, you&rsquo;ll need to use git.
If the change is correct, commit it with git.
If it&rsquo;s incorrect, fix your code and rerun the tests.
Once fixed, the git diff will disappear.</p><p><code>verify_output()</code> works a little like RMarkdown: you give it some R code and it will run it, interleaving the input and output.
For example, imagine we were writing some tests to check that tibbles print correctly:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>library</span><span class=p>(</span><span class=n>tibble</span><span class=p>)</span>

<span class=nf>test_that</span><span class=p>(</span><span class=s>&#34;tibbles print usefully&#34;</span><span class=p>,</span> <span class=p>{</span>
  <span class=nf>verify_output</span><span class=p>(</span><span class=nf>test_path</span><span class=p>(</span><span class=s>&#34;test-print-dataframe.txt&#34;</span><span class=p>),</span> <span class=p>{</span>
    <span class=n>df1</span> <span class=o>&lt;-</span> <span class=nf>tibble</span><span class=p>(</span><span class=n>x</span> <span class=o>=</span> <span class=m>1</span><span class=o>:</span><span class=m>1e6</span><span class=p>)</span>
    <span class=nf>print</span><span class=p>(</span><span class=n>df1</span><span class=p>)</span>
  <span class=p>})</span>
<span class=p>})</span>
</code></pre></div><p>That test yields a <code>test-print-dataframe.txt</code> containing this output:</p><pre><code>&gt; df1 &lt;- tibble(x = 1:1e+06)
&gt; print(df1)
# A tibble: 1,000,000 x 1
       x
   &lt;int&gt;
 1     1
 2     2
 3     3
 4     4
 5     5
 6     6
 7     7
 8     8
 9     9
10    10
# ... with 999,990 more rows

</code></pre><p>Unfortunately, there&rsquo;s no way for <code>verify_output()</code> to capture comments, so you can instead use bare strings if you want comments to appear in the output. If you start the comment with <code>#</code> it will be formatted as a heading:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>test_that</span><span class=p>(</span><span class=s>&#34;tibbles print usefully&#34;</span><span class=p>,</span> <span class=p>{</span>
  <span class=nf>verify_output</span><span class=p>(</span><span class=nf>test_path</span><span class=p>(</span><span class=s>&#34;test-print-dataframe-2.txt&#34;</span><span class=p>),</span> <span class=p>{</span>
    <span class=s>&#34;# long tibbles&#34;</span>
    <span class=n>df1</span> <span class=o>&lt;-</span> <span class=nf>tibble</span><span class=p>(</span><span class=n>x</span> <span class=o>=</span> <span class=m>1</span><span class=o>:</span><span class=m>1e6</span><span class=p>)</span>
    <span class=nf>print</span><span class=p>(</span><span class=n>df1</span><span class=p>)</span>
    
    <span class=s>&#34;# wide tibbles&#34;</span>
    <span class=s>&#34;not yet written&#34;</span>
  <span class=p>})</span>
<span class=p>})</span>
</code></pre></div><pre><code>
long tibbles
============

&gt; df1 &lt;- tibble(x = 1:1e+06)
&gt; print(df1)
# A tibble: 1,000,000 x 1
       x
   &lt;int&gt;
 1     1
 2     2
 3     3
 4     4
 5     5
 6     6
 7     7
 8     8
 9     9
10    10
# ... with 999,990 more rows


wide tibbles
============

&gt; # not yet written
</code></pre><p><code>verify_output()</code> is automatically skipped when run on CRAN.
This avoids false positives because it&rsquo;s very easy to accidentally depend on the code from other packages, and failure does not imply incorrect computation, just a change in presentation.
In other words, <code>verify_output()</code> is meant to monitor the evolution of outputs produced by your package rather than checking for regressions.
In this way, it is similar to the
<a href=http://vdiffr.r-lib.org/ target=_blank rel=noopener>vdiffr</a> extension to testthat which uses the same approach to monitor the evolution of plots.</p><h2 id=acknoweldgements>Acknoweldgements
<a href=#acknoweldgements><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>A big thanks to everyone who helped make this version happen!
<a href=https://github.com/aaronrudkin target=_blank rel=noopener>@aaronrudkin</a>,
<a href=https://github.com/aneudecker target=_blank rel=noopener>@aneudecker</a>,
<a href=https://github.com/atheriel target=_blank rel=noopener>@atheriel</a>,
<a href=https://github.com/batpigandme target=_blank rel=noopener>@batpigandme</a>,
<a href=https://github.com/billdenney target=_blank rel=noopener>@billdenney</a>,
<a href=https://github.com/cimentadaj target=_blank rel=noopener>@cimentadaj</a>,
<a href=https://github.com/CorradoLanera target=_blank rel=noopener>@CorradoLanera</a>,
<a href=https://github.com/cosi1 target=_blank rel=noopener>@cosi1</a>,
<a href=https://github.com/DavisVaughan target=_blank rel=noopener>@DavisVaughan</a>,
<a href=https://github.com/dtm2451 target=_blank rel=noopener>@dtm2451</a>,
<a href=https://github.com/EmielSchmeink target=_blank rel=noopener>@EmielSchmeink</a>,
<a href=https://github.com/flying-sheep target=_blank rel=noopener>@flying-sheep</a>,
<a href=https://github.com/gaborcsardi target=_blank rel=noopener>@gaborcsardi</a>,
<a href=https://github.com/gdurif target=_blank rel=noopener>@gdurif</a>,
<a href=https://github.com/hadley target=_blank rel=noopener>@hadley</a>,
<a href=https://github.com/hughjonesd target=_blank rel=noopener>@hughjonesd</a>,
<a href=https://github.com/ianmcook target=_blank rel=noopener>@ianmcook</a>,
<a href=https://github.com/jameslamb target=_blank rel=noopener>@jameslamb</a>,
<a href=https://github.com/jcheng5 target=_blank rel=noopener>@jcheng5</a>,
<a href=https://github.com/jcubic target=_blank rel=noopener>@jcubic</a>,
<a href=https://github.com/jennybc target=_blank rel=noopener>@jennybc</a>,
<a href=https://github.com/jeroen target=_blank rel=noopener>@jeroen</a>,
<a href=https://github.com/jimhester target=_blank rel=noopener>@jimhester</a>,
<a href=https://github.com/jozefhajnala target=_blank rel=noopener>@jozefhajnala</a>,
<a href=https://github.com/jpritikin target=_blank rel=noopener>@jpritikin</a>,
<a href=https://github.com/keesh0 target=_blank rel=noopener>@keesh0</a>,
<a href=https://github.com/kenahoo target=_blank rel=noopener>@kenahoo</a>,
<a href=https://github.com/KrishanBhasin target=_blank rel=noopener>@KrishanBhasin</a>,
<a href=https://github.com/krlmlr target=_blank rel=noopener>@krlmlr</a>,
<a href=https://github.com/lionel- target=_blank rel=noopener>@lionel-</a>,
<a href=https://github.com/lorenzwalthert target=_blank rel=noopener>@lorenzwalthert</a>,
<a href=https://github.com/maxheld83 target=_blank rel=noopener>@maxheld83</a>,
<a href=https://github.com/mcol target=_blank rel=noopener>@mcol</a>,
<a href=https://github.com/MichaelChirico target=_blank rel=noopener>@MichaelChirico</a>,
<a href=https://github.com/mkurdej target=_blank rel=noopener>@mkurdej</a>,
<a href=https://github.com/MLopez-Ibanez target=_blank rel=noopener>@MLopez-Ibanez</a>,
<a href=https://github.com/moodymudskipper target=_blank rel=noopener>@moodymudskipper</a>,
<a href=https://github.com/mwmclean target=_blank rel=noopener>@mwmclean</a>,
<a href=https://github.com/Nachtfeuer target=_blank rel=noopener>@Nachtfeuer</a>,
<a href=https://github.com/nalzok target=_blank rel=noopener>@nalzok</a>,
<a href=https://github.com/nbenn target=_blank rel=noopener>@nbenn</a>,
<a href=https://github.com/oxr463 target=_blank rel=noopener>@oxr463</a>,
<a href=https://github.com/patr1ckm target=_blank rel=noopener>@patr1ckm</a>,
<a href=https://github.com/richierocks target=_blank rel=noopener>@richierocks</a>,
<a href=https://github.com/rillig target=_blank rel=noopener>@rillig</a>,
<a href=https://github.com/sebastiangonsal target=_blank rel=noopener>@sebastiangonsal</a>,
<a href=https://github.com/shrektan target=_blank rel=noopener>@shrektan</a>,
<a href=https://github.com/StevenMaude target=_blank rel=noopener>@StevenMaude</a>,
<a href=https://github.com/tdhock target=_blank rel=noopener>@tdhock</a>,
<a href=https://github.com/theclue target=_blank rel=noopener>@theclue</a>,
<a href=https://github.com/tjbell target=_blank rel=noopener>@tjbell</a>,
<a href=https://github.com/topepo target=_blank rel=noopener>@topepo</a>,
<a href=https://github.com/torbjorn target=_blank rel=noopener>@torbjorn</a>,
<a href=https://github.com/trevorld target=_blank rel=noopener>@trevorld</a>,
<a href=https://github.com/wlandau target=_blank rel=noopener>@wlandau</a>, and
<a href=https://github.com/zappingseb target=_blank rel=noopener>@zappingseb</a></p></div></div><div class=column25><div class="section hideOnMobile"><div class=sectionTitle>Contents</div><nav id=TableOfContents><ul><li><a href=#errors>Errors</a></li><li><a href=#verify_output><code>verify_output()</code></a></li><li><a href=#acknoweldgements>Acknoweldgements</a></li></ul></nav></div><div class=section></div></div></div></div></div><div id=rStudioFooter class=band><div class=bandContent><div id=copyright>The tidyverse is proudly supported by <a class=rstudioLogo href=https://posit.co/ aria-label="Posit Homepage"></a></div><div id=logos><a href=https://www.tidyverse.org/google_privacy_policy>Privacy policy</a>
<a href=https://github.com/tidyverse class="footerLogo gitHub" aria-label="Tidyverse GitHub organization"></a><a href=https://twitter.com/hashtag/rstats class="footerLogo twitter" aria-label="rstats hashtag on twitter.com"></a></div></div></div></div></div><script type=application/javascript>var dnt=(navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack);var doNotTrack=(dnt=="1"||dnt=="yes");if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');if(window.sessionStorage){var GA_SESSION_STORAGE_KEY='ga:clientId';ga('create','UA-115082821-1',{'storage':'none','clientId':sessionStorage.getItem(GA_SESSION_STORAGE_KEY)});ga(function(tracker){sessionStorage.setItem(GA_SESSION_STORAGE_KEY,tracker.get('clientId'));});}
ga('set','anonymizeIp',true);ga('send','pageview');}</script></body></html></div></div></body></html>