<!doctype html><html><head><!doctype html><html lang=en-us><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/css/main-site.css><link rel=stylesheet href=/css/fa5-all.css><style type=text/css>body{background-color:#fff;color:#1a1917}a{color:#38577f}a:hover{color:#42709b}a:focus{outline-color:#42709b}.column25-left .sectionTitle a:hover:not(.current),.column16-left .sectionTitle a:hover:not(.current){color:#1a1917}.icon-attribution,.icon-attribution a{color:#1a1917;opacity:75%}#homeContent .band.first{background-color:#fff}#homeContent .band.second{background-color:#fdeba4}#homeContent .band.third{background-color:#fff}#rStudioHeader{background-color:#1a162d;color:#fff}#rStudioHeader .productName{color:#fff}#rStudioHeader .productName:hover,#rStudioHeader .productName:focus{color:#fdeba4}#rStudioHeader #menu .menuItem.a{background-color:#75aadb;color:#fff}#rStudioHeader #menu .menuItem:hover{background-color:#484557;color:#fff}#rStudioHeader #menu .menuItem.current{background-color:#fff;color:#1a162d;text-decoration:none}#rStudioFooter.band{background-color:#767381}#rStudioFooter .bandContent #copyright{color:#e3eef8}table tbody tr:nth-child(even){background-color:#f7faff}table tbody tr:nth-child(odd){background-color:#fff}.latest{border-top:.5em solid <no value>}.event{-moz-box-shadow:0 0 0 0 rgba(0,0,0,.1);-webkit-box-shadow:0 0 0 0 rgba(0,0,0,.1);box-shadow:0 0 0 0 rgba(0,0,0,.1)}.section .event{background-color:#eab0c41a}.section .event{border-top:7pt solid #a19ea936}.section .event a{color:#1a162d}.section .event{color:#404040}</style><link rel=stylesheet href=/css/tidyverse.css><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.71.1"><title>callr 3.3.0</title><meta property="og:title" content="callr 3.3.0"><meta property="og:description" content="callr 3.3.0 is now on CRAN"><meta property="og:type" content="article"><meta property="og:url" content="https://www.tidyverse.org/blog/2019/07/callr-3.3.0/"><meta property="twitter:card" content="summary_large_image"><meta property="og:title" content="callr 3.3.0 - Tidyverse"><meta property="description" content="callr 3.3.0 is now on CRAN"><meta property="og:description" content="callr 3.3.0 is now on CRAN"><meta property="og:image" content="https://www.tidyverse.org/blog/2019/07/callr-3.3.0/callr-3.3.0-sq.jpg"><meta name=twitter:image content="https://www.tidyverse.org/blog/2019/07/callr-3.3.0/callr-3.3.0-wd.jpg"><link rel=apple-touch-icon sizes=180x180 href=/images/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicons/favicon-16x16.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg><link rel="shortcut icon" href=/images/favicons/favicon.ico><meta name=msapplication-TileColor content="#da532c"><meta name=msapplication-config href=/images/favicons/browserconfig.xml><script type=text/javascript src=/js/jquery-3.5.1.min.js></script><script type=text/javascript src=/js/site.js></script><link rel=icon href=/images/favicon.ico><script type=text/javascript src=/js/clipboard.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin=anonymous></script><script defer data-domain=tidyverse.org,all.tidyverse.org src=https://plausible.io/js/plausible.js></script></head><body><div id=appTidyverseSite class="shrinkHeader alwaysShrinkHeader"><div id=main><div id=rStudioHeader><nav class=band><div class="innards bandContent"><div><a class=productName href=/%20/>Tidyverse</a></div><div id=menu><div id=menuToggler></div><div id=menuItems><a class=menuItem href=/packages/>Packages</a>
<a class="menuItem current" href=/blog/>Blog</a>
<a class=menuItem href=/learn/>Learn</a>
<a class=menuItem href=/help/>Help</a>
<a class=menuItem href=/contribute/>Contribute</a></div></div></div></nav></div><main><div class="band padForHeader pushFooter"><div class=bandContent><div class="full splitColumns withMobileMargins"><div class=column75><h1 class=article-title>callr 3.3.0</h1><div class=article-header aria-hidden=true><div class=photo><img src=/blog/2019/07/callr-3.3.0/callr-3.3.0-wd.jpg></div><div class=photoCredit>Photo by <a href=https://pixabay.com/photos/venus-flytrap-carnivorous-plant-1531345>MonikaP</a></div></div><span class=article-date><i class="fas fa-calendar-day fa-fw"></i>&nbsp;&nbsp;2019/07/08</span><p style=margin-bottom:.5em;margin-top:.85em><i class="fas fa-tags"></i>&nbsp;
<a href=/tags/r-lib/>r-lib</a>,
<a href=/tags/callr/>callr</a></p><p style=margin-top:.5em><i class="fas fa-user-circle fa-fw"></i>&nbsp;
Gábor Csárdi</p><div class=article-content><style type=text/css scoped>pre.fansi span{padding-top:.25em;padding-bottom:.25em}</style><p>We have just updated the <a href=https://callr.r-lib.org/>callr</a> package to version 3.3.0 on CRAN.
The biggest change in this release is better support for debugging the
background process. See the full
<a href=https://callr.r-lib.org/news/index.html>changelog here</a>.</p><p>callr helps with running R code in a separate R process, synchronously or
asynchronously. With synchronous execution the main R process waits until
the separate R subprocess finishes, see <a href=https://callr.r-lib.org/reference/r.html><code>callr::r()</code></a>. Asynchronous execution
uses <a href=https://processx.r-lib.org/>processx</a> processes, see <a href=https://callr.r-lib.org/reference/r_bg.html><code>callr::r_bg()</code></a>
and <a href=https://callr.r-lib.org/reference/r_process.html><code>callr::r_process()</code></a> for one-off and <a href=https://callr.r-lib.org/reference/r_session.html><code>callr::r_session()</code></a> for persistent
background R processes.</p><div id=callr-error-objects class="section level2"><h2>callr error objects</h2><p>Debugging code running in a background process is notoriously difficult.
Most of the time you cannot use an interactive debugger, and often even
print-debugging, i.e. inserting <code>print()</code> and <code>cat()</code> calls into the
code that runs in the background, can be non-trivial.</p><p>The new 3.3.0 version of callr aims to help with this, by creating better
error messages and error traces for errors originating from the background
process. In particular, callr now always throws error objects that
contain:</p><ul><li>the exit status of the R process, if the process terminated,</li><li>the full error object thrown in the subprocess,</li><li>the call that generated the error,</li><li>the process id of the subprocess, and</li><li>the full stack trace in the subprocess.</li></ul><p>Here is an example for a trivial error that shows how to extract this
information if the error was caught in the main process:</p><pre class=r><code>err &lt;- tryCatch(
  callr::r(function() library(Callr)),
  error = function(e) e)
err
#&gt; &lt;callr_status_error: callr subprocess failed: there is no package called ‘Callr’&gt;
#&gt;  in process 
#&gt; --&gt;
#&gt; &lt;callr_remote_error in library(Callr): there is no package called ‘Callr’&gt;</code></pre><p>The error objects has two parts. The first is the error object thrown in
the main process, and the second is the error object from the the
subprocess. We can extract more information from <code>err</code>:</p><pre class=r><code>err$status
#&gt; [1] 0
err$parent
#&gt; &lt;callr_remote_error in library(Callr): there is no package called ‘Callr’&gt;
err$parent$call
#&gt; function() library(Callr)
err$parent$`_pid`
#&gt; [1] 79124</code></pre><p><code>err$status</code> is the exit status of the subprocess. This is not present
for persistent background processes, i.e. the ones created by <code>r_session</code>,
because these do not exit on error, but continue running. <code>err$parent</code> is
the error object, thrown in the subprocess. <code>err$parent$call</code> is the call
that generated the error, and <code>err$parent$`_pid`</code> is the process id
of the subprocess.</p><p>The stack trace of the error in subprocess can be printed via
<code>err$parent$trace</code>. By default the trace omits the boilerplate frames
added by callr, these are usually not very useful for the user.
Nevertheless they are still included in <code>err$parent$trace$calls</code>.</p><pre class=r><code>err$parent$trace</code></pre><pre class="fansi fansi-output"><code>#&gt; 
#&gt; <span style=font-weight:700> ERROR TRACE for packageNotFoundError</span><span>
#&gt; 
#&gt; </span><span style=color:#555> 12. </span><span>(function ()  ...
#&gt; </span><span style=color:#555> 13. </span><span style=color:#bb0>base:::library</span><span>(Callr)
#&gt;     </span><span style=color:#0bb;font-style:italic>R/&lt;text&gt;:2:12</span><span>
#&gt; </span><span style=color:#555> 14. </span><span style=color:#bb0>base:::stop</span><span>(packageNotFoundError(package, lib.loc, sys.call()))
#&gt; </span><span style=color:#555> 15. </span><span>(function (e)  ...
#&gt; </span><span style=color:#b00;font-weight:700>
#&gt;  x there is no package called ‘Callr’ </span><span>
</span></code></pre><p>The trace starts with the anonymous function that we passed to <code>callr::r()</code>,
and it is annotated with package names and source references, if they are
available.</p></div><div id=the-last-error class="section level2"><h2>The last error</h2><p>Often, the error object is uncaught, i.e. we don’t <code>tryCatch()</code> the error
in the main R process. Then the error message is printed, but the actual
error object is lost, and you need to re-run the code in a <code>tryCatch()</code>,
hoping that it would produce the same error.</p><p>For a better workflow, whenever a callr error is uncaught, callr
assigns it to the <code>.Last.error</code> variable, that can be inspected.
Of course, a subsequent callr error will overwrite <code>.Last.error</code>, it works very
much like <code>.Last.value</code>, but for errors. Here is the same code as above
but without the <code>tryCatch()</code>:</p><pre class=r><code>callr::r(function() library(Callr))
#&gt; Error: callr subprocess failed: there is no package called ‘Callr’</code></pre><pre class=r><code>.Last.error
#&gt; &lt;callr_status_error: callr subprocess failed: there is no package called ‘Callr’&gt;
#&gt; --&gt;
#&gt; &lt;callr_remote_error in library(Callr): there is no package called ‘Callr’&gt;
.Last.error$parent$call
#&gt; function() library(Callr)</code></pre></div><div id=the-last-error-trace class="section level2"><h2>The last error trace</h2><p>If the error is uncaught, then callr adds a trace to the error object of
the main process as well. The trace will have two parts in this case.
callr also sets the <code>.Last.error.trace</code> variable for convenience, this is
easier to type than <code>.Last.error$trace</code>.</p><pre class=r><code>.Last.error.trace</code></pre><pre class="fansi fansi-output"><code>#&gt; 
#&gt; <span style=font-weight:700> ERROR TRACE for callr_status_error, callr_error, rlib_error</span><span>
#&gt; 
#&gt;  </span><span style=font-weight:700>Process 79108:</span><span>
#&gt; </span><span style=color:#555> 30. </span><span style=color:#bb0>callr::r</span><span>(function() library(Callr))
#&gt; </span><span style=color:#555> 31. </span><span style=color:#bb0>callr:::get_result</span><span>(output = out, options)
#&gt;     </span><span style=color:#0bb;font-style:italic>R/eval.R:149:3</span><span>
#&gt; </span><span style=color:#555> 32. </span><span style=color:#bb0>base:::throw</span><span>(new_callr_error(output, msg), parent = err[[2]])
#&gt;     </span><span style=color:#0bb;font-style:italic>R/result.R:73:5</span><span>
#&gt; </span><span style=color:#b00;font-weight:700>
#&gt;  x callr subprocess failed: there is no package called ‘Callr’ </span><span>
#&gt; 
#&gt;  </span><span style=font-weight:700>Process 79135:</span><span>
#&gt; </span><span style=color:#555> 44. </span><span>(function ()  ...
#&gt; </span><span style=color:#555> 45. </span><span style=color:#bb0>base:::library</span><span>(Callr)
#&gt;     </span><span style=color:#0bb;font-style:italic>R/&lt;text&gt;:1:10</span><span>
#&gt; </span><span style=color:#555> 46. </span><span style=color:#bb0>base:::stop</span><span>(packageNotFoundError(package, lib.loc, sys.call()))
#&gt; </span><span style=color:#555> 47. </span><span>(function (e)  ...
#&gt; </span><span style=color:#b00;font-weight:700>
#&gt;  x there is no package called ‘Callr’ </span><span>
</span></code></pre><p>The top part of the trace contains the frames in the main process, and the
bottom part contains the frames in the subprocess, starting with the
anonymous function.</p></div></div></div><div class=column25><div class="section hideOnMobile"></div><div class=section></div></div></div></div></div><div id=rStudioFooter class=band><div class=bandContent><div id=copyright>The tidyverse is proudly supported by <a class=rstudioLogo href=https://posit.co/ aria-label="Posit Homepage"></a></div><div id=logos><a href=https://www.tidyverse.org/google_privacy_policy>Privacy policy</a>
<a href=https://github.com/tidyverse class="footerLogo gitHub" aria-label="Tidyverse GitHub organization"></a><a href=https://twitter.com/hashtag/rstats class="footerLogo twitter" aria-label="rstats hashtag on twitter.com"></a></div></div></div></div></div><script src=/js/math-code.js></script><script type=text/x-mathjax-config>
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script><script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script type=application/javascript>var dnt=(navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack);var doNotTrack=(dnt=="1"||dnt=="yes");if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');if(window.sessionStorage){var GA_SESSION_STORAGE_KEY='ga:clientId';ga('create','UA-115082821-1',{'storage':'none','clientId':sessionStorage.getItem(GA_SESSION_STORAGE_KEY)});ga(function(tracker){sessionStorage.setItem(GA_SESSION_STORAGE_KEY,tracker.get('clientId'));});}
ga('set','anonymizeIp',true);ga('send','pageview');}</script></body></html></div></div></body></html>