<!doctype html><html><head><!doctype html><html lang=en-us><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/css/main-site.css><link rel=stylesheet href=/css/fa5-all.css><style type=text/css>body{background-color:#fff;color:#1a1917}a{color:#38577f}a:hover{color:#42709b}a:focus{outline-color:#42709b}.column25-left .sectionTitle a:hover:not(.current),.column16-left .sectionTitle a:hover:not(.current){color:#1a1917}.icon-attribution,.icon-attribution a{color:#1a1917;opacity:75%}#homeContent .band.first{background-color:#fff}#homeContent .band.second{background-color:#fdeba4}#homeContent .band.third{background-color:#fff}#rStudioHeader{background-color:#1a162d;color:#fff}#rStudioHeader .productName{color:#fff}#rStudioHeader .productName:hover,#rStudioHeader .productName:focus{color:#fdeba4}#rStudioHeader #menu .menuItem.a{background-color:#75aadb;color:#fff}#rStudioHeader #menu .menuItem:hover{background-color:#484557;color:#fff}#rStudioHeader #menu .menuItem.current{background-color:#fff;color:#1a162d;text-decoration:none}#rStudioFooter.band{background-color:#767381}#rStudioFooter .bandContent #copyright{color:#e3eef8}table tbody tr:nth-child(even){background-color:#f7faff}table tbody tr:nth-child(odd){background-color:#fff}.latest{border-top:.5em solid <no value>}.event{-moz-box-shadow:0 0 0 0 rgba(0,0,0,.1);-webkit-box-shadow:0 0 0 0 rgba(0,0,0,.1);box-shadow:0 0 0 0 rgba(0,0,0,.1)}.section .event{background-color:#eab0c41a}.section .event{border-top:7pt solid #a19ea936}.section .event a{color:#1a162d}.section .event{color:#404040}</style><link rel=stylesheet href=/css/tidyverse.css><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.71.1"><title>dplyr 1.1.0 is coming soon</title><meta property="og:title" content="dplyr 1.1.0 is coming soon"><meta property="og:description" content="dplyr 1.1.0 is coming soon! This post introduces some of the exciting new features coming in 1.1.0, and includes a call-for-feedback as we finalize the release."><meta property="og:type" content="article"><meta property="og:url" content="https://www.tidyverse.org/blog/2022/11/dplyr-1-1-0-is-coming-soon/"><meta property="twitter:card" content="summary_large_image"><meta property="og:title" content="dplyr 1.1.0 is coming soon - Tidyverse"><meta property="description" content="dplyr 1.1.0 is coming soon! This post introduces some of the exciting new features coming in 1.1.0, and includes a call-for-feedback as we finalize the release."><meta property="og:description" content="dplyr 1.1.0 is coming soon! This post introduces some of the exciting new features coming in 1.1.0, and includes a call-for-feedback as we finalize the release."><meta property="og:image" content="https://www.tidyverse.org/blog/2022/11/dplyr-1-1-0-is-coming-soon/thumbnail-sq.jpg"><meta name=twitter:image content="https://www.tidyverse.org/blog/2022/11/dplyr-1-1-0-is-coming-soon/thumbnail-wd.jpg"><link rel=apple-touch-icon sizes=180x180 href=/images/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicons/favicon-16x16.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg><link rel="shortcut icon" href=/images/favicons/favicon.ico><meta name=msapplication-TileColor content="#da532c"><meta name=msapplication-config href=/images/favicons/browserconfig.xml><script type=text/javascript src=/js/jquery-3.5.1.min.js></script><script type=text/javascript src=/js/site.js></script><link rel=icon href=/images/favicon.ico><script type=text/javascript src=/js/clipboard.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin=anonymous></script><script defer data-domain=tidyverse.org,all.tidyverse.org src=https://plausible.io/js/plausible.js></script></head><body><div id=appTidyverseSite class="shrinkHeader alwaysShrinkHeader"><div id=main><div id=rStudioHeader><nav class=band><div class="innards bandContent"><div><a class=productName href=/%20/>Tidyverse</a></div><div id=menu><div id=menuToggler></div><div id=menuItems><a class=menuItem href=/packages/>Packages</a>
<a class="menuItem current" href=/blog/>Blog</a>
<a class=menuItem href=/learn/>Learn</a>
<a class=menuItem href=/help/>Help</a>
<a class=menuItem href=/contribute/>Contribute</a></div></div></div></nav></div><main><div class="band padForHeader pushFooter"><div class=bandContent><div class="full splitColumns withMobileMargins"><div class=column75><h1 class=article-title>dplyr 1.1.0 is coming soon</h1><div class=article-header aria-hidden=true><div class=photo><img src=/blog/2022/11/dplyr-1-1-0-is-coming-soon/thumbnail-wd.jpg></div><div class=photoCredit>Photo by <a href=https://unsplash.com/photos/aId-xYRTlEc>Markus Winkler</a></div></div><span class=article-date><i class="fas fa-calendar-day fa-fw"></i>&nbsp;&nbsp;2022/11/28</span><p style=margin-bottom:.5em;margin-top:.85em><i class="fas fa-tags"></i>&nbsp;
<a href=/tags/dplyr/>dplyr</a>,
<a href=/tags/dplyr-1-1-0/>dplyr-1-1-0</a></p><p style=margin-top:.5em><i class="fas fa-user-circle fa-fw"></i>&nbsp;
Davis Vaughan</p><div class=article-content><p><a href=https://dplyr.tidyverse.org/dev/ target=_blank rel=noopener>dplyr</a> 1.1.0 is coming soon! We haven&rsquo;t started the official release process yet (where we inform maintainers), but that will start in the next few weeks, and then dplyr 1.1.0 is likely to be submitted to CRAN in late January 2023.</p><p>This is an exciting release for dplyr, incorporating a number of features that have been in flight for years, including:</p><ul><li><p>An inline alternative to
<a href=https://dplyr.tidyverse.org/reference/group_by.html target=_blank rel=noopener><code>group_by()</code></a> that implements temporary grouping</p></li><li><p>New join types, such as non-equi joins</p></li><li><p><a href=https://dplyr.tidyverse.org/reference/arrange.html target=_blank rel=noopener><code>arrange()</code></a> improvements with character vectors</p></li><li><p><a href=https://dplyr.tidyverse.org/reference/reframe.html target=_blank rel=noopener><code>reframe()</code></a>, a generalization of
<a href=https://dplyr.tidyverse.org/reference/summarise.html target=_blank rel=noopener><code>summarise()</code></a></p></li></ul><p>This pre-release blog post will discuss these new features in more detail. By releasing this post before 1.1.0 is sent to CRAN, we&rsquo;re hoping to get your feedback to catch any potential problems that we&rsquo;ve missed! If you do find a bug, or have general feedback about the new features, we welcome discussion on the
<a href=https://github.com/tidyverse/dplyr/issues target=_blank rel=noopener>dplyr issues page</a>.</p><p>You can see a full list of changes in the
<a href=https://dplyr.tidyverse.org/dev/news/index.html target=_blank rel=noopener>release notes</a>. There are many additional improvements that couldn&rsquo;t fit in a single blog post!</p><p>dplyr 1.1.0 is not on CRAN yet, but you can install the development version from GitHub with:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf>pak</span><span class=nf>::</span><span class=nf><a href=http://pak.r-lib.org/reference/pak.html>pak</a></span><span class=o>(</span><span class=s>"tidyverse/dplyr"</span><span class=o>)</span></span></code></pre></div><p>The development version is mostly stable, but is still subject to minor changes before the official release. We don&rsquo;t encourage relying on it for production usage, but we would love for you to try out these new features.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=https://dplyr.tidyverse.org>dplyr</a></span><span class=o>)</span></span>
<span><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=https://clock.r-lib.org>clock</a></span><span class=o>)</span></span>
<span><span class=nf><a href=https://rdrr.io/r/base/Random.html>set.seed</a></span><span class=o>(</span><span class=m>12345</span><span class=o>)</span></span></code></pre></div><h2 id=temporary-grouping-with-by>Temporary grouping with <code>.by</code>
<a href=#temporary-grouping-with-by><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Verbs that work &ldquo;by group,&rdquo; such as
<a href=https://dplyr.tidyverse.org/reference/mutate.html target=_blank rel=noopener><code>mutate()</code></a>,
<a href=https://dplyr.tidyverse.org/reference/summarise.html target=_blank rel=noopener><code>summarise()</code></a>,
<a href=https://dplyr.tidyverse.org/reference/filter.html target=_blank rel=noopener><code>filter()</code></a>, and
<a href=https://dplyr.tidyverse.org/reference/slice.html target=_blank rel=noopener><code>slice()</code></a>, have gained an experimental new argument, <code>.by</code>, which allows for inline and temporary grouping. Grouping radically affects the computation of the dplyr verb you use it with, and one of the goals of <code>.by</code> is to allow you to place that grouping specification alongside the code that actually uses it. As an added benefit, with <code>.by</code> you no longer need to remember to
<a href=https://dplyr.tidyverse.org/reference/group_by.html target=_blank rel=noopener><code>ungroup()</code></a> after
<a href=https://dplyr.tidyverse.org/reference/summarise.html target=_blank rel=noopener><code>summarise()</code></a>, and
<a href=https://dplyr.tidyverse.org/reference/summarise.html target=_blank rel=noopener><code>summarise()</code></a> won&rsquo;t ever message you about how it&rsquo;s handling the groups!</p><p>This feature was inspired by
<a href="https://cran.r-project.org/package=data.table" target=_blank rel=noopener>data.table</a>, which has always used per-operation grouping.</p><p>We&rsquo;ll explore <code>.by</code> with this <code>expenses</code> dataset, containing various <code>cost</code>s tracked across <code>id</code> and <code>region</code>.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>expenses</span> <span class=o>&lt;-</span> <span class=nf><a href=https://tibble.tidyverse.org/reference/tibble.html>tibble</a></span><span class=o>(</span></span>
<span>  id <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=m>1</span>, <span class=m>2</span>, <span class=m>1</span>, <span class=m>3</span>, <span class=m>1</span>, <span class=m>2</span>, <span class=m>3</span><span class=o>)</span>,</span>
<span>  region <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=s>"A"</span>, <span class=s>"A"</span>, <span class=s>"A"</span>, <span class=s>"B"</span>, <span class=s>"B"</span>, <span class=s>"A"</span>, <span class=s>"A"</span><span class=o>)</span>,</span>
<span>  cost <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=m>25</span>, <span class=m>20</span>, <span class=m>19</span>, <span class=m>12</span>, <span class=m>9</span>, <span class=m>6</span>, <span class=m>6</span><span class=o>)</span></span>
<span><span class=o>)</span></span>
<span><span class=nv>expenses</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 7 × 3</span></span></span>
<span><span class=c>#&gt;      id region  cost</span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>  <span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span>     1 A         25</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span>     2 A         20</span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span>     1 A         19</span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span>     3 B         12</span></span>
<span><span class=c>#&gt; <span style=color:#555>5</span>     1 B          9</span></span>
<span><span class=c>#&gt; <span style=color:#555>6</span>     2 A          6</span></span>
<span><span class=c>#&gt; <span style=color:#555>7</span>     3 A          6</span></span>
<span></span></code></pre></div><p>If I were to ask you to compute the average <code>cost</code> per <code>region</code>, you&rsquo;d probably write something like:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>expenses</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://dplyr.tidyverse.org/reference/group_by.html>group_by</a></span><span class=o>(</span><span class=nv>region</span><span class=o>)</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://dplyr.tidyverse.org/reference/summarise.html>summarise</a></span><span class=o>(</span>cost <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/mean.html>mean</a></span><span class=o>(</span><span class=nv>cost</span><span class=o>)</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 2 × 2</span></span></span>
<span><span class=c>#&gt;   region  cost</span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;chr&gt;</span>  <span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span> A       15.2</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span> B       10.5</span></span>
<span></span></code></pre></div><p>With <code>.by</code>, you can now write:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>expenses</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://dplyr.tidyverse.org/reference/summarise.html>summarise</a></span><span class=o>(</span>cost <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/mean.html>mean</a></span><span class=o>(</span><span class=nv>cost</span><span class=o>)</span>, .by <span class=o>=</span> <span class=nv>region</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 2 × 2</span></span></span>
<span><span class=c>#&gt;   region  cost</span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;chr&gt;</span>  <span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span> A       15.2</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span> B       10.5</span></span>
<span></span></code></pre></div><p>These two particular results look the same, but the behavior of <code>.by</code> diverges from
<a href=https://dplyr.tidyverse.org/reference/group_by.html target=_blank rel=noopener><code>group_by()</code></a> when multiple group columns are involved:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>expenses</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://dplyr.tidyverse.org/reference/group_by.html>group_by</a></span><span class=o>(</span><span class=nv>id</span>, <span class=nv>region</span><span class=o>)</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://dplyr.tidyverse.org/reference/summarise.html>summarise</a></span><span class=o>(</span>cost <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/mean.html>mean</a></span><span class=o>(</span><span class=nv>cost</span><span class=o>)</span><span class=o>)</span></span>
<span><span class=c>#&gt; `summarise()` has grouped output by 'id'. You can override using the `.groups`</span></span>
<span><span class=c>#&gt; argument.</span></span>
<span></span><span><span class=c>#&gt; <span style=color:#555># A tibble: 5 × 3</span></span></span>
<span><span class=c>#&gt; <span style=color:#555># Groups:   id [3]</span></span></span>
<span><span class=c>#&gt;      id region  cost</span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>  <span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span>     1 A         22</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span>     1 B          9</span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span>     2 A         13</span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span>     3 A          6</span></span>
<span><span class=c>#&gt; <span style=color:#555>5</span>     3 B         12</span></span>
<span></span></code></pre></div><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>expenses</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://dplyr.tidyverse.org/reference/summarise.html>summarise</a></span><span class=o>(</span>cost <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/mean.html>mean</a></span><span class=o>(</span><span class=nv>cost</span><span class=o>)</span>, .by <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=nv>id</span>, <span class=nv>region</span><span class=o>)</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 5 × 3</span></span></span>
<span><span class=c>#&gt;      id region  cost</span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>  <span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span>     1 A         22</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span>     2 A         13</span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span>     3 B         12</span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span>     1 B          9</span></span>
<span><span class=c>#&gt; <span style=color:#555>5</span>     3 A          6</span></span>
<span></span></code></pre></div><p>Usage of <code>.by</code> always results in an ungrouped data frame, regardless of the number of group columns involved.</p><p>You might also recognize that these results aren&rsquo;t returned in exactly the same order.
<a href=https://dplyr.tidyverse.org/reference/group_by.html target=_blank rel=noopener><code>group_by()</code></a> always sorts the grouping keys in ascending order, but <code>.by</code> retains the original ordering found in the data. If you need ordered summaries with <code>.by</code>, we recommend calling
<a href=https://dplyr.tidyverse.org/reference/arrange.html target=_blank rel=noopener><code>arrange()</code></a> explicitly before or after summarizing.</p><p>While here we&rsquo;ve focused on using <code>.by</code> with
<a href=https://dplyr.tidyverse.org/reference/summarise.html target=_blank rel=noopener><code>summarise()</code></a>, it also works with other verbs, like
<a href=https://dplyr.tidyverse.org/reference/mutate.html target=_blank rel=noopener><code>mutate()</code></a> and
<a href=https://dplyr.tidyverse.org/reference/slice.html target=_blank rel=noopener><code>slice()</code></a>:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>expenses</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://dplyr.tidyverse.org/reference/mutate.html>mutate</a></span><span class=o>(</span>mean <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/mean.html>mean</a></span><span class=o>(</span><span class=nv>cost</span><span class=o>)</span>, .by <span class=o>=</span> <span class=nv>region</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 7 × 4</span></span></span>
<span><span class=c>#&gt;      id region  cost  mean</span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>  <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span>     1 A         25  15.2</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span>     2 A         20  15.2</span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span>     1 A         19  15.2</span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span>     3 B         12  10.5</span></span>
<span><span class=c>#&gt; <span style=color:#555>5</span>     1 B          9  10.5</span></span>
<span><span class=c>#&gt; <span style=color:#555>6</span>     2 A          6  15.2</span></span>
<span><span class=c>#&gt; <span style=color:#555>7</span>     3 A          6  15.2</span></span>
<span></span><span></span>
<span><span class=nv>expenses</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://dplyr.tidyverse.org/reference/slice.html>slice</a></span><span class=o>(</span><span class=m>2</span>, .by <span class=o>=</span> <span class=nv>region</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 2 × 3</span></span></span>
<span><span class=c>#&gt;      id region  cost</span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>  <span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span>     2 A         20</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span>     1 B          9</span></span>
<span></span></code></pre></div><p><a href=https://dplyr.tidyverse.org/reference/group_by.html target=_blank rel=noopener><code>group_by()</code></a> won&rsquo;t ever disappear, but we are having a lot of fun writing new code with <code>.by</code>, and we think you will too.</p><h2 id=join-improvements>Join improvements
<a href=#join-improvements><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>All of the join functions in dplyr, such as
<a href=https://dplyr.tidyverse.org/reference/mutate-joins.html target=_blank rel=noopener><code>left_join()</code></a>, now accept a flexible join specification created through the new
<a href=https://dplyr.tidyverse.org/reference/join_by.html target=_blank rel=noopener><code>join_by()</code></a> helper.
<a href=https://dplyr.tidyverse.org/reference/join_by.html target=_blank rel=noopener><code>join_by()</code></a> allows you to specify your join conditions as expressions rather than as named character vectors.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://dplyr.tidyverse.org/reference/join_by.html>join_by</a></span><span class=o>(</span><span class=nv>x_id</span> <span class=o>==</span> <span class=nv>y_id</span>, <span class=nv>region</span><span class=o>)</span></span>
<span><span class=c>#&gt; Join By:</span></span>
<span><span class=c>#&gt; - x_id == y_id</span></span>
<span><span class=c>#&gt; - region</span></span>
<span></span></code></pre></div><p>This join specification matches <code>x_id</code> in the left-hand data frame with <code>y_id</code> in the right-hand one, and also matches between a commonly named <code>region</code> column, computing the following equi-join:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>df1</span> <span class=o>&lt;-</span> <span class=nf><a href=https://tibble.tidyverse.org/reference/tibble.html>tibble</a></span><span class=o>(</span>x_id <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=m>1</span>, <span class=m>2</span>, <span class=m>2</span><span class=o>)</span>, region <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=s>"A"</span>, <span class=s>"B"</span>, <span class=s>"A"</span><span class=o>)</span>, x <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=m>5</span>, <span class=m>10</span>, <span class=m>4</span><span class=o>)</span><span class=o>)</span></span>
<span><span class=nv>df2</span> <span class=o>&lt;-</span> <span class=nf><a href=https://tibble.tidyverse.org/reference/tibble.html>tibble</a></span><span class=o>(</span>y_id <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=m>2</span>, <span class=m>1</span>, <span class=m>2</span><span class=o>)</span>, region <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=s>"A"</span>, <span class=s>"A"</span>, <span class=s>"C"</span><span class=o>)</span>, y <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=m>12</span>, <span class=m>8</span>, <span class=m>7</span><span class=o>)</span><span class=o>)</span></span>
<span></span>
<span><span class=nv>df1</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 3 × 3</span></span></span>
<span><span class=c>#&gt;    x_id region     x</span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>  <span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span>     1 A          5</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span>     2 B         10</span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span>     2 A          4</span></span>
<span></span><span></span>
<span><span class=nv>df2</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 3 × 3</span></span></span>
<span><span class=c>#&gt;    y_id region     y</span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>  <span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span>     2 A         12</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span>     1 A          8</span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span>     2 C          7</span></span>
<span></span><span></span>
<span><span class=nv>df1</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://dplyr.tidyverse.org/reference/mutate-joins.html>left_join</a></span><span class=o>(</span><span class=nv>df2</span>, <span class=nf><a href=https://dplyr.tidyverse.org/reference/join_by.html>join_by</a></span><span class=o>(</span><span class=nv>x_id</span> <span class=o>==</span> <span class=nv>y_id</span>, <span class=nv>region</span><span class=o>)</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 3 × 4</span></span></span>
<span><span class=c>#&gt;    x_id region     x     y</span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>  <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span>     1 A          5     8</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span>     2 B         10    <span style=color:#b00>NA</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span>     2 A          4    12</span></span>
<span></span></code></pre></div><h3 id=non-equi-joins>Non-equi joins
<a href=#non-equi-joins><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>Allowing expressions in
<a href=https://dplyr.tidyverse.org/reference/join_by.html target=_blank rel=noopener><code>join_by()</code></a> opens up a whole new world of joins in dplyr known as <em>non-equi joins</em>. As the name somewhat implies, these are joins that involve binary conditions other than equality. There are 4 particularly useful types of non-equi joins:</p><ul><li><p><strong>Cross joins</strong> match every pair of rows and were already supported in dplyr.</p></li><li><p><strong>Inequality joins</strong> match using <code>></code>, <code>>=</code>, <code>&lt;</code>, or <code>&lt;=</code> instead of <code>==</code>.</p></li><li><p><strong>Rolling joins</strong> are based on inequality joins, but only find the closest match.</p></li><li><p><strong>Overlap joins</strong> are also based on inequality joins, but are specialized for working with ranges.</p></li></ul><p>Non-equi joins were requested back in 2016, and were the highest requested dplyr feature at the time they were finally implemented, with over
<a href=https://github.com/tidyverse/dplyr/issues/2240 target=_blank rel=noopener>147 thumbs up</a>! data.table has had support for non-equi joins for many years, and their implementation greatly inspired the one used in dplyr.</p><p>To demonstrate the different types of non-equi joins, imagine that you are in charge of the party planning committee for your office. Unfortunately, you only get to have one party per quarter, but it is your job to ensure that every employee is assigned to a single party. Upper management has provided the following 4 party dates:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>parties</span> <span class=o>&lt;-</span> <span class=nf><a href=https://tibble.tidyverse.org/reference/tibble.html>tibble</a></span><span class=o>(</span></span>
<span>  q <span class=o>=</span> <span class=m>1</span><span class=o>:</span><span class=m>4</span>,</span>
<span>  party <span class=o>=</span> <span class=nf><a href=https://clock.r-lib.org/reference/date_parse.html>date_parse</a></span><span class=o>(</span><span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=s>"2022-01-10"</span>, <span class=s>"2022-04-04"</span>, <span class=s>"2022-07-11"</span>, <span class=s>"2022-10-03"</span><span class=o>)</span><span class=o>)</span></span>
<span><span class=o>)</span></span>
<span></span>
<span><span class=nv>parties</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 4 × 2</span></span></span>
<span><span class=c>#&gt;       q party     </span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;int&gt;</span> <span style=color:#555;font-style:italic>&lt;date&gt;</span>    </span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span>     1 2022-01-10</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span>     2 2022-04-04</span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span>     3 2022-07-11</span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span>     4 2022-10-03</span></span>
<span></span></code></pre></div><p>With this set of employees:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>employees</span> <span class=o>&lt;-</span> <span class=nf><a href=https://tibble.tidyverse.org/reference/tibble.html>tibble</a></span><span class=o>(</span></span>
<span>  name <span class=o>=</span> <span class=nf>wakefield</span><span class=nf>::</span><span class=nf><a href=https://rdrr.io/pkg/wakefield/man/name.html>name</a></span><span class=o>(</span><span class=m>100</span><span class=o>)</span>,</span>
<span>  birthday <span class=o>=</span> <span class=nf><a href=https://clock.r-lib.org/reference/date_parse.html>date_parse</a></span><span class=o>(</span><span class=s>"2022-01-01"</span><span class=o>)</span> <span class=o>+</span> <span class=o>(</span><span class=nf><a href=https://rdrr.io/r/base/sample.html>sample</a></span><span class=o>(</span><span class=m>365</span>, <span class=m>100</span>, replace <span class=o>=</span> <span class=kc>TRUE</span><span class=o>)</span> <span class=o>-</span> <span class=m>1</span><span class=o>)</span></span>
<span><span class=o>)</span></span>
<span></span>
<span><span class=nv>employees</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 100 × 2</span></span></span>
<span><span class=c>#&gt;    name       birthday  </span></span>
<span><span class=c>#&gt;    <span style=color:#555;font-style:italic>&lt;variable&gt;</span> <span style=color:#555;font-style:italic>&lt;date&gt;</span>    </span></span>
<span><span class=c>#&gt; <span style=color:#555> 1</span> Seager     2022-08-26</span></span>
<span><span class=c>#&gt; <span style=color:#555> 2</span> Nathion    2022-10-04</span></span>
<span><span class=c>#&gt; <span style=color:#555> 3</span> Sametra    2022-06-13</span></span>
<span><span class=c>#&gt; <span style=color:#555> 4</span> Netty      2022-05-12</span></span>
<span><span class=c>#&gt; <span style=color:#555> 5</span> Yalissa    2022-05-28</span></span>
<span><span class=c>#&gt; <span style=color:#555> 6</span> Mirai      2022-08-20</span></span>
<span><span class=c>#&gt; <span style=color:#555> 7</span> Toyoko     2022-08-23</span></span>
<span><span class=c>#&gt; <span style=color:#555> 8</span> Earlene    2022-04-21</span></span>
<span><span class=c>#&gt; <span style=color:#555> 9</span> Abbegayle  2022-01-27</span></span>
<span><span class=c>#&gt; <span style=color:#555>10</span> Valyssa    2022-03-06</span></span>
<span><span class=c>#&gt; <span style=color:#555># … with 90 more rows</span></span></span>
<span></span></code></pre></div><p>One way to start approaching this problem is to look for the party that happened directly before each birthday. You can do this with an inequality join:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>employees</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://dplyr.tidyverse.org/reference/mutate-joins.html>left_join</a></span><span class=o>(</span><span class=nv>parties</span>, <span class=nf><a href=https://dplyr.tidyverse.org/reference/join_by.html>join_by</a></span><span class=o>(</span><span class=nv>birthday</span> <span class=o>&gt;=</span> <span class=nv>party</span><span class=o>)</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 251 × 4</span></span></span>
<span><span class=c>#&gt;    name       birthday       q party     </span></span>
<span><span class=c>#&gt;    <span style=color:#555;font-style:italic>&lt;variable&gt;</span> <span style=color:#555;font-style:italic>&lt;date&gt;</span>     <span style=color:#555;font-style:italic>&lt;int&gt;</span> <span style=color:#555;font-style:italic>&lt;date&gt;</span>    </span></span>
<span><span class=c>#&gt; <span style=color:#555> 1</span> Seager     2022-08-26     1 2022-01-10</span></span>
<span><span class=c>#&gt; <span style=color:#555> 2</span> Seager     2022-08-26     2 2022-04-04</span></span>
<span><span class=c>#&gt; <span style=color:#555> 3</span> Seager     2022-08-26     3 2022-07-11</span></span>
<span><span class=c>#&gt; <span style=color:#555> 4</span> Nathion    2022-10-04     1 2022-01-10</span></span>
<span><span class=c>#&gt; <span style=color:#555> 5</span> Nathion    2022-10-04     2 2022-04-04</span></span>
<span><span class=c>#&gt; <span style=color:#555> 6</span> Nathion    2022-10-04     3 2022-07-11</span></span>
<span><span class=c>#&gt; <span style=color:#555> 7</span> Nathion    2022-10-04     4 2022-10-03</span></span>
<span><span class=c>#&gt; <span style=color:#555> 8</span> Sametra    2022-06-13     1 2022-01-10</span></span>
<span><span class=c>#&gt; <span style=color:#555> 9</span> Sametra    2022-06-13     2 2022-04-04</span></span>
<span><span class=c>#&gt; <span style=color:#555>10</span> Netty      2022-05-12     1 2022-01-10</span></span>
<span><span class=c>#&gt; <span style=color:#555># … with 241 more rows</span></span></span>
<span></span></code></pre></div><p>This looks like a good start, but we&rsquo;ve assigned people with birthdays later in the year to multiple parties. We can restrict this to only the party that is <em>closest</em> to the employee&rsquo;s birthday by using a rolling join. Rolling joins are activated by wrapping an inequality in <code>closest()</code>.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>closest</span> <span class=o>&lt;-</span> <span class=nv>employees</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://dplyr.tidyverse.org/reference/mutate-joins.html>left_join</a></span><span class=o>(</span><span class=nv>parties</span>, <span class=nf><a href=https://dplyr.tidyverse.org/reference/join_by.html>join_by</a></span><span class=o>(</span><span class=nf>closest</span><span class=o>(</span><span class=nv>birthday</span> <span class=o>&gt;=</span> <span class=nv>party</span><span class=o>)</span><span class=o>)</span><span class=o>)</span></span>
<span></span>
<span><span class=nv>closest</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 100 × 4</span></span></span>
<span><span class=c>#&gt;    name       birthday       q party     </span></span>
<span><span class=c>#&gt;    <span style=color:#555;font-style:italic>&lt;variable&gt;</span> <span style=color:#555;font-style:italic>&lt;date&gt;</span>     <span style=color:#555;font-style:italic>&lt;int&gt;</span> <span style=color:#555;font-style:italic>&lt;date&gt;</span>    </span></span>
<span><span class=c>#&gt; <span style=color:#555> 1</span> Seager     2022-08-26     3 2022-07-11</span></span>
<span><span class=c>#&gt; <span style=color:#555> 2</span> Nathion    2022-10-04     4 2022-10-03</span></span>
<span><span class=c>#&gt; <span style=color:#555> 3</span> Sametra    2022-06-13     2 2022-04-04</span></span>
<span><span class=c>#&gt; <span style=color:#555> 4</span> Netty      2022-05-12     2 2022-04-04</span></span>
<span><span class=c>#&gt; <span style=color:#555> 5</span> Yalissa    2022-05-28     2 2022-04-04</span></span>
<span><span class=c>#&gt; <span style=color:#555> 6</span> Mirai      2022-08-20     3 2022-07-11</span></span>
<span><span class=c>#&gt; <span style=color:#555> 7</span> Toyoko     2022-08-23     3 2022-07-11</span></span>
<span><span class=c>#&gt; <span style=color:#555> 8</span> Earlene    2022-04-21     2 2022-04-04</span></span>
<span><span class=c>#&gt; <span style=color:#555> 9</span> Abbegayle  2022-01-27     1 2022-01-10</span></span>
<span><span class=c>#&gt; <span style=color:#555>10</span> Valyssa    2022-03-06     1 2022-01-10</span></span>
<span><span class=c>#&gt; <span style=color:#555># … with 90 more rows</span></span></span>
<span></span></code></pre></div><p>This is close to what we want, but isn&rsquo;t <em>quite</em> right. It turns out that poor Della hasn&rsquo;t been assigned to a party.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://dplyr.tidyverse.org/reference/filter.html>filter</a></span><span class=o>(</span><span class=nv>closest</span>, <span class=nf><a href=https://rdrr.io/r/base/NA.html>is.na</a></span><span class=o>(</span><span class=nv>party</span><span class=o>)</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 1 × 4</span></span></span>
<span><span class=c>#&gt;   name       birthday       q party </span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;variable&gt;</span> <span style=color:#555;font-style:italic>&lt;date&gt;</span>     <span style=color:#555;font-style:italic>&lt;int&gt;</span> <span style=color:#555;font-style:italic>&lt;date&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span> Della      2022-01-06    <span style=color:#b00>NA</span> <span style=color:#b00>NA</span></span></span>
<span></span></code></pre></div><p>This is because their birthday occurred before the first party date, <code>2022-01-10</code>, so there wasn&rsquo;t any &ldquo;previous party&rdquo; to match them to. It&rsquo;s a little easier to fix this if we are explicit about the quarter start/end dates that form the ranges to look for matches in:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=c># Some helpers from &#123;clock&#125;</span></span>
<span><span class=nv>quarter_start</span> <span class=o>&lt;-</span> <span class=kr>function</span><span class=o>(</span><span class=nv>x</span><span class=o>)</span> <span class=o>&#123;</span></span>
<span>  <span class=nv>x</span> <span class=o>&lt;-</span> <span class=nf><a href=https://clock.r-lib.org/reference/as_year_quarter_day.html>as_year_quarter_day</a></span><span class=o>(</span><span class=nv>x</span><span class=o>)</span></span>
<span>  <span class=nv>x</span> <span class=o>&lt;-</span> <span class=nf><a href=https://clock.r-lib.org/reference/calendar-boundary.html>calendar_start</a></span><span class=o>(</span><span class=nv>x</span>, <span class=s>"quarter"</span><span class=o>)</span></span>
<span>  <span class=nf><a href=https://clock.r-lib.org/reference/as_date.html>as_date</a></span><span class=o>(</span><span class=nv>x</span><span class=o>)</span></span>
<span><span class=o>&#125;</span></span>
<span><span class=nv>quarter_end</span> <span class=o>&lt;-</span> <span class=kr>function</span><span class=o>(</span><span class=nv>x</span><span class=o>)</span> <span class=o>&#123;</span></span>
<span>  <span class=nv>x</span> <span class=o>&lt;-</span> <span class=nf><a href=https://clock.r-lib.org/reference/as_year_quarter_day.html>as_year_quarter_day</a></span><span class=o>(</span><span class=nv>x</span><span class=o>)</span></span>
<span>  <span class=nv>x</span> <span class=o>&lt;-</span> <span class=nf><a href=https://clock.r-lib.org/reference/calendar-boundary.html>calendar_end</a></span><span class=o>(</span><span class=nv>x</span>, <span class=s>"quarter"</span><span class=o>)</span></span>
<span>  <span class=nf><a href=https://rdrr.io/r/base/as.Date.html>as.Date</a></span><span class=o>(</span><span class=nv>x</span><span class=o>)</span></span>
<span><span class=o>&#125;</span></span>
<span></span>
<span><span class=nv>parties</span> <span class=o>&lt;-</span> <span class=nv>parties</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://dplyr.tidyverse.org/reference/mutate.html>mutate</a></span><span class=o>(</span>start <span class=o>=</span> <span class=nf>quarter_start</span><span class=o>(</span><span class=nv>party</span><span class=o>)</span>, end <span class=o>=</span> <span class=nf>quarter_end</span><span class=o>(</span><span class=nv>party</span><span class=o>)</span><span class=o>)</span></span>
<span></span>
<span><span class=nv>parties</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 4 × 4</span></span></span>
<span><span class=c>#&gt;       q party      start      end       </span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;int&gt;</span> <span style=color:#555;font-style:italic>&lt;date&gt;</span>     <span style=color:#555;font-style:italic>&lt;date&gt;</span>     <span style=color:#555;font-style:italic>&lt;date&gt;</span>    </span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span>     1 2022-01-10 2022-01-01 2022-03-31</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span>     2 2022-04-04 2022-04-01 2022-06-30</span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span>     3 2022-07-11 2022-07-01 2022-09-30</span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span>     4 2022-10-03 2022-10-01 2022-12-31</span></span>
<span></span></code></pre></div><p>Now that we have 4 distinct <em>ranges</em> of dates to work with, we&rsquo;ll use an overlap join to figure out which range each birthday fell
<a href=https://dplyr.tidyverse.org/reference/between.html target=_blank rel=noopener><code>between()</code></a>. Since we know that each birthday should be matched to exactly one party, we&rsquo;ll also take this chance to set <code>multiple</code>, a new argument to the join functions that allows you to optionally <code>"error"</code> if a birthday is matched to multiple parties.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>employees</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://dplyr.tidyverse.org/reference/mutate-joins.html>left_join</a></span><span class=o>(</span></span>
<span>    <span class=nv>parties</span>, </span>
<span>    <span class=nf><a href=https://dplyr.tidyverse.org/reference/join_by.html>join_by</a></span><span class=o>(</span><span class=nf><a href=https://dplyr.tidyverse.org/reference/between.html>between</a></span><span class=o>(</span><span class=nv>birthday</span>, <span class=nv>start</span>, <span class=nv>end</span><span class=o>)</span><span class=o>)</span>,</span>
<span>    multiple <span class=o>=</span> <span class=s>"error"</span></span>
<span>  <span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 100 × 6</span></span></span>
<span><span class=c>#&gt;    name       birthday       q party      start      end       </span></span>
<span><span class=c>#&gt;    <span style=color:#555;font-style:italic>&lt;variable&gt;</span> <span style=color:#555;font-style:italic>&lt;date&gt;</span>     <span style=color:#555;font-style:italic>&lt;int&gt;</span> <span style=color:#555;font-style:italic>&lt;date&gt;</span>     <span style=color:#555;font-style:italic>&lt;date&gt;</span>     <span style=color:#555;font-style:italic>&lt;date&gt;</span>    </span></span>
<span><span class=c>#&gt; <span style=color:#555> 1</span> Seager     2022-08-26     3 2022-07-11 2022-07-01 2022-09-30</span></span>
<span><span class=c>#&gt; <span style=color:#555> 2</span> Nathion    2022-10-04     4 2022-10-03 2022-10-01 2022-12-31</span></span>
<span><span class=c>#&gt; <span style=color:#555> 3</span> Sametra    2022-06-13     2 2022-04-04 2022-04-01 2022-06-30</span></span>
<span><span class=c>#&gt; <span style=color:#555> 4</span> Netty      2022-05-12     2 2022-04-04 2022-04-01 2022-06-30</span></span>
<span><span class=c>#&gt; <span style=color:#555> 5</span> Yalissa    2022-05-28     2 2022-04-04 2022-04-01 2022-06-30</span></span>
<span><span class=c>#&gt; <span style=color:#555> 6</span> Mirai      2022-08-20     3 2022-07-11 2022-07-01 2022-09-30</span></span>
<span><span class=c>#&gt; <span style=color:#555> 7</span> Toyoko     2022-08-23     3 2022-07-11 2022-07-01 2022-09-30</span></span>
<span><span class=c>#&gt; <span style=color:#555> 8</span> Earlene    2022-04-21     2 2022-04-04 2022-04-01 2022-06-30</span></span>
<span><span class=c>#&gt; <span style=color:#555> 9</span> Abbegayle  2022-01-27     1 2022-01-10 2022-01-01 2022-03-31</span></span>
<span><span class=c>#&gt; <span style=color:#555>10</span> Valyssa    2022-03-06     1 2022-01-10 2022-01-01 2022-03-31</span></span>
<span><span class=c>#&gt; <span style=color:#555># … with 90 more rows</span></span></span>
<span></span></code></pre></div><p>We consider <code>multiple</code> to be an important &ldquo;quality control&rdquo; argument to help you enforce constraints on the join procedure.</p><h3 id=multiple-matches>Multiple matches
<a href=#multiple-matches><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>Speaking of <code>multiple</code>, we&rsquo;ve also given this argument an important default. When doing data analysis with equi-joins, it is often surprising when a join returns more rows than were present in the left-hand side table.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>df1</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 3 × 3</span></span></span>
<span><span class=c>#&gt;    x_id region     x</span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>  <span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span>     1 A          5</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span>     2 B         10</span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span>     2 A          4</span></span>
<span></span><span></span>
<span><span class=nv>df2</span> <span class=o>&lt;-</span> <span class=nf><a href=https://tibble.tidyverse.org/reference/tibble.html>tibble</a></span><span class=o>(</span>y_id <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=m>1</span>, <span class=m>2</span>, <span class=m>1</span>, <span class=m>2</span><span class=o>)</span>, region <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=s>"A"</span>, <span class=s>"B"</span>, <span class=s>"A"</span>, <span class=s>"A"</span><span class=o>)</span>, y <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=m>9</span>, <span class=m>10</span>, <span class=m>12</span>, <span class=m>4</span><span class=o>)</span><span class=o>)</span></span>
<span><span class=nv>df2</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 4 × 3</span></span></span>
<span><span class=c>#&gt;    y_id region     y</span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>  <span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span>     1 A          9</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span>     2 B         10</span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span>     1 A         12</span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span>     2 A          4</span></span>
<span></span><span></span>
<span><span class=nv>df1</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://dplyr.tidyverse.org/reference/mutate-joins.html>left_join</a></span><span class=o>(</span><span class=nv>df2</span>, <span class=nf><a href=https://dplyr.tidyverse.org/reference/join_by.html>join_by</a></span><span class=o>(</span><span class=nv>x_id</span> <span class=o>==</span> <span class=nv>y_id</span>, <span class=nv>region</span><span class=o>)</span><span class=o>)</span></span>
<span><span class=c>#&gt; Warning in left_join(df1, df2, join_by(x_id == y_id, region)): Each row in `x` is expected to match at most 1 row in `y`.</span></span>
<span><span class=c>#&gt; <span style=color:#0bb>ℹ</span> Row 1 of `x` matches multiple rows.</span></span>
<span><span class=c>#&gt; <span style=color:#0bb>ℹ</span> If multiple matches are expected, set `multiple = "all"` to silence this</span></span>
<span><span class=c>#&gt;   warning.</span></span>
<span></span><span><span class=c>#&gt; <span style=color:#555># A tibble: 4 × 4</span></span></span>
<span><span class=c>#&gt;    x_id region     x     y</span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>  <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span>     1 A          5     9</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span>     1 A          5    12</span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span>     2 B         10    10</span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span>     2 A          4     4</span></span>
<span></span></code></pre></div><p>In this case, row 1 of <code>df1</code> matched both rows <code>1</code> and <code>3</code> of <code>df2</code>, so the output has 4 rows rather than <code>df1</code>'s 3. While this is standard SQL behavior, community feedback has shown that many people don&rsquo;t expect this, and a number of people were horrified to learn that this was even possible! Because of this, we&rsquo;ve made this case a warning by default, which you can silence with <code>multiple = "all"</code>.</p><h2 id=arrange-improvements-with-character-vectors><code>arrange()</code> improvements with character vectors
<a href=#arrange-improvements-with-character-vectors><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p><a href=https://dplyr.tidyverse.org/reference/arrange.html target=_blank rel=noopener><code>arrange()</code></a> now uses a new custom backend for generating the ordering. This generally improves performance, but it is especially apparent with character vectors.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=c># 10,000 random strings, sampled up to 1,000,000 rows</span></span>
<span><span class=nv>dictionary</span> <span class=o>&lt;-</span> <span class=nf>stringi</span><span class=nf>::</span><span class=nf><a href=https://rdrr.io/pkg/stringi/man/stri_rand_strings.html>stri_rand_strings</a></span><span class=o>(</span><span class=m>10000</span>, length <span class=o>=</span> <span class=m>10</span>, pattern <span class=o>=</span> <span class=s>"[a-z]"</span><span class=o>)</span></span>
<span><span class=nv>str</span> <span class=o>&lt;-</span> <span class=nf><a href=https://tibble.tidyverse.org/reference/tibble.html>tibble</a></span><span class=o>(</span>x <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/sample.html>sample</a></span><span class=o>(</span><span class=nv>dictionary</span>, size <span class=o>=</span> <span class=m>1e6</span>, replace <span class=o>=</span> <span class=kc>TRUE</span><span class=o>)</span><span class=o>)</span></span>
<span><span class=nv>str</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 1,000,000 × 1</span></span></span>
<span><span class=c>#&gt;    x         </span></span>
<span><span class=c>#&gt;    <span style=color:#555;font-style:italic>&lt;chr&gt;</span>     </span></span>
<span><span class=c>#&gt; <span style=color:#555> 1</span> btjgpowbav</span></span>
<span><span class=c>#&gt; <span style=color:#555> 2</span> jrddujrxwt</span></span>
<span><span class=c>#&gt; <span style=color:#555> 3</span> ofgkybvsoo</span></span>
<span><span class=c>#&gt; <span style=color:#555> 4</span> dzyxfvwktu</span></span>
<span><span class=c>#&gt; <span style=color:#555> 5</span> qobgfmkgof</span></span>
<span><span class=c>#&gt; <span style=color:#555> 6</span> rmzjvtnpbf</span></span>
<span><span class=c>#&gt; <span style=color:#555> 7</span> jxrqgxouqg</span></span>
<span><span class=c>#&gt; <span style=color:#555> 8</span> empcmhnlqq</span></span>
<span><span class=c>#&gt; <span style=color:#555> 9</span> nwfgauiurp</span></span>
<span><span class=c>#&gt; <span style=color:#555>10</span> hdswclaxys</span></span>
<span><span class=c>#&gt; <span style=color:#555># … with 999,990 more rows</span></span></span>
<span></span></code></pre></div><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=c># dplyr 1.0.10</span></span>
<span><span class=nf>bench</span><span class=nf>::</span><span class=nf><a href=http://bench.r-lib.org/reference/mark.html>mark</a></span><span class=o>(</span><span class=nf><a href=https://dplyr.tidyverse.org/reference/arrange.html>arrange</a></span><span class=o>(</span><span class=nv>str</span>, <span class=nv>x</span><span class=o>)</span>, iterations <span class=o>=</span> <span class=m>100</span><span class=o>)</span></span>
<span><span class=c>#&gt; # A tibble: 1 × 6</span></span>
<span><span class=c>#&gt;   expression          min   median `itr/sec` mem_alloc `gc/sec`</span></span>
<span><span class=c>#&gt;   &lt;bch:expr&gt;     &lt;bch:tm&gt; &lt;bch:tm&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt;</span></span>
<span><span class=c>#&gt; 1 arrange(str, x)   4.38s    4.89s     0.204    12.7MB    0.148</span></span>
<span></span>
<span><span class=c># dplyr 1.1.0</span></span>
<span><span class=nf>bench</span><span class=nf>::</span><span class=nf><a href=http://bench.r-lib.org/reference/mark.html>mark</a></span><span class=o>(</span><span class=nf><a href=https://dplyr.tidyverse.org/reference/arrange.html>arrange</a></span><span class=o>(</span><span class=nv>str</span>, <span class=nv>x</span><span class=o>)</span>, iterations <span class=o>=</span> <span class=m>100</span><span class=o>)</span></span>
<span><span class=c>#&gt; # A tibble: 1 × 6</span></span>
<span><span class=c>#&gt;   expression          min   median `itr/sec` mem_alloc `gc/sec`</span></span>
<span><span class=c>#&gt;   &lt;bch:expr&gt;     &lt;bch:tm&gt; &lt;bch:tm&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt;</span></span>
<span><span class=c>#&gt; 1 arrange(str, x)  42.3ms   46.6ms      20.8    22.4MB     46.0</span></span></code></pre></div><p>For those keeping score, that is a 100x improvement! Now, I&rsquo;ll be honest, I&rsquo;m being a bit tricky here. The new backend for
<a href=https://dplyr.tidyverse.org/reference/arrange.html target=_blank rel=noopener><code>arrange()</code></a> comes with a meaningful change in behavior - it now sorts character strings in the C locale by default, rather than in the much slower system locale (American English, for me). We made this change for two main reasons:</p><ul><li><p>Much faster performance by default, because it can use {vctrs} radix sort (inspired by data.table)</p></li><li><p>Improved reproducibility across R sessions, where different computers might use different system locales</p></li></ul><p>For English users, we expect this change to have fairly minimal impact. The largest difference in ordering between the C and American English locales has to do with capitalization. In the C locale, uppercase letters are always placed before <em>any</em> lowercase letters. In the American English locale, uppercase letters are placed directly after their lowercase equivalent.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>df</span> <span class=o>&lt;-</span> <span class=nf><a href=https://tibble.tidyverse.org/reference/tibble.html>tibble</a></span><span class=o>(</span>x <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=s>"a"</span>, <span class=s>"B"</span>, <span class=s>"A"</span>, <span class=s>"b"</span><span class=o>)</span><span class=o>)</span></span>
<span></span>
<span><span class=nf><a href=https://dplyr.tidyverse.org/reference/arrange.html>arrange</a></span><span class=o>(</span><span class=nv>df</span>, <span class=nv>x</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 4 × 1</span></span></span>
<span><span class=c>#&gt;   x    </span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;chr&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span> A    </span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span> B    </span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span> a    </span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span> b</span></span>
<span></span></code></pre></div><p>If you do need to order with a specific locale, you can specify the new <code>.locale</code> argument, which takes a locale identifier string, just like
<a href=https://stringr.tidyverse.org/reference/str_order.html target=_blank rel=noopener><code>stringr::str_sort()</code></a>.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://dplyr.tidyverse.org/reference/arrange.html>arrange</a></span><span class=o>(</span><span class=nv>df</span>, <span class=nv>x</span>, .locale <span class=o>=</span> <span class=s>"en"</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 4 × 1</span></span></span>
<span><span class=c>#&gt;   x    </span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;chr&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span> a    </span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span> A    </span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span> b    </span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span> B</span></span>
<span></span></code></pre></div><p>To use this optional <code>.locale</code> feature, you must have the stringi package installed, but you likely already do because it is installed with the tidyverse by default.</p><p>It is also worth noting that using <code>.locale</code> is still much faster than relying on the system locale.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=c># Compare with ~5 seconds above with dplyr 1.0.10</span></span>
<span></span>
<span><span class=nf>bench</span><span class=nf>::</span><span class=nf><a href=http://bench.r-lib.org/reference/mark.html>mark</a></span><span class=o>(</span><span class=nf><a href=https://dplyr.tidyverse.org/reference/arrange.html>arrange</a></span><span class=o>(</span><span class=nv>str</span>, <span class=nv>x</span>, .locale <span class=o>=</span> <span class=s>"en"</span><span class=o>)</span>, iterations <span class=o>=</span> <span class=m>100</span><span class=o>)</span></span>
<span><span class=c>#&gt; # A tibble: 1 × 6</span></span>
<span><span class=c>#&gt;   expression                           min median `itr/sec` mem_alloc</span></span>
<span><span class=c>#&gt;   &lt;bch:expr&gt;                      &lt;bch:tm&gt; &lt;bch:&gt;     &lt;dbl&gt; &lt;bch:byt&gt;</span></span>
<span><span class=c>#&gt; 1 arrange(str, x, .locale = "en")    377ms  430ms      2.21    27.9MB</span></span>
<span><span class=c>#&gt; # … with 1 more variable: `gc/sec` &lt;dbl&gt;</span></span></code></pre></div><p>For non-English Latin script languages, such as Spanish, you may see more of a change, as characters such as <code>ñ</code> are ordered after <code>z</code> rather than before <code>n</code> in the C locale:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>df</span> <span class=o>&lt;-</span> <span class=nf><a href=https://tibble.tidyverse.org/reference/tibble.html>tibble</a></span><span class=o>(</span>x <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=s>"\u00F1"</span>, <span class=s>"n"</span>, <span class=s>"z"</span><span class=o>)</span><span class=o>)</span></span>
<span><span class=nv>df</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 3 × 1</span></span></span>
<span><span class=c>#&gt;   x    </span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;chr&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span> ñ    </span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span> n    </span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span> z</span></span>
<span></span><span></span>
<span><span class=nf><a href=https://dplyr.tidyverse.org/reference/arrange.html>arrange</a></span><span class=o>(</span><span class=nv>df</span>, <span class=nv>x</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 3 × 1</span></span></span>
<span><span class=c>#&gt;   x    </span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;chr&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span> n    </span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span> z    </span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span> ñ</span></span>
<span></span><span></span>
<span><span class=nf><a href=https://dplyr.tidyverse.org/reference/arrange.html>arrange</a></span><span class=o>(</span><span class=nv>df</span>, <span class=nv>x</span>, .locale <span class=o>=</span> <span class=s>"es"</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 3 × 1</span></span></span>
<span><span class=c>#&gt;   x    </span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;chr&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span> n    </span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span> ñ    </span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span> z</span></span>
<span></span></code></pre></div><p>We are optimistic that this change is an overall net positive. We anticipate that many users use
<a href=https://dplyr.tidyverse.org/reference/arrange.html target=_blank rel=noopener><code>arrange()</code></a> to simply group similar looking observations together, and we expect that the main places you&rsquo;ll need to care about localized ordering are the few places when you are generating human readable output, such as a table or a chart, at which point you might consider using <code>.locale</code>.</p><p>If you are having trouble converting an existing script over to the new behavior, you can set the temporary global option <code>options(dplyr.legacy_locale = TRUE)</code>, which will revert to the pre-1.1.0 behavior of using the system locale. We expect to remove this option in a future release.</p><p>To learn more low-level details about this change, you can read our
<a href=https://github.com/tidyverse/tidyups/blob/main/003-dplyr-radix-ordering.md target=_blank rel=noopener>tidyup</a>.</p><h2 id=reframe-a-generalization-of-summarise><code>reframe()</code>, a generalization of <code>summarise()</code>
<a href=#reframe-a-generalization-of-summarise><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>In dplyr 1.0.0, we introduced a powerful new feature:
<a href=https://dplyr.tidyverse.org/reference/summarise.html target=_blank rel=noopener><code>summarise()</code></a> could return per-group results of any length, rather than just length 1. For example:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>table</span> <span class=o>&lt;-</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=s>"a"</span>, <span class=s>"b"</span>, <span class=s>"d"</span>, <span class=s>"f"</span><span class=o>)</span></span>
<span></span>
<span><span class=nv>df</span> <span class=o>&lt;-</span> <span class=nf><a href=https://tibble.tidyverse.org/reference/tibble.html>tibble</a></span><span class=o>(</span></span>
<span>  g <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=m>1</span>, <span class=m>1</span>, <span class=m>1</span>, <span class=m>2</span>, <span class=m>2</span>, <span class=m>2</span>, <span class=m>2</span><span class=o>)</span>,</span>
<span>  x <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=s>"e"</span>, <span class=s>"a"</span>, <span class=s>"b"</span>, <span class=s>"c"</span>, <span class=s>"f"</span>, <span class=s>"d"</span>, <span class=s>"a"</span><span class=o>)</span></span>
<span><span class=o>)</span></span>
<span></span>
<span><span class=nv>df</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://dplyr.tidyverse.org/reference/summarise.html>summarise</a></span><span class=o>(</span>x <span class=o>=</span> <span class=nf><a href=https://generics.r-lib.org/reference/setops.html>intersect</a></span><span class=o>(</span><span class=nv>x</span>, <span class=nv>table</span><span class=o>)</span>, .by <span class=o>=</span> <span class=nv>g</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 5 × 2</span></span></span>
<span><span class=c>#&gt;       g x    </span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span>     1 a    </span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span>     1 b    </span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span>     2 f    </span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span>     2 d    </span></span>
<span><span class=c>#&gt; <span style=color:#555>5</span>     2 a</span></span>
<span></span></code></pre></div><p>While extremely powerful, community feedback has raised the valid concern that allowing
<a href=https://dplyr.tidyverse.org/reference/summarise.html target=_blank rel=noopener><code>summarise()</code></a> to return any number of rows per group:</p><ul><li><p>Increases the chance for accidental bugs</p></li><li><p>Is against the spirit of a &ldquo;summary,&rdquo; which implies 1 row per group</p></li><li><p>Makes translation to dbplyr very difficult</p></li></ul><p>We agree! In response to this, we&rsquo;ve decided to walk back that change to
<a href=https://dplyr.tidyverse.org/reference/summarise.html target=_blank rel=noopener><code>summarise()</code></a>, which will now throw a warning when either 0 or >1 rows are returned per group:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>df</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://dplyr.tidyverse.org/reference/summarise.html>summarise</a></span><span class=o>(</span>x <span class=o>=</span> <span class=nf><a href=https://generics.r-lib.org/reference/setops.html>intersect</a></span><span class=o>(</span><span class=nv>x</span>, <span class=nv>table</span><span class=o>)</span>, .by <span class=o>=</span> <span class=nv>g</span><span class=o>)</span></span>
<span><span class=c>#&gt; Warning: Returning more (or less) than 1 row per `summarise()` group was deprecated in</span></span>
<span><span class=c>#&gt; dplyr 1.1.0.</span></span>
<span><span class=c>#&gt; <span style=color:#0bb>ℹ</span> Please use `reframe()` instead.</span></span>
<span><span class=c>#&gt; <span style=color:#0bb>ℹ</span> When switching from `summarise()` to `reframe()`, remember that `reframe()`</span></span>
<span><span class=c>#&gt;   always returns an ungrouped data frame and adjust accordingly.</span></span>
<span></span><span><span class=c>#&gt; <span style=color:#555># A tibble: 5 × 2</span></span></span>
<span><span class=c>#&gt;       g x    </span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span>     1 a    </span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span>     1 b    </span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span>     2 f    </span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span>     2 d    </span></span>
<span><span class=c>#&gt; <span style=color:#555>5</span>     2 a</span></span>
<span></span></code></pre></div><p>That said, we still believe that this is a powerful tool, so we&rsquo;ve moved these features to a new verb,
<a href=https://dplyr.tidyverse.org/reference/reframe.html target=_blank rel=noopener><code>reframe()</code></a>. Think of
<a href=https://dplyr.tidyverse.org/reference/reframe.html target=_blank rel=noopener><code>reframe()</code></a> as a generic tool for &ldquo;doing something to each group,&rdquo; with no restrictions on the number of rows returned per group.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>df</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://dplyr.tidyverse.org/reference/reframe.html>reframe</a></span><span class=o>(</span>x <span class=o>=</span> <span class=nf><a href=https://generics.r-lib.org/reference/setops.html>intersect</a></span><span class=o>(</span><span class=nv>x</span>, <span class=nv>table</span><span class=o>)</span>, .by <span class=o>=</span> <span class=nv>g</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 5 × 2</span></span></span>
<span><span class=c>#&gt;       g x    </span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span>     1 a    </span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span>     1 b    </span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span>     2 f    </span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span>     2 d    </span></span>
<span><span class=c>#&gt; <span style=color:#555>5</span>     2 a</span></span>
<span></span></code></pre></div><p>One big difference between
<a href=https://dplyr.tidyverse.org/reference/summarise.html target=_blank rel=noopener><code>summarise()</code></a> and
<a href=https://dplyr.tidyverse.org/reference/reframe.html target=_blank rel=noopener><code>reframe()</code></a> is that
<a href=https://dplyr.tidyverse.org/reference/reframe.html target=_blank rel=noopener><code>reframe()</code></a> always returns an ungrouped data frame, even if the input was a grouped data frame with multiple group columns. This simplifies
<a href=https://dplyr.tidyverse.org/reference/reframe.html target=_blank rel=noopener><code>reframe()</code></a> immensely, as it doesn&rsquo;t need to inherit the <code>.groups</code> argument of
<a href=https://dplyr.tidyverse.org/reference/summarise.html target=_blank rel=noopener><code>summarise()</code></a>, and never emits any messages.</p><p>We expect that you&rsquo;ll continue to use
<a href=https://dplyr.tidyverse.org/reference/summarise.html target=_blank rel=noopener><code>summarise()</code></a> much more often than
<a href=https://dplyr.tidyverse.org/reference/reframe.html target=_blank rel=noopener><code>reframe()</code></a>, but if you ever find yourself applying a function to each group that returns an arbitrary number of rows,
<a href=https://dplyr.tidyverse.org/reference/reframe.html target=_blank rel=noopener><code>reframe()</code></a> should be your go-to tool!</p><p><a href=https://dplyr.tidyverse.org/reference/reframe.html target=_blank rel=noopener><code>reframe()</code></a> is one of the places we could use your feedback! We aren&rsquo;t completely confident about this function name yet, so if you have any feedback about it or suggestions for an alternate one, please leave a comment on this
<a href=https://github.com/tidyverse/dplyr/issues/6565 target=_blank rel=noopener>issue</a>.</p></div></div><div class=column25><div class="section hideOnMobile"><div class=sectionTitle>Contents</div><nav id=TableOfContents><ul><li><a href=#temporary-grouping-with-by>Temporary grouping with <code>.by</code></a></li><li><a href=#join-improvements>Join improvements</a></li><li><a href=#arrange-improvements-with-character-vectors><code>arrange()</code> improvements with character vectors</a></li><li><a href=#reframe-a-generalization-of-summarise><code>reframe()</code>, a generalization of <code>summarise()</code></a></li></ul></nav></div><div class=section></div></div></div></div></div><div id=rStudioFooter class=band><div class=bandContent><div id=copyright>The tidyverse is proudly supported by <a class=rstudioLogo href=https://posit.co/ aria-label="Posit Homepage"></a></div><div id=logos><a href=https://www.tidyverse.org/google_privacy_policy>Privacy policy</a>
<a href=https://github.com/tidyverse class="footerLogo gitHub" aria-label="Tidyverse GitHub organization"></a><a href=https://twitter.com/hashtag/rstats class="footerLogo twitter" aria-label="rstats hashtag on twitter.com"></a></div></div></div></div></div><script src=/js/math-code.js></script><script type=text/x-mathjax-config>
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script><script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script type=application/javascript>var dnt=(navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack);var doNotTrack=(dnt=="1"||dnt=="yes");if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');if(window.sessionStorage){var GA_SESSION_STORAGE_KEY='ga:clientId';ga('create','UA-115082821-1',{'storage':'none','clientId':sessionStorage.getItem(GA_SESSION_STORAGE_KEY)});ga(function(tracker){sessionStorage.setItem(GA_SESSION_STORAGE_KEY,tracker.get('clientId'));});}
ga('set','anonymizeIp',true);ga('send','pageview');}</script></body></html></div></div></body></html>