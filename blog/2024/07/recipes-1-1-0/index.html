<!doctype html><html><head><!doctype html><html lang=en-us><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/css/main-site.css><link rel=stylesheet href=/css/fa5-all.css><style type=text/css>body{background-color:#fff;color:#1a1917}a{color:#38577f}a:hover{color:#42709b}a:focus{outline-color:#42709b}.column25-left .sectionTitle a:hover:not(.current),.column16-left .sectionTitle a:hover:not(.current){color:#1a1917}.icon-attribution,.icon-attribution a{color:#1a1917;opacity:75%}#homeContent .band.first{background-color:#fff}#homeContent .band.second{background-color:#fdeba4}#homeContent .band.third{background-color:#fff}#rStudioHeader{background-color:#1a162d;color:#fff}#rStudioHeader .productName{color:#fff}#rStudioHeader .productName:hover,#rStudioHeader .productName:focus{color:#fdeba4}#rStudioHeader #menu .menuItem.a{background-color:#75aadb;color:#fff}#rStudioHeader #menu .menuItem:hover{background-color:#484557;color:#fff}#rStudioHeader #menu .menuItem.current{background-color:#fff;color:#1a162d;text-decoration:none}#rStudioFooter.band{background-color:#767381}#rStudioFooter .bandContent #copyright{color:#e3eef8}table tbody tr:nth-child(even){background-color:#f7faff}table tbody tr:nth-child(odd){background-color:#fff}.latest{border-top:.5em solid <no value>}.event{-moz-box-shadow:0 0 0 0 rgba(0,0,0,.1);-webkit-box-shadow:0 0 0 0 rgba(0,0,0,.1);box-shadow:0 0 0 0 rgba(0,0,0,.1)}.section .event{background-color:#eab0c41a}.section .event{border-top:7pt solid #a19ea936}.section .event a{color:#1a162d}.section .event{color:#404040}</style><link rel=stylesheet href=/css/tidyverse.css><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.71.1"><title>recipes 1.1.0</title><meta property="og:title" content="recipes 1.1.0"><meta property="og:description" content="recipes 1.1.0 is on CRAN! recipes now have better input checking and quality of life errors."><meta property="og:type" content="article"><meta property="og:url" content="https://www.tidyverse.org/blog/2024/07/recipes-1-1-0/"><meta property="twitter:card" content="summary_large_image"><meta property="og:title" content="recipes 1.1.0 - Tidyverse"><meta property="description" content="recipes 1.1.0 is on CRAN! recipes now have better input checking and quality of life errors."><meta property="og:description" content="recipes 1.1.0 is on CRAN! recipes now have better input checking and quality of life errors."><meta property="og:image" content="https://www.tidyverse.org/blog/2024/07/recipes-1-1-0/thumbnail-sq.jpg"><meta name=twitter:image content="https://www.tidyverse.org/blog/2024/07/recipes-1-1-0/thumbnail-wd.jpg"><link rel=apple-touch-icon sizes=180x180 href=/images/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicons/favicon-16x16.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg><link rel="shortcut icon" href=/images/favicons/favicon.ico><meta name=msapplication-TileColor content="#da532c"><meta name=msapplication-config href=/images/favicons/browserconfig.xml><script type=text/javascript src=/js/jquery-3.5.1.min.js></script><script type=text/javascript src=/js/site.js></script><link rel=icon href=/images/favicon.ico><script type=text/javascript src=/js/clipboard.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin=anonymous></script><script defer data-domain=tidyverse.org,all.tidyverse.org src=https://plausible.io/js/plausible.js></script></head><body><div id=appTidyverseSite class="shrinkHeader alwaysShrinkHeader"><div id=main><div id=rStudioHeader><nav class=band><div class="innards bandContent"><div><a class=productName href=/>Tidyverse</a></div><div id=menu><div id=menuToggler></div><div id=menuItems><a class=menuItem href=/packages/>Packages</a>
<a class="menuItem current" href=/blog/>Blog</a>
<a class=menuItem href=/learn/>Learn</a>
<a class=menuItem href=/help/>Help</a>
<a class=menuItem href=/contribute/>Contribute</a></div></div></div></nav></div><main><div class="band padForHeader pushFooter"><div class=bandContent><div class="full splitColumns withMobileMargins"><div class=column75><h1 class=article-title>recipes 1.1.0</h1><div class=article-header aria-hidden=true><div class=photo><img src=/blog/2024/07/recipes-1-1-0/thumbnail-wd.jpg></div><div class=photoCredit>Photo by <a href=https://unsplash.com/photos/close-up-photo-of-baked-cookies-OfdDiqx8Cz8>Food Photographer | Jennifer Pallian</a></div></div><span class=article-date><i class="fas fa-calendar-day fa-fw"></i>&nbsp;&nbsp;2024/07/08</span><p style=margin-bottom:.5em;margin-top:.85em><i class="fas fa-tags"></i>&nbsp;
<a href=/tags/tidymodels/>tidymodels</a>,
<a href=/tags/recipes/>recipes</a></p><p style=margin-top:.5em><i class="fas fa-user-circle fa-fw"></i>&nbsp;
Emil Hvitfeldt</p><div class=article-content><p>We&rsquo;re thrilled to announce the release of
<a href=https://recipes.tidymodels.org/ target=_blank rel=noopener>recipes</a> 1.1.0. recipes lets you create a pipeable sequence of feature engineering steps.</p><p>You can install it from CRAN with:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://rdrr.io/r/utils/install.packages.html>install.packages</a></span><span class=o>(</span><span class=s>"recipes"</span><span class=o>)</span></span></code></pre></div><p>This blog post will go over some of the bigger changes in this release. Improvements in column type checking, allowing more data types to be passed to recipes, use of long formulas and better error for misspelled argument names.</p><p>You can see a full list of changes in the
<a href=https://github.com/tidymodels/recipes/releases/tag/v1.1.0 target=_blank rel=noopener>release notes</a>.</p><h2 id=column-type-checking>Column type checking
<a href=#column-type-checking><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>A
<a href=https://github.com/tidymodels/recipes/issues/793 target=_blank rel=noopener>longtime issue</a> in recipes came from the fact that recipes didn&rsquo;t keep a
<a href=https://vctrs.r-lib.org/articles/type-size.html target=_blank rel=noopener>prototype</a> (ptype) of the data it was specified with. This would cause unexpected things to happen or uninformative error messages to appear if different data was used to
<a href=https://recipes.tidymodels.org/reference/prep.html target=_blank rel=noopener><code>prep()</code></a> than was used to create the
<a href=https://recipes.tidymodels.org/reference/recipe.html target=_blank rel=noopener><code>recipe()</code></a>.</p><p>Every recipe you create starts with a call to
<a href=https://recipes.tidymodels.org/reference/recipe.html target=_blank rel=noopener><code>recipe()</code></a>. In the below example, we create a recipe where <code>x2</code> starts by being a character vector, but the recipe is prepped where <code>x2</code> is a numeric vector. This didn&rsquo;t produce any warnings or errors, silently doing something unintended.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=n>data_template</span> <span class=o>&lt;-</span> <span class=nf>tibble</span><span class=p>(</span>
  <span class=n>outcome</span> <span class=o>=</span> <span class=nf>rnorm</span><span class=p>(</span><span class=m>10</span><span class=p>),</span> 
  <span class=n>x1</span> <span class=o>=</span> <span class=nf>rnorm</span><span class=p>(</span><span class=m>10</span><span class=p>),</span> 
  <span class=n>x2</span> <span class=o>=</span> <span class=nf>sample</span><span class=p>(</span><span class=kc>letters</span><span class=p>,</span> <span class=m>10</span><span class=p>,</span> <span class=bp>T</span><span class=p>)</span>
<span class=p>)</span>

<span class=n>rec</span> <span class=o>&lt;-</span> <span class=nf>recipe</span><span class=p>(</span><span class=n>outcome</span> <span class=o>~</span> <span class=n>.,</span> <span class=n>data_template</span><span class=p>)</span> <span class=o>%&gt;%</span>
  <span class=nf>step_bin2factor</span><span class=p>(</span><span class=nf>all_numeric_predictors</span><span class=p>())</span>

<span class=n>data_training</span> <span class=o>&lt;-</span> <span class=nf>tibble</span><span class=p>(</span><span class=n>outcome</span> <span class=o>=</span> <span class=nf>rnorm</span><span class=p>(</span><span class=m>1000</span><span class=p>),</span> <span class=n>x1</span> <span class=o>=</span> <span class=nf>rnorm</span><span class=p>(</span><span class=m>1000</span><span class=p>),</span> <span class=n>x2</span> <span class=o>=</span> <span class=nf>rnorm</span><span class=p>(</span><span class=m>1000</span><span class=p>))</span>

<span class=nf>prep</span><span class=p>(</span><span class=n>rec</span><span class=p>,</span> <span class=n>training</span> <span class=o>=</span> <span class=n>data_training</span><span class=p>)</span>
<span class=c1>#&gt; </span>
<span class=c1>#&gt; ── Recipe ──────────────────────────────────────────────────────────────────────</span>
<span class=c1>#&gt; </span>
<span class=c1>#&gt; ── Inputs</span>
<span class=c1>#&gt; Number of variables by role</span>
<span class=c1>#&gt; outcome:   1</span>
<span class=c1>#&gt; predictor: 2</span>
<span class=c1>#&gt; </span>
<span class=c1>#&gt; ── Training information</span>
<span class=c1>#&gt; Training data contained 1000 data points and no incomplete rows.</span>
<span class=c1>#&gt; </span>
<span class=c1>#&gt; ── Operations</span>
<span class=c1>#&gt; • Dummy variable to factor conversion for: x1 | Trained</span>
</code></pre></div><p>Now, we get an error detailing how the data is different.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>data_template</span> <span class=o>&lt;-</span> <span class=nf><a href=https://tibble.tidyverse.org/reference/tibble.html>tibble</a></span><span class=o>(</span>outcome <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/stats/Normal.html>rnorm</a></span><span class=o>(</span><span class=m>10</span><span class=o>)</span>, x1 <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/stats/Normal.html>rnorm</a></span><span class=o>(</span><span class=m>10</span><span class=o>)</span>, x2 <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/sample.html>sample</a></span><span class=o>(</span><span class=nv>letters</span>, <span class=m>10</span>, <span class=kc>T</span><span class=o>)</span><span class=o>)</span></span>
<span></span>
<span><span class=nv>rec</span> <span class=o>&lt;-</span> <span class=nf><a href=https://recipes.tidymodels.org/reference/recipe.html>recipe</a></span><span class=o>(</span><span class=nv>outcome</span> <span class=o>~</span> <span class=nv>.</span>, <span class=nv>data_template</span><span class=o>)</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span></span>
<span>  <span class=nf><a href=https://recipes.tidymodels.org/reference/step_bin2factor.html>step_bin2factor</a></span><span class=o>(</span><span class=nf><a href=https://recipes.tidymodels.org/reference/has_role.html>all_numeric_predictors</a></span><span class=o>(</span><span class=o>)</span><span class=o>)</span></span>
<span></span>
<span><span class=nv>data_training</span> <span class=o>&lt;-</span> <span class=nf><a href=https://tibble.tidyverse.org/reference/tibble.html>tibble</a></span><span class=o>(</span>outcome <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/stats/Normal.html>rnorm</a></span><span class=o>(</span><span class=m>1000</span><span class=o>)</span>, x1 <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/stats/Normal.html>rnorm</a></span><span class=o>(</span><span class=m>1000</span><span class=o>)</span>, x2 <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/stats/Normal.html>rnorm</a></span><span class=o>(</span><span class=m>1000</span><span class=o>)</span><span class=o>)</span></span>
<span></span>
<span><span class=nf><a href=https://recipes.tidymodels.org/reference/prep.html>prep</a></span><span class=o>(</span><span class=nv>rec</span>, training <span class=o>=</span> <span class=nv>data_training</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#bb0;font-weight:700>Error</span><span style=font-weight:700> in `prep()`:</span></span></span>
<span><span class=c>#&gt; <span style=color:#b00>✖</span> The following variable has the wrong class:</span></span>
<span><span class=c>#&gt; <span style=color:#0bb>•</span> `x2` must have class <span style=color:#00b>&lt;numeric&gt;</span>, not <span style=color:#00b>&lt;character&gt;</span>.</span></span>
<span></span></code></pre></div><p>Note that recipes created before version 1.1.0 don&rsquo;t contain any ptype information, and will not undergo checking. Rerunning the code to create the recipe will add ptype information to the recipe.</p><h2 id=input-checking-in-recipe>Input checking in <code>recipe()</code>
<a href=#input-checking-in-recipe><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>We have relaxed the requirements of data frames, while making feedback more helpful when something goes wrong.</p><p>The data was previously passed through
<a href=https://rdrr.io/r/stats/model.frame.html target=_blank rel=noopener><code>model.frame()</code></a> inside the recipe, which restricted what could be handled. Previously prohibited input included data frames with list-columns or
<a href=https://r-spatial.github.io/sf/ target=_blank rel=noopener>sf</a> data frames. Both of these are now supported, as long as they are a <code>data.frame</code> object.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>data_listcolumn</span> <span class=o>&lt;-</span> <span class=nf><a href=https://tibble.tidyverse.org/reference/tibble.html>tibble</a></span><span class=o>(</span></span>
<span>  y <span class=o>=</span> <span class=m>1</span><span class=o>:</span><span class=m>4</span>,</span>
<span>  x <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/list.html>list</a></span><span class=o>(</span><span class=m>1</span><span class=o>:</span><span class=m>3</span>, <span class=m>4</span><span class=o>:</span><span class=m>6</span>, <span class=m>3</span><span class=o>:</span><span class=m>1</span>, <span class=m>1</span><span class=o>:</span><span class=m>10</span><span class=o>)</span></span>
<span><span class=o>)</span></span>
<span></span>
<span><span class=nf><a href=https://recipes.tidymodels.org/reference/recipe.html>recipe</a></span><span class=o>(</span><span class=nv>y</span> <span class=o>~</span> <span class=nv>.</span>, data <span class=o>=</span> <span class=nv>data_listcolumn</span><span class=o>)</span></span>
<span><span class=c>#&gt; </span></span>
<span></span><span><span class=c>#&gt; <span style=color:#0bb>──</span> <span style=font-weight:700>Recipe</span> <span style=color:#0bb>──────────────────────────────────────────────────────────────────────</span></span></span>
<span></span><span><span class=c>#&gt; </span></span>
<span></span><span><span class=c>#&gt; ── Inputs</span></span>
<span></span><span><span class=c>#&gt; Number of variables by role</span></span>
<span></span><span><span class=c>#&gt; outcome:   1</span></span>
<span><span class=c>#&gt; predictor: 1</span></span>
<span></span></code></pre></div><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=https://r-spatial.github.io/sf/>sf</a></span><span class=o>)</span></span>
<span><span class=c>#&gt; Linking to GEOS 3.11.0, GDAL 3.5.3, PROJ 9.1.0; sf_use_s2() is TRUE</span></span>
<span></span><span><span class=nv>pathshp</span> <span class=o>&lt;-</span> <span class=nf><a href=https://rdrr.io/r/base/system.file.html>system.file</a></span><span class=o>(</span><span class=s>"shape/nc.shp"</span>, package <span class=o>=</span> <span class=s>"sf"</span><span class=o>)</span></span>
<span><span class=nv>data_sf</span> <span class=o>&lt;-</span> <span class=nf><a href=https://r-spatial.github.io/sf/reference/st_read.html>st_read</a></span><span class=o>(</span><span class=nv>pathshp</span>, quiet <span class=o>=</span> <span class=kc>TRUE</span><span class=o>)</span></span>
<span></span>
<span><span class=nf><a href=https://recipes.tidymodels.org/reference/recipe.html>recipe</a></span><span class=o>(</span><span class=nv>AREA</span> <span class=o>~</span> <span class=nv>.</span>, data <span class=o>=</span> <span class=nv>data_sf</span><span class=o>)</span></span>
<span><span class=c>#&gt; </span></span>
<span></span><span><span class=c>#&gt; <span style=color:#0bb>──</span> <span style=font-weight:700>Recipe</span> <span style=color:#0bb>──────────────────────────────────────────────────────────────────────</span></span></span>
<span></span><span><span class=c>#&gt; </span></span>
<span></span><span><span class=c>#&gt; ── Inputs</span></span>
<span></span><span><span class=c>#&gt; Number of variables by role</span></span>
<span></span><span><span class=c>#&gt; outcome:    1</span></span>
<span><span class=c>#&gt; predictor: 14</span></span>
<span></span></code></pre></div><p>We are excited to see what people can do with these new options.</p><p>Another way to tell a recipe what variables should be included and what roles they should have is to use
<a href=https://recipes.tidymodels.org/reference/roles.html target=_blank rel=noopener><code>add_role()</code></a> and
<a href=https://recipes.tidymodels.org/reference/roles.html target=_blank rel=noopener><code>update_role()</code></a>. But if you were not careful, you could end up in situations where the same variable is labeled as both the outcome and predictor.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=c># didn't used to throw a warning</span></span>
<span><span class=nf><a href=https://recipes.tidymodels.org/reference/recipe.html>recipe</a></span><span class=o>(</span><span class=nv>mtcars</span><span class=o>)</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://recipes.tidymodels.org/reference/roles.html>update_role</a></span><span class=o>(</span><span class=nf><a href=https://tidyselect.r-lib.org/reference/everything.html>everything</a></span><span class=o>(</span><span class=o>)</span>, new_role <span class=o>=</span> <span class=s>"predictor"</span><span class=o>)</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://recipes.tidymodels.org/reference/roles.html>add_role</a></span><span class=o>(</span><span class=s>"mpg"</span>, new_role <span class=o>=</span> <span class=s>"outcome"</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#bb0;font-weight:700>Error</span><span style=font-weight:700> in `add_role()`:</span></span></span>
<span><span class=c>#&gt; <span style=color:#bb0>!</span> `mpg` cannot get <span style=color:#00b>"outcome"</span> role as it already has role <span style=color:#00b>"predictor"</span>.</span></span>
<span></span></code></pre></div><p>This error can be avoided by using
<a href=https://recipes.tidymodels.org/reference/roles.html target=_blank rel=noopener><code>update_role()</code></a> instead of
<a href=https://recipes.tidymodels.org/reference/roles.html target=_blank rel=noopener><code>add_role()</code></a>.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://recipes.tidymodels.org/reference/recipe.html>recipe</a></span><span class=o>(</span><span class=nv>mtcars</span><span class=o>)</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://recipes.tidymodels.org/reference/roles.html>update_role</a></span><span class=o>(</span><span class=nf><a href=https://tidyselect.r-lib.org/reference/everything.html>everything</a></span><span class=o>(</span><span class=o>)</span>, new_role <span class=o>=</span> <span class=s>"predictor"</span><span class=o>)</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://recipes.tidymodels.org/reference/roles.html>update_role</a></span><span class=o>(</span><span class=s>"mpg"</span>, new_role <span class=o>=</span> <span class=s>"outcome"</span><span class=o>)</span></span>
<span><span class=c>#&gt; </span></span>
<span></span><span><span class=c>#&gt; <span style=color:#0bb>──</span> <span style=font-weight:700>Recipe</span> <span style=color:#0bb>──────────────────────────────────────────────────────────────────────</span></span></span>
<span></span><span><span class=c>#&gt; </span></span>
<span></span><span><span class=c>#&gt; ── Inputs</span></span>
<span></span><span><span class=c>#&gt; Number of variables by role</span></span>
<span></span><span><span class=c>#&gt; outcome:    1</span></span>
<span><span class=c>#&gt; predictor: 10</span></span>
<span></span></code></pre></div><h2 id=long-formulas-in-recipe>Long formulas in <code>recipe()</code>
<a href=#long-formulas-in-recipe><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Related to the changes we saw above, we now fully support very long formulas without hitting a <code>C stack usage</code> error.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>data_wide</span> <span class=o>&lt;-</span> <span class=nf><a href=https://rdrr.io/r/base/matrix.html>matrix</a></span><span class=o>(</span><span class=m>1</span><span class=o>:</span><span class=m>10000</span>, ncol <span class=o>=</span> <span class=m>10000</span><span class=o>)</span></span>
<span><span class=nv>data_wide</span> <span class=o>&lt;-</span> <span class=nf><a href=https://rdrr.io/r/base/as.data.frame.html>as.data.frame</a></span><span class=o>(</span><span class=nv>data_wide</span><span class=o>)</span></span>
<span><span class=nf><a href=https://rdrr.io/r/base/names.html>names</a></span><span class=o>(</span><span class=nv>data_wide</span><span class=o>)</span> <span class=o>&lt;-</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=nf><a href=https://rdrr.io/r/base/paste.html>paste0</a></span><span class=o>(</span><span class=s>"x"</span>, <span class=m>1</span><span class=o>:</span><span class=m>10000</span><span class=o>)</span><span class=o>)</span></span>
<span></span>
<span><span class=nv>long_formula</span> <span class=o>&lt;-</span> <span class=nf><a href=https://rdrr.io/r/stats/formula.html>as.formula</a></span><span class=o>(</span><span class=nf><a href=https://rdrr.io/r/base/paste.html>paste</a></span><span class=o>(</span><span class=s>"~ "</span>, <span class=nf><a href=https://rdrr.io/r/base/paste.html>paste</a></span><span class=o>(</span><span class=nf><a href=https://rdrr.io/r/base/names.html>names</a></span><span class=o>(</span><span class=nv>data_wide</span><span class=o>)</span>, collapse <span class=o>=</span> <span class=s>" + "</span><span class=o>)</span><span class=o>)</span><span class=o>)</span></span>
<span></span>
<span><span class=nf><a href=https://recipes.tidymodels.org/reference/recipe.html>recipe</a></span><span class=o>(</span><span class=nv>long_formula</span>, <span class=nv>data_wide</span><span class=o>)</span></span>
<span><span class=c>#&gt; </span></span>
<span></span><span><span class=c>#&gt; <span style=color:#0bb>──</span> <span style=font-weight:700>Recipe</span> <span style=color:#0bb>──────────────────────────────────────────────────────────────────────</span></span></span>
<span></span><span><span class=c>#&gt; </span></span>
<span></span><span><span class=c>#&gt; ── Inputs</span></span>
<span></span><span><span class=c>#&gt; Number of variables by role</span></span>
<span></span><span><span class=c>#&gt; predictor: 10000</span></span>
<span></span></code></pre></div><h2 id=better-error-for-misspelled-argument-names>Better error for misspelled argument names
<a href=#better-error-for-misspelled-argument-names><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>If you have used recipes long enough you are very likely to have run into the following error.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>recipe</span><span class=p>(</span><span class=n>mpg</span> <span class=o>~</span> <span class=n>.,</span> <span class=n>data</span> <span class=o>=</span> <span class=n>mtcars</span><span class=p>)</span> <span class=o>|&gt;</span>
  <span class=nf>step_pca</span><span class=p>(</span><span class=nf>all_numeric_predictors</span><span class=p>(),</span> <span class=n>number</span> <span class=o>=</span> <span class=m>4</span><span class=p>)</span> <span class=o>|&gt;</span>
  <span class=nf>prep</span><span class=p>()</span>
<span class=c1>#&gt; Error in `step_pca()`:</span>
<span class=c1>#&gt; Caused by error in `prep()`:</span>
<span class=c1>#&gt; ! Can&#39;t rename variables in this context.</span>
</code></pre></div><p>The first time you saw it, it didn&rsquo;t make much sense. Hopefully, you figured out that
<a href=https://recipes.tidymodels.org/reference/step_pca.html target=_blank rel=noopener>step_pca()</a> doesn&rsquo;t have a <code>number</code> argument, and instead uses <code>num_comp</code> to determine the number of principal components to return. This confusion will be a thing of the past as we now include this improved error message.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://recipes.tidymodels.org/reference/recipe.html>recipe</a></span><span class=o>(</span><span class=nv>mpg</span> <span class=o>~</span> <span class=nv>.</span>, data <span class=o>=</span> <span class=nv>mtcars</span><span class=o>)</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://recipes.tidymodels.org/reference/step_pca.html>step_pca</a></span><span class=o>(</span><span class=nf><a href=https://recipes.tidymodels.org/reference/has_role.html>all_numeric_predictors</a></span><span class=o>(</span><span class=o>)</span>, number <span class=o>=</span> <span class=m>4</span><span class=o>)</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://recipes.tidymodels.org/reference/prep.html>prep</a></span><span class=o>(</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#bb0;font-weight:700>Error</span><span style=font-weight:700> in `step_pca()`:</span></span></span>
<span><span class=c>#&gt; <span style=font-weight:700>Caused by error in `prep()` at recipes/R/recipe.R:479:9:</span></span></span>
<span><span class=c>#&gt; <span style=color:#bb0>!</span> The following argument was specified but do not exist: `number`.</span></span>
<span></span></code></pre></div><h2 id=quality-of-life-increases-in-step_dummy>Quality of life increases in <code>step_dummy()</code>
<a href=#quality-of-life-increases-in-step_dummy><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>I would imagine that one of the most used steps is
<a href=https://recipes.tidymodels.org/reference/step_dummy.html target=_blank rel=noopener><code>step_dummy()</code></a>. We have improved the errors and warnings it spits out when things go sideways.</p><p>If you apply
<a href=https://recipes.tidymodels.org/reference/step_dummy.html target=_blank rel=noopener><code>step_dummy()</code></a> to a variable that contains a lot of levels, it will produce a lot of columns, and the resulting object may not fit in memory. This can lead to the following error.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=n>data_id</span> <span class=o>&lt;-</span> <span class=nf>tibble</span><span class=p>(</span>
  <span class=n>id</span> <span class=o>=</span> <span class=nf>as.character</span><span class=p>(</span><span class=m>1</span><span class=o>:</span><span class=m>100000</span><span class=p>),</span> 
  <span class=n>x1</span> <span class=o>=</span> <span class=nf>rnorm</span><span class=p>(</span><span class=m>100000</span><span class=p>),</span> 
  <span class=n>x2</span> <span class=o>=</span> <span class=nf>sample</span><span class=p>(</span><span class=kc>letters</span><span class=p>,</span> <span class=m>100000</span><span class=p>,</span> <span class=kc>TRUE</span><span class=p>)</span>
<span class=p>)</span>

<span class=nf>recipe</span><span class=p>(</span><span class=o>~</span> <span class=n>.,</span> <span class=n>data</span> <span class=o>=</span> <span class=n>data_id</span><span class=p>)</span> <span class=o>|&gt;</span>
  <span class=nf>step_dummy</span><span class=p>(</span><span class=nf>all_nominal_predictors</span><span class=p>())</span> <span class=o>|&gt;</span>
  <span class=nf>prep</span><span class=p>()</span>
<span class=c1>#&gt; Error: vector memory exhausted (limit reached?)</span>
</code></pre></div><p>Instead, you now get a more helpful error message.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>data_id</span> <span class=o>&lt;-</span> <span class=nf><a href=https://tibble.tidyverse.org/reference/tibble.html>tibble</a></span><span class=o>(</span></span>
<span>  id <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/character.html>as.character</a></span><span class=o>(</span><span class=m>1</span><span class=o>:</span><span class=m>100000</span><span class=o>)</span>, </span>
<span>  x1 <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/stats/Normal.html>rnorm</a></span><span class=o>(</span><span class=m>100000</span><span class=o>)</span>, </span>
<span>  x2 <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/sample.html>sample</a></span><span class=o>(</span><span class=nv>letters</span>, <span class=m>100000</span>, <span class=kc>TRUE</span><span class=o>)</span></span>
<span><span class=o>)</span></span>
<span></span>
<span><span class=nf><a href=https://recipes.tidymodels.org/reference/recipe.html>recipe</a></span><span class=o>(</span><span class=o>~</span> <span class=nv>.</span>, data <span class=o>=</span> <span class=nv>data_id</span><span class=o>)</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://recipes.tidymodels.org/reference/step_dummy.html>step_dummy</a></span><span class=o>(</span><span class=nf><a href=https://recipes.tidymodels.org/reference/has_role.html>all_nominal_predictors</a></span><span class=o>(</span><span class=o>)</span><span class=o>)</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://recipes.tidymodels.org/reference/prep.html>prep</a></span><span class=o>(</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#bb0;font-weight:700>Error</span><span style=font-weight:700> in `step_dummy()`:</span></span></span>
<span><span class=c>#&gt; <span style=font-weight:700>Caused by error:</span></span></span>
<span><span class=c>#&gt; <span style=color:#bb0>!</span> `id` contains too many levels (100000), which would result in a</span></span>
<span><span class=c>#&gt;   data.frame too large to fit in memory.</span></span>
<span></span></code></pre></div><p>Likewise, you will get helpful errors if
<a href=https://recipes.tidymodels.org/reference/step_dummy.html target=_blank rel=noopener><code>step_dummy()</code></a> gets a <code>NA</code> or unseen values.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>data_train</span> <span class=o>&lt;-</span> <span class=nf><a href=https://tibble.tidyverse.org/reference/tibble.html>tibble</a></span><span class=o>(</span>x <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=s>"a"</span>, <span class=s>"b"</span><span class=o>)</span><span class=o>)</span></span>
<span><span class=nv>data_unseen</span> <span class=o>&lt;-</span> <span class=nf><a href=https://tibble.tidyverse.org/reference/tibble.html>tibble</a></span><span class=o>(</span>x <span class=o>=</span> <span class=s>"c"</span><span class=o>)</span></span>
<span></span>
<span><span class=nv>rec_spec</span> <span class=o>&lt;-</span> <span class=nf><a href=https://recipes.tidymodels.org/reference/recipe.html>recipe</a></span><span class=o>(</span><span class=o>~</span><span class=nv>.</span>, data <span class=o>=</span> <span class=nv>data_train</span><span class=o>)</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span></span>
<span>  <span class=nf><a href=https://recipes.tidymodels.org/reference/step_dummy.html>step_dummy</a></span><span class=o>(</span><span class=nv>x</span><span class=o>)</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span></span>
<span>  <span class=nf><a href=https://recipes.tidymodels.org/reference/prep.html>prep</a></span><span class=o>(</span><span class=o>)</span></span>
<span></span>
<span><span class=nv>rec_spec</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span></span>
<span>  <span class=nf><a href=https://recipes.tidymodels.org/reference/bake.html>bake</a></span><span class=o>(</span><span class=nv>data_unseen</span><span class=o>)</span></span>
<span><span class=c>#&gt; Warning: <span style=color:#bb0>!</span> There are new levels in `x`: <span style=color:#00b>"c"</span>.</span></span>
<span><span class=c>#&gt; <span style=color:#0bb>ℹ</span> Consider using step_novel() (`?recipes::step_novel()`) before `step_dummy()`</span></span>
<span><span class=c>#&gt;   to handle unseen values.</span></span>
<span></span><span><span class=c>#&gt; <span style=color:#555># A tibble: 1 × 1</span></span></span>
<span><span class=c>#&gt;     x_b</span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span>    <span style=color:#b00>NA</span></span></span>
<span></span></code></pre></div><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>data_na</span> <span class=o>&lt;-</span> <span class=nf><a href=https://tibble.tidyverse.org/reference/tibble.html>tibble</a></span><span class=o>(</span>x <span class=o>=</span> <span class=kc>NA</span><span class=o>)</span></span>
<span></span>
<span><span class=nv>rec_spec</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span></span>
<span>  <span class=nf><a href=https://recipes.tidymodels.org/reference/bake.html>bake</a></span><span class=o>(</span><span class=nv>data_na</span><span class=o>)</span></span>
<span><span class=c>#&gt; Warning: <span style=color:#bb0>!</span> There are new levels in `x`: <span style=color:#00b>NA</span>.</span></span>
<span><span class=c>#&gt; <span style=color:#0bb>ℹ</span> Consider using step_unknown() (`?recipes::step_unknown()`) before</span></span>
<span><span class=c>#&gt;   `step_dummy()` to handle missing values.</span></span>
<span></span><span><span class=c>#&gt; <span style=color:#555># A tibble: 1 × 1</span></span></span>
<span><span class=c>#&gt;     x_b</span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span>    <span style=color:#b00>NA</span></span></span>
<span></span></code></pre></div><h2 id=acknowledgements>Acknowledgements
<a href=#acknowledgements><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>A big thank you to all the people who have contributed to recipes since the release of v1.0.10:</p><p><a href=https://github.com/brynhum target=_blank rel=noopener>@brynhum</a>,
<a href=https://github.com/DemetriPananos target=_blank rel=noopener>@DemetriPananos</a>,
<a href=https://github.com/diegoperoni target=_blank rel=noopener>@diegoperoni</a>,
<a href=https://github.com/EmilHvitfeldt target=_blank rel=noopener>@EmilHvitfeldt</a>,
<a href=https://github.com/JiahuaQu target=_blank rel=noopener>@JiahuaQu</a>,
<a href=https://github.com/joranE target=_blank rel=noopener>@joranE</a>,
<a href=https://github.com/nhward target=_blank rel=noopener>@nhward</a>,
<a href=https://github.com/olivroy target=_blank rel=noopener>@olivroy</a>, and
<a href=https://github.com/simonpcouch target=_blank rel=noopener>@simonpcouch</a>.</p><h2 id=chocolate-chocolate-chip-cookies>Chocolate Chocolate Chip Cookies
<a href=#chocolate-chocolate-chip-cookies><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>preheat oven 350°F</p><ul><li>1/3c butter</li><li>1/2 + 1/3c sugar</li></ul><p>mix until fluffy</p><ul><li>1 tsp vanilla</li><li>1 egg</li></ul><p>mix until combined</p><ul><li>1/2c cocoa</li><li>1/2 tsp baking soda</li><li>1c flour</li></ul><p>mix until combined</p><ul><li>3/4c chocolate chips</li></ul><p>bake for about 8 mins, depending on size! they will crack on top, but still be soft.</p></div></div><div class=column25><div class="section hideOnMobile"><div class=sectionTitle>Contents</div><nav id=TableOfContents><ul><li><a href=#column-type-checking>Column type checking</a></li><li><a href=#input-checking-in-recipe>Input checking in <code>recipe()</code></a></li><li><a href=#long-formulas-in-recipe>Long formulas in <code>recipe()</code></a></li><li><a href=#better-error-for-misspelled-argument-names>Better error for misspelled argument names</a></li><li><a href=#quality-of-life-increases-in-step_dummy>Quality of life increases in <code>step_dummy()</code></a></li><li><a href=#acknowledgements>Acknowledgements</a></li><li><a href=#chocolate-chocolate-chip-cookies>Chocolate Chocolate Chip Cookies</a></li></ul></nav></div><div class=section></div></div></div></div></div><div id=rStudioFooter class=band><div class=bandContent><div id=copyright>The tidyverse is proudly supported by <a class=rstudioLogo href=https://posit.co/ aria-label="Posit Homepage"></a></div><div id=logos><a href=https://www.tidyverse.org/google_privacy_policy>Privacy policy</a>
<a href=https://github.com/tidyverse class="footerLogo gitHub" aria-label="Tidyverse GitHub organization"></a><a href=https://twitter.com/hashtag/rstats class="footerLogo twitter" aria-label="rstats hashtag on twitter.com"></a></div></div></div></div></div><script type=application/javascript>var dnt=(navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack);var doNotTrack=(dnt=="1"||dnt=="yes");if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');if(window.sessionStorage){var GA_SESSION_STORAGE_KEY='ga:clientId';ga('create','UA-115082821-1',{'storage':'none','clientId':sessionStorage.getItem(GA_SESSION_STORAGE_KEY)});ga(function(tracker){sessionStorage.setItem(GA_SESSION_STORAGE_KEY,tracker.get('clientId'));});}
ga('set','anonymizeIp',true);ga('send','pageview');}</script></body></html></div></div></body></html>