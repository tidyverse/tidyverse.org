<!doctype html><html><head><!doctype html><html lang=en-us><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/css/main-site.css><link rel=stylesheet href=/css/fa5-all.css><style type=text/css>body{background-color:#fff;color:#1a1917}a{color:#38577f}a:hover{color:#42709b}a:focus{outline-color:#42709b}.column25-left .sectionTitle a:hover:not(.current),.column16-left .sectionTitle a:hover:not(.current){color:#1a1917}.icon-attribution,.icon-attribution a{color:#1a1917;opacity:75%}#homeContent .band.first{background-color:#fff}#homeContent .band.second{background-color:#fdeba4}#homeContent .band.third{background-color:#fff}#rStudioHeader{background-color:#1a162d;color:#fff}#rStudioHeader .productName{color:#fff}#rStudioHeader .productName:hover,#rStudioHeader .productName:focus{color:#fdeba4}#rStudioHeader #menu .menuItem.a{background-color:#75aadb;color:#fff}#rStudioHeader #menu .menuItem:hover{background-color:#484557;color:#fff}#rStudioHeader #menu .menuItem.current{background-color:#fff;color:#1a162d;text-decoration:none}#rStudioFooter.band{background-color:#767381}#rStudioFooter .bandContent #copyright{color:#e3eef8}table tbody tr:nth-child(even){background-color:#f7faff}table tbody tr:nth-child(odd){background-color:#fff}.latest{border-top:.5em solid <no value>}.event{-moz-box-shadow:0 0 0 0 rgba(0,0,0,.1);-webkit-box-shadow:0 0 0 0 rgba(0,0,0,.1);box-shadow:0 0 0 0 rgba(0,0,0,.1)}.section .event{background-color:#eab0c41a}.section .event{border-top:7pt solid #a19ea936}.section .event a{color:#1a162d}.section .event{color:#404040}</style><link rel=stylesheet href=/css/tidyverse.css><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.71.1"><title>webR 0.3.1</title><meta property="og:title" content="webR 0.3.1"><meta property="og:description" content="webR 0.3.1 is now available at npm, GitHub, and via CDN. Take a look at what's new in this release."><meta property="og:type" content="article"><meta property="og:url" content="https://www.tidyverse.org/blog/2024/04/webr-0-3-1/"><meta property="twitter:card" content="summary_large_image"><meta property="og:title" content="webR 0.3.1 - Tidyverse"><meta property="description" content="webR 0.3.1 is now available at npm, GitHub, and via CDN. Take a look at what's new in this release."><meta property="og:description" content="webR 0.3.1 is now available at npm, GitHub, and via CDN. Take a look at what's new in this release."><meta property="og:image" content="https://www.tidyverse.org/blog/2024/04/webr-0-3-1/thumbnail-sq.jpg"><meta name=twitter:image content="https://www.tidyverse.org/blog/2024/04/webr-0-3-1/thumbnail-wd.jpg"><link rel=apple-touch-icon sizes=180x180 href=/images/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicons/favicon-16x16.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg><link rel="shortcut icon" href=/images/favicons/favicon.ico><meta name=msapplication-TileColor content="#da532c"><meta name=msapplication-config href=/images/favicons/browserconfig.xml><script type=text/javascript src=/js/jquery-3.5.1.min.js></script><script type=text/javascript src=/js/site.js></script><link rel=icon href=/images/favicon.ico><script type=text/javascript src=/js/clipboard.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin=anonymous></script><script defer data-domain=tidyverse.org,all.tidyverse.org src=https://plausible.io/js/plausible.js></script></head><body><div id=appTidyverseSite class="shrinkHeader alwaysShrinkHeader"><div id=main><div id=rStudioHeader><nav class=band><div class="innards bandContent"><div><a class=productName href=/%20/>Tidyverse</a></div><div id=menu><div id=menuToggler></div><div id=menuItems><a class=menuItem href=/packages/>Packages</a>
<a class="menuItem current" href=/blog/>Blog</a>
<a class=menuItem href=/learn/>Learn</a>
<a class=menuItem href=/help/>Help</a>
<a class=menuItem href=/contribute/>Contribute</a></div></div></div></nav></div><main><div class="band padForHeader pushFooter"><div class=bandContent><div class="full splitColumns withMobileMargins"><div class=column75><h1 class=article-title>webR 0.3.1</h1><div class=article-header aria-hidden=true><div class=photo><img src=/blog/2024/04/webr-0-3-1/thumbnail-wd.jpg></div><div class=photoCredit>Photo by <a href=https://unsplash.com/photos/purple-and-black-pyramid-wallpaper-k1bO_VTiZSs>Sandro Katalina</a></div></div><span class=article-date><i class="fas fa-calendar-day fa-fw"></i>&nbsp;&nbsp;2024/04/02</span><p style=margin-bottom:.5em;margin-top:.85em><i class="fas fa-tags"></i>&nbsp;
<a href=/tags/wasm/>wasm</a>,
<a href=/tags/webr/>webr</a>,
<a href=/tags/webassembly/>webassembly</a></p><p style=margin-top:.5em><i class="fas fa-user-circle fa-fw"></i>&nbsp;
George Stagg</p><div class=article-content><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.css><style>.CodeMirror pre{background-color:unset!important}.btn-webr{background-color:#eee;border-bottom-left-radius:0;border-bottom-right-radius:0}</style><script src=https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/mode/r/r.js></script><script type=module>
  import { WebR } from 'https://webr.r-wasm.org/v0.4.2/webr.mjs';
  globalThis.webR = new WebR();
  await globalThis.webR.init();
  await webR.FS.mkdir('/persist');
  await webR.FS.mount('IDBFS', {}, '/persist');
  await webR.FS.syncfs(true);
  await webR.evalRVoid("webr::shim_install()");
  await webR.evalRVoid("webr::global_prompt_install()", { withHandlers: false });

  globalThis.webRCodeShelter = await new globalThis.webR.Shelter();
  document.querySelectorAll(".btn-webr").forEach((btn) => {
    btn.innerText = 'Run code';
    btn.disabled = false;
  });
</script><div class=highlight></div><div class=highlight><style type=text/css>.output>pre,.output code{background-color:#fff!important;margin-top:-17px;border-top-left-radius:0;border-top-right-radius:0}.error>pre,.error code{background-color:#fcebeb!important;color:#410e0e!important}</style></div><p>We&rsquo;re delighted to announce the release of
<a href=https://docs.r-wasm.org/webr/latest/ target=_blank rel=noopener>webR</a> 0.3.1. This release brings bug fixes, infrastructure upgrades, and exciting improvements to webR&rsquo;s API for creating R objects and evaluating R code from JavaScript. These new features make integrating webR with existing JavaScript frameworks such as
<a href=https://observablehq.com target=_blank rel=noopener>Observable</a> a breeze.</p><p>You can install the latest release from
<a href=https://www.npmjs.com/package/webr target=_blank rel=noopener>npm</a> with the command:</p><pre><code>npm i webr@0.3.1
</code></pre><p>or if you&rsquo;re using JavaScript modules to import webR directly from CDN:</p><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=kr>import</span> <span class=p>{</span> <span class=nx>WebR</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;https://webr.r-wasm.org/v0.3.1/webr.mjs&#39;</span><span class=p>;</span>
</code></pre></div><p>A summary of changes is described below, with the full
<a href=https://github.com/r-wasm/webr/releases target=_blank rel=noopener>release notes</a> on GitHub.</p><h2 id=evaluating-r-code-from-javascript>Evaluating R code from JavaScript
<a href=#evaluating-r-code-from-javascript><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>The underlying interpreter powering webR is built from the same source code as R itself, with patches applied so that it can run in the WebAssembly environment. With this release, we have rebased our patches on the latest stable version of R<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>. By keeping our source in sync, improvements and bug fixes made by the R Core Team also benefit any project making use of webR.</p><p>WebR&rsquo;s core functionality is to evaluate R code from a JavaScript environment. As such, it is imperative that this works well, even with large and complex scripts. The
<a href=https://webr.r-wasm.org/v0.3.1/ target=_blank rel=noopener>webR app</a> has been updated to better handle large R scripts, and scripts longer than 4096 characters should no longer cause strange issues in the R console.</p><h3 id=loading-webassembly-packages>Loading WebAssembly packages
<a href=#loading-webassembly-packages><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>The package management functions provided by webR have been expanded and improved. We set up webR with shims (interceptors) for
<a href=https://rdrr.io/r/utils/install.packages.html target=_blank rel=noopener><code>install.packages()</code></a>,
<a href=https://rdrr.io/r/base/library.html target=_blank rel=noopener><code>library()</code></a>, and
<a href=https://rdrr.io/r/base/library.html target=_blank rel=noopener><code>require()</code></a> so that installing or loading R packages automatically downloads WebAssembly binaries from the
<a href=https://repo.r-wasm.org target=_blank rel=noopener>webR package repository</a>. Also, it is no longer required to run the
<a href=https://rdrr.io/r/base/library.html target=_blank rel=noopener><code>library()</code></a> command a second time to subsequently load the package.</p><p>In this interactive example, webR is configured to automatically install WebAssembly packages. Click &ldquo;Run code&rdquo; to download the packages listed in the R script.</p><div class=highlight><button class="btn btn-default btn-webr" disabled type=button id=webr-run-button-1>Loading webR...</button><div id=webr-editor-1></div><div id=webr-code-output-1><pre style=visibility:hidden></pre></div><script type=module>
  const runButton = document.getElementById('webr-run-button-1');
  const outputDiv = document.getElementById('webr-code-output-1');
  const editorDiv = document.getElementById('webr-editor-1');

  const editor = CodeMirror((elt) => {
    elt.style.border = '1px solid #eee';
    elt.style.height = 'auto';
    editorDiv.append(elt);
  },{
    value: `# Explicitly install wasm packages\ninstall.packages("cli")\n\n# Automatically install wasm packages\nlibrary(vctrs)\nrequire(jsonlite)\n\n# Confirm the packages installed successfully\nrownames(installed.packages())`,
    lineNumbers: true,
    mode: 'r',
    theme: 'light default',
    viewportMargin: Infinity,
  });

  runButton.onclick = async () => {
    runButton.disabled = true;
    let canvas = undefined;
    await webR.init();
    await webR.evalRVoid('webr::canvas(width=504, height=311.472)');
    await webR.FS.syncfs(false);
    const result = await webRCodeShelter.captureR(editor.getValue(), {
      withAutoprint: true,
      captureStreams: true,
      captureConditions: false,
      captureGraphics: false,
      env: {},
    });
    try {
      await webR.evalRVoid("dev.off()");
      const out = result.output.filter(
        evt => evt.type == 'stdout' || evt.type == 'stderr'
      ).map((evt) => evt.data).join('\n');

      outputDiv.innerHTML = '';
      const pre = document.createElement("pre");
      if (/\S/.test(out)) {
        const code = document.createElement("code");
        code.innerText = out;
        pre.appendChild(code);
      } else {
        pre.style.visibility = 'hidden';
      }
      outputDiv.appendChild(pre);

      const msgs = await webR.flush();
      msgs.forEach(msg => {
        if (msg.type === 'canvas'){
          if (msg.data.event === 'canvasImage') {
            
            canvas.getContext('2d').drawImage(msg.data.image, 0, 0);
          } else if (msg.data.event === 'canvasNewPage') {
            
            canvas = document.createElement('canvas');
            canvas.setAttribute('width', 2 * 504);
            canvas.setAttribute('height', 2 * 311.472);
            canvas.style.width="700px";
            canvas.style.display="block";
            canvas.style.margin="auto";
            
            const p = document.createElement("p");
            p.appendChild(canvas);
            outputDiv.appendChild(p);
          }
        }
      });
    } finally {
      webRCodeShelter.purge();
      runButton.disabled = false;
    }
  }
</script></div><p>See the
<a href=https://docs.r-wasm.org/webr/latest/packages.html target=_blank rel=noopener>documentation</a> for more details on how to control this behaviour in your own webR-powered applications, including optionally showing an interactive download menu to the user.</p><h3 id=error-handling-and-reporting>Error handling and reporting
<a href=#error-handling-and-reporting><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>Improvements have been made to how webR raises R conditions as JavaScript exceptions. Exceptions now include the offending source R call in the error message text, better matching what is shown in a traditional R console.</p><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=nx>await</span> <span class=nx>webR</span><span class=p>.</span><span class=nx>evalR</span><span class=p>(</span><span class=s2>&#34;sin(&#39;abc&#39;)&#34;</span><span class=p>);</span>
</code></pre></div><div class="output error"><pre><code>Uncaught Error: Error in sin(&quot;abc&quot;): non-numeric argument to mathematical function
</code></pre></div><p>Conditions raised when invoking function objects are now also re-thrown as JavaScript exceptions, rather than a generic <code>UnwindProtectException</code> error. Compare the error messages shown below from the previous and latest versions of webR to see the useful context added by this change.</p><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=c1>// webR 0.2.2
</span><span class=c1></span><span class=kr>const</span> <span class=nx>do_calc</span> <span class=o>=</span> <span class=nx>await</span> <span class=nx>webR</span><span class=p>.</span><span class=nx>evalR</span><span class=p>(</span><span class=sb>`function (n) { rnorm(n) }`</span><span class=p>)</span>
<span class=nx>do_calc</span><span class=p>(</span><span class=o>-</span><span class=mi>10</span><span class=p>)</span>
</code></pre></div><div class="output error"><pre><code>Uncaught (in promise) UnwindProtectException: A non-local transfer of control occured during evaluation
</code></pre></div><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=c1>// webR 0.3.1
</span><span class=c1></span><span class=kr>const</span> <span class=nx>do_calc</span> <span class=o>=</span> <span class=nx>await</span> <span class=nx>webR</span><span class=p>.</span><span class=nx>evalR</span><span class=p>(</span><span class=sb>`function (n) { rnorm(n) }`</span><span class=p>)</span>
<span class=nx>do_calc</span><span class=p>(</span><span class=o>-</span><span class=mi>10</span><span class=p>)</span>
</code></pre></div><div class="output error"><pre><code>Uncaught (in promise) Error: Error in rnorm(n): invalid arguments
</code></pre></div><p>Some base R features can be problematic when running R under WebAssembly. For example, in the constrained WebAssembly sandbox the base R function
<a href=https://rdrr.io/r/base/system.html target=_blank rel=noopener><code>system()</code></a> does not work. The latest release of webR now handles these cases more consistently, raising R
<a href=https://rdrr.io/r/base/stop.html target=_blank rel=noopener><code>stop()</code></a> conditions rather than incorrectly returning an empty result.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=c1># webR 0.3.1</span>
<span class=nf>system</span><span class=p>()</span>
</code></pre></div><div class="output error"><pre><code>Error in webr_hook_system(command) : 
  The &quot;system()&quot; function is unsupported under Emscripten.
</code></pre></div><h2 id=capturing-html-canvas-graphics-output>Capturing HTML canvas graphics output
<a href=#capturing-html-canvas-graphics-output><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>The
<a href=https://docs.r-wasm.org/webr/latest/evaluating.html#evaluating-r-code-and-capturing-output-with-capturer target=_blank rel=noopener><code>captureR()</code></a> function is designed to capture output generated when evaluating R code. In addition to capturing standard text output, details about errors and other R conditions are also captured. With this release, plots drawn using webR&rsquo;s HTML canvas graphics device,
<a href=https://rdrr.io/pkg/webr/man/canvas.html target=_blank rel=noopener><code>webr::canvas()</code></a>, are also captured and returned by default.</p><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=c1>// Evaluate R code, capturing all output
</span><span class=c1></span><span class=kr>const</span> <span class=nx>capture</span> <span class=o>=</span> <span class=nx>await</span> <span class=nx>webR</span><span class=p>.</span><span class=nx>globalShelter</span><span class=p>.</span><span class=nx>captureR</span><span class=p>(</span><span class=sb>`
</span><span class=sb>  x &lt;- rnorm(10000)
</span><span class=sb>  print(x[1])
</span><span class=sb>  hist(x)
</span><span class=sb>`</span><span class=p>);</span>
<span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>capture</span><span class=p>);</span>
</code></pre></div><div class=output><pre><code>{
  result: Proxy(Object),
  output: [
    { type: 'stdout', data: '[1] 0.7612882' },
  ],
  images: [ ImageBitmap ],
}
</code></pre></div><p>Captured plots are returned as an array of
<a href=https://developer.mozilla.org/en-US/docs/Web/API/ImageBitmap target=_blank rel=noopener><code>ImageBitmap</code></a> JavaScript objects in the <code>images</code> property. This interface represents a bitmap image in a way that can be efficiently drawn to a HTML
<a href=https://developer.mozilla.org/en-US/docs/Web/HTML/Element/canvas target=_blank rel=noopener><code>&lt;canvas></code></a> element.</p><p>This change makes plotting consistent with other forms of R output and simplifies the process when working with multiple independent R code blocks and output images. See the webR documentation on
<a href=https://docs.r-wasm.org/webr/latest/evaluating.html#evaluating-r-code-and-capturing-output-with-capturer target=_blank rel=noopener>evaluating R code</a> for further details, and this
<a href=https://observablehq.com/d/ec99bb89a4c646ab target=_blank rel=noopener>Observable notebook</a> for an example of capturing R plots from JavaScript.</p><h3 id=graphics-device-bug-fixes>Graphics device bug fixes
<a href=#graphics-device-bug-fixes><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>In addition to adding the ability to capture graphics output, the
<a href=https://rdrr.io/pkg/webr/man/canvas.html target=_blank rel=noopener><code>webr::canvas()</code></a> graphics device has also had various bug fixes made to better implement R base graphics. The easiest way to demonstrate is probably by example:</p><div class=highlight><button class="btn btn-default btn-webr" disabled type=button id=webr-run-button-2>Loading webR...</button><div id=webr-editor-2></div><div id=webr-code-output-2><pre style=visibility:hidden></pre></div><script type=module>
  const runButton = document.getElementById('webr-run-button-2');
  const outputDiv = document.getElementById('webr-code-output-2');
  const editorDiv = document.getElementById('webr-editor-2');

  const editor = CodeMirror((elt) => {
    elt.style.border = '1px solid #eee';
    elt.style.height = 'auto';
    editorDiv.append(elt);
  },{
    value: `# The lty and lwd graphical properties now work correctly\nplot(1:10, type = "l", lty = 2, lwd = 3)\npoints(1:10, cex = 3, lwd = 2)`,
    lineNumbers: true,
    mode: 'r',
    theme: 'light default',
    viewportMargin: Infinity,
  });

  runButton.onclick = async () => {
    runButton.disabled = true;
    let canvas = undefined;
    await webR.init();
    await webR.evalRVoid('webr::canvas(width=504, height=311.472)');
    await webR.FS.syncfs(false);
    const result = await webRCodeShelter.captureR(editor.getValue(), {
      withAutoprint: true,
      captureStreams: true,
      captureConditions: false,
      captureGraphics: false,
      env: {},
    });
    try {
      await webR.evalRVoid("dev.off()");
      const out = result.output.filter(
        evt => evt.type == 'stdout' || evt.type == 'stderr'
      ).map((evt) => evt.data).join('\n');

      outputDiv.innerHTML = '';
      const pre = document.createElement("pre");
      if (/\S/.test(out)) {
        const code = document.createElement("code");
        code.innerText = out;
        pre.appendChild(code);
      } else {
        pre.style.visibility = 'hidden';
      }
      outputDiv.appendChild(pre);

      const msgs = await webR.flush();
      msgs.forEach(msg => {
        if (msg.type === 'canvas'){
          if (msg.data.event === 'canvasImage') {
            
            canvas.getContext('2d').drawImage(msg.data.image, 0, 0);
          } else if (msg.data.event === 'canvasNewPage') {
            
            canvas = document.createElement('canvas');
            canvas.setAttribute('width', 2 * 504);
            canvas.setAttribute('height', 2 * 311.472);
            canvas.style.width="700px";
            canvas.style.display="block";
            canvas.style.margin="auto";
            
            const p = document.createElement("p");
            p.appendChild(canvas);
            outputDiv.appendChild(p);
          }
        }
      });
    } finally {
      webRCodeShelter.purge();
      runButton.disabled = false;
    }
  }
</script></div><div class=highlight><button class="btn btn-default btn-webr" disabled type=button id=webr-run-button-3>Loading webR...</button><div id=webr-editor-3></div><div id=webr-code-output-3><pre style=visibility:hidden></pre></div><script type=module>
  const runButton = document.getElementById('webr-run-button-3');
  const outputDiv = document.getElementById('webr-code-output-3');
  const editorDiv = document.getElementById('webr-editor-3');

  const editor = CodeMirror((elt) => {
    elt.style.border = '1px solid #eee';
    elt.style.height = 'auto';
    editorDiv.append(elt);
  },{
    value: `# The cex graphical property is now taken into account\n# when calculating font sizes\nplot(1, main = "This is a large title", cex.main = 3)`,
    lineNumbers: true,
    mode: 'r',
    theme: 'light default',
    viewportMargin: Infinity,
  });

  runButton.onclick = async () => {
    runButton.disabled = true;
    let canvas = undefined;
    await webR.init();
    await webR.evalRVoid('webr::canvas(width=504, height=311.472)');
    await webR.FS.syncfs(false);
    const result = await webRCodeShelter.captureR(editor.getValue(), {
      withAutoprint: true,
      captureStreams: true,
      captureConditions: false,
      captureGraphics: false,
      env: {},
    });
    try {
      await webR.evalRVoid("dev.off()");
      const out = result.output.filter(
        evt => evt.type == 'stdout' || evt.type == 'stderr'
      ).map((evt) => evt.data).join('\n');

      outputDiv.innerHTML = '';
      const pre = document.createElement("pre");
      if (/\S/.test(out)) {
        const code = document.createElement("code");
        code.innerText = out;
        pre.appendChild(code);
      } else {
        pre.style.visibility = 'hidden';
      }
      outputDiv.appendChild(pre);

      const msgs = await webR.flush();
      msgs.forEach(msg => {
        if (msg.type === 'canvas'){
          if (msg.data.event === 'canvasImage') {
            
            canvas.getContext('2d').drawImage(msg.data.image, 0, 0);
          } else if (msg.data.event === 'canvasNewPage') {
            
            canvas = document.createElement('canvas');
            canvas.setAttribute('width', 2 * 504);
            canvas.setAttribute('height', 2 * 311.472);
            canvas.style.width="700px";
            canvas.style.display="block";
            canvas.style.margin="auto";
            
            const p = document.createElement("p");
            p.appendChild(canvas);
            outputDiv.appendChild(p);
          }
        }
      });
    } finally {
      webRCodeShelter.purge();
      runButton.disabled = false;
    }
  }
</script></div><div class=highlight><button class="btn btn-default btn-webr" disabled type=button id=webr-run-button-4>Loading webR...</button><div id=webr-editor-4></div><div id=webr-code-output-4><pre style=visibility:hidden></pre></div><script type=module>
  const runButton = document.getElementById('webr-run-button-4');
  const outputDiv = document.getElementById('webr-code-output-4');
  const editorDiv = document.getElementById('webr-editor-4');

  const editor = CodeMirror((elt) => {
    elt.style.border = '1px solid #eee';
    elt.style.height = 'auto';
    editorDiv.append(elt);
  },{
    value: `# Rasters with negative width or height are now correctly\n# drawn mirrored and flipped.\ninstall.packages("jpeg")\nlogo = jpeg::readJPEG(system.file(package = "jpeg", "img", "Rlogo.jpg"))\nplot(NULL, xlab = "", ylab = "", xlim = c(0, 1), ylim = c(0, 1))\n\nrasterImage(logo, xleft = 0.2, xright = 0.5, ybottom = 0.5, ytop = 1)\nrasterImage(logo, xleft = 0.8, xright = 0.5, ybottom = 0.5, ytop = 1)\nrasterImage(logo, xleft = 0.2, xright = 0.5, ybottom = 0.5, ytop = 0)\nrasterImage(logo, xleft = 0.8, xright = 0.5, ybottom = 0.5, ytop = 0)`,
    lineNumbers: true,
    mode: 'r',
    theme: 'light default',
    viewportMargin: Infinity,
  });

  runButton.onclick = async () => {
    runButton.disabled = true;
    let canvas = undefined;
    await webR.init();
    await webR.evalRVoid('webr::canvas(width=504, height=311.472)');
    await webR.FS.syncfs(false);
    const result = await webRCodeShelter.captureR(editor.getValue(), {
      withAutoprint: true,
      captureStreams: true,
      captureConditions: false,
      captureGraphics: false,
      env: {},
    });
    try {
      await webR.evalRVoid("dev.off()");
      const out = result.output.filter(
        evt => evt.type == 'stdout' || evt.type == 'stderr'
      ).map((evt) => evt.data).join('\n');

      outputDiv.innerHTML = '';
      const pre = document.createElement("pre");
      if (/\S/.test(out)) {
        const code = document.createElement("code");
        code.innerText = out;
        pre.appendChild(code);
      } else {
        pre.style.visibility = 'hidden';
      }
      outputDiv.appendChild(pre);

      const msgs = await webR.flush();
      msgs.forEach(msg => {
        if (msg.type === 'canvas'){
          if (msg.data.event === 'canvasImage') {
            
            canvas.getContext('2d').drawImage(msg.data.image, 0, 0);
          } else if (msg.data.event === 'canvasNewPage') {
            
            canvas = document.createElement('canvas');
            canvas.setAttribute('width', 2 * 504);
            canvas.setAttribute('height', 2 * 311.472);
            canvas.style.width="700px";
            canvas.style.display="block";
            canvas.style.margin="auto";
            
            const p = document.createElement("p");
            p.appendChild(canvas);
            outputDiv.appendChild(p);
          }
        }
      });
    } finally {
      webRCodeShelter.purge();
      runButton.disabled = false;
    }
  }
</script></div><h2 id=the-r-object-interface>The R object interface
<a href=#the-r-object-interface><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>The R object interface provided by webR has been expanded to support the conversion of more types of JavaScript objects into R objects. Such conversions are automatically applied when interacting with the R environment from JavaScript.</p><h3 id=raw-vectors>Raw vectors
<a href=#raw-vectors><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>JavaScript objects of type <code>TypedArray</code>, <code>ArrayBuffer</code>, and <code>ArrayBufferView</code> (e.g. 
<a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array target=_blank rel=noopener><code>Uint8Array</code></a>) may now be used to construct R objects. By default, objects of this type are converted to R raw atomic vectors. This simplifies the transfer of binary data to R.</p><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=kr>const</span> <span class=nx>data</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Uint8Array</span><span class=p>([</span><span class=mi>4</span><span class=p>,</span> <span class=mi>12</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>24</span><span class=p>,</span> <span class=mi>15</span><span class=p>,</span> <span class=mi>12</span><span class=p>]);</span>
<span class=c1>// Print data&#39;s R object class and an example byte
</span><span class=c1></span><span class=nx>await</span> <span class=nx>webR</span><span class=p>.</span><span class=nx>evalR</span><span class=p>(</span><span class=sb>`
</span><span class=sb>  class(data)
</span><span class=sb>  data[2]
</span><span class=sb>`</span><span class=p>,</span> <span class=p>{</span> <span class=nx>withAutoprint</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=nx>env</span><span class=o>:</span> <span class=p>{</span> <span class=nx>data</span> <span class=p>}</span> <span class=p>});</span>
</code></pre></div><div class=output><pre><code>[1] &quot;raw&quot;
[1] 0c
</code></pre></div><h3 id=r-dataframe>R <code>data.frame</code>
<a href=#r-dataframe><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>JavaScript objects of shape <code>{ x: [...], y: [...] }</code>, with data in a &ldquo;long&rdquo; column-based form, can now be used to construct R objects. In previous versions of webR, this object shape was reserved for future use. However, with this release webR now constructs an R <code>data.frame</code> by taking the source object&rsquo;s properties as column vectors. The resulting <code>data.frame</code> can then be manipulated from R in the usual way:</p><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=kr>const</span> <span class=nx>data</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>column_x</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;foo&#34;</span><span class=p>,</span> <span class=s2>&#34;bar&#34;</span><span class=p>,</span> <span class=s2>&#34;baz&#34;</span><span class=p>],</span> <span class=nx>column_y</span><span class=o>:</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>7</span><span class=p>]</span> <span class=p>}</span>
<span class=nx>await</span> <span class=nx>webR</span><span class=p>.</span><span class=nx>evalR</span><span class=p>(</span><span class=sb>`
</span><span class=sb>  class(data)
</span><span class=sb>  colnames(data)
</span><span class=sb>  data[2:3,]
</span><span class=sb>`</span><span class=p>,</span> <span class=p>{</span> <span class=nx>withAutoprint</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=nx>env</span><span class=o>:</span> <span class=p>{</span> <span class=nx>data</span> <span class=p>}</span> <span class=p>});</span>
</code></pre></div><div class=output><pre><code>[1] &quot;data.frame&quot;
[1] &quot;column_x&quot; &quot;column_y&quot;
        column_x column_y
 2      bar        3
 3      baz        7
</code></pre></div><p>Similarly, an R <code>data.frame</code> can be converted back into a JavaScript object of this form:</p><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=kr>const</span> <span class=nx>cars</span> <span class=o>=</span> <span class=nx>await</span> <span class=nx>webR</span><span class=p>.</span><span class=nx>evalR</span><span class=p>(</span><span class=sb>`mtcars`</span><span class=p>);</span>
<span class=nx>await</span> <span class=nx>cars</span><span class=p>.</span><span class=nx>toObject</span><span class=p>();</span>
</code></pre></div><div class=output><pre><code>{
  am: [1, 1, 1, ..., 1],
  carb: [4, 4, 1, ..., 2],
  cyl: [6, 6, 4, ..., 4]
  ...,
  wt: [2.62, 2.875, 2.32, ..., 2.78],
}
</code></pre></div><h3 id=d3-wide-format>D3 &ldquo;wide&rdquo; format
<a href=#d3-wide-format><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>In JavaScript, particularly when using frameworks built upon
<a href=https://d3js.org target=_blank rel=noopener>D3</a>, it is typical to work with data in a &ldquo;wide&rdquo; form: an array of objects per row, each including all the column names and values. With this release, webR can also convert JavaScript objects in this form into an R <code>data.frame</code>.</p><p>The following example loads the same data as shown in the previous example but expressed in the &ldquo;wide&rdquo; form.</p><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=kr>const</span> <span class=nx>data</span> <span class=o>=</span> <span class=p>[</span>
  <span class=p>{</span> <span class=nx>column_x</span><span class=o>:</span> <span class=s2>&#34;foo&#34;</span><span class=p>,</span> <span class=nx>column_y</span><span class=o>:</span> <span class=mi>1</span> <span class=p>},</span>
  <span class=p>{</span> <span class=nx>column_x</span><span class=o>:</span> <span class=s2>&#34;bar&#34;</span><span class=p>,</span> <span class=nx>column_y</span><span class=o>:</span> <span class=mi>3</span> <span class=p>},</span>
  <span class=p>{</span> <span class=nx>column_x</span><span class=o>:</span> <span class=s2>&#34;baz&#34;</span><span class=p>,</span> <span class=nx>column_y</span><span class=o>:</span> <span class=mi>7</span> <span class=p>},</span>
<span class=p>];</span>
<span class=nx>await</span> <span class=nx>webR</span><span class=p>.</span><span class=nx>evalR</span><span class=p>(</span><span class=sb>`
</span><span class=sb>  class(data)
</span><span class=sb>  colnames(data)
</span><span class=sb>  data[2:3,]
</span><span class=sb>`</span><span class=p>,</span> <span class=p>{</span> <span class=nx>withAutoprint</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=nx>env</span><span class=o>:</span> <span class=p>{</span> <span class=nx>data</span> <span class=p>}</span> <span class=p>});</span>
</code></pre></div><div class=output><pre><code>[1] &quot;data.frame&quot;
[1] &quot;column_x&quot; &quot;column_y&quot;
        column_x column_y
 2      bar        3
 3      baz        7
</code></pre></div><p>An R <code>data.frame</code> can also be converted into a D3 compatible JavaScript object:</p><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=kr>const</span> <span class=nx>cars</span> <span class=o>=</span> <span class=nx>await</span> <span class=nx>webR</span><span class=p>.</span><span class=nx>evalR</span><span class=p>(</span><span class=sb>`mtcars`</span><span class=p>);</span>
<span class=nx>await</span> <span class=nx>cars</span><span class=p>.</span><span class=nx>toD3</span><span class=p>();</span>
</code></pre></div><div class=output><pre><code>[
  { mpg: 21, cyl: 6, disp: 160, ... },
  { mpg: 21, cyl: 6, disp: 160, ... },
  { mpg: 22.8, cyl: 4, disp: 108, ...},
  ...
  { mpg: 21.4, cyl: 4, disp: 121, ...},
]
</code></pre></div><h2 id=webassembly-toolchain-upgrades>WebAssembly toolchain upgrades
<a href=#webassembly-toolchain-upgrades><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>We have updated our WebAssembly build system, upgrading the
<a href=https://emscripten.org target=_blank rel=noopener>Emscripten</a> C/C++ compiler to version 3.1.47 and the
<a href=https://flang.llvm.org/docs/ target=_blank rel=noopener>LLVM Flang</a> Fortran compiler to be based on LLVM 18.1.1. As part of the work, webR now supports building under Nix using
<a href=https://nixos.wiki/wiki/Flakes target=_blank rel=noopener>flakes</a>, suggested and largely implemented by
<a href=https://github.com/wch target=_blank rel=noopener>@wch</a>.</p><p>With this, source-code level reproducible builds of the webR WebAssembly binaries can be made, strengthening the argument for webR as a potential future platform for reproducible data science.</p><h3 id=llvm-flang>LLVM Flang
<a href=#llvm-flang><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>To compile Fortran sources in the R source code<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> for webR, we require a Fortran compiler that supports outputting WebAssembly objects. This is a surprisingly tricky business, and our current solution is to maintain a patched version of LLVM&rsquo;s <code>flang-new</code> compiler frontend.</p><p>In recent months, the patches we must make to LLVM Flang have become smaller and easier to manage as the LLVM team continues to improve the Flang frontend. While too long for this post, for those interested in exactly what changes we make to enable WebAssembly output, I have written a deep-dive blog post,
<a href=https://gws.phd/posts/fortran_wasm/ target=_blank rel=noopener>Fortran on WebAssembly</a>.</p><h2 id=additional-system-libraries-and-rust-support>Additional system libraries and Rust support
<a href=#additional-system-libraries-and-rust-support><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Thanks to some great work by
<a href=https://github.com/jeroen target=_blank rel=noopener>@jeroen</a> and
<a href=https://github.com/yutannihilation target=_blank rel=noopener>@yutannihilation</a>, this release of webR includes some additional WebAssembly system libraries and software in the webR Docker container. This includes numerical libraries such as
<a href=https://www.gnu.org/software/gsl/ target=_blank rel=noopener>GSL</a> and
<a href=https://gmplib.org target=_blank rel=noopener>GMP</a>, image manipulation tools such as
<a href=https://imagemagick.org/ target=_blank rel=noopener>ImageMagick</a>, and a Rust compiler configured to build WebAssembly R packages containing Rust source code.</p><p>A demonstration R package containing Rust code, compatible with webR, can be found at <a href=https://github.com/yutannihilation/savvy-webr-test/>https://github.com/yutannihilation/savvy-webr-test/</a>.</p><p>An example Shiny app making use of the WebAssembly compiled ImageMagick library is shown below, with the source code at <a href=https://github.com/jeroen/shinymagick>https://github.com/jeroen/shinymagick</a>.</p><iframe style="border:1px solid #000" width=100% height=550px src=https://georgestagg.github.io/shinymagick/></iframe><h2 id=webassembly-r-package-binaries>WebAssembly R package binaries
<a href=#webassembly-r-package-binaries><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>With the introduction of additional system libraries and changes to the WebAssembly toolchain, the default webR package repository has also been refreshed. The repository tends to follow CRAN package releases, though is updated less frequently. <strong>19452</strong> WebAssembly R packages have been recompiled from source for this release, with <strong>12969</strong> packages, about 63% of CRAN, fully available<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup> for use in webR.</p><p>As my usual caveat goes, we have not been able to test all the available packages. Feel free to try your favourite package in the
<a href=https://webr.r-wasm.org/v0.3.1/ target=_blank rel=noopener>webR app</a> and let us know in a
<a href=https://github.com/r-wasm/webr/issues target=_blank rel=noopener>GitHub issue</a> if there is a problem.</p><p>The
<a href=https://repo.r-wasm.org target=_blank rel=noopener>package repository index</a> contains further information and a searchable list of WebAssembly R packages. In addition,
<a href=https://r-universe.dev target=_blank rel=noopener>R-Universe</a> also builds webR-compatible binaries and so can be used as an alternative repository for access to even more R packages.</p><h3 id=building-custom-webassembly-r-packages>Building custom WebAssembly R packages
<a href=#building-custom-webassembly-r-packages><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>If you&rsquo;d like to build your own R packages for webR, the
<a href=https://r-wasm.github.io/rwasm/ target=_blank rel=noopener>rwasm</a> package provides functions to help compile R packages for WebAssembly, manage repositories, and prepare webR-compatible filesystem images.</p><p>We&rsquo;ve also started building
<a href=https://github.com/r-wasm/actions/ target=_blank rel=noopener>reusable workflows for GitHub Actions</a>. If you have an R package with source code hosted on GitHub, an action can be added to your repository such that a WebAssembly version of your package will be built automatically by a GitHub runner on package release.</p><h2 id=acknowledgements>Acknowledgements
<a href=#acknowledgements><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Thank you, as always, to the users and developers contributing to webR in the form of discussion in issues, bug reports, and pull requests.</p><p><a href=https://github.com/adrianolszewski target=_blank rel=noopener>@adrianolszewski</a>,
<a href=https://github.com/christianp target=_blank rel=noopener>@christianp</a>,
<a href=https://github.com/coatless target=_blank rel=noopener>@coatless</a>,
<a href=https://github.com/ColinFay target=_blank rel=noopener>@ColinFay</a>,
<a href=https://github.com/drgomulka target=_blank rel=noopener>@drgomulka</a>,
<a href=https://github.com/erex target=_blank rel=noopener>@erex</a>,
<a href=https://github.com/gitdemont target=_blank rel=noopener>@gitdemont</a>,
<a href=https://github.com/gorkang target=_blank rel=noopener>@gorkang</a>,
<a href=https://github.com/isbool target=_blank rel=noopener>@isbool</a>,
<a href=https://github.com/JeremyPasco target=_blank rel=noopener>@JeremyPasco</a>,
<a href=https://github.com/jeroen target=_blank rel=noopener>@jeroen</a>,
<a href=https://github.com/JosiahParry target=_blank rel=noopener>@JosiahParry</a>,
<a href=https://github.com/Luke-Symes-Tsy target=_blank rel=noopener>@Luke-Symes-Tsy</a>,
<a href=https://github.com/maek-ies target=_blank rel=noopener>@maek-ies</a>,
<a href=https://github.com/MaybeJustJames target=_blank rel=noopener>@MaybeJustJames</a>,
<a href=https://github.com/ravinder387 target=_blank rel=noopener>@ravinder387</a>,
<a href=https://github.com/StaffanBetner target=_blank rel=noopener>@StaffanBetner</a>,
<a href=https://github.com/SugarRayLua target=_blank rel=noopener>@SugarRayLua</a>,
<a href=https://github.com/takahser target=_blank rel=noopener>@takahser</a>,
<a href=https://github.com/tim-newans target=_blank rel=noopener>@tim-newans</a>,
<a href=https://github.com/timelyportfolio target=_blank rel=noopener>@timelyportfolio</a>,
<a href=https://github.com/tstubbs-evolution target=_blank rel=noopener>@tstubbs-evolution</a>,
<a href=https://github.com/yhm-amber target=_blank rel=noopener>@yhm-amber</a>,
<a href=https://github.com/yii-iiy target=_blank rel=noopener>@yii-iiy</a>,
<a href=https://github.com/yutannihilation target=_blank rel=noopener>@yutannihilation</a>, and
<a href=https://github.com/zhangwenda0518 target=_blank rel=noopener>@zhangwenda0518</a>.</p><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>The latest stable release at the time of writing:
<a href=https://cran.rstudio.com/doc/manuals/r-release/NEWS.html target=_blank rel=noopener>R 4.3.3 &mdash; &ldquo;Angel Food Cake&rdquo;</a> <a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p>There are also many R packages containing Fortran source code. <a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3 role=doc-endnote><p>Here &ldquo;available&rdquo; means that both a binary build of an R package and all of its dependencies can be downloaded from the repository. <a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></div></div><div class=column25><div class="section hideOnMobile"><div class=sectionTitle>Contents</div><nav id=TableOfContents><ul><li><a href=#evaluating-r-code-from-javascript>Evaluating R code from JavaScript</a></li><li><a href=#capturing-html-canvas-graphics-output>Capturing HTML canvas graphics output</a></li><li><a href=#the-r-object-interface>The R object interface</a></li><li><a href=#webassembly-toolchain-upgrades>WebAssembly toolchain upgrades</a></li><li><a href=#additional-system-libraries-and-rust-support>Additional system libraries and Rust support</a></li><li><a href=#webassembly-r-package-binaries>WebAssembly R package binaries</a></li><li><a href=#acknowledgements>Acknowledgements</a></li></ul></nav></div><div class=section></div></div></div></div></div><div id=rStudioFooter class=band><div class=bandContent><div id=copyright>The tidyverse is proudly supported by <a class=rstudioLogo href=https://posit.co/ aria-label="Posit Homepage"></a></div><div id=logos><a href=https://www.tidyverse.org/google_privacy_policy>Privacy policy</a>
<a href=https://github.com/tidyverse class="footerLogo gitHub" aria-label="Tidyverse GitHub organization"></a><a href=https://twitter.com/hashtag/rstats class="footerLogo twitter" aria-label="rstats hashtag on twitter.com"></a></div></div></div></div></div><script src=/js/math-code.js></script><script type=text/x-mathjax-config>
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script><script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script type=application/javascript>var dnt=(navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack);var doNotTrack=(dnt=="1"||dnt=="yes");if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');if(window.sessionStorage){var GA_SESSION_STORAGE_KEY='ga:clientId';ga('create','UA-115082821-1',{'storage':'none','clientId':sessionStorage.getItem(GA_SESSION_STORAGE_KEY)});ga(function(tracker){sessionStorage.setItem(GA_SESSION_STORAGE_KEY,tracker.get('clientId'));});}
ga('set','anonymizeIp',true);ga('send','pageview');}</script></body></html></div></div></body></html>