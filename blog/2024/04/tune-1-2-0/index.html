<!doctype html><html><head><!doctype html><html lang=en-us><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/css/main-site.css><link rel=stylesheet href=/css/fa5-all.css><style type=text/css>body{background-color:#fff;color:#1a1917}a{color:#38577f}a:hover{color:#42709b}a:focus{outline-color:#42709b}.column25-left .sectionTitle a:hover:not(.current),.column16-left .sectionTitle a:hover:not(.current){color:#1a1917}.icon-attribution,.icon-attribution a{color:#1a1917;opacity:75%}#homeContent .band.first{background-color:#fff}#homeContent .band.second{background-color:#fdeba4}#homeContent .band.third{background-color:#fff}#rStudioHeader{background-color:#1a162d;color:#fff}#rStudioHeader .productName{color:#fff}#rStudioHeader .productName:hover,#rStudioHeader .productName:focus{color:#fdeba4}#rStudioHeader #menu .menuItem.a{background-color:#75aadb;color:#fff}#rStudioHeader #menu .menuItem:hover{background-color:#484557;color:#fff}#rStudioHeader #menu .menuItem.current{background-color:#fff;color:#1a162d;text-decoration:none}#rStudioFooter.band{background-color:#767381}#rStudioFooter .bandContent #copyright{color:#e3eef8}table tbody tr:nth-child(even){background-color:#f7faff}table tbody tr:nth-child(odd){background-color:#fff}.latest{border-top:.5em solid <no value>}.event{-moz-box-shadow:0 0 0 0 rgba(0,0,0,.1);-webkit-box-shadow:0 0 0 0 rgba(0,0,0,.1);box-shadow:0 0 0 0 rgba(0,0,0,.1)}.section .event{background-color:#eab0c41a}.section .event{border-top:7pt solid #a19ea936}.section .event a{color:#1a162d}.section .event{color:#404040}</style><link rel=stylesheet href=/css/tidyverse.css><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.71.1"><title>tune 1.2.0</title><meta property="og:title" content="tune 1.2.0"><meta property="og:description" content="While we've written about survival analysis and machine learning fairness  already, the newest tune release includes a number of other major changes."><meta property="og:type" content="article"><meta property="og:url" content="https://www.tidyverse.org/blog/2024/04/tune-1-2-0/"><meta property="twitter:card" content="summary_large_image"><meta property="og:title" content="tune 1.2.0 - Tidyverse"><meta property="description" content="While we've written about survival analysis and machine learning fairness  already, the newest tune release includes a number of other major changes."><meta property="og:description" content="While we've written about survival analysis and machine learning fairness  already, the newest tune release includes a number of other major changes."><meta property="og:image" content="https://www.tidyverse.org/blog/2024/04/tune-1-2-0/thumbnail-sq.jpg"><meta name=twitter:image content="https://www.tidyverse.org/blog/2024/04/tune-1-2-0/thumbnail-wd.jpg"><link rel=apple-touch-icon sizes=180x180 href=/images/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicons/favicon-16x16.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg><link rel="shortcut icon" href=/images/favicons/favicon.ico><meta name=msapplication-TileColor content="#da532c"><meta name=msapplication-config href=/images/favicons/browserconfig.xml><script type=text/javascript src=/js/jquery-3.5.1.min.js></script><script type=text/javascript src=/js/site.js></script><link rel=icon href=/images/favicon.ico><script type=text/javascript src=/js/clipboard.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin=anonymous></script><script defer data-domain=tidyverse.org,all.tidyverse.org src=https://plausible.io/js/plausible.js></script></head><body><div id=appTidyverseSite class="shrinkHeader alwaysShrinkHeader"><div id=main><div id=rStudioHeader><nav class=band><div class="innards bandContent"><div><a class=productName href=/%20/>Tidyverse</a></div><div id=menu><div id=menuToggler></div><div id=menuItems><a class=menuItem href=/packages/>Packages</a>
<a class="menuItem current" href=/blog/>Blog</a>
<a class=menuItem href=/learn/>Learn</a>
<a class=menuItem href=/help/>Help</a>
<a class=menuItem href=/contribute/>Contribute</a></div></div></div></nav></div><main><div class="band padForHeader pushFooter"><div class=bandContent><div class="full splitColumns withMobileMargins"><div class=column75><h1 class=article-title>tune 1.2.0</h1><div class=article-header aria-hidden=true><div class=photo><img src=/blog/2024/04/tune-1-2-0/thumbnail-wd.jpg></div><div class=photoCredit>Photo by <a href=https://unsplash.com/photos/1Pzhr6XPl6k>Derek Story</a></div></div><span class=article-date><i class="fas fa-calendar-day fa-fw"></i>&nbsp;&nbsp;2024/04/18</span><p style=margin-bottom:.5em;margin-top:.85em><i class="fas fa-tags"></i>&nbsp;
<a href=/tags/parallelism/>parallelism</a>,
<a href=/tags/tidymodels/>tidymodels</a>,
<a href=/tags/tune/>tune</a></p><p style=margin-top:.5em><i class="fas fa-user-circle fa-fw"></i>&nbsp;
Simon Couch</p><div class=article-content><div class=highlight></div><p>We&rsquo;re indubitably amped to announce the release of
<a href=https://tune.tidymodels.org/ target=_blank rel=noopener>tune</a> 1.2.0, a package for hyperparameter tuning in the
<a href=https://www.tidymodels.org/ target=_blank rel=noopener>tidymodels framework</a>.</p><p>You can install it from CRAN, along with the rest of the core packages in tidymodels, using the tidymodels meta-package:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://rdrr.io/r/utils/install.packages.html>install.packages</a></span><span class=o>(</span><span class=s>"tidymodels"</span><span class=o>)</span></span></code></pre></div><p>The 1.2.0 release of tune has introduced support for two major features that we&rsquo;ve written about on the tidyverse blog already:</p><ul><li><a href=https://www.tidyverse.org/blog/2024/04/tidymodels-survival-analysis/ target=_blank rel=noopener>Survival analysis for time-to-event data with tidymodels</a></li><li><a href=https://www.tidyverse.org/blog/2024/03/tidymodels-fairness/ target=_blank rel=noopener>Fair machine learning with tidymodels</a></li></ul><p>While those features got their own blog posts, there are several more features in this release that we thought were worth calling out. This post will highlight improvements to our support for parallel processing, the introduction of support for percentile confidence intervals for performance metrics, and a few other bits and bobs. You can see a full list of changes in the
<a href=https://github.com/tidymodels/tune/releases/tag/v1.2.0 target=_blank rel=noopener>release notes</a>.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=https://tidymodels.tidymodels.org>tidymodels</a></span><span class=o>)</span></span></code></pre></div><p>Throughout this post, I&rsquo;ll refer to the example of tuning an XGBoost model to predict the fuel efficiency of various car models. I hear this is already a well-explored modeling problem, but alas:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://rdrr.io/r/base/Random.html>set.seed</a></span><span class=o>(</span><span class=m>2024</span><span class=o>)</span></span>
<span></span>
<span><span class=nv>xgb_res</span> <span class=o>&lt;-</span> </span>
<span>  <span class=nf>tune_grid</span><span class=o>(</span></span>
<span>    <span class=nf>boost_tree</span><span class=o>(</span>mode <span class=o>=</span> <span class=s>"regression"</span>, mtry <span class=o>=</span> <span class=nf>tune</span><span class=o>(</span><span class=o>)</span>, learn_rate <span class=o>=</span> <span class=nf>tune</span><span class=o>(</span><span class=o>)</span><span class=o>)</span>,</span>
<span>    <span class=nv>mpg</span> <span class=o>~</span> <span class=nv>.</span>,</span>
<span>    <span class=nf>bootstraps</span><span class=o>(</span><span class=nv>mtcars</span><span class=o>)</span>,</span>
<span>    control <span class=o>=</span> <span class=nf>control_grid</span><span class=o>(</span>save_pred <span class=o>=</span> <span class=kc>TRUE</span><span class=o>)</span></span>
<span>  <span class=o>)</span></span></code></pre></div><p>Note that we&rsquo;ve used the
<a href=https://tune.tidymodels.org/reference/control_grid.html target=_blank rel=noopener>control option</a> <code>save_pred = TRUE</code> to indicate that we want to save the predictions from our resampled models in the tuning results. Both <code>int_pctl()</code> and <code>compute_metrics()</code> below will need those predictions. The metrics for our resampled model look like so:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf>collect_metrics</span><span class=o>(</span><span class=nv>xgb_res</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 20 Ã— 8</span></span></span>
<span><span class=c>#&gt;    mtry learn_rate .metric .estimator   mean     n std_err .config              </span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;int&gt;</span>      <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>   <span style=color:#555;font-style:italic>&lt;chr&gt;</span>       <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;int&gt;</span>   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>                </span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span>     2    0.002<span style=text-decoration:underline>04</span> rmse    standard   19.7      25  0.262  Preprocessor1_Model01</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span>     2    0.002<span style=text-decoration:underline>04</span> rsq     standard    0.659    25  0.031<span style=text-decoration:underline>4</span> Preprocessor1_Model01</span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span>     6    0.008<span style=text-decoration:underline>59</span> rmse    standard   18.0      25  0.260  Preprocessor1_Model02</span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span>     6    0.008<span style=text-decoration:underline>59</span> rsq     standard    0.607    25  0.027<span style=text-decoration:underline>0</span> Preprocessor1_Model02</span></span>
<span><span class=c>#&gt; <span style=color:#555>5</span>     3    0.027<span style=text-decoration:underline>6</span>  rmse    standard   14.0      25  0.267  Preprocessor1_Model03</span></span>
<span><span class=c>#&gt; <span style=color:#555>6</span>     3    0.027<span style=text-decoration:underline>6</span>  rsq     standard    0.710    25  0.023<span style=text-decoration:underline>7</span> Preprocessor1_Model03</span></span>
<span><span class=c>#&gt; <span style=color:#555># â„¹ 14 more rows</span></span></span>
<span></span></code></pre></div><h2 id=modernized-support-for-parallel-processing>Modernized support for parallel processing
<a href=#modernized-support-for-parallel-processing><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>The tidymodels framework has long supported evaluating models in parallel using the
<a href=https://cran.r-project.org/web/packages/foreach/vignettes/foreach.html target=_blank rel=noopener>foreach</a> package. This release of tune has introduced support for parallelism using the
<a href=https://www.futureverse.org/ target=_blank rel=noopener>futureverse</a> framework, and we will begin deprecating our support for foreach in a coming release.</p><p>To tune a model in parallel with foreach, a user would load a <em>parallel backend</em> package (usually with a name like
<a href=https://rdrr.io/r/base/library.html target=_blank rel=noopener><code>library(doBackend)</code></a>) and then <em>register</em> it with foreach (with a function call like <code>registerDoBackend()</code>). The tune package would then detect that registered backend and take it from there. For example, the code to distribute the above tuning process across 10 cores with foreach would look like:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv>doMC</span><span class=o>)</span></span>
<span><span class=nf><a href=https://rdrr.io/pkg/doMC/man/registerDoMC.html>registerDoMC</a></span><span class=o>(</span>cores <span class=o>=</span> <span class=m>10</span><span class=o>)</span></span>
<span></span>
<span><span class=nf><a href=https://rdrr.io/r/base/Random.html>set.seed</a></span><span class=o>(</span><span class=m>2024</span><span class=o>)</span></span>
<span></span>
<span><span class=nv>xgb_res</span> <span class=o>&lt;-</span> </span>
<span>  <span class=nf>tune_grid</span><span class=o>(</span></span>
<span>    <span class=nf>boost_tree</span><span class=o>(</span>mode <span class=o>=</span> <span class=s>"regression"</span>, mtry <span class=o>=</span> <span class=nf>tune</span><span class=o>(</span><span class=o>)</span>, learn_rate <span class=o>=</span> <span class=nf>tune</span><span class=o>(</span><span class=o>)</span><span class=o>)</span>,</span>
<span>    <span class=nv>mpg</span> <span class=o>~</span> <span class=nv>.</span>,</span>
<span>    <span class=nf>bootstraps</span><span class=o>(</span><span class=nv>mtcars</span><span class=o>)</span>,</span>
<span>    control <span class=o>=</span> <span class=nf>control_grid</span><span class=o>(</span>save_pred <span class=o>=</span> <span class=kc>TRUE</span><span class=o>)</span></span>
<span>  <span class=o>)</span></span></code></pre></div><p>The code to do so with future is similarly simple. Users first load the
<a href=https://future.futureverse.org/index.html target=_blank rel=noopener>future</a> package, and then specify a
<a href=https://future.futureverse.org/reference/plan.html target=_blank rel=noopener><code>plan()</code></a> which dictates how computations will be distributed. For example, the code to distribute the above tuning process across 10 cores with future looks like:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=https://future.futureverse.org>future</a></span><span class=o>)</span></span>
<span><span class=nf><a href=https://future.futureverse.org/reference/plan.html>plan</a></span><span class=o>(</span><span class=nv>multisession</span>, workers <span class=o>=</span> <span class=m>10</span><span class=o>)</span></span>
<span></span>
<span><span class=nf><a href=https://rdrr.io/r/base/Random.html>set.seed</a></span><span class=o>(</span><span class=m>2024</span><span class=o>)</span></span>
<span></span>
<span><span class=nv>xgb_res</span> <span class=o>&lt;-</span> </span>
<span>  <span class=nf>tune_grid</span><span class=o>(</span></span>
<span>    <span class=nf>boost_tree</span><span class=o>(</span>mode <span class=o>=</span> <span class=s>"regression"</span>, mtry <span class=o>=</span> <span class=nf>tune</span><span class=o>(</span><span class=o>)</span>, learn_rate <span class=o>=</span> <span class=nf>tune</span><span class=o>(</span><span class=o>)</span><span class=o>)</span>,</span>
<span>    <span class=nv>mpg</span> <span class=o>~</span> <span class=nv>.</span>,</span>
<span>    <span class=nf>bootstraps</span><span class=o>(</span><span class=nv>mtcars</span><span class=o>)</span>,</span>
<span>    control <span class=o>=</span> <span class=nf>control_grid</span><span class=o>(</span>save_pred <span class=o>=</span> <span class=kc>TRUE</span><span class=o>)</span></span>
<span>  <span class=o>)</span></span></code></pre></div><p>For users, the transition to parallelism with future has several benefits:</p><ul><li>The futureverse presently supports a greater number of parallelism technologies and has been more likely to receive implementations for new ones.</li><li>Once foreach is fully deprecated, users will be able to use the
<a href=https://www.tidyverse.org/blog/2023/04/tuning-delights/#interactive-issue-logging target=_blank rel=noopener>interactive logger</a> when tuning in parallel.</li></ul><p>From our perspective, transitioning our parallelism support to future makes our packages much more maintainable, reducing complexity in random number generation, error handling, and progress reporting.</p><p>In an upcoming release of the package, you&rsquo;ll see a deprecation warning when a foreach parallel backend is registered but no future plan has been specified, so start transitioning your code sooner than later!</p><h2 id=percentile-confidence-intervals>Percentile confidence intervals
<a href=#percentile-confidence-intervals><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Following up on changes in the
<a href=https://github.com/tidymodels/rsample/releases/tag/v1.2.0 target=_blank rel=noopener>most recent rsample release</a>, tune has introduced a
<a href=https://tune.tidymodels.org/reference/int_pctl.tune_results.html target=_blank rel=noopener>method for <code>int_pctl()</code></a> that calculates percentile confidence intervals for performance metrics. To calculate a 90% confidence interval for the values of each performance metric returned in <code>collect_metrics()</code>, we&rsquo;d write:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://rdrr.io/r/base/Random.html>set.seed</a></span><span class=o>(</span><span class=m>2024</span><span class=o>)</span></span>
<span></span>
<span><span class=nf>int_pctl</span><span class=o>(</span><span class=nv>xgb_res</span>, alpha <span class=o>=</span> <span class=m>.1</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 20 Ã— 8</span></span></span>
<span><span class=c>#&gt;   .metric .estimator .lower .estimate .upper .config             mtry learn_rate</span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;chr&gt;</span>   <span style=color:#555;font-style:italic>&lt;chr&gt;</span>       <span style=color:#555;font-style:italic>&lt;dbl&gt;</span>     <span style=color:#555;font-style:italic>&lt;dbl&gt;</span>  <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>              <span style=color:#555;font-style:italic>&lt;int&gt;</span>      <span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span> rmse    bootstrap  18.1      19.9   22.0   Preprocessor1_Modâ€¦     2    0.002<span style=text-decoration:underline>04</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span> rsq     bootstrap   0.570     0.679  0.778 Preprocessor1_Modâ€¦     2    0.002<span style=text-decoration:underline>04</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span> rmse    bootstrap  16.6      18.3   19.9   Preprocessor1_Modâ€¦     6    0.008<span style=text-decoration:underline>59</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span> rsq     bootstrap   0.548     0.665  0.765 Preprocessor1_Modâ€¦     6    0.008<span style=text-decoration:underline>59</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>5</span> rmse    bootstrap  12.5      14.1   15.9   Preprocessor1_Modâ€¦     3    0.027<span style=text-decoration:underline>6</span> </span></span>
<span><span class=c>#&gt; <span style=color:#555>6</span> rsq     bootstrap   0.622     0.720  0.818 Preprocessor1_Modâ€¦     3    0.027<span style=text-decoration:underline>6</span> </span></span>
<span><span class=c>#&gt; <span style=color:#555># â„¹ 14 more rows</span></span></span>
<span></span></code></pre></div><p>Note that the output has the same number of rows as the <code>collect_metrics()</code> output: one for each unique pair of metric and workflow.</p><p>This is very helpful for validation sets. Other resampling methods generate replicated performance statistics. We can compute simple interval estimates using the mean and standard error for those. Validation sets produce only one estimate, and these bootstrap methods are probably the best option for obtaining interval estimates.</p><h2 id=breaking-change-relocation-of-ellipses>Breaking change: relocation of ellipses
<a href=#breaking-change-relocation-of-ellipses><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>We&rsquo;ve made a <strong>breaking change</strong> in argument order for several functions in the package (and downstream packages like finetune and workflowsets). Ellipses (&mldr;) are now used consistently in the package to require optional arguments to be named. For functions that previously had unused ellipses at the end of the function signature, they have been moved to follow the last argument without a default value, and several other functions that previously did not have ellipses in their signatures gained them. This applies to methods for <code>augment()</code>, <code>collect_predictions()</code>, <code>collect_metrics()</code>, <code>select_best()</code>, <code>show_best()</code>, and <code>conf_mat_resampled()</code>.</p><h2 id=compute-new-metrics-without-re-fitting>Compute new metrics without re-fitting
<a href=#compute-new-metrics-without-re-fitting><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>We&rsquo;ve also added a new function,
<a href=https://tune.tidymodels.org/reference/compute_metrics.html target=_blank rel=noopener><code>compute_metrics()</code></a>, that allows for calculating metrics that were not used when evaluating against resamples. For example, consider our <code>xgb_res</code> object. Since we didn&rsquo;t supply any metrics to evaluate, and this model is a regression model, tidymodels selected RMSE and R<sup>2</sup> as defaults:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf>collect_metrics</span><span class=o>(</span><span class=nv>xgb_res</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 20 Ã— 8</span></span></span>
<span><span class=c>#&gt;    mtry learn_rate .metric .estimator   mean     n std_err .config              </span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;int&gt;</span>      <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>   <span style=color:#555;font-style:italic>&lt;chr&gt;</span>       <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;int&gt;</span>   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>                </span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span>     2    0.002<span style=text-decoration:underline>04</span> rmse    standard   19.7      25  0.262  Preprocessor1_Model01</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span>     2    0.002<span style=text-decoration:underline>04</span> rsq     standard    0.659    25  0.031<span style=text-decoration:underline>4</span> Preprocessor1_Model01</span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span>     6    0.008<span style=text-decoration:underline>59</span> rmse    standard   18.0      25  0.260  Preprocessor1_Model02</span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span>     6    0.008<span style=text-decoration:underline>59</span> rsq     standard    0.607    25  0.027<span style=text-decoration:underline>0</span> Preprocessor1_Model02</span></span>
<span><span class=c>#&gt; <span style=color:#555>5</span>     3    0.027<span style=text-decoration:underline>6</span>  rmse    standard   14.0      25  0.267  Preprocessor1_Model03</span></span>
<span><span class=c>#&gt; <span style=color:#555>6</span>     3    0.027<span style=text-decoration:underline>6</span>  rsq     standard    0.710    25  0.023<span style=text-decoration:underline>7</span> Preprocessor1_Model03</span></span>
<span><span class=c>#&gt; <span style=color:#555># â„¹ 14 more rows</span></span></span>
<span></span></code></pre></div><p>In the past, if you wanted to evaluate that workflow against a performance metric that you hadn&rsquo;t included in your <code>tune_grid()</code> run, you&rsquo;d need to re-run <code>tune_grid()</code>, fitting models and predicting new values all over again. Now, using the <code>compute_metrics()</code> function, you can use the <code>tune_grid()</code> output you&rsquo;ve already generated and compute any number of new metrics without having to fit any more models as long as you use the control option <code>save_pred = TRUE</code> when tuning.</p><p>So, say I want to additionally calculate Huber Loss and Mean Absolute Percent Error. I just pass those metrics along with the tuning result to <code>compute_metrics()</code>, and the result looks just like <code>collect_metrics()</code> output for the metrics originally calculated:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf>compute_metrics</span><span class=o>(</span><span class=nv>xgb_res</span>, <span class=nf>metric_set</span><span class=o>(</span><span class=nv>huber_loss</span>, <span class=nv>mape</span><span class=o>)</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 20 Ã— 8</span></span></span>
<span><span class=c>#&gt;    mtry learn_rate .metric    .estimator  mean     n std_err .config            </span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;int&gt;</span>      <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>      <span style=color:#555;font-style:italic>&lt;chr&gt;</span>      <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;int&gt;</span>   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>              </span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span>     2    0.002<span style=text-decoration:underline>04</span> huber_loss standard    18.3    25  0.232  Preprocessor1_Modeâ€¦</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span>     2    0.002<span style=text-decoration:underline>04</span> mape       standard    94.4    25  0.068<span style=text-decoration:underline>5</span> Preprocessor1_Modeâ€¦</span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span>     6    0.008<span style=text-decoration:underline>59</span> huber_loss standard    16.7    25  0.229  Preprocessor1_Modeâ€¦</span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span>     6    0.008<span style=text-decoration:underline>59</span> mape       standard    85.7    25  0.178  Preprocessor1_Modeâ€¦</span></span>
<span><span class=c>#&gt; <span style=color:#555>5</span>     3    0.027<span style=text-decoration:underline>6</span>  huber_loss standard    12.6    25  0.230  Preprocessor1_Modeâ€¦</span></span>
<span><span class=c>#&gt; <span style=color:#555>6</span>     3    0.027<span style=text-decoration:underline>6</span>  mape       standard    64.4    25  0.435  Preprocessor1_Modeâ€¦</span></span>
<span><span class=c>#&gt; <span style=color:#555># â„¹ 14 more rows</span></span></span>
<span></span></code></pre></div><h2 id=easily-pivot-resampled-metrics>Easily pivot resampled metrics
<a href=#easily-pivot-resampled-metrics><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Finally, the <code>collect_metrics()</code> method for tune results recently
<a href=https://tune.tidymodels.org/reference/collect_predictions.html#arguments target=_blank rel=noopener>gained a new argument</a>, <code>type</code>, indicating the shape of the returned metrics. The default, <code>type = "long"</code>, is the same shape as before. The argument value <code>type = "wide"</code> will allot each metric its own column, making it easier to compare metrics across different models.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf>collect_metrics</span><span class=o>(</span><span class=nv>xgb_res</span>, type <span class=o>=</span> <span class=s>"wide"</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 10 Ã— 5</span></span></span>
<span><span class=c>#&gt;    mtry learn_rate .config                rmse   rsq</span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;int&gt;</span>      <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>                 <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span>     2    0.002<span style=text-decoration:underline>04</span> Preprocessor1_Model01  19.7 0.659</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span>     6    0.008<span style=text-decoration:underline>59</span> Preprocessor1_Model02  18.0 0.607</span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span>     3    0.027<span style=text-decoration:underline>6</span>  Preprocessor1_Model03  14.0 0.710</span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span>     2    0.037<span style=text-decoration:underline>1</span>  Preprocessor1_Model04  12.3 0.728</span></span>
<span><span class=c>#&gt; <span style=color:#555>5</span>     5    0.005<span style=text-decoration:underline>39</span> Preprocessor1_Model05  18.8 0.595</span></span>
<span><span class=c>#&gt; <span style=color:#555>6</span>     9    0.011<span style=text-decoration:underline>0</span>  Preprocessor1_Model06  17.4 0.577</span></span>
<span><span class=c>#&gt; <span style=color:#555># â„¹ 4 more rows</span></span></span>
<span></span></code></pre></div><p>Under the hood, this is indeed just a <code>pivot_wider()</code> call. We&rsquo;ve found that it&rsquo;s time-consuming and error-prone to programmatically determine identifying columns when pivoting resampled metrics, so we&rsquo;ve localized and thoroughly tested the code that we use to do so with this feature.</p><h2 id=more-love-for-the-brier-score>More love for the Brier score
<a href=#more-love-for-the-brier-score><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Tuning and resampling functions use default metrics when the user does not specify a custom metric set. For regression models, these are RMSE and R<sup>2</sup>. For classification, accuracy and the area under the ROC curve <em>were</em> the default. We&rsquo;ve also added the
<a href=https://en.wikipedia.org/wiki/Brier_score target=_blank rel=noopener>Brier score</a> to the default classification metric list.</p><h2 id=acknowledgements>Acknowledgements
<a href=#acknowledgements><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>As always, we&rsquo;re appreciative of the community contributors who helped make this release happen:
<a href=https://github.com/AlbertoImg target=_blank rel=noopener>@AlbertoImg</a>,
<a href=https://github.com/dramanica target=_blank rel=noopener>@dramanica</a>,
<a href=https://github.com/epiheather target=_blank rel=noopener>@epiheather</a>,
<a href=https://github.com/joranE target=_blank rel=noopener>@joranE</a>,
<a href=https://github.com/jrosell target=_blank rel=noopener>@jrosell</a>,
<a href=https://github.com/jxu target=_blank rel=noopener>@jxu</a>,
<a href=https://github.com/kbodwin target=_blank rel=noopener>@kbodwin</a>,
<a href=https://github.com/kenraywilliams target=_blank rel=noopener>@kenraywilliams</a>,
<a href=https://github.com/KJT-Habitat target=_blank rel=noopener>@KJT-Habitat</a>,
<a href=https://github.com/lionel- target=_blank rel=noopener>@lionel-</a>,
<a href=https://github.com/marcozanotti target=_blank rel=noopener>@marcozanotti</a>,
<a href=https://github.com/MasterLuke84 target=_blank rel=noopener>@MasterLuke84</a>,
<a href=https://github.com/mikemahoney218 target=_blank rel=noopener>@mikemahoney218</a>,
<a href=https://github.com/PathosEthosLogos target=_blank rel=noopener>@PathosEthosLogos</a>, and
<a href=https://github.com/Peter4801 target=_blank rel=noopener>@Peter4801</a>.</p><div class=highlight></div></div></div><div class=column25><div class="section hideOnMobile"><div class=sectionTitle>Contents</div><nav id=TableOfContents><ul><li><a href=#modernized-support-for-parallel-processing>Modernized support for parallel processing</a></li><li><a href=#percentile-confidence-intervals>Percentile confidence intervals</a></li><li><a href=#breaking-change-relocation-of-ellipses>Breaking change: relocation of ellipses</a></li><li><a href=#compute-new-metrics-without-re-fitting>Compute new metrics without re-fitting</a></li><li><a href=#easily-pivot-resampled-metrics>Easily pivot resampled metrics</a></li><li><a href=#more-love-for-the-brier-score>More love for the Brier score</a></li><li><a href=#acknowledgements>Acknowledgements</a></li></ul></nav></div><div class=section></div></div></div></div></div><div id=rStudioFooter class=band><div class=bandContent><div id=copyright>The tidyverse is proudly supported by <a class=rstudioLogo href=https://posit.co/ aria-label="Posit Homepage"></a></div><div id=logos><a href=https://www.tidyverse.org/google_privacy_policy>Privacy policy</a>
<a href=https://github.com/tidyverse class="footerLogo gitHub" aria-label="Tidyverse GitHub organization"></a><a href=https://twitter.com/hashtag/rstats class="footerLogo twitter" aria-label="rstats hashtag on twitter.com"></a></div></div></div></div></div><script type=application/javascript>var dnt=(navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack);var doNotTrack=(dnt=="1"||dnt=="yes");if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');if(window.sessionStorage){var GA_SESSION_STORAGE_KEY='ga:clientId';ga('create','UA-115082821-1',{'storage':'none','clientId':sessionStorage.getItem(GA_SESSION_STORAGE_KEY)});ga(function(tracker){sessionStorage.setItem(GA_SESSION_STORAGE_KEY,tracker.get('clientId'));});}
ga('set','anonymizeIp',true);ga('send','pageview');}</script></body></html></div></div></body></html>