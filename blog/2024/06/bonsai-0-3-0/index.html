<!doctype html><html><head><!doctype html><html lang=en-us><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/css/main-site.css><link rel=stylesheet href=/css/fa5-all.css><style type=text/css>body{background-color:#fff;color:#1a1917}a{color:#38577f}a:hover{color:#42709b}a:focus{outline-color:#42709b}.column25-left .sectionTitle a:hover:not(.current),.column16-left .sectionTitle a:hover:not(.current){color:#1a1917}.icon-attribution,.icon-attribution a{color:#1a1917;opacity:75%}#homeContent .band.first{background-color:#fff}#homeContent .band.second{background-color:#fdeba4}#homeContent .band.third{background-color:#fff}#rStudioHeader{background-color:#1a162d;color:#fff}#rStudioHeader .productName{color:#fff}#rStudioHeader .productName:hover,#rStudioHeader .productName:focus{color:#fdeba4}#rStudioHeader #menu .menuItem.a{background-color:#75aadb;color:#fff}#rStudioHeader #menu .menuItem:hover{background-color:#484557;color:#fff}#rStudioHeader #menu .menuItem.current{background-color:#fff;color:#1a162d;text-decoration:none}#rStudioFooter.band{background-color:#767381}#rStudioFooter .bandContent #copyright{color:#e3eef8}table tbody tr:nth-child(even){background-color:#f7faff}table tbody tr:nth-child(odd){background-color:#fff}.latest{border-top:.5em solid <no value>}.event{-moz-box-shadow:0 0 0 0 rgba(0,0,0,.1);-webkit-box-shadow:0 0 0 0 rgba(0,0,0,.1);box-shadow:0 0 0 0 rgba(0,0,0,.1)}.section .event{background-color:#eab0c41a}.section .event{border-top:7pt solid #a19ea936}.section .event a{color:#1a162d}.section .event{color:#404040}</style><link rel=stylesheet href=/css/tidyverse.css><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.71.1"><title>bonsai 0.3.0</title><meta property="og:title" content="bonsai 0.3.0"><meta property="og:description" content="A new release of the parsnip extension package bonsai introduces support for  oblique random forests for classification and regression to tidymodels."><meta property="og:type" content="article"><meta property="og:url" content="https://www.tidyverse.org/blog/2024/06/bonsai-0-3-0/"><meta property="twitter:card" content="summary_large_image"><meta property="og:title" content="bonsai 0.3.0 - Tidyverse"><meta property="description" content="A new release of the parsnip extension package bonsai introduces support for  oblique random forests for classification and regression to tidymodels."><meta property="og:description" content="A new release of the parsnip extension package bonsai introduces support for  oblique random forests for classification and regression to tidymodels."><meta property="og:image" content="https://www.tidyverse.org/blog/2024/06/bonsai-0-3-0/thumbnail-sq.jpg"><meta name=twitter:image content="https://www.tidyverse.org/blog/2024/06/bonsai-0-3-0/thumbnail-wd.jpg"><link rel=apple-touch-icon sizes=180x180 href=/images/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicons/favicon-16x16.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg><link rel="shortcut icon" href=/images/favicons/favicon.ico><meta name=msapplication-TileColor content="#da532c"><meta name=msapplication-config href=/images/favicons/browserconfig.xml><script type=text/javascript src=/js/jquery-3.5.1.min.js></script><script type=text/javascript src=/js/site.js></script><link rel=icon href=/images/favicon.ico><script type=text/javascript src=/js/clipboard.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin=anonymous></script><script defer data-domain=tidyverse.org,all.tidyverse.org src=https://plausible.io/js/plausible.js></script></head><body><div id=appTidyverseSite class="shrinkHeader alwaysShrinkHeader"><div id=main><div id=rStudioHeader><nav class=band><div class="innards bandContent"><div><a class=productName href=/%20/>Tidyverse</a></div><div id=menu><div id=menuToggler></div><div id=menuItems><a class=menuItem href=/packages/>Packages</a>
<a class="menuItem current" href=/blog/>Blog</a>
<a class=menuItem href=/learn/>Learn</a>
<a class=menuItem href=/help/>Help</a>
<a class=menuItem href=/contribute/>Contribute</a></div></div></div></nav></div><main><div class="band padForHeader pushFooter"><div class=bandContent><div class="full splitColumns withMobileMargins"><div class=column75><h1 class=article-title>bonsai 0.3.0</h1><div class=article-header aria-hidden=true><div class=photo><img src=/blog/2024/06/bonsai-0-3-0/thumbnail-wd.jpg></div><div class=photoCredit>Photo by <a href=https://unsplash.com/photos/QD-mtViB5Ks>Scott Webb</a></div></div><span class=article-date><i class="fas fa-calendar-day fa-fw"></i>&nbsp;&nbsp;2024/06/25</span><p style=margin-bottom:.5em;margin-top:.85em><i class="fas fa-tags"></i>&nbsp;
<a href=/tags/tidymodels/>tidymodels</a>,
<a href=/tags/parsnip/>parsnip</a>,
<a href=/tags/bonsai/>bonsai</a></p><p style=margin-top:.5em><i class="fas fa-user-circle fa-fw"></i>&nbsp;
Simon Couch</p><div class=article-content><p>We&rsquo;re brimming with glee to announce the release of
<a href=https://bonsai.tidymodels.org target=_blank rel=noopener>bonsai</a> 0.3.0. bonsai is a parsnip extension package for tree-based models, and includes support for random forest and gradient-boosted tree frameworks like partykit and LightGBM. This most recent release of the package introduces support for the <code>"aorsf"</code> engine, which implements accelerated oblique random forests (Jaeger et al. 2022, Jaeger et al. 2024).</p><p>You can install it from CRAN with:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://rdrr.io/r/utils/install.packages.html>install.packages</a></span><span class=o>(</span><span class=s>"bonsai"</span><span class=o>)</span></span></code></pre></div><p>This blog post will demonstrate a modeling workflow where the benefits of using oblique random forests shine through.</p><p>You can see a full list of changes in the
<a href=https://bonsai.tidymodels.org/news/index.html#bonsai-030 target=_blank rel=noopener>release notes</a>.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=https://tidymodels.tidymodels.org>tidymodels</a></span><span class=o>)</span></span>
<span><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=https://bonsai.tidymodels.org/>bonsai</a></span><span class=o>)</span></span>
<span><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=https://plsmod.tidymodels.org>plsmod</a></span><span class=o>)</span></span>
<span><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=https://github.com/tidymodels/corrr>corrr</a></span><span class=o>)</span></span></code></pre></div><h2 id=the-meats-data>The <code>meats</code> data
<a href=#the-meats-data><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>The modeldata package, loaded automatically with the tidymodels meta-package, includes several example datasets to demonstrate modeling problems. We&rsquo;ll make use of a dataset called <code>meats</code> in this post. Each row is a measurement of a sample of finely chopped meat.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>meats</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 215 × 103</span></span></span>
<span><span class=c>#&gt;    x_001 x_002 x_003 x_004 x_005 x_006 x_007 x_008 x_009 x_010 x_011 x_012 x_013</span></span>
<span><span class=c>#&gt;    <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555> 1</span>  2.62  2.62  2.62  2.62  2.62  2.62  2.62  2.62  2.63  2.63  2.63  2.63  2.64</span></span>
<span><span class=c>#&gt; <span style=color:#555> 2</span>  2.83  2.84  2.84  2.85  2.85  2.86  2.86  2.87  2.87  2.88  2.88  2.89  2.90</span></span>
<span><span class=c>#&gt; <span style=color:#555> 3</span>  2.58  2.58  2.59  2.59  2.59  2.59  2.59  2.60  2.60  2.60  2.60  2.61  2.61</span></span>
<span><span class=c>#&gt; <span style=color:#555> 4</span>  2.82  2.82  2.83  2.83  2.83  2.83  2.83  2.84  2.84  2.84  2.84  2.85  2.85</span></span>
<span><span class=c>#&gt; <span style=color:#555> 5</span>  2.79  2.79  2.79  2.79  2.80  2.80  2.80  2.80  2.81  2.81  2.81  2.82  2.82</span></span>
<span><span class=c>#&gt; <span style=color:#555> 6</span>  3.01  3.02  3.02  3.03  3.03  3.04  3.04  3.05  3.06  3.06  3.07  3.08  3.09</span></span>
<span><span class=c>#&gt; <span style=color:#555> 7</span>  2.99  2.99  3.00  3.01  3.01  3.02  3.02  3.03  3.04  3.04  3.05  3.06  3.07</span></span>
<span><span class=c>#&gt; <span style=color:#555> 8</span>  2.53  2.53  2.53  2.53  2.53  2.53  2.53  2.53  2.54  2.54  2.54  2.54  2.54</span></span>
<span><span class=c>#&gt; <span style=color:#555> 9</span>  3.27  3.28  3.29  3.29  3.30  3.31  3.31  3.32  3.33  3.33  3.34  3.35  3.36</span></span>
<span><span class=c>#&gt; <span style=color:#555>10</span>  3.40  3.41  3.41  3.42  3.43  3.43  3.44  3.45  3.46  3.47  3.48  3.48  3.49</span></span>
<span><span class=c>#&gt; <span style=color:#555># ℹ 205 more rows</span></span></span>
<span><span class=c>#&gt; <span style=color:#555># ℹ 90 more variables: x_014 &lt;dbl&gt;, x_015 &lt;dbl&gt;, x_016 &lt;dbl&gt;, x_017 &lt;dbl&gt;,</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>#   x_018 &lt;dbl&gt;, x_019 &lt;dbl&gt;, x_020 &lt;dbl&gt;, x_021 &lt;dbl&gt;, x_022 &lt;dbl&gt;,</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>#   x_023 &lt;dbl&gt;, x_024 &lt;dbl&gt;, x_025 &lt;dbl&gt;, x_026 &lt;dbl&gt;, x_027 &lt;dbl&gt;,</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>#   x_028 &lt;dbl&gt;, x_029 &lt;dbl&gt;, x_030 &lt;dbl&gt;, x_031 &lt;dbl&gt;, x_032 &lt;dbl&gt;,</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>#   x_033 &lt;dbl&gt;, x_034 &lt;dbl&gt;, x_035 &lt;dbl&gt;, x_036 &lt;dbl&gt;, x_037 &lt;dbl&gt;,</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>#   x_038 &lt;dbl&gt;, x_039 &lt;dbl&gt;, x_040 &lt;dbl&gt;, x_041 &lt;dbl&gt;, x_042 &lt;dbl&gt;, …</span></span></span>
<span></span></code></pre></div><p>From that dataset&rsquo;s documentation:</p><blockquote><p>These data are recorded on a Tecator Infratec Food and Feed Analyzer&mldr; For each meat sample the data consists of a 100 channel spectrum of absorbances and the contents of moisture (water), fat and protein. The absorbance is -log10 of the transmittance measured by the spectrometer. The three contents, measured in percent, are determined by analytic chemistry.</p></blockquote><p>We&rsquo;ll try to predict the protein content, as a percentage, using the absorbance measurements.</p><p>Before we take a further look, let&rsquo;s split up our data. I&rsquo;ll first select off two other possible outcome variables and, after splitting into training and testing sets, resample the data using 5-fold cross-validation with 2 repeats.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>meats</span> <span class=o>&lt;-</span> <span class=nv>meats</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span> <span class=nf>select</span><span class=o>(</span><span class=o>-</span><span class=nv>water</span>, <span class=o>-</span><span class=nv>fat</span><span class=o>)</span></span>
<span></span>
<span><span class=nf><a href=https://rdrr.io/r/base/Random.html>set.seed</a></span><span class=o>(</span><span class=m>1</span><span class=o>)</span></span>
<span><span class=nv>meats_split</span> <span class=o>&lt;-</span> <span class=nf>initial_split</span><span class=o>(</span><span class=nv>meats</span><span class=o>)</span></span>
<span><span class=nv>meats_train</span> <span class=o>&lt;-</span> <span class=nf>training</span><span class=o>(</span><span class=nv>meats_split</span><span class=o>)</span></span>
<span><span class=nv>meats_test</span> <span class=o>&lt;-</span> <span class=nf>testing</span><span class=o>(</span><span class=nv>meats_split</span><span class=o>)</span></span>
<span><span class=nv>meats_folds</span> <span class=o>&lt;-</span> <span class=nf>vfold_cv</span><span class=o>(</span><span class=nv>meats_train</span>, v <span class=o>=</span> <span class=m>5</span>, repeats <span class=o>=</span> <span class=m>2</span><span class=o>)</span></span></code></pre></div><p>The tricky parts of this modeling problem are that:</p><ol><li>There are few observations to work with (215 total).</li><li>Each of these 100 absorbance measurements are <em>highly</em> correlated.</li></ol><p>Visualizing that correlation:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>meats_train</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span></span>
<span>  <span class=nf><a href=https://corrr.tidymodels.org/reference/correlate.html>correlate</a></span><span class=o>(</span><span class=o>)</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span></span>
<span>  <span class=nf><a href=https://ggplot2.tidyverse.org/reference/autoplot.html>autoplot</a></span><span class=o>(</span><span class=o>)</span> <span class=o>+</span></span>
<span>  <span class=nf>theme</span><span class=o>(</span>axis.text.x <span class=o>=</span> <span class=nf>element_blank</span><span class=o>(</span><span class=o>)</span>, axis.text.y <span class=o>=</span> <span class=nf>element_blank</span><span class=o>(</span><span class=o>)</span><span class=o>)</span></span>
<span><span class=c>#&gt; Correlation computed with</span></span>
<span><span class=c>#&gt; <span style=color:#0bb>•</span> Method: 'pearson'</span></span>
<span><span class=c>#&gt; <span style=color:#0bb>•</span> Missing treated using: 'pairwise.complete.obs'</span></span>
<span></span></code></pre><p><img src=figs/correlate-1.png width=700px style=display:block;margin:auto></p></div><p>Almost all of these pairwise correlations between predictors are near 1, besides the last variable and every other variable. That last variable with weaker correlation values? It&rsquo;s the outcome.</p><h2 id=baseline-models>Baseline models
<a href=#baseline-models><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>There are several existing model implementations in tidymodels that are resilient to highly correlated predictors. The first one I&rsquo;d probably reach for is an elastic net: an interpolation of the LASSO and Ridge regularized linear regression models. Evaluating that modeling approach against resamples:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=c># define a regularized linear model</span></span>
<span><span class=nv>spec_lr</span> <span class=o>&lt;-</span> </span>
<span>  <span class=nf><a href=https://parsnip.tidymodels.org/reference/linear_reg.html>linear_reg</a></span><span class=o>(</span>penalty <span class=o>=</span> <span class=nf><a href=https://hardhat.tidymodels.org/reference/tune.html>tune</a></span><span class=o>(</span><span class=o>)</span>, mixture <span class=o>=</span> <span class=nf><a href=https://hardhat.tidymodels.org/reference/tune.html>tune</a></span><span class=o>(</span><span class=o>)</span><span class=o>)</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span></span>
<span>  <span class=nf><a href=https://parsnip.tidymodels.org/reference/set_engine.html>set_engine</a></span><span class=o>(</span><span class=s>"glmnet"</span><span class=o>)</span></span>
<span></span>
<span><span class=c># try out different penalization approaches</span></span>
<span><span class=nv>res_lr</span> <span class=o>&lt;-</span> <span class=nf>tune_grid</span><span class=o>(</span><span class=nv>spec_lr</span>, <span class=nv>protein</span> <span class=o>~</span> <span class=nv>.</span>, <span class=nv>meats_folds</span><span class=o>)</span></span>
<span></span>
<span><span class=nf>show_best</span><span class=o>(</span><span class=nv>res_lr</span>, metric <span class=o>=</span> <span class=s>"rmse"</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 5 × 8</span></span></span>
<span><span class=c>#&gt;         penalty mixture .metric .estimator  mean     n std_err .config          </span></span>
<span><span class=c>#&gt;           <span style=color:#555;font-style:italic>&lt;dbl&gt;</span>   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>   <span style=color:#555;font-style:italic>&lt;chr&gt;</span>      <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;int&gt;</span>   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>            </span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span> 0.000<span style=text-decoration:underline>032</span>4       0.668 rmse    standard    1.24    10  0.051<span style=text-decoration:underline>6</span> Preprocessor1_Mo…</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span> 0.000<span style=text-decoration:underline>000</span>005<span style=text-decoration:underline>24</span>   0.440 rmse    standard    1.25    10  0.054<span style=text-decoration:underline>8</span> Preprocessor1_Mo…</span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span> 0.000<span style=text-decoration:underline>000</span>461     0.839 rmse    standard    1.26    10  0.053<span style=text-decoration:underline>8</span> Preprocessor1_Mo…</span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span> 0.000<span style=text-decoration:underline>005</span>50      0.965 rmse    standard    1.26    10  0.054<span style=text-decoration:underline>0</span> Preprocessor1_Mo…</span></span>
<span><span class=c>#&gt; <span style=color:#555>5</span> 0.000<span style=text-decoration:underline>000</span>048<span style=text-decoration:underline>9</span>    0.281 rmse    standard    1.26    10  0.053<span style=text-decoration:underline>4</span> Preprocessor1_Mo…</span></span>
<span></span><span><span class=nf>show_best</span><span class=o>(</span><span class=nv>res_lr</span>, metric <span class=o>=</span> <span class=s>"rsq"</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 5 × 8</span></span></span>
<span><span class=c>#&gt;         penalty mixture .metric .estimator  mean     n std_err .config          </span></span>
<span><span class=c>#&gt;           <span style=color:#555;font-style:italic>&lt;dbl&gt;</span>   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>   <span style=color:#555;font-style:italic>&lt;chr&gt;</span>      <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;int&gt;</span>   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>            </span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span> 0.000<span style=text-decoration:underline>032</span>4       0.668 rsq     standard   0.849    10  0.012<span style=text-decoration:underline>6</span> Preprocessor1_Mo…</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span> 0.000<span style=text-decoration:underline>000</span>005<span style=text-decoration:underline>24</span>   0.440 rsq     standard   0.848    10  0.012<span style=text-decoration:underline>8</span> Preprocessor1_Mo…</span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span> 0.000<span style=text-decoration:underline>000</span>461     0.839 rsq     standard   0.846    10  0.011<span style=text-decoration:underline>4</span> Preprocessor1_Mo…</span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span> 0.000<span style=text-decoration:underline>005</span>50      0.965 rsq     standard   0.846    10  0.011<span style=text-decoration:underline>1</span> Preprocessor1_Mo…</span></span>
<span><span class=c>#&gt; <span style=color:#555>5</span> 0.000<span style=text-decoration:underline>000</span>048<span style=text-decoration:underline>9</span>    0.281 rsq     standard   0.846    10  0.012<span style=text-decoration:underline>6</span> Preprocessor1_Mo…</span></span>
<span></span></code></pre></div><p>That best RMSE value of 1.24 gives us a baseline to work with, and the best R-squared 0.85 seems like a good start.</p><p>Many tree-based model implementations in tidymodels generally handle correlated predictors well. Just to be apples-to-apples with <code>"aorsf"</code>, let&rsquo;s use a different random forest engine to get a better sense for baseline performance:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>spec_rf</span> <span class=o>&lt;-</span> </span>
<span>  <span class=nf><a href=https://parsnip.tidymodels.org/reference/rand_forest.html>rand_forest</a></span><span class=o>(</span>mtry <span class=o>=</span> <span class=nf><a href=https://hardhat.tidymodels.org/reference/tune.html>tune</a></span><span class=o>(</span><span class=o>)</span>, min_n <span class=o>=</span> <span class=nf><a href=https://hardhat.tidymodels.org/reference/tune.html>tune</a></span><span class=o>(</span><span class=o>)</span><span class=o>)</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span></span>
<span>  <span class=c># this is the default engine, but for consistency's sake:</span></span>
<span>  <span class=nf><a href=https://parsnip.tidymodels.org/reference/set_engine.html>set_engine</a></span><span class=o>(</span><span class=s>"ranger"</span><span class=o>)</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span></span>
<span>  <span class=nf><a href=https://parsnip.tidymodels.org/reference/set_args.html>set_mode</a></span><span class=o>(</span><span class=s>"regression"</span><span class=o>)</span></span>
<span></span>
<span><span class=nv>res_rf</span> <span class=o>&lt;-</span> <span class=nf>tune_grid</span><span class=o>(</span><span class=nv>spec_rf</span>, <span class=nv>protein</span> <span class=o>~</span> <span class=nv>.</span>, <span class=nv>meats_folds</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#00b>i</span> <span style=color:#000>Creating pre-processing data to finalize unknown parameter: mtry</span></span></span>
<span></span><span></span>
<span><span class=nf>show_best</span><span class=o>(</span><span class=nv>res_rf</span>, metric <span class=o>=</span> <span class=s>"rmse"</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 5 × 8</span></span></span>
<span><span class=c>#&gt;    mtry min_n .metric .estimator  mean     n std_err .config              </span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;int&gt;</span> <span style=color:#555;font-style:italic>&lt;int&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>   <span style=color:#555;font-style:italic>&lt;chr&gt;</span>      <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;int&gt;</span>   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>                </span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span>    96     4 rmse    standard    2.37    10  0.090<span style=text-decoration:underline>5</span> Preprocessor1_Model08</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span>    41     6 rmse    standard    2.39    10  0.088<span style=text-decoration:underline>3</span> Preprocessor1_Model01</span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span>    88    10 rmse    standard    2.43    10  0.081<span style=text-decoration:underline>6</span> Preprocessor1_Model06</span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span>    79    17 rmse    standard    2.51    10  0.074<span style=text-decoration:underline>0</span> Preprocessor1_Model07</span></span>
<span><span class=c>#&gt; <span style=color:#555>5</span>    27    18 rmse    standard    2.52    10  0.077<span style=text-decoration:underline>8</span> Preprocessor1_Model04</span></span>
<span></span><span><span class=nf>show_best</span><span class=o>(</span><span class=nv>res_rf</span>, metric <span class=o>=</span> <span class=s>"rsq"</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 5 × 8</span></span></span>
<span><span class=c>#&gt;    mtry min_n .metric .estimator  mean     n std_err .config              </span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;int&gt;</span> <span style=color:#555;font-style:italic>&lt;int&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>   <span style=color:#555;font-style:italic>&lt;chr&gt;</span>      <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;int&gt;</span>   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>                </span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span>    96     4 rsq     standard   0.424    10  0.038<span style=text-decoration:underline>5</span> Preprocessor1_Model08</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span>    41     6 rsq     standard   0.409    10  0.039<span style=text-decoration:underline>4</span> Preprocessor1_Model01</span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span>    88    10 rsq     standard   0.387    10  0.036<span style=text-decoration:underline>5</span> Preprocessor1_Model06</span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span>    79    17 rsq     standard   0.353    10  0.040<span style=text-decoration:underline>4</span> Preprocessor1_Model07</span></span>
<span><span class=c>#&gt; <span style=color:#555>5</span>    27    18 rsq     standard   0.346    10  0.039<span style=text-decoration:underline>7</span> Preprocessor1_Model04</span></span>
<span></span></code></pre></div><p>Not so hot. Just to show I&rsquo;m not making a straw man here, I&rsquo;ll evaluate a few more alternative modeling approaches behind the curtain and print out their best performance metrics:</p><ul><li><strong>Gradient boosted tree with LightGBM</strong>. Best RMSE: 2.34. Best R-squared: 0.43.</li><li><strong>Partial least squares regression</strong>. Best RMSE: 1.39. Best R-squared: 0.81.</li><li><strong>Support vector machine</strong>. Best RMSE: 2.28. Best R-squared: 0.46.</li></ul><p>This is a tricky one.</p><h2 id=introducing-accelerated-oblique-random-forests>Introducing accelerated oblique random forests
<a href=#introducing-accelerated-oblique-random-forests><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>The 0.3.0 release of bonsai introduces support for accelerated oblique random forests via the <code>"aorsf"</code> engine for classification and regression in tidymodels. (Tidy survival modelers might note that
<a href=https://www.tidyverse.org/blog/2023/04/censored-0-2-0/ target=_blank rel=noopener>we already support <code>"aorsf"</code> for censored regression</a> via the
<a href=https://censored.tidymodels.org target=_blank rel=noopener>censored</a> parsnip extension package!)</p><p>Unlike trees in conventional random forests, which create splits using thresholds based on individual predictors (e.g. <code>x_001 > 3</code>), oblique random forests use linear combinations of predictors to create splits (e.g. <code>x_001 * x_002 > 7.5</code>) and have been shown to improve predictive performance related to conventional random forests for a variety of applications (Menze et al. 2011). &ldquo;Oblique&rdquo; references the appearance of decision boundaries when a set of splits is plotted; I&rsquo;ve grabbed a visual from the
<a href="https://github.com/ropensci/aorsf?tab=readme-ov-file#what-does-oblique-mean" target=_blank rel=noopener>aorsf README</a> that demonstrates:</p><div class=highlight><p><img src=figures/oblique.png alt="Two plots of decision boundaries for a classification problem. One uses single-variable splitting and the other oblique splitting. Both trees partition the predictor space defined by predictors X1 and X2, but the oblique splits do a better job of separating the two classes thanks to an 'oblique' boundary formed by considering both X1 and X2 at the same time." width=700px style=display:block;margin:auto></p></div><p>In the above, we&rsquo;d like to separate the purple dots from the orange squares. A tree in a traditional random forest, represented on the left, can only generate splits based on one of X1 or X2 at a time. A tree in an oblique random forest, represented on the right, can consider both X1 and X2 in creating decision boundaries, often resulting in stronger predictive performance.</p><p>Where does the &ldquo;accelerated&rdquo; come from? Generally, finding optimal oblique splits is computationally more intensive than finding single-predictor splits. The aorsf package uses something called &ldquo;Newton Raphson scoring&rdquo;&mdash;the same algorithm under the hood in the survival package&mdash;to identify splits based on linear combinations of predictor variables. This approach speeds up that process greatly, resulting in fit times that are analogous to implementations of traditional random forests in R (and hundreds of times faster than existing oblique random forest implementations, Jaeger et al. 2024).</p><p>The code to tune this model with the <code>"aorsf"</code> engine is the same as for <code>"ranger"</code>, except we switch out the <code>engine</code> argument to
<a href=https://parsnip.tidymodels.org/reference/set_engine.html target=_blank rel=noopener><code>set_engine()</code></a>:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>spec_aorsf</span> <span class=o>&lt;-</span> </span>
<span>  <span class=nf><a href=https://parsnip.tidymodels.org/reference/rand_forest.html>rand_forest</a></span><span class=o>(</span></span>
<span>    mtry <span class=o>=</span> <span class=nf><a href=https://hardhat.tidymodels.org/reference/tune.html>tune</a></span><span class=o>(</span><span class=o>)</span>,</span>
<span>    min_n <span class=o>=</span> <span class=nf><a href=https://hardhat.tidymodels.org/reference/tune.html>tune</a></span><span class=o>(</span><span class=o>)</span></span>
<span>  <span class=o>)</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span></span>
<span>  <span class=nf><a href=https://parsnip.tidymodels.org/reference/set_engine.html>set_engine</a></span><span class=o>(</span><span class=s>"aorsf"</span><span class=o>)</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span></span>
<span>  <span class=nf><a href=https://parsnip.tidymodels.org/reference/set_args.html>set_mode</a></span><span class=o>(</span><span class=s>"regression"</span><span class=o>)</span></span>
<span></span>
<span><span class=nv>res_aorsf</span> <span class=o>&lt;-</span> <span class=nf>tune_grid</span><span class=o>(</span><span class=nv>spec_aorsf</span>, <span class=nv>protein</span> <span class=o>~</span> <span class=nv>.</span>, <span class=nv>meats_folds</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#00b>i</span> <span style=color:#000>Creating pre-processing data to finalize unknown parameter: mtry</span></span></span>
<span></span><span></span>
<span><span class=nf>show_best</span><span class=o>(</span><span class=nv>res_aorsf</span>, metric <span class=o>=</span> <span class=s>"rmse"</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 5 × 8</span></span></span>
<span><span class=c>#&gt;    mtry min_n .metric .estimator  mean     n std_err .config              </span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;int&gt;</span> <span style=color:#555;font-style:italic>&lt;int&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>   <span style=color:#555;font-style:italic>&lt;chr&gt;</span>      <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;int&gt;</span>   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>                </span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span>    87    11 rmse    standard   0.786    10  0.037<span style=text-decoration:underline>0</span> Preprocessor1_Model02</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span>    98     8 rmse    standard   0.789    10  0.036<span style=text-decoration:underline>3</span> Preprocessor1_Model10</span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span>    48     5 rmse    standard   0.793    10  0.036<span style=text-decoration:underline>3</span> Preprocessor1_Model01</span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span>    16    17 rmse    standard   0.803    10  0.032<span style=text-decoration:underline>5</span> Preprocessor1_Model09</span></span>
<span><span class=c>#&gt; <span style=color:#555>5</span>    31    18 rmse    standard   0.813    10  0.035<span style=text-decoration:underline>9</span> Preprocessor1_Model05</span></span>
<span></span><span><span class=nf>show_best</span><span class=o>(</span><span class=nv>res_aorsf</span>, metric <span class=o>=</span> <span class=s>"rsq"</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 5 × 8</span></span></span>
<span><span class=c>#&gt;    mtry min_n .metric .estimator  mean     n std_err .config              </span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;int&gt;</span> <span style=color:#555;font-style:italic>&lt;int&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>   <span style=color:#555;font-style:italic>&lt;chr&gt;</span>      <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;int&gt;</span>   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>                </span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span>    48     5 rsq     standard   0.946    10 0.004<span style=text-decoration:underline>46</span> Preprocessor1_Model01</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span>    98     8 rsq     standard   0.945    10 0.004<span style=text-decoration:underline>82</span> Preprocessor1_Model10</span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span>    87    11 rsq     standard   0.945    10 0.004<span style=text-decoration:underline>84</span> Preprocessor1_Model02</span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span>    16    17 rsq     standard   0.941    10 0.003<span style=text-decoration:underline>70</span> Preprocessor1_Model09</span></span>
<span><span class=c>#&gt; <span style=color:#555>5</span>    31    18 rsq     standard   0.940    10 0.005<span style=text-decoration:underline>47</span> Preprocessor1_Model05</span></span>
<span></span></code></pre></div><p>Holy smokes. The best RMSE from aorsf is 0.79, much more performant than the previous best RMSE from the elastic net with a value of 1.24, and the best R-squared is 0.95, much stronger than the previous best (also from the elastic net) of 0.85.</p><p>Especially if your modeling problems involve few samples of many, highly correlated predictors, give the <code>"aorsf"</code> modeling engine a whirl in your workflows and let us know what you think!</p><h2 id=references>References
<a href=#references><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Byron C. Jaeger, Sawyer Welden, Kristin Lenoir, Jaime L. Speiser, Matthew W. Segar, Ambarish Pandey, Nicholas M. Pajewski. 2024. &ldquo;Accelerated and Interpretable Oblique Random Survival Forests.&rdquo; <em>Journal of Computational and Graphical Statistics</em> 33.1: 192-207.</p><p>Byron C. Jaeger, Sawyer Welden, Kristin Lenoir, and Nicholas M. Pajewski. 2022. &ldquo;aorsf: An R package for Supervised Learning Using the Oblique Random Survival Forest.&rdquo; <em>The Journal of Open Source Software</em>.</p><p>Bjoern H. Menze, B. Michael Kelm, Daniel N. Splitthoff, Ullrich Koethe, and Fred A. Hamprecht. (2011). &ldquo;On Oblique Random Forests.&rdquo; <em>Joint European Conference on Machine Learning and Knowledge Discovery in Databases</em> (pp. 453&ndash;469). Springer.</p><h2 id=acknowledgements>Acknowledgements
<a href=#acknowledgements><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Thank you to
<a href=https://github.com/bcjaeger target=_blank rel=noopener>@bcjaeger</a>, the aorsf author, for doing most of the work to implement aorsf support in bonsai. Thank you to
<a href=https://github.com/hfrick target=_blank rel=noopener>@hfrick</a>,
<a href=https://github.com/joranE target=_blank rel=noopener>@joranE</a>,
<a href=https://github.com/jrosell target=_blank rel=noopener>@jrosell</a>,
<a href=https://github.com/nipnipj target=_blank rel=noopener>@nipnipj</a>,
<a href=https://github.com/p-schaefer target=_blank rel=noopener>@p-schaefer</a>,
<a href=https://github.com/seb-mueller target=_blank rel=noopener>@seb-mueller</a>, and
<a href=https://github.com/tcovert target=_blank rel=noopener>@tcovert</a> for their contributions on the bonsai repository since version 0.2.1.</p></div></div><div class=column25><div class="section hideOnMobile"><div class=sectionTitle>Contents</div><nav id=TableOfContents><ul><li><a href=#the-meats-data>The <code>meats</code> data</a></li><li><a href=#baseline-models>Baseline models</a></li><li><a href=#introducing-accelerated-oblique-random-forests>Introducing accelerated oblique random forests</a></li><li><a href=#references>References</a></li><li><a href=#acknowledgements>Acknowledgements</a></li></ul></nav></div><div class=section></div></div></div></div></div><div id=rStudioFooter class=band><div class=bandContent><div id=copyright>The tidyverse is proudly supported by <a class=rstudioLogo href=https://posit.co/ aria-label="Posit Homepage"></a></div><div id=logos><a href=https://www.tidyverse.org/google_privacy_policy>Privacy policy</a>
<a href=https://github.com/tidyverse class="footerLogo gitHub" aria-label="Tidyverse GitHub organization"></a><a href=https://twitter.com/hashtag/rstats class="footerLogo twitter" aria-label="rstats hashtag on twitter.com"></a></div></div></div></div></div><script type=application/javascript>var dnt=(navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack);var doNotTrack=(dnt=="1"||dnt=="yes");if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');if(window.sessionStorage){var GA_SESSION_STORAGE_KEY='ga:clientId';ga('create','UA-115082821-1',{'storage':'none','clientId':sessionStorage.getItem(GA_SESSION_STORAGE_KEY)});ga(function(tracker){sessionStorage.setItem(GA_SESSION_STORAGE_KEY,tracker.get('clientId'));});}
ga('set','anonymizeIp',true);ga('send','pageview');}</script></body></html></div></div></body></html>