<!doctype html><html><head><!doctype html><html lang=en-us><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/css/main-site.css><link rel=stylesheet href=/css/fa5-all.css><style type=text/css>body{background-color:#fff;color:#1a1917}a{color:#38577f}a:hover{color:#42709b}a:focus{outline-color:#42709b}.column25-left .sectionTitle a:hover:not(.current),.column16-left .sectionTitle a:hover:not(.current){color:#1a1917}.icon-attribution,.icon-attribution a{color:#1a1917;opacity:75%}#homeContent .band.first{background-color:#fff}#homeContent .band.second{background-color:#fdeba4}#homeContent .band.third{background-color:#fff}#rStudioHeader{background-color:#1a162d;color:#fff}#rStudioHeader .productName{color:#fff}#rStudioHeader .productName:hover,#rStudioHeader .productName:focus{color:#fdeba4}#rStudioHeader #menu .menuItem.a{background-color:#75aadb;color:#fff}#rStudioHeader #menu .menuItem:hover{background-color:#484557;color:#fff}#rStudioHeader #menu .menuItem.current{background-color:#fff;color:#1a162d;text-decoration:none}#rStudioFooter.band{background-color:#767381}#rStudioFooter .bandContent #copyright{color:#e3eef8}table tbody tr:nth-child(even){background-color:#f7faff}table tbody tr:nth-child(odd){background-color:#fff}.latest{border-top:.5em solid <no value>}.event{-moz-box-shadow:0 0 0 0 rgba(0,0,0,.1);-webkit-box-shadow:0 0 0 0 rgba(0,0,0,.1);box-shadow:0 0 0 0 rgba(0,0,0,.1)}.section .event{background-color:#eab0c41a}.section .event{border-top:7pt solid #a19ea936}.section .event a{color:#1a162d}.section .event{color:#404040}</style><link rel=stylesheet href=/css/tidyverse.css><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.71.1"><title>ggplot2 3.5.0: Legends</title><meta property="og:title" content="ggplot2 3.5.0: Legends"><meta property="og:description" content="The 3.5.0 version of ggplot2 comes with an overhaul of the guide system. Read here what is new for legends."><meta property="og:type" content="article"><meta property="og:url" content="https://www.tidyverse.org/blog/2024/02/ggplot2-3-5-0-legends/"><meta property="twitter:card" content="summary_large_image"><meta property="og:title" content="ggplot2 3.5.0: Legends - Tidyverse"><meta property="description" content="The 3.5.0 version of ggplot2 comes with an overhaul of the guide system. Read here what is new for legends."><meta property="og:description" content="The 3.5.0 version of ggplot2 comes with an overhaul of the guide system. Read here what is new for legends."><meta property="og:image" content="https://www.tidyverse.org/blog/2024/02/ggplot2-3-5-0-legends/thumbnail-sq.jpg"><meta name=twitter:image content="https://www.tidyverse.org/blog/2024/02/ggplot2-3-5-0-legends/thumbnail-wd.jpg"><link rel=apple-touch-icon sizes=180x180 href=/images/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicons/favicon-16x16.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg><link rel="shortcut icon" href=/images/favicons/favicon.ico><meta name=msapplication-TileColor content="#da532c"><meta name=msapplication-config href=/images/favicons/browserconfig.xml><script type=text/javascript src=/js/jquery-3.5.1.min.js></script><script type=text/javascript src=/js/site.js></script><link rel=icon href=/images/favicon.ico><script type=text/javascript src=/js/clipboard.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin=anonymous></script><script defer data-domain=tidyverse.org,all.tidyverse.org src=https://plausible.io/js/plausible.js></script></head><body><div id=appTidyverseSite class="shrinkHeader alwaysShrinkHeader"><div id=main><div id=rStudioHeader><nav class=band><div class="innards bandContent"><div><a class=productName href=/%20/>Tidyverse</a></div><div id=menu><div id=menuToggler></div><div id=menuItems><a class=menuItem href=/packages/>Packages</a>
<a class="menuItem current" href=/blog/>Blog</a>
<a class=menuItem href=/learn/>Learn</a>
<a class=menuItem href=/help/>Help</a>
<a class=menuItem href=/contribute/>Contribute</a></div></div></div></nav></div><main><div class="band padForHeader pushFooter"><div class=bandContent><div class="full splitColumns withMobileMargins"><div class=column75><h1 class=article-title>ggplot2 3.5.0: Legends</h1><div class=article-header aria-hidden=true><div class=photo><img src=/blog/2024/02/ggplot2-3-5-0-legends/thumbnail-wd.jpg></div><div class=photoCredit>Photo by <a href=https://unsplash.com/photos/close-up-photo-of-black-camera-lens-hqCEQTc5gZA>Markus Spiske</a></div></div><span class=article-date><i class="fas fa-calendar-day fa-fw"></i>&nbsp;&nbsp;2024/02/26</span><p style=margin-bottom:.5em;margin-top:.85em><i class="fas fa-tags"></i>&nbsp;
<a href=/tags/ggplot2/>ggplot2</a>,
<a href=/tags/ggplot2-3-5-0/>ggplot2-3-5-0</a></p><p style=margin-top:.5em><i class="fas fa-user-circle fa-fw"></i>&nbsp;
Teun van den Brand</p><div class=article-content><p>We are pleased to release
<a href=https://ggplot2.tidyverse.org target=_blank rel=noopener>ggplot2</a> 3.5.0. This is one blogpost among several outlining changes to legend guides. Please find the
<a href=/blog/2024/02/ggplot2-3-5-0/>main release post</a> to read about other changes.</p><p>Legends, alongside axes, are visual representations of scales and allow observes to translate graphical properties of a plot into information. To no surprise, legends in ggplot2 comprise the guides called
<a href=https://ggplot2.tidyverse.org/reference/guide_legend.html target=_blank rel=noopener><code>guide_legend()</code></a>, but also
<a href=https://ggplot2.tidyverse.org/reference/guide_colourbar.html target=_blank rel=noopener><code>guide_colourbar()</code></a>,
<a href=https://ggplot2.tidyverse.org/reference/guide_coloursteps.html target=_blank rel=noopener><code>guide_coloursteps()</code></a> and
<a href=https://ggplot2.tidyverse.org/reference/guide_bins.html target=_blank rel=noopener><code>guide_bins()</code></a>.</p><h2 id=styling>Styling
<a href=#styling><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>One of the more user-visible changes is that these guides no longer have styling options. Or at least, they have been soft-deprecated: they continue to work for now, but are scheduled for removal. Gone are the days where there were 4 possible ways to set the horizontal justification of legend text in 5 different functions. There is only one way to style guides now, and that is by using
<a href=https://ggplot2.tidyverse.org/reference/theme.html target=_blank rel=noopener><code>theme()</code></a>. The
<a href=https://ggplot2.tidyverse.org/reference/theme.html target=_blank rel=noopener><code>theme()</code></a> function has new arguments to control the appearance of legends, which makes it easier to globally control the appearance of legends. For example: <code>theme(legend.frame)</code> replaces <code>guide_colourbar(frame.colour, frame.linewidth, frame.linetype)</code> and <code>theme(legend.axis.line)</code> replaces <code>guide_bins(axis, axis.colour, axis.linewidth, axis.arrow)</code>. To allow for tweaking the style of any individual guide, the guide functions now have a <code>theme</code> argument that can accept a theme specific to that guide.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=https://ggplot2.tidyverse.org>ggplot2</a></span><span class=o>)</span></span>
<span></span>
<span><span class=nf><a href=https://ggplot2.tidyverse.org/reference/ggplot.html>ggplot</a></span><span class=o>(</span><span class=nv>mpg</span>, <span class=nf><a href=https://ggplot2.tidyverse.org/reference/aes.html>aes</a></span><span class=o>(</span><span class=nv>displ</span>, <span class=nv>hwy</span>, shape <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/factor.html>factor</a></span><span class=o>(</span><span class=nv>cyl</span><span class=o>)</span>, colour <span class=o>=</span> <span class=nv>cty</span><span class=o>)</span><span class=o>)</span> <span class=o>+</span></span>
<span>  <span class=nf><a href=https://ggplot2.tidyverse.org/reference/geom_point.html>geom_point</a></span><span class=o>(</span><span class=o>)</span> <span class=o>+</span></span>
<span>  <span class=c># Styling individual guides</span></span>
<span>  <span class=nf><a href=https://ggplot2.tidyverse.org/reference/guides.html>guides</a></span><span class=o>(</span></span>
<span>    shape  <span class=o>=</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/guide_legend.html>guide_legend</a></span><span class=o>(</span>theme <span class=o>=</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/theme.html>theme</a></span><span class=o>(</span>legend.text <span class=o>=</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/element.html>element_text</a></span><span class=o>(</span>colour <span class=o>=</span> <span class=s>"red"</span><span class=o>)</span><span class=o>)</span><span class=o>)</span>,</span>
<span>    colour <span class=o>=</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/guide_colourbar.html>guide_colorbar</a></span><span class=o>(</span>theme <span class=o>=</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/theme.html>theme</a></span><span class=o>(</span>legend.frame <span class=o>=</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/element.html>element_rect</a></span><span class=o>(</span>colour <span class=o>=</span> <span class=s>"red"</span><span class=o>)</span><span class=o>)</span><span class=o>)</span></span>
<span>  <span class=o>)</span> <span class=o>+</span></span>
<span>  <span class=c># Styling guides globally</span></span>
<span>  <span class=nf><a href=https://ggplot2.tidyverse.org/reference/theme.html>theme</a></span><span class=o>(</span></span>
<span>    legend.title.position <span class=o>=</span> <span class=s>"left"</span>,</span>
<span>    <span class=c># Title justification is controlled by hjust/vjust in the element</span></span>
<span>    legend.title <span class=o>=</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/element.html>element_text</a></span><span class=o>(</span>angle <span class=o>=</span> <span class=m>90</span>, hjust <span class=o>=</span> <span class=m>0.5</span><span class=o>)</span></span>
<span>  <span class=o>)</span></span>
</code></pre><p><img src=figs/guide_theming-1.png alt="Scatterplot of engine displacement versus highway miles per gallon. The legend indicating shapes for the number of cylinders has red text. The colour bar indicating city miles per gallon has a red rectangle around the bar. Both the legend and colour bar titles are rotated, centered and on the left of the guide." width=700px style=display:block;margin:auto></p></div><p>In the plot above, notice how the legend title settings affect both the colour bar and the legend, whereas the local options, like red legend text, only apply to a single guide.</p><h2 id=awareness>Awareness
<a href=#awareness><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Legends are now more aware what discrete variables should be placed in which keys. By default, they now only draw keys for the layer which contain the relevant value. This saves one having to hassle with the <code>guide_legend(override.aes)</code> argument to get the keys to display just right. In the plot below, notice how the points and line have separate keys.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>p</span> <span class=o>&lt;-</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/ggplot.html>ggplot</a></span><span class=o>(</span><span class=nv>mpg</span>, <span class=nf><a href=https://ggplot2.tidyverse.org/reference/aes.html>aes</a></span><span class=o>(</span><span class=nv>displ</span>, <span class=nv>hwy</span><span class=o>)</span><span class=o>)</span> <span class=o>+</span></span>
<span>  <span class=nf><a href=https://ggplot2.tidyverse.org/reference/scale_manual.html>scale_alpha_manual</a></span><span class=o>(</span>values <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=m>0.5</span>, <span class=m>1</span><span class=o>)</span><span class=o>)</span></span>
<span><span class=nv>p</span> <span class=o>+</span></span>
<span>  <span class=nf><a href=https://ggplot2.tidyverse.org/reference/geom_point.html>geom_point</a></span><span class=o>(</span><span class=nf><a href=https://ggplot2.tidyverse.org/reference/aes.html>aes</a></span><span class=o>(</span>colour <span class=o>=</span> <span class=s>"points"</span>, alpha <span class=o>=</span> <span class=s>"points"</span><span class=o>)</span><span class=o>)</span> <span class=o>+</span></span>
<span>  <span class=nf><a href=https://ggplot2.tidyverse.org/reference/geom_path.html>geom_line</a></span><span class=o>(</span></span>
<span>    <span class=nf><a href=https://ggplot2.tidyverse.org/reference/aes.html>aes</a></span><span class=o>(</span>colour <span class=o>=</span> <span class=s>"line"</span>, alpha <span class=o>=</span> <span class=s>"line"</span><span class=o>)</span>,</span>
<span>    stat <span class=o>=</span> <span class=s>"smooth"</span>, formula <span class=o>=</span> <span class=nv>y</span> <span class=o>~</span> <span class=nv>x</span>, method <span class=o>=</span> <span class=s>"lm"</span></span>
<span>  <span class=o>)</span></span>
</code></pre><p><img src=figs/legend_awareness-1.png alt="A scatterplot with trendline showing engine displacement versus highway miles per gallon. There are two legends for colour and alpha. Both legends show points and lines separately." width=700px style=display:block;margin:auto></p></div><p>To revert back to the old behaviour, you can set the <code>show.legend = TRUE</code> option in the layers. Like before, the <code>show.legend</code> argument can still be set in an aesthetic-specific way. Setting it to <code>TRUE</code> means &lsquo;always show&rsquo;, <code>FALSE</code> means &lsquo;never show&rsquo; and <code>NA</code> means &lsquo;show if found&rsquo;.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>p</span> <span class=o>+</span></span>
<span>  <span class=nf><a href=https://ggplot2.tidyverse.org/reference/geom_point.html>geom_point</a></span><span class=o>(</span></span>
<span>    <span class=nf><a href=https://ggplot2.tidyverse.org/reference/aes.html>aes</a></span><span class=o>(</span>colour <span class=o>=</span> <span class=s>"points"</span>, alpha <span class=o>=</span> <span class=s>"points"</span><span class=o>)</span>,</span>
<span>    show.legend <span class=o>=</span> <span class=kc>TRUE</span> <span class=c># always show</span></span>
<span>  <span class=o>)</span> <span class=o>+</span></span>
<span>  <span class=nf><a href=https://ggplot2.tidyverse.org/reference/geom_path.html>geom_line</a></span><span class=o>(</span></span>
<span>    <span class=nf><a href=https://ggplot2.tidyverse.org/reference/aes.html>aes</a></span><span class=o>(</span>colour <span class=o>=</span> <span class=s>"line"</span>, alpha <span class=o>=</span> <span class=s>"line"</span><span class=o>)</span>,</span>
<span>    stat <span class=o>=</span> <span class=s>"smooth"</span>, formula <span class=o>=</span> <span class=nv>y</span> <span class=o>~</span> <span class=nv>x</span>, method <span class=o>=</span> <span class=s>"lm"</span>,</span>
<span>    show.legend <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span>colour <span class=o>=</span> <span class=kc>NA</span>, alpha <span class=o>=</span> <span class=kc>TRUE</span><span class=o>)</span> <span class=c># always show in alpha</span></span>
<span>  <span class=o>)</span></span>
</code></pre><p><img src=figs/show_key_setting-1.png alt="The same plot as before, but every legend keys displays points. Lines are shown in every 'alpha' legend key, but only one 'colour' key." width=700px style=display:block;margin:auto></p></div><h2 id=placement>Placement
<a href=#placement><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Legend positions are no longer restricted to just a single side of the plot. By setting the <code>position</code> argument of guides, you can tailor which guides appear where in the plot. Guides that do not have a position set, like the &lsquo;drv&rsquo; shape legend below, follow the global theme&rsquo;s <code>legend.position</code> setting. If we suspend our belief in good data visualisation practice, we can showcase this as follows:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>p</span> <span class=o>&lt;-</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/ggplot.html>ggplot</a></span><span class=o>(</span><span class=nv>mpg</span>, <span class=nf><a href=https://ggplot2.tidyverse.org/reference/aes.html>aes</a></span><span class=o>(</span><span class=nv>displ</span>, <span class=nv>hwy</span>, shape <span class=o>=</span> <span class=nv>drv</span>, colour <span class=o>=</span> <span class=nv>cty</span>, size <span class=o>=</span> <span class=nv>year</span><span class=o>)</span><span class=o>)</span> <span class=o>+</span></span>
<span>  <span class=nf><a href=https://ggplot2.tidyverse.org/reference/geom_point.html>geom_point</a></span><span class=o>(</span><span class=nf><a href=https://ggplot2.tidyverse.org/reference/aes.html>aes</a></span><span class=o>(</span>alpha <span class=o>=</span> <span class=nv>cyl</span><span class=o>)</span><span class=o>)</span> <span class=o>+</span></span>
<span>  <span class=nf><a href=https://ggplot2.tidyverse.org/reference/guides.html>guides</a></span><span class=o>(</span></span>
<span>    colour <span class=o>=</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/guide_colourbar.html>guide_colourbar</a></span><span class=o>(</span>position <span class=o>=</span> <span class=s>"bottom"</span><span class=o>)</span>,</span>
<span>    size   <span class=o>=</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/guide_legend.html>guide_legend</a></span><span class=o>(</span>position <span class=o>=</span> <span class=s>"top"</span><span class=o>)</span>,</span>
<span>    alpha  <span class=o>=</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/guide_legend.html>guide_legend</a></span><span class=o>(</span>position <span class=o>=</span> <span class=s>"inside"</span><span class=o>)</span></span>
<span>  <span class=o>)</span> <span class=o>+</span></span>
<span>  <span class=nf><a href=https://ggplot2.tidyverse.org/reference/theme.html>theme</a></span><span class=o>(</span>legend.position <span class=o>=</span> <span class=s>"left"</span><span class=o>)</span></span>
<span><span class=nv>p</span></span>
</code></pre><p><img src=figs/legend_positions-1.png alt="A scatterplot showing engine displacement versus highway miles per gallon. It has four legend placed at the top, left, bottom of the panel and one inside the panel." width=700px style=display:block;margin:auto></p></div><p>In the plot above, the legend for the &lsquo;cyl&rsquo; variable is in the middle of the plot. In previous versions of ggplot2, you could set the <code>legend.position</code> to a coordinate to control the placement. However, doing this would change the default legend position, which is not always desirable. To cover such cases, there is now a specialised <code>legend.position.inside</code> argument that controls the positioning of legends with <code>position = "inside"</code> regardless of whether the position was specified in the theme or in the guide.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>p</span> <span class=o>+</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/theme.html>theme</a></span><span class=o>(</span>legend.position.inside <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=m>0.7</span>, <span class=m>0.7</span><span class=o>)</span><span class=o>)</span></span>
</code></pre><p><img src=figs/legend_inside-1.png alt="The same plot as before, but the legend for the 'cyl' variable is to the top-right of the centre." width=700px style=display:block;margin:auto></p></div><p>The justification of legends is controllable by using the <code>legend.justification.{position}</code> theme setting. Moreover, the top and bottom guides can be aligned to the plot rather than the panel by setting the <code>legend.location</code> argument. The main reason behind this is that you can then align the legends with the plot&rsquo;s title. By default, when <code>plot.title.position = "plot"</code>, left legends are already aligned. For this reason, the top and bottom guides are prioritised for the <code>legend.location</code> setting. Moreover, it avoids overlapping of legends in the corners if the justifications would dictate it.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>p</span> <span class=o>+</span> </span>
<span>  <span class=nf><a href=https://ggplot2.tidyverse.org/reference/labs.html>labs</a></span><span class=o>(</span>title <span class=o>=</span> <span class=s>"Plot-aligned title"</span><span class=o>)</span> <span class=o>+</span></span>
<span>  <span class=nf><a href=https://ggplot2.tidyverse.org/reference/theme.html>theme</a></span><span class=o>(</span></span>
<span>    legend.margin <span class=o>=</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/element.html>margin</a></span><span class=o>(</span><span class=m>0</span>, <span class=m>0</span>, <span class=m>0</span>, <span class=m>0</span><span class=o>)</span>, <span class=c># turned off for alignment</span></span>
<span>    legend.justification.top <span class=o>=</span> <span class=s>"left"</span>,</span>
<span>    legend.justification.left <span class=o>=</span> <span class=s>"top"</span>,</span>
<span>    legend.justification.bottom <span class=o>=</span> <span class=s>"right"</span>,</span>
<span>    legend.justification.inside <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=m>1</span>, <span class=m>1</span><span class=o>)</span>,</span>
<span>    legend.location <span class=o>=</span> <span class=s>"plot"</span>,</span>
<span>    plot.title.position <span class=o>=</span> <span class=s>"plot"</span></span>
<span>  <span class=o>)</span></span>
</code></pre><p><img src=figs/legend_alignments-1.png alt="The same plot as before, but with a plot-aligned title and different alignments of the legends. The left and top legends are left-aligned with the title." width=700px style=display:block;margin:auto></p></div><h2 id=spacing-and-margins>Spacing and margins
<a href=#spacing-and-margins><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>In this release, the way spacing in legends work has been reworked.</p><ul><li>The <code>legend.spacing{.x/.y}</code> theme setting is now used to space different guides apart. Previously, it was also used to space legend keys apart; that is no longer the case.</li><li>Spacing legend key-label pairs apart is now controlled by the <code>legend.key.spacing{.x/.y}</code> theme setting.</li><li>Spacing the labels from the keys is now controlled by the label element&rsquo;s <code>margin</code> argument.</li></ul><p>Because the legend spacing and margin options can be a bit bewildering, a small overview is added below. One setting not included in the overview is <code>legend.spacing.x</code>, which only applies when <code>legend.box = "horizontal"</code>. Which exact text margin is relevant for spacing apart keys and labels, or titles and the rest of the guide, depends on the <code>legend.text.position</code> and <code>legend.title.position</code> theme elements.</p><div class=highlight><p><img src=figs/spacing_overview-1.png alt="Overview of legend spacing and margin options. Two abstract legends are placed above one another to the right of an area called 'plot'. Various arrows with labels point out different theme settings." width=700px style=display:block;margin:auto></p></div><p>When the titles and keys don&rsquo;t have explicit margins, appropriate margins are added automatically depending on the text or title position. However, if you override the margins, they will be interpreted literally.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://ggplot2.tidyverse.org/reference/ggplot.html>ggplot</a></span><span class=o>(</span><span class=nv>mpg</span>, <span class=nf><a href=https://ggplot2.tidyverse.org/reference/aes.html>aes</a></span><span class=o>(</span><span class=nv>displ</span>, <span class=nv>hwy</span>, colour <span class=o>=</span> <span class=nv>class</span><span class=o>)</span><span class=o>)</span> <span class=o>+</span></span>
<span>  <span class=nf><a href=https://ggplot2.tidyverse.org/reference/geom_point.html>geom_point</a></span><span class=o>(</span><span class=o>)</span> <span class=o>+</span></span>
<span>  <span class=nf><a href=https://ggplot2.tidyverse.org/reference/guides.html>guides</a></span><span class=o>(</span>colour <span class=o>=</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/guide_legend.html>guide_legend</a></span><span class=o>(</span>ncol <span class=o>=</span> <span class=m>2</span><span class=o>)</span><span class=o>)</span> <span class=o>+</span></span>
<span>  <span class=nf><a href=https://ggplot2.tidyverse.org/reference/theme.html>theme</a></span><span class=o>(</span></span>
<span>    legend.key.spacing.x <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/grid/unit.html>unit</a></span><span class=o>(</span><span class=m>10</span>, <span class=s>"pt"</span><span class=o>)</span>,</span>
<span>    legend.key.spacing.y <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/grid/unit.html>unit</a></span><span class=o>(</span><span class=m>20</span>, <span class=s>"pt"</span><span class=o>)</span>,</span>
<span>    legend.text <span class=o>=</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/element.html>element_text</a></span><span class=o>(</span>margin <span class=o>=</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/element.html>margin</a></span><span class=o>(</span>l <span class=o>=</span> <span class=m>0</span><span class=o>)</span><span class=o>)</span>,</span>
<span>    legend.title <span class=o>=</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/element.html>element_text</a></span><span class=o>(</span>margin <span class=o>=</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/element.html>margin</a></span><span class=o>(</span>b <span class=o>=</span> <span class=m>20</span><span class=o>)</span><span class=o>)</span></span>
<span>  <span class=o>)</span></span>
</code></pre><p><img src=figs/legend_spacing-1.png alt="A scatterplot showing engine displacement versus highway miles per gallon. The legend for the 'class' variable shows a key layout with two columns. Keys are widely spacing in the vertical direction and more narrowly in the horizontal direction. There is no space between the keys and their labels, but plenty of space between the legend and its title." width=700px style=display:block;margin:auto></p></div><p>For all intents and purposes, colour bar/step and bins guides are treated as legend guides with just a single key-label pair. While the <code>legend.key.spacing</code> setting does not apply due to it being one single key, the other spacings and margins do apply equally.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://ggplot2.tidyverse.org/reference/ggplot.html>ggplot</a></span><span class=o>(</span><span class=nv>mpg</span>, <span class=nf><a href=https://ggplot2.tidyverse.org/reference/aes.html>aes</a></span><span class=o>(</span><span class=nv>displ</span>, <span class=nv>hwy</span>, colour <span class=o>=</span> <span class=nv>cty</span><span class=o>)</span><span class=o>)</span> <span class=o>+</span></span>
<span>  <span class=nf><a href=https://ggplot2.tidyverse.org/reference/geom_point.html>geom_point</a></span><span class=o>(</span><span class=o>)</span> <span class=o>+</span></span>
<span>  <span class=nf><a href=https://ggplot2.tidyverse.org/reference/theme.html>theme</a></span><span class=o>(</span></span>
<span>    legend.text  <span class=o>=</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/element.html>element_text</a></span><span class=o>(</span>margin <span class=o>=</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/element.html>margin</a></span><span class=o>(</span>l <span class=o>=</span> <span class=m>0</span><span class=o>)</span><span class=o>)</span>,</span>
<span>    legend.title <span class=o>=</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/element.html>element_text</a></span><span class=o>(</span>margin <span class=o>=</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/element.html>margin</a></span><span class=o>(</span>b <span class=o>=</span> <span class=m>20</span><span class=o>)</span><span class=o>)</span></span>
<span>  <span class=o>)</span></span>
</code></pre><p><img src=figs/legend_spacing_bar-1.png alt="The same plot as before, but with a colourbar indicating the 'cty' variable. Again, there is no space between the bar and the labels and ample space between the bar and the title." width=700px style=display:block;margin:auto></p></div><h2 id=stretching>Stretching
<a href=#stretching><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Another experimental tweak to legends is that they can now have stretching keys (or bars). The option is still considered &lsquo;experimental&rsquo; because there are some things that may go wrong. By setting the <code>legend.key{.height/.width}</code> theme argument as a <code>"null"</code> unit, legends can now expand to fill the available space.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>p</span> <span class=o>&lt;-</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/ggplot.html>ggplot</a></span><span class=o>(</span><span class=nv>mpg</span>, <span class=nf><a href=https://ggplot2.tidyverse.org/reference/aes.html>aes</a></span><span class=o>(</span><span class=nv>displ</span>, <span class=nv>hwy</span><span class=o>)</span><span class=o>)</span> <span class=o>+</span></span>
<span>  <span class=nf><a href=https://ggplot2.tidyverse.org/reference/geom_point.html>geom_point</a></span><span class=o>(</span><span class=nf><a href=https://ggplot2.tidyverse.org/reference/aes.html>aes</a></span><span class=o>(</span>colour <span class=o>=</span> <span class=nv>cty</span>, size <span class=o>=</span> <span class=nv>cyl</span><span class=o>)</span>, shape <span class=o>=</span> <span class=m>21</span><span class=o>)</span> <span class=o>+</span></span>
<span>  <span class=nf><a href=https://ggplot2.tidyverse.org/reference/theme.html>theme</a></span><span class=o>(</span>legend.key.height <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/grid/unit.html>unit</a></span><span class=o>(</span><span class=m>1</span>, <span class=s>"null"</span><span class=o>)</span><span class=o>)</span></span>
<span><span class=nv>p</span></span>
</code></pre><p><img src=figs/stretch_keys-1.png alt="Scatterplot of engine displacement versus highway miles per gallon. There is a legend guide showing the point's size and a colour. Both the legend and the bar take up an approximately equal amount of space on the right-hand side of the panel." width=700px style=display:block;margin:auto></p></div><p>The term &lsquo;available space&rsquo; is a tricky one. For starters, other legends placed in the same position take up space, as can be seen in the plot above. If your legend is the only legend in a position, more space is available and it stretches more. As you can see in the plot below, the legends are not aligned with the panel even when stretched. This is because the titles, margins and various spacings all take up space that is <em>not</em> available to stretch into.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>p</span> <span class=o>+</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/guides.html>guides</a></span><span class=o>(</span>colour <span class=o>=</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/guide_colourbar.html>guide_colourbar</a></span><span class=o>(</span>position <span class=o>=</span> <span class=s>"left"</span><span class=o>)</span><span class=o>)</span></span>
</code></pre><p><img src=figs/isolated_stretch-1.png alt="Same plot as before, but the colour bar is placed on the left. Both the colour bar and legend take up a lot of vertical space." width=700px style=display:block;margin:auto></p></div><p>On the other hand, if one position is packed with legends, the keys may shrink instead of stretch. The keys can become too small to show the aesthetics properly. You can see in the example below that the size legend becomes cut-off due to small keys and text is spaced too closely to comfortably read.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>p</span> <span class=o>+</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/aes.html>aes</a></span><span class=o>(</span>fill <span class=o>=</span> <span class=nv>model</span><span class=o>)</span></span>
</code></pre><p><img src=figs/shrinking_keys-1.png alt="Same plot as before, but all legends are on the right, including a new legend for the 'model' variable. All legends have keys that are too small to read the text comfortably, and the points indicating size are clipped." width=700px style=display:block;margin:auto></p></div><p>Another issue that may come up is that the &lsquo;available space&rsquo; might be 0. Because the plot itself is also space-filling, setting null-heights for top/bottom positions or null-widths for left/right positions means there is no available space. This may result in the keys or bars becoming invisible. For the plot below, recall that we&rsquo;ve set the <code>legend.key.height</code> setting to a null unit.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>p</span> <span class=o>+</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/theme.html>theme</a></span><span class=o>(</span>legend.position <span class=o>=</span> <span class=s>"top"</span><span class=o>)</span></span>
</code></pre><p><img src=figs/disappearing_keys-1.png alt="Still the same scatterplot but without the fill variable. Legends are placed at the top of the panel, but the bar and key backgrounds have disappeared. The text labels are still present." width=700px style=display:block;margin:auto></p></div><h2 id=other-improvements>Other improvements
<a href=#other-improvements><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>We welcome a new type of legend:
<a href=https://ggplot2.tidyverse.org/reference/guide_custom.html target=_blank rel=noopener><code>guide_custom()</code></a>. It can be used to add any graphical object (grob) to a plot, like
<a href=https://ggplot2.tidyverse.org/reference/annotation_custom.html target=_blank rel=noopener><code>annotation_custom()</code></a>. There are a few differences though: it is positioned just like a legend and adds titles and margins. In some sense, this guide is &lsquo;special&rsquo;, as it is the only guide that does not directly reflect a scale. The downside is that it cannot read properties from the plot, but the upside is that it is very flexible. Be careful when your grob does not have an absolute size, you should set the <code>width</code> and <code>height</code> arguments.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>x</span> <span class=o>&lt;-</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=m>0.5</span>, <span class=m>1</span>, <span class=m>1.5</span>, <span class=m>1.2</span>, <span class=m>1.5</span>, <span class=m>1</span>, <span class=m>0.5</span>, <span class=m>0.8</span>, <span class=m>1</span>, <span class=m>1.15</span>, <span class=m>2</span>, <span class=m>1.15</span>, <span class=m>1</span>, <span class=m>0.85</span>, <span class=m>0</span>, <span class=m>0.85</span><span class=o>)</span></span>
<span><span class=nv>y</span> <span class=o>&lt;-</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=m>1.5</span>, <span class=m>1.2</span>, <span class=m>1.5</span>, <span class=m>1</span>, <span class=m>0.5</span>, <span class=m>0.8</span>, <span class=m>0.5</span>, <span class=m>1</span>, <span class=m>2</span>, <span class=m>1.15</span>, <span class=m>1</span>, <span class=m>0.85</span>, <span class=m>0</span>, <span class=m>0.85</span>, <span class=m>1</span>, <span class=m>1.15</span><span class=o>)</span></span>
<span></span>
<span><span class=nv>compass_rose</span> <span class=o>&lt;-</span> <span class=nf>grid</span><span class=nf>::</span><span class=nf><a href=https://rdrr.io/r/grid/grid.polygon.html>polygonGrob</a></span><span class=o>(</span></span>
<span>  x <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/grid/unit.html>unit</a></span><span class=o>(</span><span class=nv>x</span>, <span class=s>"cm"</span><span class=o>)</span>, y <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/grid/unit.html>unit</a></span><span class=o>(</span><span class=nv>y</span>, <span class=s>"cm"</span><span class=o>)</span>, id.lengths <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=m>8</span>, <span class=m>8</span><span class=o>)</span>,</span>
<span>  gp <span class=o>=</span> <span class=nf>grid</span><span class=nf>::</span><span class=nf><a href=https://rdrr.io/r/grid/gpar.html>gpar</a></span><span class=o>(</span>fill <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=s>"grey50"</span>, <span class=s>"grey25"</span><span class=o>)</span>, col <span class=o>=</span> <span class=kc>NA</span><span class=o>)</span></span>
<span><span class=o>)</span></span>
<span></span>
<span><span class=nv>nc</span> <span class=o>&lt;-</span> <span class=nf>sf</span><span class=nf>::</span><span class=nf><a href=https://r-spatial.github.io/sf/reference/st_read.html>st_read</a></span><span class=o>(</span><span class=nf><a href=https://rdrr.io/r/base/system.file.html>system.file</a></span><span class=o>(</span><span class=s>"shape/nc.shp"</span>, package <span class=o>=</span> <span class=s>"sf"</span><span class=o>)</span>, quiet <span class=o>=</span> <span class=kc>TRUE</span><span class=o>)</span></span>
<span><span class=nf><a href=https://ggplot2.tidyverse.org/reference/ggplot.html>ggplot</a></span><span class=o>(</span><span class=nv>nc</span><span class=o>)</span> <span class=o>+</span></span>
<span>  <span class=nf><a href=https://ggplot2.tidyverse.org/reference/ggsf.html>geom_sf</a></span><span class=o>(</span><span class=nf><a href=https://ggplot2.tidyverse.org/reference/aes.html>aes</a></span><span class=o>(</span>fill <span class=o>=</span> <span class=nv>AREA</span><span class=o>)</span><span class=o>)</span> <span class=o>+</span></span>
<span>  <span class=nf><a href=https://ggplot2.tidyverse.org/reference/guides.html>guides</a></span><span class=o>(</span>custom <span class=o>=</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/guide_custom.html>guide_custom</a></span><span class=o>(</span><span class=nv>compass_rose</span>, title <span class=o>=</span> <span class=s>"compass"</span><span class=o>)</span><span class=o>)</span></span>
</code></pre><p><img src=figs/custom_guide-1.png alt="A map of the US state North Carolina, where fill colour indicates the area of counties. Underneath the colour bar for the fill, there is an eight-pointed star to the right of the panel with the title 'compass'." width=700px style=display:block;margin:auto></p></div><p>In previous version of ggplot2, when legend titles are wider than the legends, the guide-title alignment was always left aligned. Now, the justification setting of the legend text determines the alignment: 1 is right or top aligned and 0 is left or bottom aligned.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://ggplot2.tidyverse.org/reference/ggplot.html>ggplot</a></span><span class=o>(</span><span class=nv>mpg</span>, <span class=nf><a href=https://ggplot2.tidyverse.org/reference/aes.html>aes</a></span><span class=o>(</span><span class=nv>displ</span>, <span class=nv>hwy</span>, shape <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/factor.html>factor</a></span><span class=o>(</span><span class=nv>cyl</span><span class=o>)</span>, colour <span class=o>=</span> <span class=nv>drv</span><span class=o>)</span><span class=o>)</span> <span class=o>+</span></span>
<span>  <span class=nf><a href=https://ggplot2.tidyverse.org/reference/geom_point.html>geom_point</a></span><span class=o>(</span><span class=o>)</span> <span class=o>+</span></span>
<span>  <span class=nf><a href=https://ggplot2.tidyverse.org/reference/guides.html>guides</a></span><span class=o>(</span></span>
<span>    shape <span class=o>=</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/guide_legend.html>guide_legend</a></span><span class=o>(</span></span>
<span>      title <span class=o>=</span> <span class=s>"A title that is pretty long"</span>,</span>
<span>      theme <span class=o>=</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/theme.html>theme</a></span><span class=o>(</span>legend.title <span class=o>=</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/element.html>element_text</a></span><span class=o>(</span>hjust <span class=o>=</span> <span class=m>1</span><span class=o>)</span><span class=o>)</span>,</span>
<span>      order <span class=o>=</span> <span class=m>1</span></span>
<span>    <span class=o>)</span>,</span>
<span>    colour <span class=o>=</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/guide_legend.html>guide_legend</a></span><span class=o>(</span></span>
<span>      title <span class=o>=</span> <span class=s>"Another long title"</span>,</span>
<span>      theme <span class=o>=</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/theme.html>theme</a></span><span class=o>(</span>legend.title <span class=o>=</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/element.html>element_text</a></span><span class=o>(</span>hjust <span class=o>=</span> <span class=m>0</span><span class=o>)</span><span class=o>)</span></span>
<span>    <span class=o>)</span></span>
<span>  <span class=o>)</span></span>
</code></pre><p><img src=figs/title_justification-1.png alt="Scatterplot of engine displacement versus highway miles per gallon. The 'drv' variable has a legend that is left aligned, whereas the 'cyl' variable has a legend that is right-aligned." width=700px style=display:block;margin:auto></p></div></div></div><div class=column25><div class="section hideOnMobile"><div class=sectionTitle>Contents</div><nav id=TableOfContents><ul><li><a href=#styling>Styling</a></li><li><a href=#awareness>Awareness</a></li><li><a href=#placement>Placement</a></li><li><a href=#spacing-and-margins>Spacing and margins</a></li><li><a href=#stretching>Stretching</a></li><li><a href=#other-improvements>Other improvements</a></li></ul></nav></div><div class=section></div></div></div></div></div><div id=rStudioFooter class=band><div class=bandContent><div id=copyright>The tidyverse is proudly supported by <a class=rstudioLogo href=https://posit.co/ aria-label="Posit Homepage"></a></div><div id=logos><a href=https://www.tidyverse.org/google_privacy_policy>Privacy policy</a>
<a href=https://github.com/tidyverse class="footerLogo gitHub" aria-label="Tidyverse GitHub organization"></a><a href=https://twitter.com/hashtag/rstats class="footerLogo twitter" aria-label="rstats hashtag on twitter.com"></a></div></div></div></div></div><script type=application/javascript>var dnt=(navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack);var doNotTrack=(dnt=="1"||dnt=="yes");if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');if(window.sessionStorage){var GA_SESSION_STORAGE_KEY='ga:clientId';ga('create','UA-115082821-1',{'storage':'none','clientId':sessionStorage.getItem(GA_SESSION_STORAGE_KEY)});ga(function(tracker){sessionStorage.setItem(GA_SESSION_STORAGE_KEY,tracker.get('clientId'));});}
ga('set','anonymizeIp',true);ga('send','pageview');}</script></body></html></div></div></body></html>