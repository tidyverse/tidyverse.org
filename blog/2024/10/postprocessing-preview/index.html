<!doctype html><html><head><!doctype html><html lang=en-us><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/css/main-site.css><link rel=stylesheet href=/css/fa5-all.css><style type=text/css>body{background-color:#fff;color:#1a1917}a{color:#38577f}a:hover{color:#42709b}a:focus{outline-color:#42709b}.column25-left .sectionTitle a:hover:not(.current),.column16-left .sectionTitle a:hover:not(.current){color:#1a1917}.icon-attribution,.icon-attribution a{color:#1a1917;opacity:75%}#homeContent .band.first{background-color:#fff}#homeContent .band.second{background-color:#fdeba4}#homeContent .band.third{background-color:#fff}#rStudioHeader{background-color:#1a162d;color:#fff}#rStudioHeader .productName{color:#fff}#rStudioHeader .productName:hover,#rStudioHeader .productName:focus{color:#fdeba4}#rStudioHeader #menu .menuItem.a{background-color:#75aadb;color:#fff}#rStudioHeader #menu .menuItem:hover{background-color:#484557;color:#fff}#rStudioHeader #menu .menuItem.current{background-color:#fff;color:#1a162d;text-decoration:none}#rStudioFooter.band{background-color:#767381}#rStudioFooter .bandContent #copyright{color:#e3eef8}table tbody tr:nth-child(even){background-color:#f7faff}table tbody tr:nth-child(odd){background-color:#fff}.latest{border-top:.5em solid <no value>}.event{-moz-box-shadow:0 0 0 0 rgba(0,0,0,.1);-webkit-box-shadow:0 0 0 0 rgba(0,0,0,.1);box-shadow:0 0 0 0 rgba(0,0,0,.1)}.section .event{background-color:#eab0c41a}.section .event{border-top:7pt solid #a19ea936}.section .event a{color:#1a162d}.section .event{color:#404040}</style><link rel=stylesheet href=/css/tidyverse.css><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.71.1"><title>Postprocessing is coming to tidymodels</title><meta property="og:title" content="Postprocessing is coming to tidymodels"><meta property="og:description" content="The tidymodels team has been hard at work on postprocessing, a set of features to adjust model predictions. The functionality includes a new package as well as changes across the framework."><meta property="og:type" content="article"><meta property="og:url" content="https://www.tidyverse.org/blog/2024/10/postprocessing-preview/"><meta property="twitter:card" content="summary_large_image"><meta property="og:title" content="Postprocessing is coming to tidymodels - Tidyverse"><meta property="description" content="The tidymodels team has been hard at work on postprocessing, a set of features to adjust model predictions. The functionality includes a new package as well as changes across the framework."><meta property="og:description" content="The tidymodels team has been hard at work on postprocessing, a set of features to adjust model predictions. The functionality includes a new package as well as changes across the framework."><meta property="og:image" content="https://www.tidyverse.org/blog/2024/10/postprocessing-preview/thumbnail-sq.jpg"><meta name=twitter:image content="https://www.tidyverse.org/blog/2024/10/postprocessing-preview/thumbnail-wd.jpg"><link rel=apple-touch-icon sizes=180x180 href=/images/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicons/favicon-16x16.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg><link rel="shortcut icon" href=/images/favicons/favicon.ico><meta name=msapplication-TileColor content="#da532c"><meta name=msapplication-config href=/images/favicons/browserconfig.xml><script type=text/javascript src=/js/jquery-3.5.1.min.js></script><script type=text/javascript src=/js/site.js></script><link rel=icon href=/images/favicon.ico><script type=text/javascript src=/js/clipboard.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin=anonymous></script><script defer data-domain=tidyverse.org,all.tidyverse.org src=https://plausible.io/js/plausible.js></script></head><body><div id=appTidyverseSite class="shrinkHeader alwaysShrinkHeader"><div id=main><div id=rStudioHeader><nav class=band><div class="innards bandContent"><div><a class=productName href=/%20/>Tidyverse</a></div><div id=menu><div id=menuToggler></div><div id=menuItems><a class=menuItem href=/packages/>Packages</a>
<a class="menuItem current" href=/blog/>Blog</a>
<a class=menuItem href=/learn/>Learn</a>
<a class=menuItem href=/help/>Help</a>
<a class=menuItem href=/contribute/>Contribute</a></div></div></div></nav></div><main><div class="band padForHeader pushFooter"><div class=bandContent><div class="full splitColumns withMobileMargins"><div class=column75><h1 class=article-title>Postprocessing is coming to tidymodels</h1><div class=article-header aria-hidden=true><div class=photo><img src=/blog/2024/10/postprocessing-preview/thumbnail-wd.jpg></div><div class=photoCredit>Photo by <a href=https://unsplash.com/photos/G6Y_YM3gO44>Haley Owens</a></div></div><span class=article-date><i class="fas fa-calendar-day fa-fw"></i>&nbsp;&nbsp;2024/10/08</span><p style=margin-bottom:.5em;margin-top:.85em><i class="fas fa-tags"></i>&nbsp;
<a href=/tags/tidymodels/>tidymodels</a>,
<a href=/tags/workflows/>workflows</a>,
<a href=/tags/postprocessing/>postprocessing</a></p><p style=margin-top:.5em><i class="fas fa-user-circle fa-fw"></i>&nbsp;
Simon Couch, Hannah Frick, and Max Kuhn</p><div class=article-content><p>We&rsquo;re bristling with elation to share about a set of upcoming features for postprocessing with tidymodels. Postprocessors refine predictions outputted from machine learning models to improve predictive performance or better satisfy distributional limitations. The developmental versions of many tidymodels core packages include changes to support postprocessors, and we&rsquo;re ready to share about our work and hear the community&rsquo;s thoughts on our progress so far.</p><p>Postprocessing support with tidymodels hasn&rsquo;t yet made it to CRAN, but you can install the needed versions of tidymodels packages with the following code.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf>pak</span><span class=nf>::</span><span class=nf><a href=https://pak.r-lib.org/reference/pak.html>pak</a></span><span class=o>(</span></span>
<span>  <span class=nf><a href=https://rdrr.io/r/base/paste.html>paste0</a></span><span class=o>(</span></span>
<span>    <span class=s>"tidymodels/"</span>,</span>
<span>    <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=s>"tune"</span>, <span class=s>"workflows"</span>, <span class=s>"rsample"</span>, <span class=s>"tailor"</span><span class=o>)</span></span>
<span>  <span class=o>)</span></span>
<span><span class=o>)</span></span></code></pre></div><p>Now, we load packages with those developmental versions installed.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=https://tidymodels.tidymodels.org>tidymodels</a></span><span class=o>)</span></span>
<span><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=https://github.com/tidymodels/probably>probably</a></span><span class=o>)</span></span>
<span><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=https://github.com/tidymodels/tailor>tailor</a></span><span class=o>)</span></span></code></pre></div><p>Existing tidymodels users might have spotted something funky already; who is this tailor character?</p><h2 id=meet-tailor>Meet tailorðŸ‘‹
<a href=#meet-tailor><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>The tailor package introduces tailor objects, which compose iterative adjustments to model predictions. tailor is to postprocessing as recipes is to preprocessing; applying your mental model of recipes to tailor should get you a good bit of the way there.</p><div style=width:140%;max-width:140%;overflow-x:auto><table><thead><tr><th>Tool</th><th>Applied to...</th><th>Initialize with...</th><th>Composes...</th><th>Train with...</th><th>Predict with...</th></tr></thead><tbody><tr><td>recipes</td><td>Training data</td><td><code>recipe()</code></td><td><code>step_*()</code>s</td><td><code>prep()</code></td><td><code>bake()</code></td></tr><tr><td>tailor</td><td>Model predictions</td><td><a href=https://tailor.tidymodels.org/reference/tailor.html target=_blank rel=noopener><code>tailor()</code></a></td><td><code>adjust_*()</code>ments</td><td><a href=https://generics.r-lib.org/reference/fit.html target=_blank rel=noopener><code>fit()</code></a></td><td><a href=https://rdrr.io/r/stats/predict.html target=_blank rel=noopener><code>predict()</code></a></td></tr></tbody></table></div><p>First, users can initialize a tailor object with
<a href=https://tailor.tidymodels.org/reference/tailor.html target=_blank rel=noopener><code>tailor()</code></a>.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://tailor.tidymodels.org/reference/tailor.html>tailor</a></span><span class=o>(</span><span class=o>)</span></span>
<span><span class=c>#&gt; </span></span>
<span></span><span><span class=c>#&gt; <span style=color:#0bb>â”€â”€</span> <span style=font-weight:700>tailor</span> <span style=color:#0bb>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span></span><span><span class=c>#&gt; A postprocessor with 0 adjustments.</span></span>
<span></span></code></pre></div><p>Tailors compose &ldquo;adjustments,&rdquo; analogous to steps from the recipes package.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://tailor.tidymodels.org/reference/tailor.html>tailor</a></span><span class=o>(</span><span class=o>)</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span></span>
<span>  <span class=nf><a href=https://tailor.tidymodels.org/reference/adjust_probability_threshold.html>adjust_probability_threshold</a></span><span class=o>(</span>threshold <span class=o>=</span> <span class=m>.7</span><span class=o>)</span></span>
<span><span class=c>#&gt; </span></span>
<span></span><span><span class=c>#&gt; <span style=color:#0bb>â”€â”€</span> <span style=font-weight:700>tailor</span> <span style=color:#0bb>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span></span><span><span class=c>#&gt; A binary postprocessor with 1 adjustment:</span></span>
<span></span><span><span class=c>#&gt; </span></span>
<span></span><span><span class=c>#&gt; <span style=color:#0bb>â€¢</span> Adjust probability threshold to 0.7.</span></span>
<span></span></code></pre></div><p>As an example, we&rsquo;ll apply this tailor to the <code>two_class_example</code> data made available after loading tidymodels.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://rdrr.io/r/utils/head.html>head</a></span><span class=o>(</span><span class=nv>two_class_example</span><span class=o>)</span></span>
<span><span class=c>#&gt;    truth      Class1       Class2 predicted</span></span>
<span><span class=c>#&gt; 1 Class2 0.003589243 0.9964107574    Class2</span></span>
<span><span class=c>#&gt; 2 Class1 0.678621054 0.3213789460    Class1</span></span>
<span><span class=c>#&gt; 3 Class2 0.110893522 0.8891064779    Class2</span></span>
<span><span class=c>#&gt; 4 Class1 0.735161703 0.2648382969    Class1</span></span>
<span><span class=c>#&gt; 5 Class2 0.016239960 0.9837600397    Class2</span></span>
<span><span class=c>#&gt; 6 Class1 0.999275071 0.0007249286    Class1</span></span>
<span></span></code></pre></div><p>This data gives the true value of an outcome variable <code>truth</code> as well as predicted probabilities (<code>Class1</code> and <code>Class2</code>). The hard class predictions, in <code>predicted</code>, are <code>"Class1"</code> if the probability assigned to <code>"Class1"</code> is above .5, and <code>"Class2"</code> otherwise.</p><p>The model predicts <code>"Class1"</code> more often than it does <code>"Class2"</code>.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>two_class_example</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span> <span class=nf>count</span><span class=o>(</span><span class=nv>predicted</span><span class=o>)</span></span>
<span><span class=c>#&gt;   predicted   n</span></span>
<span><span class=c>#&gt; 1    Class1 277</span></span>
<span><span class=c>#&gt; 2    Class2 223</span></span>
<span></span></code></pre></div><p>If we wanted the model to predict <code>"Class2"</code> more often, we could increase the probability threshold assigned to <code>"Class1"</code> above which the hard class prediction will be <code>"Class1"</code>. In the tailor package, this adjustment is implemented in
<a href=https://tailor.tidymodels.org/reference/adjust_probability_threshold.html target=_blank rel=noopener><code>adjust_probability_threshold()</code></a>, which can be situated in a tailor object.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>tlr</span> <span class=o>&lt;-</span></span>
<span>  <span class=nf><a href=https://tailor.tidymodels.org/reference/tailor.html>tailor</a></span><span class=o>(</span><span class=o>)</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span></span>
<span>  <span class=nf><a href=https://tailor.tidymodels.org/reference/adjust_probability_threshold.html>adjust_probability_threshold</a></span><span class=o>(</span>threshold <span class=o>=</span> <span class=m>.7</span><span class=o>)</span></span>
<span></span>
<span><span class=nv>tlr</span></span>
<span><span class=c>#&gt; </span></span>
<span></span><span><span class=c>#&gt; <span style=color:#0bb>â”€â”€</span> <span style=font-weight:700>tailor</span> <span style=color:#0bb>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span></span><span><span class=c>#&gt; A binary postprocessor with 1 adjustment:</span></span>
<span></span><span><span class=c>#&gt; </span></span>
<span></span><span><span class=c>#&gt; <span style=color:#0bb>â€¢</span> Adjust probability threshold to 0.7.</span></span>
<span></span></code></pre></div><p>tailors must be fitted before they can predict on new data. For adjustments like
<a href=https://tailor.tidymodels.org/reference/adjust_probability_threshold.html target=_blank rel=noopener><code>adjust_probability_threshold()</code></a>, there&rsquo;s no training that actually happens at the
<a href=https://generics.r-lib.org/reference/fit.html target=_blank rel=noopener><code>fit()</code></a> step besides recording the name and type of relevant variables. For other adjustments, like numeric calibration with
<a href=https://tailor.tidymodels.org/reference/adjust_numeric_calibration.html target=_blank rel=noopener><code>adjust_numeric_calibration()</code></a>, parameters are actually estimated at the
<a href=https://generics.r-lib.org/reference/fit.html target=_blank rel=noopener><code>fit()</code></a> stage and separate data should be used to train the postprocessor and evaluate its performance. More on this in
<a href=#tailors-in-context>Tailors in context</a>.</p><p>In this case, though, we can
<a href=https://generics.r-lib.org/reference/fit.html target=_blank rel=noopener><code>fit()</code></a> on the whole dataset. The resulting object is still a tailor, but is now flagged as trained.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>tlr_trained</span> <span class=o>&lt;-</span> <span class=nf><a href=https://generics.r-lib.org/reference/fit.html>fit</a></span><span class=o>(</span></span>
<span>  <span class=nv>tlr</span>,</span>
<span>  <span class=nv>two_class_example</span>,</span>
<span>  outcome <span class=o>=</span> <span class=nv>truth</span>,</span>
<span>  estimate <span class=o>=</span> <span class=nv>predicted</span>,</span>
<span>  probabilities <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=nv>Class1</span>, <span class=nv>Class2</span><span class=o>)</span></span>
<span><span class=o>)</span></span>
<span></span>
<span><span class=nv>tlr_trained</span></span>
<span><span class=c>#&gt; </span></span>
<span></span><span><span class=c>#&gt; <span style=color:#0bb>â”€â”€</span> <span style=font-weight:700>tailor</span> <span style=color:#0bb>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span></span><span><span class=c>#&gt; A binary postprocessor with 1 adjustment:</span></span>
<span></span><span><span class=c>#&gt; </span></span>
<span></span><span><span class=c>#&gt; <span style=color:#0bb>â€¢</span> Adjust probability threshold to 0.7. [trained]</span></span>
<span></span></code></pre></div><p>When used with a model
<a href=https://workflows.tidymodels.org target=_blank rel=noopener>workflow</a> via
<a href=https://workflows.tidymodels.org/dev/reference/add_tailor.html target=_blank rel=noopener><code>add_tailor()</code></a>, the arguments to
<a href=https://generics.r-lib.org/reference/fit.html target=_blank rel=noopener><code>fit()</code></a> a tailor will be set automatically. Generally, as in recipes, we recommend that users add tailors to model workflows for training and prediction rather than using them standalone for greater ease of use and to prevent data leakage, but tailors are totally functional by themselves, too.</p><p>Now, when passed new data, the trained tailor will determine the outputted class based on whether the probability assigned to the level <code>"Class1"</code> is above <code>.7</code>, resulting in more predictions of <code>"Class2"</code> than before.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://rdrr.io/r/stats/predict.html>predict</a></span><span class=o>(</span><span class=nv>tlr_trained</span>, <span class=nv>two_class_example</span><span class=o>)</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span> <span class=nf>count</span><span class=o>(</span><span class=nv>predicted</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 2 Ã— 2</span></span></span>
<span><span class=c>#&gt;   predicted     n</span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;fct&gt;</span>     <span style=color:#555;font-style:italic>&lt;int&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span> Class1      236</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span> Class2      264</span></span>
<span></span></code></pre></div><p>Changing the probability threshold is one of many possible adjustments available in tailor.</p><ul><li>For probabilities:
<a href=https://tailor.tidymodels.org/reference/adjust_probability_calibration.html target=_blank rel=noopener>calibration</a></li><li>For transformation of probabilities to hard class predictions:
<a href=https://tailor.tidymodels.org/reference/adjust_probability_threshold.html target=_blank rel=noopener>thresholds</a>,
<a href=https://tailor.tidymodels.org/reference/adjust_equivocal_zone.html target=_blank rel=noopener>equivocal zones</a></li><li>For numeric outcomes:
<a href=https://tailor.tidymodels.org/reference/adjust_numeric_calibration.html target=_blank rel=noopener>calibration</a>,
<a href=https://tailor.tidymodels.org/reference/adjust_numeric_range.html target=_blank rel=noopener>range</a></li></ul><p>Support for tailors is now plumbed through workflows (via
<a href=https://workflows.tidymodels.org/dev/reference/add_tailor.html target=_blank rel=noopener><code>add_tailor()</code></a>) and tune, and rsample includes a set of infrastructural changes to prevent data leakage behind the scenes. That said, we haven&rsquo;t yet implemented support for tuning parameters in tailors, but we plan to implement that before this functionality heads to CRAN.</p><h2 id=tailors-in-context>Tailors in context
<a href=#tailors-in-context><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>As an example, let&rsquo;s model a study of food delivery times in minutes (i.e., the time from the initial order to receiving the food) for a single restaurant. The <code>deliveries</code> data is available upon loading the tidymodels meta-package.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://rdrr.io/r/utils/data.html>data</a></span><span class=o>(</span><span class=nv>deliveries</span><span class=o>)</span></span>
<span></span>
<span><span class=c># split into training and testing sets</span></span>
<span><span class=nf><a href=https://rdrr.io/r/base/Random.html>set.seed</a></span><span class=o>(</span><span class=m>1</span><span class=o>)</span></span>
<span><span class=nv>delivery_split</span> <span class=o>&lt;-</span> <span class=nf>initial_split</span><span class=o>(</span><span class=nv>deliveries</span><span class=o>)</span></span>
<span><span class=nv>delivery_train</span> <span class=o>&lt;-</span> <span class=nf>training</span><span class=o>(</span><span class=nv>delivery_split</span><span class=o>)</span></span>
<span><span class=nv>delivery_test</span>  <span class=o>&lt;-</span> <span class=nf>testing</span><span class=o>(</span><span class=nv>delivery_split</span><span class=o>)</span></span>
<span></span>
<span><span class=c># resample the training set using 10-fold cross-validation</span></span>
<span><span class=nf><a href=https://rdrr.io/r/base/Random.html>set.seed</a></span><span class=o>(</span><span class=m>1</span><span class=o>)</span></span>
<span><span class=nv>delivery_folds</span> <span class=o>&lt;-</span> <span class=nf>vfold_cv</span><span class=o>(</span><span class=nv>delivery_train</span><span class=o>)</span></span>
<span></span>
<span><span class=c># print out the training set</span></span>
<span><span class=nv>delivery_train</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 7,509 Ã— 31</span></span></span>
<span><span class=c>#&gt;    time_to_delivery  hour day   distance item_01 item_02 item_03 item_04 item_05</span></span>
<span><span class=c>#&gt;               <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;fct&gt;</span>    <span style=color:#555;font-style:italic>&lt;dbl&gt;</span>   <span style=color:#555;font-style:italic>&lt;int&gt;</span>   <span style=color:#555;font-style:italic>&lt;int&gt;</span>   <span style=color:#555;font-style:italic>&lt;int&gt;</span>   <span style=color:#555;font-style:italic>&lt;int&gt;</span>   <span style=color:#555;font-style:italic>&lt;int&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555> 1</span>             21.2  16.1 Tue       3.02       0       0       0       0       0</span></span>
<span><span class=c>#&gt; <span style=color:#555> 2</span>             17.9  12.4 Sun       3.37       0       0       0       0       0</span></span>
<span><span class=c>#&gt; <span style=color:#555> 3</span>             22.4  14.2 Fri       2.59       0       0       0       0       0</span></span>
<span><span class=c>#&gt; <span style=color:#555> 4</span>             30.9  19.1 Sat       2.77       0       0       0       0       0</span></span>
<span><span class=c>#&gt; <span style=color:#555> 5</span>             30.1  16.5 Fri       2.05       0       0       0       1       0</span></span>
<span><span class=c>#&gt; <span style=color:#555> 6</span>             35.3  14.7 Sat       4.57       0       0       2       1       1</span></span>
<span><span class=c>#&gt; <span style=color:#555> 7</span>             13.1  11.5 Sat       2.09       0       0       0       0       0</span></span>
<span><span class=c>#&gt; <span style=color:#555> 8</span>             18.3  13.4 Tue       2.35       0       2       1       0       0</span></span>
<span><span class=c>#&gt; <span style=color:#555> 9</span>             25.2  20.5 Sat       2.43       0       0       0       1       0</span></span>
<span><span class=c>#&gt; <span style=color:#555>10</span>             30.7  16.7 Fri       2.24       0       0       0       1       0</span></span>
<span><span class=c>#&gt; <span style=color:#555># â„¹ 7,499 more rows</span></span></span>
<span><span class=c>#&gt; <span style=color:#555># â„¹ 22 more variables: item_06 &lt;int&gt;, item_07 &lt;int&gt;, item_08 &lt;int&gt;,</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>#   item_09 &lt;int&gt;, item_10 &lt;int&gt;, item_11 &lt;int&gt;, item_12 &lt;int&gt;, item_13 &lt;int&gt;,</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>#   item_14 &lt;int&gt;, item_15 &lt;int&gt;, item_16 &lt;int&gt;, item_17 &lt;int&gt;, item_18 &lt;int&gt;,</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>#   item_19 &lt;int&gt;, item_20 &lt;int&gt;, item_21 &lt;int&gt;, item_22 &lt;int&gt;, item_23 &lt;int&gt;,</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>#   item_24 &lt;int&gt;, item_25 &lt;int&gt;, item_26 &lt;int&gt;, item_27 &lt;int&gt;</span></span></span>
<span></span></code></pre></div><p>Let&rsquo;s deliberately define a regression model that has poor predicted values: a boosted tree with only three ensemble members.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>delivery_wflow</span> <span class=o>&lt;-</span></span>
<span>  <span class=nf>workflow</span><span class=o>(</span><span class=o>)</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span></span>
<span>  <span class=nf>add_formula</span><span class=o>(</span><span class=nv>time_to_delivery</span> <span class=o>~</span> <span class=nv>.</span><span class=o>)</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span></span>
<span>  <span class=nf>add_model</span><span class=o>(</span><span class=nf>boost_tree</span><span class=o>(</span>mode <span class=o>=</span> <span class=s>"regression"</span>, trees <span class=o>=</span> <span class=m>3</span><span class=o>)</span><span class=o>)</span></span></code></pre></div><p>Evaluating against resamples:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://rdrr.io/r/base/Random.html>set.seed</a></span><span class=o>(</span><span class=m>1</span><span class=o>)</span></span>
<span><span class=nv>delivery_res</span> <span class=o>&lt;-</span> </span>
<span>  <span class=nf>fit_resamples</span><span class=o>(</span></span>
<span>    <span class=nv>delivery_wflow</span>, </span>
<span>    <span class=nv>delivery_folds</span>, </span>
<span>    control <span class=o>=</span> <span class=nf>control_resamples</span><span class=o>(</span>save_pred <span class=o>=</span> <span class=kc>TRUE</span><span class=o>)</span></span>
<span>  <span class=o>)</span></span></code></pre></div><p>The $R^2$ looks quite strong!</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://tune.tidymodels.org/reference/collect_predictions.html>collect_metrics</a></span><span class=o>(</span><span class=nv>delivery_res</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 2 Ã— 6</span></span></span>
<span><span class=c>#&gt;   .metric .estimator  mean     n std_err .config             </span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;chr&gt;</span>   <span style=color:#555;font-style:italic>&lt;chr&gt;</span>      <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;int&gt;</span>   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>               </span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span> rmse    standard   9.52     10 0.053<span style=text-decoration:underline>3</span>  Preprocessor1_Model1</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span> rsq     standard   0.853    10 0.003<span style=text-decoration:underline>57</span> Preprocessor1_Model1</span></span>
<span></span></code></pre></div><p>Let&rsquo;s take a closer look at the predictions, though. How well are they calibrated? We can use the
<a href=https://probably.tidymodels.org/reference/cal_plot_regression.html target=_blank rel=noopener><code>cal_plot_regression()</code></a> helper from the probably package to put together a quick diagnostic plot.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://tune.tidymodels.org/reference/collect_predictions.html>collect_predictions</a></span><span class=o>(</span><span class=nv>delivery_res</span><span class=o>)</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span></span>
<span>  <span class=nf><a href=https://probably.tidymodels.org/reference/cal_plot_regression.html>cal_plot_regression</a></span><span class=o>(</span>truth <span class=o>=</span> <span class=nv>time_to_delivery</span>, estimate <span class=o>=</span> <span class=nv>.pred</span><span class=o>)</span></span>
</code></pre><p><img src=figs/predictions-bad-boost-1.png width=700px style=display:block;margin:auto></p></div><p>Ooof.</p><p>In comes tailor! Numeric calibration can help address the correlated errors here. We can add a tailor to our existing workflow to &ldquo;bump up&rdquo; predictions towards their true value.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>delivery_wflow_improved</span> <span class=o>&lt;-</span></span>
<span>  <span class=nv>delivery_wflow</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span></span>
<span>  <span class=nf>add_tailor</span><span class=o>(</span><span class=nf><a href=https://tailor.tidymodels.org/reference/tailor.html>tailor</a></span><span class=o>(</span><span class=o>)</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span> <span class=nf><a href=https://tailor.tidymodels.org/reference/adjust_numeric_calibration.html>adjust_numeric_calibration</a></span><span class=o>(</span><span class=o>)</span><span class=o>)</span></span></code></pre></div><p>The resampling code looks the same from here.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://rdrr.io/r/base/Random.html>set.seed</a></span><span class=o>(</span><span class=m>1</span><span class=o>)</span></span>
<span><span class=nv>delivery_res_improved</span> <span class=o>&lt;-</span> </span>
<span>  <span class=nf>fit_resamples</span><span class=o>(</span></span>
<span>    <span class=nv>delivery_wflow_improved</span>, </span>
<span>    <span class=nv>delivery_folds</span>, </span>
<span>    control <span class=o>=</span> <span class=nf>control_resamples</span><span class=o>(</span>save_pred <span class=o>=</span> <span class=kc>TRUE</span><span class=o>)</span></span>
<span>  <span class=o>)</span></span></code></pre></div><p>Checking out the same plot reveals a much better fit!</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://tune.tidymodels.org/reference/collect_predictions.html>collect_predictions</a></span><span class=o>(</span><span class=nv>delivery_res_improved</span><span class=o>)</span> <span class=o><a href=https://magrittr.tidyverse.org/reference/pipe.html>%&gt;%</a></span></span>
<span>  <span class=nf><a href=https://probably.tidymodels.org/reference/cal_plot_regression.html>cal_plot_regression</a></span><span class=o>(</span>truth <span class=o>=</span> <span class=nv>time_to_delivery</span>, estimate <span class=o>=</span> <span class=nv>.pred</span><span class=o>)</span></span>
</code></pre><p><img src=figs/predictios-better-boost-1.png width=700px style=display:block;margin:auto></p></div><p>There&rsquo;s actually some tricky data leakage prevention happening under the hood here. When you add tailors to workflow and fit them with tune, this is all taken care of for you. If you&rsquo;re interested in using tailors outside of that context, check out
<a href=https://workflows.tidymodels.org/dev/reference/add_tailor.html#data-usage target=_blank rel=noopener>this documentation section</a> in <code>add_tailor()</code>.</p><h2 id=whats-to-come>What&rsquo;s to come
<a href=#whats-to-come><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>We&rsquo;re excited about how this work is shaping up and would love to hear yall&rsquo;s thoughts on what we&rsquo;ve brought together so far. Please do comment on our social media posts about this blog entry or leave issues on the
<a href=https://github.com/tidymodels/tailor target=_blank rel=noopener>tailor GitHub repository</a> and let us know what you think!</p><p>Before these changes head out to CRAN, we&rsquo;ll also be implementing tuning functionality for postprocessors. You&rsquo;ll be able to tag arguments like <code>adjust_probability_threshold(threshold)</code> or <code>adjust_probability_calibration(method)</code> with <code>tune()</code> to optimize across several values. Besides that, post-processing with tidymodels should &ldquo;just work&rdquo; on the developmental versions of our packages&mdash;let us know if you come across anything wonky.</p><h2 id=acknowledgements>Acknowledgements
<a href=#acknowledgements><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Postprocessing support has been a longstanding feature request across many of our repositories; we&rsquo;re grateful for the community discussions there for shaping this work. Additionally, we thank Ryan Tibshirani and Daniel McDonald for fruitful discussions on how we might scope these features.</p></div></div><div class=column25><div class="section hideOnMobile"><div class=sectionTitle>Contents</div><nav id=TableOfContents><ul><li><a href=#meet-tailor>Meet tailorðŸ‘‹</a></li><li><a href=#tailors-in-context>Tailors in context</a></li><li><a href=#whats-to-come>What&rsquo;s to come</a></li><li><a href=#acknowledgements>Acknowledgements</a></li></ul></nav></div><div class=section></div></div></div></div></div><div id=rStudioFooter class=band><div class=bandContent><div id=copyright>The tidyverse is proudly supported by <a class=rstudioLogo href=https://posit.co/ aria-label="Posit Homepage"></a></div><div id=logos><a href=https://www.tidyverse.org/google_privacy_policy>Privacy policy</a>
<a href=https://github.com/tidyverse class="footerLogo gitHub" aria-label="Tidyverse GitHub organization"></a><a href=https://twitter.com/hashtag/rstats class="footerLogo twitter" aria-label="rstats hashtag on twitter.com"></a></div></div></div></div></div><script src=/js/math-code.js></script><script type=text/x-mathjax-config>
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script><script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script type=application/javascript>var dnt=(navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack);var doNotTrack=(dnt=="1"||dnt=="yes");if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');if(window.sessionStorage){var GA_SESSION_STORAGE_KEY='ga:clientId';ga('create','UA-115082821-1',{'storage':'none','clientId':sessionStorage.getItem(GA_SESSION_STORAGE_KEY)});ga(function(tracker){sessionStorage.setItem(GA_SESSION_STORAGE_KEY,tracker.get('clientId'));});}
ga('set','anonymizeIp',true);ga('send','pageview');}</script></body></html></div></div></body></html>