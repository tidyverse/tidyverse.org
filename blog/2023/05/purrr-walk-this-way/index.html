<!doctype html><html><head><!doctype html><html lang=en-us><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/css/main-site.css><link rel=stylesheet href=/css/fa5-all.css><style type=text/css>body{background-color:#fff;color:#1a1917}a{color:#38577f}a:hover{color:#42709b}a:focus{outline-color:#42709b}.column25-left .sectionTitle a:hover:not(.current),.column16-left .sectionTitle a:hover:not(.current){color:#1a1917}.icon-attribution,.icon-attribution a{color:#1a1917;opacity:75%}#homeContent .band.first{background-color:#fff}#homeContent .band.second{background-color:#fdeba4}#homeContent .band.third{background-color:#fff}#rStudioHeader{background-color:#1a162d;color:#fff}#rStudioHeader .productName{color:#fff}#rStudioHeader .productName:hover,#rStudioHeader .productName:focus{color:#fdeba4}#rStudioHeader #menu .menuItem.a{background-color:#75aadb;color:#fff}#rStudioHeader #menu .menuItem:hover{background-color:#484557;color:#fff}#rStudioHeader #menu .menuItem.current{background-color:#fff;color:#1a162d;text-decoration:none}#rStudioFooter.band{background-color:#767381}#rStudioFooter .bandContent #copyright{color:#e3eef8}table tbody tr:nth-child(even){background-color:#f7faff}table tbody tr:nth-child(odd){background-color:#fff}.latest{border-top:.5em solid <no value>}.event{-moz-box-shadow:0 0 0 0 rgba(0,0,0,.1);-webkit-box-shadow:0 0 0 0 rgba(0,0,0,.1);box-shadow:0 0 0 0 rgba(0,0,0,.1)}.section .event{background-color:#eab0c41a}.section .event{border-top:7pt solid #a19ea936}.section .event a{color:#1a162d}.section .event{color:#404040}</style><link rel=stylesheet href=/css/tidyverse.css><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.71.1"><title>`purrr::walk()` this way</title><meta property="og:title" content="`purrr::walk()` this way"><meta property="og:description" content="How to use `purrr::walk()` to write many files,  featuring file-system navigation with the fs package."><meta property="og:type" content="article"><meta property="og:url" content="https://www.tidyverse.org/blog/2023/05/purrr-walk-this-way/"><meta property="twitter:card" content="summary_large_image"><meta property="og:title" content="`purrr::walk()` this way - Tidyverse"><meta property="description" content="How to use `purrr::walk()` to write many files,  featuring file-system navigation with the fs package."><meta property="og:description" content="How to use `purrr::walk()` to write many files,  featuring file-system navigation with the fs package."><meta property="og:image" content="https://www.tidyverse.org/blog/2023/05/purrr-walk-this-way/thumbnail-sq.jpg"><meta name=twitter:image content="https://www.tidyverse.org/blog/2023/05/purrr-walk-this-way/thumbnail-wd.jpg"><link rel=apple-touch-icon sizes=180x180 href=/images/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicons/favicon-16x16.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg><link rel="shortcut icon" href=/images/favicons/favicon.ico><meta name=msapplication-TileColor content="#da532c"><meta name=msapplication-config href=/images/favicons/browserconfig.xml><script type=text/javascript src=/js/jquery-3.5.1.min.js></script><script type=text/javascript src=/js/site.js></script><link rel=icon href=/images/favicon.ico><script type=text/javascript src=/js/clipboard.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin=anonymous></script><script defer data-domain=tidyverse.org,all.tidyverse.org src=https://plausible.io/js/plausible.js></script></head><body><div id=appTidyverseSite class="shrinkHeader alwaysShrinkHeader"><div id=main><div id=rStudioHeader><nav class=band><div class="innards bandContent"><div><a class=productName href=/%20/>Tidyverse</a></div><div id=menu><div id=menuToggler></div><div id=menuItems><a class=menuItem href=/packages/>Packages</a>
<a class="menuItem current" href=/blog/>Blog</a>
<a class=menuItem href=/learn/>Learn</a>
<a class=menuItem href=/help/>Help</a>
<a class=menuItem href=/contribute/>Contribute</a></div></div></div></nav></div><main><div class="band padForHeader pushFooter"><div class=bandContent><div class="full splitColumns withMobileMargins"><div class=column75><h1 class=article-title><code>purrr::walk()</code> this way</h1><div class=article-header aria-hidden=true><div class=photo><img src=/blog/2023/05/purrr-walk-this-way/thumbnail-wd.jpg></div><div class=photoCredit>Photo by <a href=https://unsplash.com/photos/TRJjPc0wss0>Ryoji Iwata</a></div></div><span class=article-date><i class="fas fa-calendar-day fa-fw"></i>&nbsp;&nbsp;2023/05/26</span><p style=margin-bottom:.5em;margin-top:.85em><i class="fas fa-tags"></i>&nbsp;
<a href=/tags/purrr/>purrr</a>,
<a href=/tags/fs/>fs</a></p><p style=margin-top:.5em><i class="fas fa-user-circle fa-fw"></i>&nbsp;
Mara Averick</p><div class=article-content><h2 id=meet-the-map-family>Meet the <code>map()</code> family
<a href=#meet-the-map-family><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>purrr&rsquo;s
<a href=https://purrr.tidyverse.org/reference/map.html target=_blank rel=noopener><code>map()</code></a> family of functions are tools for <strong>iteration</strong>, performing the same action on multiple inputs. If you&rsquo;re new to purrr, the
<a href=https://r4ds.had.co.nz/iteration.html#iteration target=_blank rel=noopener>Iteration chapter</a> of R for Data Science is a good place to get started.</p><p>One of the benefits of using
<a href=https://purrr.tidyverse.org/reference/map.html target=_blank rel=noopener><code>map()</code></a> is that the function has variants (e.g. 
<a href=https://purrr.tidyverse.org/reference/map2.html target=_blank rel=noopener><code>map2()</code></a>,
<a href=https://purrr.tidyverse.org/reference/pmap.html target=_blank rel=noopener><code>pmap()</code></a>, etc.) all of which work the same way. To borrow from Jennifer Thompson&rsquo;s excellent
<a href=https://github.com/jenniferthompson/RLadiesIntroToPurrr target=_blank rel=noopener>Intro to purrr</a>,the arguments can be broken into two groups: what we&rsquo;re iterating over, and what we&rsquo;re doing each time. The adapted figure below shows what this looks like for
<a href=https://purrr.tidyverse.org/reference/map.html target=_blank rel=noopener><code>map()</code></a>,
<a href=https://purrr.tidyverse.org/reference/map2.html target=_blank rel=noopener><code>map2()</code></a>, and
<a href=https://purrr.tidyverse.org/reference/pmap.html target=_blank rel=noopener><code>pmap()</code></a>.</p><div class=highlight><div class=figure style=text-align:center><p><img src=purrr-map-args.png alt="Highlighted titles read: what we're iterating over, and what we're doing each time. For map(.x = , .f = ) .x is what we're iterating over and .f is what we're doing each time. For map2(.x = , .y = , .f = ) .x and .y are what we're iterating over and .f is what we're doing each time. For pmap(.l = list(), .f = ) .l is what we're iterating over and .f is what we're doing each time." width=700px></p><p class=caption>Grouped map function arguments, adapted from Intro to purrr by Jennifer Thompson</p></div></div><p>In addition to handling different input arguments, the map family of functions has variants that create different outputs. The following table from the
<a href=https://adv-r.hadley.nz/functionals.html#map-variants target=_blank rel=noopener>Map-variants section of Advanced R</a> shows how the orthogonal inputs and outputs can be used to organise the variants into a matrix:</p><table><thead><tr><th></th><th>List</th><th>Atomic</th><th>Same type</th><th>Nothing</th></tr></thead><tbody><tr><td>One argument</td><td><a href=https://purrr.tidyverse.org/reference/map.html target=_blank rel=noopener><code>map()</code></a></td><td><a href=https://purrr.tidyverse.org/reference/map.html target=_blank rel=noopener><code>map_lgl()</code></a>, &mldr;</td><td><a href=https://purrr.tidyverse.org/reference/modify.html target=_blank rel=noopener><code>modify()</code></a></td><td><a href=https://purrr.tidyverse.org/reference/map.html target=_blank rel=noopener><code>walk()</code></a></td></tr><tr><td>Two arguments</td><td><a href=https://purrr.tidyverse.org/reference/map2.html target=_blank rel=noopener><code>map2()</code></a></td><td><a href=https://purrr.tidyverse.org/reference/map2.html target=_blank rel=noopener><code>map2_lgl()</code></a>, &mldr;</td><td><a href=https://purrr.tidyverse.org/reference/modify.html target=_blank rel=noopener><code>modify2()</code></a></td><td><a href=https://purrr.tidyverse.org/reference/map2.html target=_blank rel=noopener><code>walk2()</code></a></td></tr><tr><td>One argument + index</td><td><a href=https://purrr.tidyverse.org/reference/imap.html target=_blank rel=noopener><code>imap()</code></a></td><td><a href=https://purrr.tidyverse.org/reference/imap.html target=_blank rel=noopener><code>imap_lgl()</code></a>, &mldr;</td><td><a href=https://purrr.tidyverse.org/reference/modify.html target=_blank rel=noopener><code>imodify()</code></a></td><td><a href=https://purrr.tidyverse.org/reference/imap.html target=_blank rel=noopener><code>iwalk()</code></a></td></tr><tr><td>N arguments</td><td><a href=https://purrr.tidyverse.org/reference/pmap.html target=_blank rel=noopener><code>pmap()</code></a></td><td><a href=https://purrr.tidyverse.org/reference/pmap.html target=_blank rel=noopener><code>pmap_lgl()</code></a>, &mldr;</td><td>&mdash;</td><td><a href=https://purrr.tidyverse.org/reference/pmap.html target=_blank rel=noopener><code>pwalk()</code></a></td></tr></tbody></table><h2 id=whats-up-with-walk>What&rsquo;s up with <code>walk()</code>?
<a href=#whats-up-with-walk><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Based on the table above, you might think that
<a href=https://purrr.tidyverse.org/reference/map.html target=_blank rel=noopener><code>walk()</code></a> isn&rsquo;t very useful. Indeed,
<a href=https://purrr.tidyverse.org/reference/map.html target=_blank rel=noopener><code>walk()</code></a>,
<a href=https://purrr.tidyverse.org/reference/map2.html target=_blank rel=noopener><code>walk2()</code></a>, and
<a href=https://purrr.tidyverse.org/reference/pmap.html target=_blank rel=noopener><code>pwalk()</code></a> all invisibly return <code>.x</code>. However, they come in handy when you want to call a function for its <em><strong>side effects</strong></em> rather than its return value.</p><p>Here, we&rsquo;ll go through two common use cases: saving multiple CSVs, and multiple plots. We&rsquo;ll also make use of the
<a href=https://fs.r-lib.org/ target=_blank rel=noopener>fs</a> package, a cross-platform interface to file system operations, to inspect our outputs.</p><p>If you want to try this out but don&rsquo;t want to save files locally, there&rsquo;s a
<a href=https://posit.cloud/content/5983147 target=_blank rel=noopener>companion project on <strong>Posit Cloud</strong></a> where you can follow along.</p><div class=highlight><a class=test-drive-link href=https://posit.cloud/content/5983147 target=_blank><button class=test-drive-btn><i class="fa fa-cloud" aria-hidden=true></i> Test Drive on Posit Cloud</button></a></div><h2 id=writing-and-deleting-multiple-csvs>Writing (and deleting) multiple CSVs
<a href=#writing-and-deleting-multiple-csvs><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>To get started, we&rsquo;ll need some data. Let&rsquo;s use the
<a href=https://googlesheets4.tidyverse.org/reference/gs4_examples.html target=_blank rel=noopener>gapminder</a> example Sheet built into
<a href=https://googlesheets4.tidyverse.org/ target=_blank rel=noopener>googlesheets4</a>. Because there are multiple worksheets (one for each continent), we&rsquo;ll use
<a href=https://purrr.tidyverse.org/reference/map.html target=_blank rel=noopener><code>map()</code></a> to apply
<a href=https://googlesheets4.tidyverse.org/reference/range_read.html target=_blank rel=noopener><code>read_sheet()</code></a><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> to each one, and get back a list of data frames.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=https://tidyverse.tidyverse.org>tidyverse</a></span><span class=o>)</span></span>
<span><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=https://googlesheets4.tidyverse.org>googlesheets4</a></span><span class=o>)</span></span></code></pre></div><div class=highlight></div><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>ss</span> <span class=o>&lt;-</span> <span class=nf><a href=https://googlesheets4.tidyverse.org/reference/gs4_examples.html>gs4_example</a></span><span class=o>(</span><span class=s>"gapminder"</span><span class=o>)</span> <span class=c># get sheet id</span></span>
<span><span class=nv>sheets</span> <span class=o>&lt;-</span> <span class=nf><a href=https://googlesheets4.tidyverse.org/reference/sheet_properties.html>sheet_names</a></span><span class=o>(</span><span class=nv>ss</span><span class=o>)</span> <span class=c># get the names of individual sheets</span></span>
<span><span class=nv>gap_dfs</span> <span class=o>&lt;-</span> <span class=nf><a href=https://purrr.tidyverse.org/reference/map.html>map</a></span><span class=o>(</span><span class=nv>sheets</span>, .f <span class=o>=</span> \<span class=o>(</span><span class=nv>x</span><span class=o>)</span> <span class=nf><a href=https://googlesheets4.tidyverse.org/reference/range_read.html>read_sheet</a></span><span class=o>(</span><span class=nv>ss</span>, sheet <span class=o>=</span> <span class=nv>x</span><span class=o>)</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#0b0>✔</span> Reading from <span style=color:#0bb>gapminder</span>.</span></span>
<span></span><span><span class=c>#&gt; <span style=color:#0b0>✔</span> Range '<span style=color:#bb0>'Africa'</span>'.</span></span>
<span></span><span><span class=c>#&gt; <span style=color:#0b0>✔</span> Reading from <span style=color:#0bb>gapminder</span>.</span></span>
<span></span><span><span class=c>#&gt; <span style=color:#0b0>✔</span> Range '<span style=color:#bb0>'Americas'</span>'.</span></span>
<span></span><span><span class=c>#&gt; <span style=color:#0b0>✔</span> Reading from <span style=color:#0bb>gapminder</span>.</span></span>
<span></span><span><span class=c>#&gt; <span style=color:#0b0>✔</span> Range '<span style=color:#bb0>'Asia'</span>'.</span></span>
<span></span><span><span class=c>#&gt; <span style=color:#0b0>✔</span> Reading from <span style=color:#0bb>gapminder</span>.</span></span>
<span></span><span><span class=c>#&gt; <span style=color:#0b0>✔</span> Range '<span style=color:#bb0>'Europe'</span>'.</span></span>
<span></span><span><span class=c>#&gt; <span style=color:#0b0>✔</span> Reading from <span style=color:#0bb>gapminder</span>.</span></span>
<span></span><span><span class=c>#&gt; <span style=color:#0b0>✔</span> Range '<span style=color:#bb0>'Oceania'</span>'.</span></span>
<span></span></code></pre></div><p>Note that the backslash syntax for anonymous functions (e.g. <code>\(x) x + 1</code>) was introduced in base R version 4.1.0 as a shorthand for <code>function(x) x + 1</code>. If you&rsquo;re using an earlier version of R, you can use purrr&rsquo;s shorthand: a formula (e.g. <code>~ .x + 1</code>).</p><p>Typically, you&rsquo;d want to combine these data frames into one to make it easier to work with your data. To do so, we&rsquo;ll use
<a href=https://purrr.tidyverse.org/reference/list_c.html target=_blank rel=noopener><code>list_rbind()</code></a> on <code>gap_dfs</code>. I&rsquo;ve kept the intermediary object, since we&rsquo;ll use it in a moment with
<a href=https://purrr.tidyverse.org/reference/map.html target=_blank rel=noopener><code>walk()</code></a>, but could have just as easily piped the output directly. The combination of
<a href=https://purrr.tidyverse.org/reference/map.html target=_blank rel=noopener><code>purrr::map()</code></a> and
<a href=https://purrr.tidyverse.org/reference/list_c.html target=_blank rel=noopener><code>list_rbind()</code></a> is a handy one that you can learn more about in the
<a href=https://r4ds.hadley.nz/iteration.html?#purrrmap-and-list_rbind target=_blank rel=noopener>R for Data Science</a>.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>gap_combined</span> <span class=o>&lt;-</span> <span class=nv>gap_dfs</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://purrr.tidyverse.org/reference/list_c.html>list_rbind</a></span><span class=o>(</span><span class=o>)</span></span></code></pre></div><p>Now let&rsquo;s say that, for whatever reason, you&rsquo;d like to save the data from these sheets as individual CSVs. This is where
<a href=https://purrr.tidyverse.org/reference/map.html target=_blank rel=noopener><code>walk()</code></a> comes into play&mdash;writing out the file with
<a href=https://readr.tidyverse.org/reference/write_delim.html target=_blank rel=noopener><code>write_csv()</code></a> is a &ldquo;side effect.&rdquo; We&rsquo;ll use
<a href=https://fs.r-lib.org/reference/create.html target=_blank rel=noopener><code>fs::dir_create()</code></a> to create a data folder to put our files into<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>, and build a vector of paths/file names. Since we have two arguments, the list of data frames, and the paths, we&rsquo;ll use
<a href=https://purrr.tidyverse.org/reference/map2.html target=_blank rel=noopener><code>walk2()</code></a>.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf>fs</span><span class=nf>::</span><span class=nf><a href=https://fs.r-lib.org/reference/create.html>dir_create</a></span><span class=o>(</span><span class=s>"data"</span><span class=o>)</span></span>
<span><span class=nv>paths</span> <span class=o>&lt;-</span> <span class=nf><a href=https://stringr.tidyverse.org/reference/str_glue.html>str_glue</a></span><span class=o>(</span><span class=s>"data/gapminder_&#123;tolower(sheets)&#125;.csv"</span><span class=o>)</span></span>
<span><span class=nf><a href=https://purrr.tidyverse.org/reference/map2.html>walk2</a></span><span class=o>(</span></span>
<span>  <span class=nv>gap_dfs</span>, </span>
<span>  <span class=nv>paths</span>,</span>
<span>  \<span class=o>(</span><span class=nv>df</span>, <span class=nv>name</span><span class=o>)</span> <span class=nf><a href=https://readr.tidyverse.org/reference/write_delim.html>write_csv</a></span><span class=o>(</span><span class=nv>df</span>, <span class=nv>name</span><span class=o>)</span></span>
<span>  <span class=o>)</span></span></code></pre></div><p>To see what we&rsquo;ve done, we can use
<a href=https://fs.r-lib.org/reference/dir_tree.html target=_blank rel=noopener><code>fs::dir_tree()</code></a> to see the contents of the directory as a tree, or
<a href=https://fs.r-lib.org/reference/dir_ls.html target=_blank rel=noopener><code>fs::dir_ls()</code></a> to return the paths as a vector. These functions also take <code>glob</code> and <code>regexp</code> arguments, allowing you to filter paths by file type with globbing patterns (e.g. <code>*.csv</code>) or using a regular expression passed on to
<a href=https://rdrr.io/r/base/grep.html target=_blank rel=noopener><code>grep()</code></a>.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf>fs</span><span class=nf>::</span><span class=nf><a href=https://fs.r-lib.org/reference/dir_tree.html>dir_tree</a></span><span class=o>(</span><span class=s>"data"</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#00b;font-weight:700>data</span></span></span>
<span><span class=c>#&gt; ├── gapminder_africa.csv</span></span>
<span><span class=c>#&gt; ├── gapminder_americas.csv</span></span>
<span><span class=c>#&gt; ├── gapminder_asia.csv</span></span>
<span><span class=c>#&gt; ├── gapminder_europe.csv</span></span>
<span><span class=c>#&gt; └── gapminder_oceania.csv</span></span>
<span></span><span><span class=nf>fs</span><span class=nf>::</span><span class=nf><a href=https://fs.r-lib.org/reference/dir_ls.html>dir_ls</a></span><span class=o>(</span><span class=s>"data"</span><span class=o>)</span></span>
<span><span class=c>#&gt; data/gapminder_africa.csv   data/gapminder_americas.csv </span></span>
<span><span class=c>#&gt; data/gapminder_asia.csv     data/gapminder_europe.csv   </span></span>
<span><span class=c>#&gt; data/gapminder_oceania.csv</span></span>
<span></span></code></pre></div><p>If you&rsquo;re having regrets, or want to return your example project to its previous state, it&rsquo;s just as easy to
<a href=https://purrr.tidyverse.org/reference/map.html target=_blank rel=noopener><code>walk()</code></a>
<a href=https://fs.r-lib.org/reference/delete.html target=_blank rel=noopener><code>fs::file_delete()</code></a> along those same paths.<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup></p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://purrr.tidyverse.org/reference/map.html>walk</a></span><span class=o>(</span><span class=nv>paths</span>, \<span class=o>(</span><span class=nv>paths</span><span class=o>)</span> <span class=nf>fs</span><span class=nf>::</span><span class=nf><a href=https://fs.r-lib.org/reference/delete.html>file_delete</a></span><span class=o>(</span><span class=nv>paths</span><span class=o>)</span><span class=o>)</span></span></code></pre></div><h2 id=saving-multiple-plots>Saving multiple plots
<a href=#saving-multiple-plots><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Now, let&rsquo;s say you want to create and save a bunch of plots. We&rsquo;ll use a modified version of the
<a href=https://r4ds.hadley.nz/functions.html#combining-with-other-tidyverse target=_blank rel=noopener><code>conditional_bars()</code></a><sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup> function from the R for Data Science chapter on writing
<a href=https://r4ds.hadley.nz/functions.html target=_blank rel=noopener>functions</a>, and the built-in
<a href=https://ggplot2.tidyverse.org/reference/diamonds.html target=_blank rel=noopener>diamonds</a> dataset.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=c># modified conditional bars function from R4DS</span></span>
<span><span class=nv>conditional_bars</span> <span class=o>&lt;-</span> <span class=kr>function</span><span class=o>(</span><span class=nv>df</span>, <span class=nv>condition</span>, <span class=nv>var</span><span class=o>)</span> <span class=o>&#123;</span></span>
<span>  <span class=nv>df</span> <span class=o>|&gt;</span></span>
<span>    <span class=nf><a href=https://dplyr.tidyverse.org/reference/filter.html>filter</a></span><span class=o>(</span><span class=o>&#123;</span><span class=o>&#123;</span> <span class=nv>condition</span> <span class=o>&#125;</span><span class=o>&#125;</span><span class=o>)</span> <span class=o>|&gt;</span></span>
<span>    <span class=nf><a href=https://ggplot2.tidyverse.org/reference/ggplot.html>ggplot</a></span><span class=o>(</span><span class=nf><a href=https://ggplot2.tidyverse.org/reference/aes.html>aes</a></span><span class=o>(</span>x <span class=o>=</span> <span class=o>&#123;</span><span class=o>&#123;</span> <span class=nv>var</span> <span class=o>&#125;</span><span class=o>&#125;</span><span class=o>)</span><span class=o>)</span> <span class=o>+</span></span>
<span>    <span class=nf><a href=https://ggplot2.tidyverse.org/reference/geom_bar.html>geom_bar</a></span><span class=o>(</span><span class=o>)</span> <span class=o>+</span></span>
<span>    <span class=nf><a href=https://ggplot2.tidyverse.org/reference/labs.html>ggtitle</a></span><span class=o>(</span><span class=nf>rlang</span><span class=nf>::</span><span class=nf><a href=https://rlang.r-lib.org/reference/englue.html>englue</a></span><span class=o>(</span><span class=s>"Count of diamonds by &#123;&#123;var&#125;&#125; where &#123;&#123;condition&#125;&#125;"</span><span class=o>)</span><span class=o>)</span></span>
<span><span class=o>&#125;</span></span></code></pre></div><p>It&rsquo;s easy enough to run this for one condition, for example for the diamonds with <code>cut == "Good"</code>.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>diamonds</span> <span class=o>|&gt;</span> <span class=nf>conditional_bars</span><span class=o>(</span><span class=nv>cut</span> <span class=o>==</span> <span class=s>"Good"</span>, <span class=nv>clarity</span><span class=o>)</span></span>
</code></pre><p><img src=figs/goodclarity-1.png alt="Bar chart showing count of diamonds by clarity in the diamonds dataset where the cut == Good." width=700px style=display:block;margin:auto></p></div><p>But what if we want to make and save a plot for each cut? Again, it&rsquo;s
<a href=https://purrr.tidyverse.org/reference/map.html target=_blank rel=noopener><code>map()</code></a> and
<a href=https://purrr.tidyverse.org/reference/map.html target=_blank rel=noopener><code>walk()</code></a> to the rescue.</p><p>Because we&rsquo;re using the same data (<code>diamonds</code>) and conditioning on the same variable (<code>cut</code>), we&rsquo;ll only need to
<a href=https://purrr.tidyverse.org/reference/map.html target=_blank rel=noopener><code>map()</code></a> across the levels of <code>cut</code>, and can hard code the rest into the anonymous function.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=c># get the levels</span></span>
<span><span class=nv>cuts</span> <span class=o>&lt;-</span> <span class=nf><a href=https://rdrr.io/r/base/levels.html>levels</a></span><span class=o>(</span><span class=nv>diamonds</span><span class=o>$</span><span class=nv>cut</span><span class=o>)</span></span>
<span></span>
<span><span class=c># make the plots</span></span>
<span><span class=nv>plots</span> <span class=o>&lt;-</span> <span class=nf><a href=https://purrr.tidyverse.org/reference/map.html>map</a></span><span class=o>(</span></span>
<span>  <span class=nv>cuts</span>,</span>
<span>  \<span class=o>(</span><span class=nv>x</span><span class=o>)</span> <span class=nf>conditional_bars</span><span class=o>(</span></span>
<span>    df <span class=o>=</span> <span class=nv>diamonds</span>,</span>
<span>    <span class=nv>cut</span> <span class=o>==</span> <span class=o>&#123;</span><span class=o>&#123;</span> <span class=nv>x</span> <span class=o>&#125;</span><span class=o>&#125;</span>,</span>
<span>    <span class=nv>clarity</span></span>
<span>    <span class=o>)</span></span>
<span><span class=o>)</span></span></code></pre></div><p>The plots are now saved in a list&mdash;a fine format for storing ggplots. As we did when saving our CSVs, we&rsquo;ll use fs to create a directory to store them in, and make a vector of paths for file names.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=c># make the folder to put them it (if exists, &#123;fs&#125; does nothing)</span></span>
<span><span class=nf>fs</span><span class=nf>::</span><span class=nf><a href=https://fs.r-lib.org/reference/create.html>dir_create</a></span><span class=o>(</span><span class=s>"plots"</span><span class=o>)</span></span>
<span><span class=c># make the file names</span></span>
<span><span class=nv>plot_paths</span> <span class=o>&lt;-</span> <span class=nf><a href=https://stringr.tidyverse.org/reference/str_glue.html>str_glue</a></span><span class=o>(</span><span class=s>"plots/&#123;tolower(cuts)&#125;_clarity.png"</span><span class=o>)</span></span></code></pre></div><p>Now we can use the paths and plots with
<a href=https://purrr.tidyverse.org/reference/map2.html target=_blank rel=noopener><code>walk2()</code></a> to pass them as arguments to
<a href=https://ggplot2.tidyverse.org/reference/ggsave.html target=_blank rel=noopener><code>ggsave()</code></a>.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://purrr.tidyverse.org/reference/map2.html>walk2</a></span><span class=o>(</span></span>
<span>  <span class=nv>plot_paths</span>,</span>
<span>  <span class=nv>plots</span>,</span>
<span>  \<span class=o>(</span><span class=nv>path</span>, <span class=nv>plot</span><span class=o>)</span> <span class=nf><a href=https://ggplot2.tidyverse.org/reference/ggsave.html>ggsave</a></span><span class=o>(</span><span class=nv>path</span>, <span class=nv>plot</span>, width <span class=o>=</span> <span class=m>6</span>, height <span class=o>=</span> <span class=m>6</span><span class=o>)</span></span>
<span><span class=o>)</span></span></code></pre></div><p>Again, we can use fs to see what we&rsquo;ve done:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf>fs</span><span class=nf>::</span><span class=nf><a href=https://fs.r-lib.org/reference/dir_tree.html>dir_tree</a></span><span class=o>(</span><span class=s>"plots"</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#00b;font-weight:700>plots</span></span></span>
<span><span class=c>#&gt; ├── <span style=color:#b0b;font-weight:700>fair_clarity.png</span></span></span>
<span><span class=c>#&gt; ├── <span style=color:#b0b;font-weight:700>good_clarity.png</span></span></span>
<span><span class=c>#&gt; ├── <span style=color:#b0b;font-weight:700>ideal_clarity.png</span></span></span>
<span><span class=c>#&gt; ├── <span style=color:#b0b;font-weight:700>premium_clarity.png</span></span></span>
<span><span class=c>#&gt; └── <span style=color:#b0b;font-weight:700>very good_clarity.png</span></span></span>
<span></span></code></pre></div><p>And, clean up after ourselves if we didn&rsquo;t <em>really</em> want those plots after all.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://purrr.tidyverse.org/reference/map.html>walk</a></span><span class=o>(</span><span class=nv>plot_paths</span>, \<span class=o>(</span><span class=nv>paths</span><span class=o>)</span> <span class=nf>fs</span><span class=nf>::</span><span class=nf><a href=https://fs.r-lib.org/reference/delete.html>file_delete</a></span><span class=o>(</span><span class=nv>paths</span><span class=o>)</span><span class=o>)</span></span></code></pre></div><h2 id=fin>Fin
<a href=#fin><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Hopefully this gave you a taste for some of what
<a href=https://purrr.tidyverse.org/reference/map.html target=_blank rel=noopener><code>walk()</code></a> can do. To learn more, see
<a href=https://r4ds.hadley.nz/iteration.html#saving-multiple-outputs target=_blank rel=noopener>Saving multiple outputs</a> in the Iteration chapter of R for Data Science.</p><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>See
<a href=https://googlesheets4.tidyverse.org/articles/googlesheets4.html target=_blank rel=noopener>Getting started with googlesheets4</a> to learn more about the basics of reading and writing sheets. <a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p>If the directory already exists, it will be left unchanged. <a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3 role=doc-endnote><p>There&rsquo;s also a function in fs called
<a href=https://fs.r-lib.org/reference/dir_ls.html target=_blank rel=noopener><code>dir_walk()</code></a>, which you can feel free to explore on your own. <a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4 role=doc-endnote><p>I&rsquo;ve added a title that reflects the variable name and condition with
<a href=https://rlang.r-lib.org/reference/englue.html target=_blank rel=noopener><code>rlang::englue()</code></a>, which you can learn more about in the
<a href=https://r4ds.hadley.nz/functions.html#labeling target=_blank rel=noopener>Labeling</a> section of the same R4DS chapter. <a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></div></div><div class=column25><div class="section hideOnMobile"><div class=sectionTitle>Contents</div><nav id=TableOfContents><ul><li><a href=#meet-the-map-family>Meet the <code>map()</code> family</a></li><li><a href=#whats-up-with-walk>What&rsquo;s up with <code>walk()</code>?</a></li><li><a href=#writing-and-deleting-multiple-csvs>Writing (and deleting) multiple CSVs</a></li><li><a href=#saving-multiple-plots>Saving multiple plots</a></li><li><a href=#fin>Fin</a></li></ul></nav></div><div class=section></div></div></div></div></div><div id=rStudioFooter class=band><div class=bandContent><div id=copyright>The tidyverse is proudly supported by <a class=rstudioLogo href=https://posit.co/ aria-label="Posit Homepage"></a></div><div id=logos><a href=https://www.tidyverse.org/google_privacy_policy>Privacy policy</a>
<a href=https://github.com/tidyverse class="footerLogo gitHub" aria-label="Tidyverse GitHub organization"></a><a href=https://twitter.com/hashtag/rstats class="footerLogo twitter" aria-label="rstats hashtag on twitter.com"></a></div></div></div></div></div><script src=/js/math-code.js></script><script type=text/x-mathjax-config>
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script><script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script type=application/javascript>var dnt=(navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack);var doNotTrack=(dnt=="1"||dnt=="yes");if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');if(window.sessionStorage){var GA_SESSION_STORAGE_KEY='ga:clientId';ga('create','UA-115082821-1',{'storage':'none','clientId':sessionStorage.getItem(GA_SESSION_STORAGE_KEY)});ga(function(tracker){sessionStorage.setItem(GA_SESSION_STORAGE_KEY,tracker.get('clientId'));});}
ga('set','anonymizeIp',true);ga('send','pageview');}</script></body></html></div></div></body></html>