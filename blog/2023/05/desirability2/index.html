<!doctype html><html><head><!doctype html><html lang=en-us><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/css/main-site.css><link rel=stylesheet href=/css/fa5-all.css><style type=text/css>body{background-color:#fff;color:#1a1917}a{color:#38577f}a:hover{color:#42709b}a:focus{outline-color:#42709b}.column25-left .sectionTitle a:hover:not(.current),.column16-left .sectionTitle a:hover:not(.current){color:#1a1917}.icon-attribution,.icon-attribution a{color:#1a1917;opacity:75%}#homeContent .band.first{background-color:#fff}#homeContent .band.second{background-color:#fdeba4}#homeContent .band.third{background-color:#fff}#rStudioHeader{background-color:#1a162d;color:#fff}#rStudioHeader .productName{color:#fff}#rStudioHeader .productName:hover,#rStudioHeader .productName:focus{color:#fdeba4}#rStudioHeader #menu .menuItem.a{background-color:#75aadb;color:#fff}#rStudioHeader #menu .menuItem:hover{background-color:#484557;color:#fff}#rStudioHeader #menu .menuItem.current{background-color:#fff;color:#1a162d;text-decoration:none}#rStudioFooter.band{background-color:#767381}#rStudioFooter .bandContent #copyright{color:#e3eef8}table tbody tr:nth-child(even){background-color:#f7faff}table tbody tr:nth-child(odd){background-color:#fff}.latest{border-top:.5em solid <no value>}.event{-moz-box-shadow:0 0 0 0 rgba(0,0,0,.1);-webkit-box-shadow:0 0 0 0 rgba(0,0,0,.1);box-shadow:0 0 0 0 rgba(0,0,0,.1)}.section .event{background-color:#eab0c41a}.section .event{border-top:7pt solid #a19ea936}.section .event a{color:#1a162d}.section .event{color:#404040}</style><link rel=stylesheet href=/css/tidyverse.css><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.71.1"><title>desirability2</title><meta property="og:title" content="desirability2"><meta property="og:description" content="The desirability2 package, for multivariable optimization, is now on CRAN."><meta property="og:type" content="article"><meta property="og:url" content="https://www.tidyverse.org/blog/2023/05/desirability2/"><meta property="twitter:card" content="summary_large_image"><meta property="og:title" content="desirability2 - Tidyverse"><meta property="description" content="The desirability2 package, for multivariable optimization, is now on CRAN."><meta property="og:description" content="The desirability2 package, for multivariable optimization, is now on CRAN."><meta property="og:image" content="https://www.tidyverse.org/blog/2023/05/desirability2/thumbnail-sq.jpg"><meta name=twitter:image content="https://www.tidyverse.org/blog/2023/05/desirability2/thumbnail-wd.jpg"><link rel=apple-touch-icon sizes=180x180 href=/images/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicons/favicon-16x16.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg><link rel="shortcut icon" href=/images/favicons/favicon.ico><meta name=msapplication-TileColor content="#da532c"><meta name=msapplication-config href=/images/favicons/browserconfig.xml><script type=text/javascript src=/js/jquery-3.5.1.min.js></script><script type=text/javascript src=/js/site.js></script><link rel=icon href=/images/favicon.ico><script type=text/javascript src=/js/clipboard.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin=anonymous></script><script defer data-domain=tidyverse.org,all.tidyverse.org src=https://plausible.io/js/plausible.js></script></head><body><div id=appTidyverseSite class="shrinkHeader alwaysShrinkHeader"><div id=main><div id=rStudioHeader><nav class=band><div class="innards bandContent"><div><a class=productName href=/%20/>Tidyverse</a></div><div id=menu><div id=menuToggler></div><div id=menuItems><a class=menuItem href=/packages/>Packages</a>
<a class="menuItem current" href=/blog/>Blog</a>
<a class=menuItem href=/learn/>Learn</a>
<a class=menuItem href=/help/>Help</a>
<a class=menuItem href=/contribute/>Contribute</a></div></div></div></nav></div><main><div class="band padForHeader pushFooter"><div class=bandContent><div class="full splitColumns withMobileMargins"><div class=column75><h1 class=article-title>desirability2</h1><div class=article-header aria-hidden=true><div class=photo><img src=/blog/2023/05/desirability2/thumbnail-wd.jpg></div><div class=photoCredit>Photo by <a href=https://unsplash.com/photos/8cvksz5mmnE>Joel Naren</a></div></div><span class=article-date><i class="fas fa-calendar-day fa-fw"></i>&nbsp;&nbsp;2023/05/17</span><p style=margin-bottom:.5em;margin-top:.85em><i class="fas fa-tags"></i>&nbsp;
<a href=/tags/tidymodels/>tidymodels</a>,
<a href=/tags/desirability/>desirability</a>,
<a href=/tags/optimization/>optimization</a></p><p style=margin-top:.5em><i class="fas fa-user-circle fa-fw"></i>&nbsp;
Max Kuhn</p><div class=article-content><p>We&rsquo;re tickled pink to announce the release of
<a href=http://desirability2.tidymodels.org target=_blank rel=noopener>desirability2</a> (version 0.0.1). You can install it from CRAN with:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>install.packages</span><span class=p>(</span><span class=s>&#34;desirability2&#34;</span><span class=p>)</span>
</code></pre></div><p>This blog post will introduce you to the package and desirability functions.</p><p>Let&rsquo;s load some packages!</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>library</span><span class=p>(</span><span class=n>desirability2</span><span class=p>)</span>
<span class=nf>library</span><span class=p>(</span><span class=n>dplyr</span><span class=p>)</span>
<span class=nf>library</span><span class=p>(</span><span class=n>ggplot2</span><span class=p>)</span>
</code></pre></div><p><a href="https://scholar.google.com/scholar?hl=en&as_sdt=0%2C7&q=%22desirability+functions%22" target=_blank rel=noopener>Desirability functions</a> are tools that can be used to rank or optimize multiple characteristics at once. They are intuitive and easy to use. There are a few R packages that implement them, including
<a href="http://cran.r-project.org/package=desirability" target=_blank rel=noopener>desirability</a> and
<a href="http://cran.r-project.org/package=desiR" target=_blank rel=noopener>desiR</a>.</p><p>We have a new one,
<a href="http://cran.r-project.org/package=desirability2" target=_blank rel=noopener>desirability2</a>, with an interface conducive to being used in-line via dplyr pipelines.</p><p>Let&rsquo;s demonstrate that by looking at an application. Suppose we created a classification model and produced multiple metrics on how well it classifies new data. We measured the area under the ROC curve and the binomial log-loss statistic in this example. There are about 300 different model configurations that we investigated via tuning.</p><p>The results from the tuning process were:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=n>classification_results</span>
</code></pre></div><pre><code>## # A tibble: 298 × 5
##    mixture penalty mn_log_loss roc_auc num_features
##      &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt;        &lt;int&gt;
##  1       0  0.1          0.199   0.869          211
##  2       0  0.0788       0.196   0.870          211
##  3       0  0.0621       0.194   0.871          211
##  4       0  0.0489       0.192   0.872          211
##  5       0  0.0386       0.191   0.873          211
##  6       0  0.0304       0.190   0.873          211
##  7       0  0.0240       0.188   0.874          211
##  8       0  0.0189       0.188   0.874          211
##  9       0  0.0149       0.187   0.874          211
## 10       0  0.0117       0.186   0.874          211
## # ℹ 288 more rows
</code></pre><p>If we were interested in the best area under the ROC curve:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=n>classification_results</span> <span class=o>|&gt;</span> <span class=nf>slice_max</span><span class=p>(</span><span class=n>roc_auc</span><span class=p>,</span> <span class=n>n</span> <span class=o>=</span> <span class=m>1</span><span class=p>)</span>
</code></pre></div><pre><code>## # A tibble: 1 × 5
##   mixture penalty mn_log_loss roc_auc num_features
##     &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt;        &lt;int&gt;
## 1   0.222 0.00574       0.185   0.876           86
</code></pre><p>However, there are different optimal settings when the log-likelihood is considered:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=n>classification_results</span> <span class=o>|&gt;</span> <span class=nf>slice_min</span><span class=p>(</span><span class=n>mn_log_loss</span><span class=p>,</span> <span class=n>n</span> <span class=o>=</span> <span class=m>1</span><span class=p>)</span>
</code></pre></div><pre><code>## # A tibble: 1 × 5
##   mixture  penalty mn_log_loss roc_auc num_features
##     &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt;        &lt;int&gt;
## 1       1 0.000853       0.184   0.876          103
</code></pre><p>Are the two metrics related? Here&rsquo;s a plot of the data:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=n>classification_results</span> <span class=o>|&gt;</span> 
  <span class=nf>ggplot</span><span class=p>(</span><span class=nf>aes</span><span class=p>(</span><span class=n>roc_auc</span><span class=p>,</span> <span class=n>mn_log_loss</span><span class=p>,</span> <span class=n>col</span> <span class=o>=</span> <span class=n>num_features</span><span class=p>))</span> <span class=o>+</span> 
  <span class=nf>geom_point</span><span class=p>(</span><span class=n>alpha</span> <span class=o>=</span> <span class=m>1</span><span class=o>/</span><span class=m>2</span><span class=p>)</span>
</code></pre></div><p><img src=figure/unnamed-chunk-7-1.svg alt="plot of chunk unnamed-chunk-7" width=60%></p><p>We colored the point using the number of features used in the model. Fewer predictors are better; we&rsquo;d like to factor that into the tuning parameter selection.</p><p>To optimize them all at once, desirability functions map their values to be between zero and one (with the latter being the most desirable). For the ROC scores, a value of 1.0 is best, and we may not consider a model with an AUC of less than 0.80. We can use desirability2&rsquo;s
<a href=http://desirability2.tidymodels.org/reference/inline_desirability.html target=_blank rel=noopener><code>d_max()</code></a> function to translate these values to desirability:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=n>classification_results</span> <span class=o>%&gt;%</span> 
  <span class=nf>mutate</span><span class=p>(</span><span class=n>roc_d</span> <span class=o>=</span> <span class=nf>d_max</span><span class=p>(</span><span class=n>roc_auc</span><span class=p>,</span> <span class=n>high</span> <span class=o>=</span> <span class=m>1</span><span class=p>,</span> <span class=n>low</span> <span class=o>=</span> <span class=m>0.8</span><span class=p>))</span> <span class=o>%&gt;%</span> 
  <span class=nf>ggplot</span><span class=p>(</span><span class=nf>aes</span><span class=p>(</span><span class=n>roc_auc</span><span class=p>,</span> <span class=n>roc_d</span><span class=p>))</span> <span class=o>+</span>
  <span class=nf>geom_line</span><span class=p>()</span> <span class=o>+</span> 
  <span class=nf>geom_point</span><span class=p>()</span> <span class=o>+</span> 
  <span class=nf>lims</span><span class=p>(</span><span class=n>y</span> <span class=o>=</span> <span class=m>0</span><span class=o>:</span><span class=m>1</span><span class=p>)</span>
</code></pre></div><p><img src=figure/unnamed-chunk-8-1.svg alt="plot of chunk unnamed-chunk-8" width=60%></p><p>Note that all model configurations with ROC AUC scores below 0.80 have zero desirability.</p><p>Since we want to reduce loss, we can use <code>d_min()</code> to show a curve where smaller is better. For this specification, we&rsquo;ll use the min and max values as defined by the data, by setting <code>use_data = TRUE</code>:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=n>classification_results</span> <span class=o>%&gt;%</span> 
  <span class=nf>mutate</span><span class=p>(</span>
    <span class=n>roc_d</span>   <span class=o>=</span> <span class=nf>d_max</span><span class=p>(</span><span class=n>roc_auc</span><span class=p>,</span> <span class=n>high</span> <span class=o>=</span> <span class=m>1</span><span class=p>,</span> <span class=n>low</span> <span class=o>=</span> <span class=m>0.8</span><span class=p>),</span>
    <span class=n>loss_d</span>  <span class=o>=</span> <span class=nf>d_min</span><span class=p>(</span><span class=n>mn_log_loss</span><span class=p>,</span> <span class=n>use_data</span> <span class=o>=</span> <span class=kc>TRUE</span><span class=p>)</span>
    <span class=p>)</span> <span class=o>%&gt;%</span> 
  <span class=nf>ggplot</span><span class=p>(</span><span class=nf>aes</span><span class=p>(</span><span class=n>mn_log_loss</span><span class=p>,</span> <span class=n>loss_d</span><span class=p>))</span> <span class=o>+</span>
  <span class=nf>geom_line</span><span class=p>()</span> <span class=o>+</span> 
  <span class=nf>geom_point</span><span class=p>()</span> <span class=o>+</span> 
  <span class=nf>lims</span><span class=p>(</span><span class=n>y</span> <span class=o>=</span> <span class=m>0</span><span class=o>:</span><span class=m>1</span><span class=p>)</span>
</code></pre></div><p><img src=figure/unnamed-chunk-9-1.svg alt="plot of chunk unnamed-chunk-9" width=60%></p><p>Finally, we can factor in the number of features. Arguably this is more important to use than the other two outcomes; we will make this curve nonlinear so that it becomes more challenging to be desirable as the number of features increases. For this, we&rsquo;ll use the <code>scale</code> option to <code>d_min()</code>, where larger values make the criteria more difficult to satisfy:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=n>classification_results</span> <span class=o>%&gt;%</span> 
  <span class=nf>mutate</span><span class=p>(</span>
    <span class=n>roc_d</span>   <span class=o>=</span> <span class=nf>d_max</span><span class=p>(</span><span class=n>roc_auc</span><span class=p>,</span> <span class=n>high</span> <span class=o>=</span> <span class=m>1</span><span class=p>,</span> <span class=n>low</span> <span class=o>=</span> <span class=m>0.8</span><span class=p>),</span>
    <span class=n>loss_d</span>  <span class=o>=</span> <span class=nf>d_min</span><span class=p>(</span><span class=n>mn_log_loss</span><span class=p>,</span> <span class=n>use_data</span> <span class=o>=</span> <span class=kc>TRUE</span><span class=p>),</span>
    <span class=n>feat_d</span>  <span class=o>=</span> <span class=nf>d_min</span><span class=p>(</span><span class=n>num_features</span><span class=p>,</span> <span class=n>low</span> <span class=o>=</span> <span class=m>0</span><span class=p>,</span> <span class=n>high</span> <span class=o>=</span> <span class=m>100</span><span class=p>,</span> <span class=n>scale</span> <span class=o>=</span> <span class=m>2</span><span class=p>)</span>
    <span class=p>)</span> <span class=o>%&gt;%</span> 
  <span class=nf>ggplot</span><span class=p>(</span><span class=nf>aes</span><span class=p>(</span><span class=n>num_features</span><span class=p>,</span> <span class=n>feat_d</span><span class=p>))</span> <span class=o>+</span>
  <span class=nf>geom_line</span><span class=p>()</span> <span class=o>+</span> 
  <span class=nf>geom_point</span><span class=p>()</span> <span class=o>+</span> 
  <span class=nf>lims</span><span class=p>(</span><span class=n>y</span> <span class=o>=</span> <span class=m>0</span><span class=o>:</span><span class=m>1</span><span class=p>)</span>
</code></pre></div><p><img src=figure/unnamed-chunk-10-1.svg alt="plot of chunk unnamed-chunk-10" width=60%></p><p>Combining these components into a single criterion using the geometric mean is common. Using this statistic has the side effect that any criteria with zero desirability make the overall desirability zero (since the geometric mean multiples the values). There is a function called
<a href=http://desirability2.tidymodels.org/reference/d_overall.html target=_blank rel=noopener><code>d_overall()</code></a> that can be used with dplyr&rsquo;s <code>across()</code> function. Sorting by overall desirability gives us tuning parameter values (<code>mixture</code> and <code>penalty</code>) that are best for this combination of criteria.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=n>classification_results</span> <span class=o>%&gt;%</span> 
  <span class=nf>mutate</span><span class=p>(</span>
    <span class=n>roc_d</span>   <span class=o>=</span> <span class=nf>d_max</span><span class=p>(</span><span class=n>roc_auc</span><span class=p>,</span> <span class=n>high</span> <span class=o>=</span> <span class=m>1</span><span class=p>,</span> <span class=n>low</span> <span class=o>=</span> <span class=m>0.8</span><span class=p>),</span>
    <span class=n>loss_d</span>  <span class=o>=</span> <span class=nf>d_min</span><span class=p>(</span><span class=n>mn_log_loss</span><span class=p>,</span> <span class=n>use_data</span> <span class=o>=</span> <span class=kc>TRUE</span><span class=p>),</span>
    <span class=n>feat_d</span>  <span class=o>=</span> <span class=nf>d_min</span><span class=p>(</span><span class=n>num_features</span><span class=p>,</span> <span class=n>low</span> <span class=o>=</span> <span class=m>0</span><span class=p>,</span> <span class=n>high</span> <span class=o>=</span> <span class=m>100</span><span class=p>,</span> <span class=n>scale</span> <span class=o>=</span> <span class=m>2</span><span class=p>),</span>
    <span class=n>overall</span> <span class=o>=</span> <span class=nf>d_overall</span><span class=p>(</span><span class=nf>across</span><span class=p>(</span><span class=nf>ends_with</span><span class=p>(</span><span class=s>&#34;_d&#34;</span><span class=p>)))</span>
  <span class=p>)</span> <span class=o>%&gt;%</span> 
  <span class=nf>slice_max</span><span class=p>(</span><span class=n>overall</span><span class=p>,</span> <span class=n>n</span> <span class=o>=</span> <span class=m>5</span><span class=p>)</span>
</code></pre></div><pre><code>## # A tibble: 5 × 9
##   mixture penalty mn_log_loss roc_auc num_features roc_d loss_d feat_d overall
##     &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt;        &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1   1     0.00924       0.200   0.859           15 0.295  0.815  0.722   0.558
## 2   0.667 0.0117        0.199   0.862           18 0.311  0.827  0.672   0.557
## 3   0.667 0.0149        0.201   0.858           14 0.291  0.802  0.740   0.557
## 4   0.889 0.00924       0.199   0.861           18 0.305  0.825  0.672   0.553
## 5   0.889 0.0117        0.201   0.857           14 0.285  0.801  0.740   0.553
</code></pre><p>That&rsquo;s it! That&rsquo;s the package.</p></div></div><div class=column25><div class="section hideOnMobile"></div><div class=section></div></div></div></div></div><div id=rStudioFooter class=band><div class=bandContent><div id=copyright>The tidyverse is proudly supported by <a class=rstudioLogo href=https://posit.co/ aria-label="Posit Homepage"></a></div><div id=logos><a href=https://www.tidyverse.org/google_privacy_policy>Privacy policy</a>
<a href=https://github.com/tidyverse class="footerLogo gitHub" aria-label="Tidyverse GitHub organization"></a><a href=https://twitter.com/hashtag/rstats class="footerLogo twitter" aria-label="rstats hashtag on twitter.com"></a></div></div></div></div></div><script type=application/javascript>var dnt=(navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack);var doNotTrack=(dnt=="1"||dnt=="yes");if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');if(window.sessionStorage){var GA_SESSION_STORAGE_KEY='ga:clientId';ga('create','UA-115082821-1',{'storage':'none','clientId':sessionStorage.getItem(GA_SESSION_STORAGE_KEY)});ga(function(tracker){sessionStorage.setItem(GA_SESSION_STORAGE_KEY,tracker.get('clientId'));});}
ga('set','anonymizeIp',true);ga('send','pageview');}</script></body></html></div></div></body></html>