<!doctype html><html><head><!doctype html><html lang=en-us><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/css/main-site.css><link rel=stylesheet href=/css/fa5-all.css><style type=text/css>body{background-color:#fff;color:#1a1917}a{color:#38577f}a:hover{color:#42709b}a:focus{outline-color:#42709b}.column25-left .sectionTitle a:hover:not(.current),.column16-left .sectionTitle a:hover:not(.current){color:#1a1917}.icon-attribution,.icon-attribution a{color:#1a1917;opacity:75%}#homeContent .band.first{background-color:#fff}#homeContent .band.second{background-color:#fdeba4}#homeContent .band.third{background-color:#fff}#rStudioHeader{background-color:#1a162d;color:#fff}#rStudioHeader .productName{color:#fff}#rStudioHeader .productName:hover,#rStudioHeader .productName:focus{color:#fdeba4}#rStudioHeader #menu .menuItem.a{background-color:#75aadb;color:#fff}#rStudioHeader #menu .menuItem:hover{background-color:#484557;color:#fff}#rStudioHeader #menu .menuItem.current{background-color:#fff;color:#1a162d;text-decoration:none}#rStudioFooter.band{background-color:#767381}#rStudioFooter .bandContent #copyright{color:#e3eef8}table tbody tr:nth-child(even){background-color:#f7faff}table tbody tr:nth-child(odd){background-color:#fff}.latest{border-top:.5em solid <no value>}.event{-moz-box-shadow:0 0 0 0 rgba(0,0,0,.1);-webkit-box-shadow:0 0 0 0 rgba(0,0,0,.1);box-shadow:0 0 0 0 rgba(0,0,0,.1)}.section .event{background-color:#eab0c41a}.section .event{border-top:7pt solid #a19ea936}.section .event a{color:#1a162d}.section .event{color:#404040}</style><link rel=stylesheet href=/css/tidyverse.css><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.71.1"><title>dplyr 1.1.0: Per-operation grouping</title><meta property="og:title" content="dplyr 1.1.0: Per-operation grouping"><meta property="og:description" content="dplyr now supports an experimental per-operation grouping syntax. This serves as an alternative to `group_by()` and always returns an ungrouped data frame, meaning that you never need to remember to `ungroup()`."><meta property="og:type" content="article"><meta property="og:url" content="https://www.tidyverse.org/blog/2023/02/dplyr-1-1-0-per-operation-grouping/"><meta property="twitter:card" content="summary_large_image"><meta property="og:title" content="dplyr 1.1.0: Per-operation grouping - Tidyverse"><meta property="description" content="dplyr now supports an experimental per-operation grouping syntax. This serves as an alternative to `group_by()` and always returns an ungrouped data frame, meaning that you never need to remember to `ungroup()`."><meta property="og:description" content="dplyr now supports an experimental per-operation grouping syntax. This serves as an alternative to `group_by()` and always returns an ungrouped data frame, meaning that you never need to remember to `ungroup()`."><meta property="og:image" content="https://www.tidyverse.org/blog/2023/02/dplyr-1-1-0-per-operation-grouping/thumbnail-sq.jpg"><meta name=twitter:image content="https://www.tidyverse.org/blog/2023/02/dplyr-1-1-0-per-operation-grouping/thumbnail-wd.jpg"><link rel=apple-touch-icon sizes=180x180 href=/images/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicons/favicon-16x16.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg><link rel="shortcut icon" href=/images/favicons/favicon.ico><meta name=msapplication-TileColor content="#da532c"><meta name=msapplication-config href=/images/favicons/browserconfig.xml><script type=text/javascript src=/js/jquery-3.5.1.min.js></script><script type=text/javascript src=/js/site.js></script><link rel=icon href=/images/favicon.ico><script type=text/javascript src=/js/clipboard.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin=anonymous></script><script defer data-domain=tidyverse.org,all.tidyverse.org src=https://plausible.io/js/plausible.js></script></head><body><div id=appTidyverseSite class="shrinkHeader alwaysShrinkHeader"><div id=main><div id=rStudioHeader><nav class=band><div class="innards bandContent"><div><a class=productName href=/%20/>Tidyverse</a></div><div id=menu><div id=menuToggler></div><div id=menuItems><a class=menuItem href=/packages/>Packages</a>
<a class="menuItem current" href=/blog/>Blog</a>
<a class=menuItem href=/learn/>Learn</a>
<a class=menuItem href=/help/>Help</a>
<a class=menuItem href=/contribute/>Contribute</a></div></div></div></nav></div><main><div class="band padForHeader pushFooter"><div class=bandContent><div class="full splitColumns withMobileMargins"><div class=column75><h1 class=article-title>dplyr 1.1.0: Per-operation grouping</h1><div class=article-header aria-hidden=true><div class=photo><img src=/blog/2023/02/dplyr-1-1-0-per-operation-grouping/thumbnail-wd.jpg></div><div class=photoCredit>Photo by <a href=https://www.pexels.com/photo/fruit-stand-375897/>Clem Onojeghuo</a></div></div><span class=article-date><i class="fas fa-calendar-day fa-fw"></i>&nbsp;&nbsp;2023/02/01</span><p style=margin-bottom:.5em;margin-top:.85em><i class="fas fa-tags"></i>&nbsp;
<a href=/tags/dplyr/>dplyr</a>,
<a href=/tags/dplyr-1-1-0/>dplyr-1-1-0</a></p><p style=margin-top:.5em><i class="fas fa-user-circle fa-fw"></i>&nbsp;
Davis Vaughan</p><div class=article-content><p>Today we are going to look at one of the major new features in
<a href=https://dplyr.tidyverse.org/news/index.html#dplyr-110 target=_blank rel=noopener>dplyr 1.1.0</a>, per-operation grouping with
<a href=https://dplyr.tidyverse.org/reference/dplyr_by.html target=_blank rel=noopener><code>.by</code>/<code>by</code></a>. Per-operation grouping is an experimental alternative to
<a href=https://dplyr.tidyverse.org/reference/group_by.html target=_blank rel=noopener><code>group_by()</code></a> which is only active within a single dplyr verb. This is another of the new dplyr features that was inspired by
<a href=https://cran.r-project.org/web/packages/data.table/index.html target=_blank rel=noopener>data.table</a>, this time by their own grouping syntax with <code>by</code>.</p><p>To see the other blog posts in this series, head
<a href=https://www.tidyverse.org/tags/dplyr-1-1-0/ target=_blank rel=noopener>here</a>.</p><p>You can install it from CRAN with:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://rdrr.io/r/utils/install.packages.html>install.packages</a></span><span class=o>(</span><span class=s>"dplyr"</span><span class=o>)</span></span></code></pre></div><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=https://dplyr.tidyverse.org>dplyr</a></span><span class=o>)</span></span></code></pre></div><h2 id=persistent-grouping-with-group_by>Persistent grouping with <code>group_by()</code>
<a href=#persistent-grouping-with-group_by><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>In dplyr, grouping radically affects the computation of the verb that you use it with. Since the very beginning of dplyr, you&rsquo;ve been able to perform grouped operations by modifying your data frame with
<a href=https://dplyr.tidyverse.org/reference/group_by.html target=_blank rel=noopener><code>group_by()</code></a>. This grouping is <em>persistent</em>, meaning that it typically sticks around in some form for more than one operation. As an example, take a look at this <code>transactions</code> dataset which tracks revenue brought in from various transactions across multiple companies. If we wanted to add a column for the total yearly revenue per company, we might do:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>transactions</span> <span class=o>&lt;-</span> <span class=nf><a href=https://tibble.tidyverse.org/reference/tibble.html>tibble</a></span><span class=o>(</span></span>
<span>  company <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=s>"A"</span>, <span class=s>"A"</span>, <span class=s>"A"</span>, <span class=s>"B"</span>, <span class=s>"B"</span>, <span class=s>"B"</span><span class=o>)</span>,</span>
<span>  year <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=m>2019</span>, <span class=m>2019</span>, <span class=m>2020</span>, <span class=m>2021</span>, <span class=m>2023</span>, <span class=m>2023</span><span class=o>)</span>,</span>
<span>  revenue <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=m>20</span>, <span class=m>50</span>, <span class=m>4</span>, <span class=m>10</span>, <span class=m>12</span>, <span class=m>18</span><span class=o>)</span></span>
<span><span class=o>)</span></span>
<span></span>
<span><span class=nv>transactions</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 6 Ã— 3</span></span></span>
<span><span class=c>#&gt;   company  year revenue</span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;chr&gt;</span>   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span>   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span> A        <span style=text-decoration:underline>2</span>019      20</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span> A        <span style=text-decoration:underline>2</span>019      50</span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span> A        <span style=text-decoration:underline>2</span>020       4</span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span> B        <span style=text-decoration:underline>2</span>021      10</span></span>
<span><span class=c>#&gt; <span style=color:#555>5</span> B        <span style=text-decoration:underline>2</span>023      12</span></span>
<span><span class=c>#&gt; <span style=color:#555>6</span> B        <span style=text-decoration:underline>2</span>023      18</span></span>
<span></span></code></pre></div><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>transactions</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://dplyr.tidyverse.org/reference/group_by.html>group_by</a></span><span class=o>(</span><span class=nv>company</span>, <span class=nv>year</span><span class=o>)</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://dplyr.tidyverse.org/reference/mutate.html>mutate</a></span><span class=o>(</span>total <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/sum.html>sum</a></span><span class=o>(</span><span class=nv>revenue</span><span class=o>)</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 6 Ã— 4</span></span></span>
<span><span class=c>#&gt; <span style=color:#555># Groups:   company, year [4]</span></span></span>
<span><span class=c>#&gt;   company  year revenue total</span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;chr&gt;</span>   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span>   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span> A        <span style=text-decoration:underline>2</span>019      20    70</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span> A        <span style=text-decoration:underline>2</span>019      50    70</span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span> A        <span style=text-decoration:underline>2</span>020       4     4</span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span> B        <span style=text-decoration:underline>2</span>021      10    10</span></span>
<span><span class=c>#&gt; <span style=color:#555>5</span> B        <span style=text-decoration:underline>2</span>023      12    30</span></span>
<span><span class=c>#&gt; <span style=color:#555>6</span> B        <span style=text-decoration:underline>2</span>023      18    30</span></span>
<span></span></code></pre></div><p>Notice that the result is still grouped by both <code>company</code> and <code>year</code>. This is useful if you need to follow up with additional grouped operations (with the exact same grouping columns), but many people follow this
<a href=https://dplyr.tidyverse.org/reference/mutate.html target=_blank rel=noopener><code>mutate()</code></a> with an
<a href=https://dplyr.tidyverse.org/reference/group_by.html target=_blank rel=noopener><code>ungroup()</code></a>.</p><p>If we only need the totals, we could also use
<a href=https://dplyr.tidyverse.org/reference/summarise.html target=_blank rel=noopener><code>summarise()</code></a>, which peels off 1 layer of grouping by default:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>transactions</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://dplyr.tidyverse.org/reference/group_by.html>group_by</a></span><span class=o>(</span><span class=nv>company</span>, <span class=nv>year</span><span class=o>)</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://dplyr.tidyverse.org/reference/summarise.html>summarise</a></span><span class=o>(</span>total <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/sum.html>sum</a></span><span class=o>(</span><span class=nv>revenue</span><span class=o>)</span><span class=o>)</span></span>
<span><span class=c>#&gt; `summarise()` has grouped output by 'company'. You can override using the</span></span>
<span><span class=c>#&gt; `.groups` argument.</span></span>
<span></span><span><span class=c>#&gt; <span style=color:#555># A tibble: 4 Ã— 3</span></span></span>
<span><span class=c>#&gt; <span style=color:#555># Groups:   company [2]</span></span></span>
<span><span class=c>#&gt;   company  year total</span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;chr&gt;</span>   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span> A        <span style=text-decoration:underline>2</span>019    70</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span> A        <span style=text-decoration:underline>2</span>020     4</span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span> B        <span style=text-decoration:underline>2</span>021    10</span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span> B        <span style=text-decoration:underline>2</span>023    30</span></span>
<span></span></code></pre></div><p>Here the grouping of the output isn&rsquo;t exactly the same as the input, but we still consider this persistent grouping because some of the groups outlive the verb they were used with.</p><h2 id=per-operation-grouping-with-byby>Per-operation grouping with <code>.by</code>/<code>by</code>
<a href=#per-operation-grouping-with-byby><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>In dplyr 1.1.0, we&rsquo;ve added an alternative to
<a href=https://dplyr.tidyverse.org/reference/group_by.html target=_blank rel=noopener><code>group_by()</code></a> known as
<a href=https://dplyr.tidyverse.org/reference/dplyr_by.html target=_blank rel=noopener><code>.by</code></a> that introduces the idea of <em>per-operation</em> grouping:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>transactions</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://dplyr.tidyverse.org/reference/mutate.html>mutate</a></span><span class=o>(</span>total <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/sum.html>sum</a></span><span class=o>(</span><span class=nv>revenue</span><span class=o>)</span>, .by <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=nv>company</span>, <span class=nv>year</span><span class=o>)</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 6 Ã— 4</span></span></span>
<span><span class=c>#&gt;   company  year revenue total</span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;chr&gt;</span>   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span>   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span> A        <span style=text-decoration:underline>2</span>019      20    70</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span> A        <span style=text-decoration:underline>2</span>019      50    70</span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span> A        <span style=text-decoration:underline>2</span>020       4     4</span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span> B        <span style=text-decoration:underline>2</span>021      10    10</span></span>
<span><span class=c>#&gt; <span style=color:#555>5</span> B        <span style=text-decoration:underline>2</span>023      12    30</span></span>
<span><span class=c>#&gt; <span style=color:#555>6</span> B        <span style=text-decoration:underline>2</span>023      18    30</span></span>
<span></span><span></span>
<span><span class=nv>transactions</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://dplyr.tidyverse.org/reference/summarise.html>summarise</a></span><span class=o>(</span>total <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/sum.html>sum</a></span><span class=o>(</span><span class=nv>revenue</span><span class=o>)</span>, .by <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=nv>company</span>, <span class=nv>year</span><span class=o>)</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 4 Ã— 3</span></span></span>
<span><span class=c>#&gt;   company  year total</span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;chr&gt;</span>   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span> A        <span style=text-decoration:underline>2</span>019    70</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span> A        <span style=text-decoration:underline>2</span>020     4</span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span> B        <span style=text-decoration:underline>2</span>021    10</span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span> B        <span style=text-decoration:underline>2</span>023    30</span></span>
<span></span></code></pre></div><p>There are a few things about <code>.by</code> worth noting:</p><ul><li><p>The result is always ungrouped, regardless of the number of grouping columns. With <code>.by</code>, you never need to remember to call
<a href=https://dplyr.tidyverse.org/reference/group_by.html target=_blank rel=noopener><code>ungroup()</code></a>.</p></li><li><p>We used
<a href=https://tidyselect.r-lib.org/reference/language.html target=_blank rel=noopener>tidyselect</a> to group by multiple columns.</p></li><li><p><a href=https://dplyr.tidyverse.org/reference/summarise.html target=_blank rel=noopener><code>summarise()</code></a> didn&rsquo;t emit a message about regrouping.</p></li></ul><p>One of the things we like about <code>.by</code> is that it allows you to place the grouping specification alongside the code that uses it, rather than in a separate
<a href=https://dplyr.tidyverse.org/reference/group_by.html target=_blank rel=noopener><code>group_by()</code></a> line. This idea was inspired by data.table&rsquo;s grouping syntax, which looks like:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>transactions</span><span class=o>[</span>, <span class=nf>.</span><span class=o>(</span>total <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/sum.html>sum</a></span><span class=o>(</span><span class=nv>revenue</span><span class=o>)</span><span class=o>)</span>, by <span class=o>=</span> <span class=nf>.</span><span class=o>(</span><span class=nv>company</span>, <span class=nv>year</span><span class=o>)</span><span class=o>]</span></span></code></pre></div><p>To see a complete list of dplyr verbs that support <code>.by</code>, look
<a href=https://dplyr.tidyverse.org/reference/dplyr_by.html#supported-verbs target=_blank rel=noopener>here</a>.</p><h3 id=by-or-by><code>.by</code> or <code>by</code>?
<a href=#by-or-by><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>As you use per-operation grouping in dplyr, you&rsquo;ll likely notice that some verbs use <code>.by</code> and others use <code>by</code>, for example:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>transactions</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://dplyr.tidyverse.org/reference/slice.html>slice_max</a></span><span class=o>(</span><span class=nv>revenue</span>, n <span class=o>=</span> <span class=m>2</span>, by <span class=o>=</span> <span class=nv>company</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 4 Ã— 3</span></span></span>
<span><span class=c>#&gt;   company  year revenue</span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;chr&gt;</span>   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span>   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span> A        <span style=text-decoration:underline>2</span>019      50</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span> A        <span style=text-decoration:underline>2</span>019      20</span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span> B        <span style=text-decoration:underline>2</span>023      18</span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span> B        <span style=text-decoration:underline>2</span>023      12</span></span>
<span></span></code></pre></div><p>This is a technical difference resulting from the fact that some verbs consistently use a <code>.</code> prefix for their arguments, and others don&rsquo;t (see our design notes on the
<a href=https://design.tidyverse.org/dots-prefix.html target=_blank rel=noopener>dot prefix</a> for more details). Most dplyr verbs use <code>.by</code>, and we&rsquo;ve tried to ensure that the cases that are most likely to result in typos instead generate an informative error:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=c># Uses `by` to be consistent with `n` and `prop`</span></span>
<span><span class=nv>transactions</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://dplyr.tidyverse.org/reference/slice.html>slice_max</a></span><span class=o>(</span><span class=nv>revenue</span>, n <span class=o>=</span> <span class=m>2</span>, .by <span class=o>=</span> <span class=nv>company</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#bb0;font-weight:700>Error</span><span style=font-weight:700> in `slice_max()`:</span></span></span>
<span><span class=c>#&gt; <span style=color:#bb0>!</span> Can't specify an argument named `.by` in this verb.</span></span>
<span><span class=c>#&gt; <span style=color:#0bb>â„¹</span> Did you mean to use `by` instead?</span></span>
<span></span><span></span>
<span><span class=c># Uses `.by` to be consistent with `.preserve`</span></span>
<span><span class=nv>transactions</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://dplyr.tidyverse.org/reference/slice.html>slice</a></span><span class=o>(</span><span class=nv>revenue</span>, by <span class=o>=</span> <span class=nv>company</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#bb0;font-weight:700>Error</span><span style=font-weight:700> in `slice()`:</span></span></span>
<span><span class=c>#&gt; <span style=color:#bb0>!</span> Can't specify an argument named `by` in this verb.</span></span>
<span><span class=c>#&gt; <span style=color:#0bb>â„¹</span> Did you mean to use `.by` instead?</span></span>
<span></span></code></pre></div><h3 id=translating-from-group_by>Translating from <code>group_by()</code>
<a href=#translating-from-group_by><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>You shouldn&rsquo;t feel pressured to translate existing code using
<a href=https://dplyr.tidyverse.org/reference/group_by.html target=_blank rel=noopener><code>group_by()</code></a> to use <code>.by</code> instead.
<a href=https://dplyr.tidyverse.org/reference/group_by.html target=_blank rel=noopener><code>group_by()</code></a> won&rsquo;t ever disappear, and is not currently being superseded.</p><p>That said, if you do want to start using <code>.by</code>, there are a few differences from
<a href=https://dplyr.tidyverse.org/reference/group_by.html target=_blank rel=noopener><code>group_by()</code></a> to be aware of.</p><ul><li><p><code>.by</code> always returns an ungrouped data frame. This is one of the main reasons to use <code>.by</code>, but is worth keeping in mind if you have existing code that takes advantage of persistent grouping from
<a href=https://dplyr.tidyverse.org/reference/group_by.html target=_blank rel=noopener><code>group_by()</code></a>.</p></li><li><p><code>.by</code> uses tidy-selection.
<a href=https://dplyr.tidyverse.org/reference/group_by.html target=_blank rel=noopener><code>group_by()</code></a>, on the other hand, works more like
<a href=https://dplyr.tidyverse.org/reference/mutate.html target=_blank rel=noopener><code>mutate()</code></a> in that it allows you to create grouping columns on the fly, i.e.Â <code>df |> group_by(month = floor_date(date, "month"))</code>. With <code>.by</code>, you must create your grouping columns ahead of time. An added benefit of <code>.by</code>'s usage of tidy-selection is that you can supply an external character vector of grouping variables using <code>.by = all_of(groups_vec)</code>.</p></li><li><p><code>.by</code> doesn&rsquo;t sort grouping keys.
<a href=https://dplyr.tidyverse.org/reference/group_by.html target=_blank rel=noopener><code>group_by()</code></a> always sorts keys in ascending order, which affects the results of verbs like
<a href=https://dplyr.tidyverse.org/reference/summarise.html target=_blank rel=noopener><code>summarise()</code></a>.</p></li></ul><p>The last point might seem strange, but consider what happens if we preferred our transactions data in order by descending year so that the most recent transactions are at the top.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>transactions2</span> <span class=o>&lt;-</span> <span class=nv>transactions</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://dplyr.tidyverse.org/reference/arrange.html>arrange</a></span><span class=o>(</span><span class=nv>company</span>, <span class=nf><a href=https://dplyr.tidyverse.org/reference/desc.html>desc</a></span><span class=o>(</span><span class=nv>year</span><span class=o>)</span><span class=o>)</span></span>
<span></span>
<span><span class=nv>transactions2</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 6 Ã— 3</span></span></span>
<span><span class=c>#&gt;   company  year revenue</span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;chr&gt;</span>   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span>   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span> A        <span style=text-decoration:underline>2</span>020       4</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span> A        <span style=text-decoration:underline>2</span>019      20</span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span> A        <span style=text-decoration:underline>2</span>019      50</span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span> B        <span style=text-decoration:underline>2</span>023      12</span></span>
<span><span class=c>#&gt; <span style=color:#555>5</span> B        <span style=text-decoration:underline>2</span>023      18</span></span>
<span><span class=c>#&gt; <span style=color:#555>6</span> B        <span style=text-decoration:underline>2</span>021      10</span></span>
<span></span></code></pre></div><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=c># Note that `group_by()` re-ordered</span></span>
<span><span class=nv>transactions2</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://dplyr.tidyverse.org/reference/group_by.html>group_by</a></span><span class=o>(</span><span class=nv>company</span>, <span class=nv>year</span><span class=o>)</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://dplyr.tidyverse.org/reference/summarise.html>summarise</a></span><span class=o>(</span>total <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/sum.html>sum</a></span><span class=o>(</span><span class=nv>revenue</span><span class=o>)</span>, .groups <span class=o>=</span> <span class=s>"drop"</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 4 Ã— 3</span></span></span>
<span><span class=c>#&gt;   company  year total</span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;chr&gt;</span>   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span> A        <span style=text-decoration:underline>2</span>019    70</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span> A        <span style=text-decoration:underline>2</span>020     4</span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span> B        <span style=text-decoration:underline>2</span>021    10</span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span> B        <span style=text-decoration:underline>2</span>023    30</span></span>
<span></span><span></span>
<span><span class=c># But `.by` used whatever order was already there</span></span>
<span><span class=nv>transactions2</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://dplyr.tidyverse.org/reference/summarise.html>summarise</a></span><span class=o>(</span>total <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/sum.html>sum</a></span><span class=o>(</span><span class=nv>revenue</span><span class=o>)</span>, .by <span class=o>=</span> <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=nv>company</span>, <span class=nv>year</span><span class=o>)</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 4 Ã— 3</span></span></span>
<span><span class=c>#&gt;   company  year total</span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;chr&gt;</span>   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span> A        <span style=text-decoration:underline>2</span>020     4</span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span> A        <span style=text-decoration:underline>2</span>019    70</span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span> B        <span style=text-decoration:underline>2</span>023    30</span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span> B        <span style=text-decoration:underline>2</span>021    10</span></span>
<span></span></code></pre></div><p>Notice that <code>.by</code> doesn&rsquo;t re-sort the grouping keys. Instead, the previous call to
<a href=https://dplyr.tidyverse.org/reference/arrange.html target=_blank rel=noopener><code>arrange()</code></a> is &ldquo;respected&rdquo; in the summary (this is also useful in combination with the new <code>.locale</code> argument to
<a href=https://dplyr.tidyverse.org/reference/arrange.html target=_blank rel=noopener><code>arrange()</code></a>).</p><p>We expect that most code won&rsquo;t depend on the ordering of these group keys, but it is worth keeping in mind if you are switching to <code>.by</code>. If you did rely on sorted group keys, you currently need to explicitly call
<a href=https://dplyr.tidyverse.org/reference/arrange.html target=_blank rel=noopener><code>arrange()</code></a> either before or after the call to <code>summarise(.by =)</code>. In a future release, we may add
<a href=https://github.com/tidyverse/dplyr/issues/6663 target=_blank rel=noopener>an argument</a> to control this.</p><h2 id=nestby--><code>nest(.by = )</code>
<a href=#nestby--><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=https://tidyr.tidyverse.org>tidyr</a></span><span class=o>)</span></span></code></pre></div><p>The idea behind <code>.by</code> turns out to be useful in contexts outside of dplyr. In
<a href=https://www.tidyverse.org/blog/2023/01/tidyr-1-3-0/#nestby target=_blank rel=noopener>tidyr 1.3.0</a>,
<a href=https://tidyr.tidyverse.org/reference/nest.html target=_blank rel=noopener><code>nest()</code></a> gained a <code>.by</code> argument, allowing you to specify the columns you want to nest <em>by</em> rather than the columns that appear in the nested results, which often makes for more natural calls to
<a href=https://tidyr.tidyverse.org/reference/nest.html target=_blank rel=noopener><code>nest()</code></a>.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=c># Specify what to nest by</span></span>
<span><span class=nv>transactions</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://tidyr.tidyverse.org/reference/nest.html>nest</a></span><span class=o>(</span>.by <span class=o>=</span> <span class=nv>company</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 2 Ã— 2</span></span></span>
<span><span class=c>#&gt;   company data            </span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;chr&gt;</span>   <span style=color:#555;font-style:italic>&lt;list&gt;</span>          </span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span> A       <span style=color:#555>&lt;tibble [3 Ã— 2]&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span> B       <span style=color:#555>&lt;tibble [3 Ã— 2]&gt;</span></span></span>
<span></span><span></span>
<span><span class=c># Specify what to nest</span></span>
<span><span class=nv>transactions</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://tidyr.tidyverse.org/reference/nest.html>nest</a></span><span class=o>(</span>data <span class=o>=</span> <span class=o>!</span><span class=nv>company</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 2 Ã— 2</span></span></span>
<span><span class=c>#&gt;   company data            </span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;chr&gt;</span>   <span style=color:#555;font-style:italic>&lt;list&gt;</span>          </span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span> A       <span style=color:#555>&lt;tibble [3 Ã— 2]&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span> B       <span style=color:#555>&lt;tibble [3 Ã— 2]&gt;</span></span></span>
<span></span><span></span>
<span><span class=c># Specify both, allowing you to drop `year` along the way</span></span>
<span><span class=nv>transactions</span> <span class=o>|&gt;</span></span>
<span>  <span class=nf><a href=https://tidyr.tidyverse.org/reference/nest.html>nest</a></span><span class=o>(</span>data <span class=o>=</span> <span class=nv>revenue</span>, .by <span class=o>=</span> <span class=nv>company</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 2 Ã— 2</span></span></span>
<span><span class=c>#&gt;   company data            </span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;chr&gt;</span>   <span style=color:#555;font-style:italic>&lt;list&gt;</span>          </span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span> A       <span style=color:#555>&lt;tibble [3 Ã— 1]&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span> B       <span style=color:#555>&lt;tibble [3 Ã— 1]&gt;</span></span></span>
<span></span></code></pre></div><p>We currently have 3 different nesting variants in the tidyverse:
<a href=https://tidyr.tidyverse.org/reference/nest.html target=_blank rel=noopener><code>tidyr::nest()</code></a>,
<a href=https://dplyr.tidyverse.org/reference/group_nest.html target=_blank rel=noopener><code>dplyr::group_nest()</code></a>, and
<a href=https://dplyr.tidyverse.org/reference/nest_by.html target=_blank rel=noopener><code>dplyr::nest_by()</code></a>. Because the tidyr variant is now the most flexible of all of these, and because
<a href=https://tidyr.tidyverse.org/reference/unnest.html target=_blank rel=noopener><code>unnest()</code></a> also lives in tidyr, we are likely to deprecate the two experimental dplyr options in the future.</p></div></div><div class=column25><div class="section hideOnMobile"><div class=sectionTitle>Contents</div><nav id=TableOfContents><ul><li><a href=#persistent-grouping-with-group_by>Persistent grouping with <code>group_by()</code></a></li><li><a href=#per-operation-grouping-with-byby>Per-operation grouping with <code>.by</code>/<code>by</code></a></li><li><a href=#nestby--><code>nest(.by = )</code></a></li></ul></nav></div><div class=section></div></div></div></div></div><div id=rStudioFooter class=band><div class=bandContent><div id=copyright>The tidyverse is proudly supported by <a class=rstudioLogo href=https://posit.co/ aria-label="Posit Homepage"></a></div><div id=logos><a href=https://www.tidyverse.org/google_privacy_policy>Privacy policy</a>
<a href=https://github.com/tidyverse class="footerLogo gitHub" aria-label="Tidyverse GitHub organization"></a><a href=https://twitter.com/hashtag/rstats class="footerLogo twitter" aria-label="rstats hashtag on twitter.com"></a></div></div></div></div></div><script type=application/javascript>var dnt=(navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack);var doNotTrack=(dnt=="1"||dnt=="yes");if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');if(window.sessionStorage){var GA_SESSION_STORAGE_KEY='ga:clientId';ga('create','UA-115082821-1',{'storage':'none','clientId':sessionStorage.getItem(GA_SESSION_STORAGE_KEY)});ga(function(tracker){sessionStorage.setItem(GA_SESSION_STORAGE_KEY,tracker.get('clientId'));});}
ga('set','anonymizeIp',true);ga('send','pageview');}</script></body></html></div></div></body></html>