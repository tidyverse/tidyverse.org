<!doctype html><html><head><!doctype html><html lang=en-us><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/css/main-site.css><link rel=stylesheet href=/css/fa5-all.css><style type=text/css>body{background-color:#fff;color:#1a1917}a{color:#38577f}a:hover{color:#42709b}a:focus{outline-color:#42709b}.column25-left .sectionTitle a:hover:not(.current),.column16-left .sectionTitle a:hover:not(.current){color:#1a1917}.icon-attribution,.icon-attribution a{color:#1a1917;opacity:75%}#homeContent .band.first{background-color:#fff}#homeContent .band.second{background-color:#fdeba4}#homeContent .band.third{background-color:#fff}#rStudioHeader{background-color:#1a162d;color:#fff}#rStudioHeader .productName{color:#fff}#rStudioHeader .productName:hover,#rStudioHeader .productName:focus{color:#fdeba4}#rStudioHeader #menu .menuItem.a{background-color:#75aadb;color:#fff}#rStudioHeader #menu .menuItem:hover{background-color:#484557;color:#fff}#rStudioHeader #menu .menuItem.current{background-color:#fff;color:#1a162d;text-decoration:none}#rStudioFooter.band{background-color:#767381}#rStudioFooter .bandContent #copyright{color:#e3eef8}table tbody tr:nth-child(even){background-color:#f7faff}table tbody tr:nth-child(odd){background-color:#fff}.latest{border-top:.5em solid <no value>}.event{-moz-box-shadow:0 0 0 0 rgba(0,0,0,.1);-webkit-box-shadow:0 0 0 0 rgba(0,0,0,.1);box-shadow:0 0 0 0 rgba(0,0,0,.1)}.section .event{background-color:#eab0c41a}.section .event{border-top:7pt solid #a19ea936}.section .event a{color:#1a162d}.section .event{color:#404040}</style><link rel=stylesheet href=/css/tidyverse.css><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.71.1"><title>Tuning hyperparameters with tidymodels is a delight</title><meta property="og:title" content="Tuning hyperparameters with tidymodels is a delight"><meta property="og:description" content="New releases of the tune, finetune, and workflowsets packages have made  optimizing model parameters with tidymodels even more pleasant."><meta property="og:type" content="article"><meta property="og:url" content="https://www.tidyverse.org/blog/2023/04/tuning-delights/"><meta property="twitter:card" content="summary_large_image"><meta property="og:title" content="Tuning hyperparameters with tidymodels is a delight - Tidyverse"><meta property="description" content="New releases of the tune, finetune, and workflowsets packages have made  optimizing model parameters with tidymodels even more pleasant."><meta property="og:description" content="New releases of the tune, finetune, and workflowsets packages have made  optimizing model parameters with tidymodels even more pleasant."><meta property="og:image" content="https://www.tidyverse.org/blog/2023/04/tuning-delights/thumbnail-sq.jpg"><meta name=twitter:image content="https://www.tidyverse.org/blog/2023/04/tuning-delights/thumbnail-wd.jpg"><link rel=apple-touch-icon sizes=180x180 href=/images/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicons/favicon-16x16.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg><link rel="shortcut icon" href=/images/favicons/favicon.ico><meta name=msapplication-TileColor content="#da532c"><meta name=msapplication-config href=/images/favicons/browserconfig.xml><script type=text/javascript src=/js/jquery-3.5.1.min.js></script><script type=text/javascript src=/js/site.js></script><link rel=icon href=/images/favicon.ico><script type=text/javascript src=/js/clipboard.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin=anonymous></script><script defer data-domain=tidyverse.org,all.tidyverse.org src=https://plausible.io/js/plausible.js></script></head><body><div id=appTidyverseSite class="shrinkHeader alwaysShrinkHeader"><div id=main><div id=rStudioHeader><nav class=band><div class="innards bandContent"><div><a class=productName href=/%20/>Tidyverse</a></div><div id=menu><div id=menuToggler></div><div id=menuItems><a class=menuItem href=/packages/>Packages</a>
<a class="menuItem current" href=/blog/>Blog</a>
<a class=menuItem href=/learn/>Learn</a>
<a class=menuItem href=/help/>Help</a>
<a class=menuItem href=/contribute/>Contribute</a></div></div></div></nav></div><main><div class="band padForHeader pushFooter"><div class=bandContent><div class="full splitColumns withMobileMargins"><div class=column75><h1 class=article-title>Tuning hyperparameters with tidymodels is a delight</h1><div class=article-header aria-hidden=true><div class=photo><img src=/blog/2023/04/tuning-delights/thumbnail-wd.jpg></div><div class=photoCredit>Photo by <a href=https://unsplash.com/photos/Wrx0iVcYKmM>Mario La Pergola</a></div></div><span class=article-date><i class="fas fa-calendar-day fa-fw"></i>&nbsp;&nbsp;2023/04/20</span><p style=margin-bottom:.5em;margin-top:.85em><i class="fas fa-tags"></i>&nbsp;
<a href=/tags/tidymodels/>tidymodels</a>,
<a href=/tags/workflowsets/>workflowsets</a>,
<a href=/tags/tune/>tune</a></p><p style=margin-top:.5em><i class="fas fa-user-circle fa-fw"></i>&nbsp;
Simon Couch</p><div class=article-content><p>The tidymodels team recently released new versions of the tune, finetune, and workflowsets packages, and we&rsquo;re super stoked about it! Each of these three packages facilitates tuning hyperparameters in tidymodels, and their new releases work to make the experience of hyperparameter tuning more joyful.</p><p>You can install these releases from CRAN with:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://rdrr.io/r/utils/install.packages.html>install.packages</a></span><span class=o>(</span><span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=s>"tune"</span>, <span class=s>"workflowsets"</span>, <span class=s>"finetune"</span><span class=o>)</span><span class=o>)</span></span></code></pre></div><p>This blog post will highlight some of new changes in these packages that we&rsquo;re most excited about.</p><p>You can see the full lists of changes in the release notes for each package:</p><ul><li><a href=https://github.com/tidymodels/tune/releases/tag/v1.1.0 target=_blank rel=noopener>tune v1.1.0</a></li><li><a href=https://github.com/tidymodels/workflowsets/releases/tag/v1.0.1 target=_blank rel=noopener>workflowsets v1.0.1</a></li><li><a href=https://github.com/tidymodels/finetune/releases/tag/v1.1.0 target=_blank rel=noopener>finetune v1.1.0</a></li></ul><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=https://tidymodels.tidymodels.org>tidymodels</a></span><span class=o>)</span></span>
<span><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=https://github.com/tidymodels/finetune>finetune</a></span><span class=o>)</span></span></code></pre></div><h2 id=a-shorthand-for-fitting-the-optimal-model>A shorthand for fitting the optimal model
<a href=#a-shorthand-for-fitting-the-optimal-model><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>In tidymodels, the result of tuning a set of hyperparameters is a data structure describing the candidate models, their predictions, and the performance metrics associated with those predictions. For example, tuning the number of <code>neighbors</code> in a <code>nearest_neighbors()</code> model over a regular grid:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=c># tune the `neighbors` hyperparameter</span></span>
<span><span class=nv>knn_model_spec</span> <span class=o>&lt;-</span> <span class=nf>nearest_neighbor</span><span class=o>(</span><span class=s>"regression"</span>, neighbors <span class=o>=</span> <span class=nf><a href=https://hardhat.tidymodels.org/reference/tune.html>tune</a></span><span class=o>(</span><span class=o>)</span><span class=o>)</span></span>
<span></span>
<span><span class=nv>tuning_res</span> <span class=o>&lt;-</span> </span>
<span>  <span class=nf><a href=https://tune.tidymodels.org/reference/tune_grid.html>tune_grid</a></span><span class=o>(</span></span>
<span>    <span class=nv>knn_model_spec</span>,</span>
<span>    <span class=nv>mpg</span> <span class=o>~</span> <span class=nv>.</span>,</span>
<span>    <span class=nf>bootstraps</span><span class=o>(</span><span class=nv>mtcars</span>, <span class=m>5</span><span class=o>)</span>,</span>
<span>    control <span class=o>=</span> <span class=nf><a href=https://tune.tidymodels.org/reference/control_grid.html>control_grid</a></span><span class=o>(</span>save_workflow <span class=o>=</span> <span class=kc>TRUE</span><span class=o>)</span></span>
<span>  <span class=o>)</span></span>
<span></span>
<span><span class=c># check out the resulting object</span></span>
<span><span class=nv>tuning_res</span></span>
<span><span class=c>#&gt; # Tuning results</span></span>
<span><span class=c>#&gt; # Bootstrap sampling </span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 5 × 4</span></span></span>
<span><span class=c>#&gt;   splits          id         .metrics          .notes          </span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;list&gt;</span>          <span style=color:#555;font-style:italic>&lt;chr&gt;</span>      <span style=color:#555;font-style:italic>&lt;list&gt;</span>            <span style=color:#555;font-style:italic>&lt;list&gt;</span>          </span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span> <span style=color:#555>&lt;split [32/11]&gt;</span> Bootstrap1 <span style=color:#555>&lt;tibble [20 × 5]&gt;</span> <span style=color:#555>&lt;tibble [0 × 3]&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span> <span style=color:#555>&lt;split [32/12]&gt;</span> Bootstrap2 <span style=color:#555>&lt;tibble [20 × 5]&gt;</span> <span style=color:#555>&lt;tibble [0 × 3]&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span> <span style=color:#555>&lt;split [32/11]&gt;</span> Bootstrap3 <span style=color:#555>&lt;tibble [20 × 5]&gt;</span> <span style=color:#555>&lt;tibble [0 × 3]&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span> <span style=color:#555>&lt;split [32/10]&gt;</span> Bootstrap4 <span style=color:#555>&lt;tibble [20 × 5]&gt;</span> <span style=color:#555>&lt;tibble [0 × 3]&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>5</span> <span style=color:#555>&lt;split [32/12]&gt;</span> Bootstrap5 <span style=color:#555>&lt;tibble [20 × 5]&gt;</span> <span style=color:#555>&lt;tibble [0 × 3]&gt;</span></span></span>
<span></span><span></span>
<span><span class=c># examine proposed hyperparameters and associated metrics</span></span>
<span><span class=nf><a href=https://tune.tidymodels.org/reference/collect_predictions.html>collect_metrics</a></span><span class=o>(</span><span class=nv>tuning_res</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 20 × 7</span></span></span>
<span><span class=c>#&gt;    neighbors .metric .estimator  mean     n std_err .config              </span></span>
<span><span class=c>#&gt;        <span style=color:#555;font-style:italic>&lt;int&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>   <span style=color:#555;font-style:italic>&lt;chr&gt;</span>      <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;int&gt;</span>   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;chr&gt;</span>                </span></span>
<span><span class=c>#&gt; <span style=color:#555> 1</span>         2 rmse    standard   3.19      5  0.208  Preprocessor1_Model01</span></span>
<span><span class=c>#&gt; <span style=color:#555> 2</span>         2 rsq     standard   0.664     5  0.086<span style=text-decoration:underline>1</span> Preprocessor1_Model01</span></span>
<span><span class=c>#&gt; <span style=color:#555> 3</span>         3 rmse    standard   3.13      5  0.266  Preprocessor1_Model02</span></span>
<span><span class=c>#&gt; <span style=color:#555> 4</span>         3 rsq     standard   0.678     5  0.086<span style=text-decoration:underline>8</span> Preprocessor1_Model02</span></span>
<span><span class=c>#&gt; <span style=color:#555> 5</span>         4 rmse    standard   3.11      5  0.292  Preprocessor1_Model03</span></span>
<span><span class=c>#&gt; <span style=color:#555> 6</span>         4 rsq     standard   0.684     5  0.085<span style=text-decoration:underline>1</span> Preprocessor1_Model03</span></span>
<span><span class=c>#&gt; <span style=color:#555> 7</span>         5 rmse    standard   3.10      5  0.287  Preprocessor1_Model04</span></span>
<span><span class=c>#&gt; <span style=color:#555> 8</span>         5 rsq     standard   0.686     5  0.083<span style=text-decoration:underline>9</span> Preprocessor1_Model04</span></span>
<span><span class=c>#&gt; <span style=color:#555> 9</span>         8 rmse    standard   3.08      5  0.263  Preprocessor1_Model05</span></span>
<span><span class=c>#&gt; <span style=color:#555>10</span>         8 rsq     standard   0.689     5  0.084<span style=text-decoration:underline>3</span> Preprocessor1_Model05</span></span>
<span><span class=c>#&gt; <span style=color:#555>11</span>         9 rmse    standard   3.07      5  0.256  Preprocessor1_Model06</span></span>
<span><span class=c>#&gt; <span style=color:#555>12</span>         9 rsq     standard   0.691     5  0.084<span style=text-decoration:underline>5</span> Preprocessor1_Model06</span></span>
<span><span class=c>#&gt; <span style=color:#555>13</span>        10 rmse    standard   3.06      5  0.247  Preprocessor1_Model07</span></span>
<span><span class=c>#&gt; <span style=color:#555>14</span>        10 rsq     standard   0.693     5  0.083<span style=text-decoration:underline>7</span> Preprocessor1_Model07</span></span>
<span><span class=c>#&gt; <span style=color:#555>15</span>        11 rmse    standard   3.05      5  0.241  Preprocessor1_Model08</span></span>
<span><span class=c>#&gt; <span style=color:#555>16</span>        11 rsq     standard   0.696     5  0.083<span style=text-decoration:underline>3</span> Preprocessor1_Model08</span></span>
<span><span class=c>#&gt; <span style=color:#555>17</span>        13 rmse    standard   3.03      5  0.236  Preprocessor1_Model09</span></span>
<span><span class=c>#&gt; <span style=color:#555>18</span>        13 rsq     standard   0.701     5  0.082<span style=text-decoration:underline>0</span> Preprocessor1_Model09</span></span>
<span><span class=c>#&gt; <span style=color:#555>19</span>        14 rmse    standard   3.02      5  0.235  Preprocessor1_Model10</span></span>
<span><span class=c>#&gt; <span style=color:#555>20</span>        14 rsq     standard   0.704     5  0.080<span style=text-decoration:underline>8</span> Preprocessor1_Model10</span></span>
<span></span></code></pre></div><p>Given these tuning results, the next steps are to choose the &ldquo;best&rdquo; hyperparameters, assign those hyperparameters to the model, and fit the finalized model on the training set. Previously in tidymodels, this has felt like:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=c># choose a method to define "best" and extract the resulting parameters</span></span>
<span><span class=nv>best_param</span> <span class=o>&lt;-</span> <span class=nf><a href=https://tune.tidymodels.org/reference/show_best.html>select_best</a></span><span class=o>(</span><span class=nv>tuning_res</span>, <span class=s>"rmse"</span><span class=o>)</span> </span>
<span></span>
<span><span class=c># assign those parameters to model</span></span>
<span><span class=nv>knn_model_final</span> <span class=o>&lt;-</span> <span class=nf><a href=https://tune.tidymodels.org/reference/finalize_model.html>finalize_model</a></span><span class=o>(</span><span class=nv>knn_model_spec</span>, <span class=nv>best_param</span><span class=o>)</span></span>
<span></span>
<span><span class=c># fit the finalized model to the training set</span></span>
<span><span class=nv>knn_fit</span> <span class=o>&lt;-</span> <span class=nf>fit</span><span class=o>(</span><span class=nv>knn_model_final</span>, <span class=nv>mpg</span> <span class=o>~</span> <span class=nv>.</span>, <span class=nv>mtcars</span><span class=o>)</span></span></code></pre></div><p>Voilà! <code>knn_fit</code> is a properly resampled model that is ready to
<a href=https://rdrr.io/r/stats/predict.html target=_blank rel=noopener><code>predict()</code></a> on new data:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf><a href=https://rdrr.io/r/stats/predict.html>predict</a></span><span class=o>(</span><span class=nv>knn_fit</span>, <span class=nv>mtcars</span><span class=o>[</span><span class=m>1</span>, <span class=o>]</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 1 × 1</span></span></span>
<span><span class=c>#&gt;   .pred</span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span>  22.0</span></span>
<span></span></code></pre></div><p>The newest release of tune introduced a shorthand interface for going from tuning results to final fit called
<a href=https://tune.tidymodels.org/reference/fit_best.html target=_blank rel=noopener><code>fit_best()</code></a>. The function wraps each of those three functions with sensible defaults to abbreviate the process described above.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>knn_fit_2</span> <span class=o>&lt;-</span> <span class=nf><a href=https://tune.tidymodels.org/reference/fit_best.html>fit_best</a></span><span class=o>(</span><span class=nv>tuning_res</span><span class=o>)</span></span>
<span></span>
<span><span class=nf><a href=https://rdrr.io/r/stats/predict.html>predict</a></span><span class=o>(</span><span class=nv>knn_fit_2</span>, <span class=nv>mtcars</span><span class=o>[</span><span class=m>1</span>, <span class=o>]</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 1 × 1</span></span></span>
<span><span class=c>#&gt;   .pred</span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span>  22.0</span></span>
<span></span></code></pre></div><p>This function is closely related to the
<a href=https://tune.tidymodels.org/reference/last_fit.html target=_blank rel=noopener><code>last_fit()</code></a> function. They both give you access to a workflow fitted on the training data but are situated somewhat differently in the modeling workflow.
<a href=https://tune.tidymodels.org/reference/fit_best.html target=_blank rel=noopener><code>fit_best()</code></a> picks up after a tuning function like
<a href=https://tune.tidymodels.org/reference/tune_grid.html target=_blank rel=noopener><code>tune_grid()</code></a> to take you from tuning results to fitted workflow, ready for you to predict and assess further.
<a href=https://tune.tidymodels.org/reference/last_fit.html target=_blank rel=noopener><code>last_fit()</code></a> assumes you have made your choice of hyperparameters and finalized your workflow to then take you from finalized workflow to fitted workflow and further to performance assessment on the test data. While
<a href=https://tune.tidymodels.org/reference/fit_best.html target=_blank rel=noopener><code>fit_best()</code></a> gives a fitted workflow,
<a href=https://tune.tidymodels.org/reference/last_fit.html target=_blank rel=noopener><code>last_fit()</code></a> gives you the performance results. If you want the fitted workflow, you can extract it from the result of
<a href=https://tune.tidymodels.org/reference/last_fit.html target=_blank rel=noopener><code>last_fit()</code></a> via
<a href=https://hardhat.tidymodels.org/reference/hardhat-extract.html target=_blank rel=noopener><code>extract_workflow()</code></a>.</p><p>The newest release of the workflowsets package also includes a
<a href=https://tune.tidymodels.org/reference/fit_best.html target=_blank rel=noopener><code>fit_best()</code></a> method for workflow set objects. Given a set of tuning results, that method will sift through all of the possible models to find and fit the optimal model configuration.</p><h2 id=interactive-issue-logging>Interactive issue logging
<a href=#interactive-issue-logging><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Imagine, in the previous example, we made some subtle error in specifying the tuning process. For example, passing a function to <code>extract</code> elements of the proposed workflows that injects some warnings and errors into the tuning process:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>raise_concerns</span> <span class=o>&lt;-</span> <span class=kr>function</span><span class=o>(</span><span class=nv>x</span><span class=o>)</span> <span class=o>&#123;</span></span>
<span>  <span class=kr><a href=https://rdrr.io/r/base/warning.html>warning</a></span><span class=o>(</span><span class=s>"Ummm, wait. :o"</span><span class=o>)</span></span>
<span>  <span class=kr><a href=https://rdrr.io/r/base/stop.html>stop</a></span><span class=o>(</span><span class=s>"Eep! Nooo!"</span><span class=o>)</span></span>
<span><span class=o>&#125;</span></span>
<span></span>
<span><span class=nv>tuning_res</span> <span class=o>&lt;-</span></span>
<span>  <span class=nf><a href=https://tune.tidymodels.org/reference/tune_grid.html>tune_grid</a></span><span class=o>(</span></span>
<span>    <span class=nv>knn_model_spec</span>,</span>
<span>    <span class=nv>mpg</span> <span class=o>~</span> <span class=nv>.</span>,</span>
<span>    <span class=nf>bootstraps</span><span class=o>(</span><span class=nv>mtcars</span>, <span class=m>5</span><span class=o>)</span>,</span>
<span>    control <span class=o>=</span> <span class=nf><a href=https://tune.tidymodels.org/reference/control_grid.html>control_grid</a></span><span class=o>(</span>extract <span class=o>=</span> <span class=nv>raise_concerns</span><span class=o>)</span></span>
<span>  <span class=o>)</span></span></code></pre></div><p>Warnings and errors can come up in all sorts of places while tuning hyperparameters. Often, with obvious issues, we can raise errors early on and halt the tuning process, but with more subtle concerns, we don&rsquo;t want to be too restrictive; it&rsquo;s sometimes better to defer to the underlying modeling packages to decide what&rsquo;s a dire issue versus something that can be worked around.</p><p>In the past, we&rsquo;ve raised warnings and issues as they occur, printing context on the issue to the console before logging the issue in the tuning result. In the above example, this would look like:</p><pre><code>! Bootstrap1: preprocessor 1/1, model 1/1 (extracts): Ummm, wait. :o
x Bootstrap1: preprocessor 1/1, model 1/1 (extracts): Error in extractor(object): Eep! Nooo!
! Bootstrap2: preprocessor 1/1, model 1/1 (extracts): Ummm, wait. :o
x Bootstrap2: preprocessor 1/1, model 1/1 (extracts): Error in extractor(object): Eep! Nooo!
! Bootstrap3: preprocessor 1/1, model 1/1 (extracts): Ummm, wait. :o
x Bootstrap3: preprocessor 1/1, model 1/1 (extracts): Error in extractor(object): Eep! Nooo!
! Bootstrap4: preprocessor 1/1, model 1/1 (extracts): Ummm, wait. :o
x Bootstrap4: preprocessor 1/1, model 1/1 (extracts): Error in extractor(object): Eep! Nooo!
! Bootstrap5: preprocessor 1/1, model 1/1 (extracts): Ummm, wait. :o
x Bootstrap5: preprocessor 1/1, model 1/1 (extracts): Error in extractor(object): Eep! Nooo!
</code></pre><p>The above messages are super descriptive about where issues occur&mdash;they note in which resample, from which proposed modeling workflow, and in which part of the fitting process the issues occurred in. At the same time, they are quite repetitive; if there&rsquo;s an issue during hyperparameter tuning, it probably occurs in every resample, always in the same place. If, instead, we were evaluating this model against 1,000 resamples, or there were more than just two issues, this output could get very overwhelming very quickly.</p><p>The new releases of our tuning packages include tools to determine which tuning issues are unique, and for each unique issue, only print out the message once while maintaining a dynamic count of how many times the issue occurred. With the new tune release, the same output would look like:</p><div class=highlight><pre class=chroma><span><span class=c>#&gt; → <span style=color:#bb0;font-weight:700>A</span> | <span style=color:#bb0>warning</span>: Ummm, wait. :o</span></span>
<span></span><span><span class=c>#&gt; → <span style=color:#b00;font-weight:700>B</span> | <span style=color:#b00>error</span>:   Eep! Nooo!</span></span>
<span><span class=c>#&gt; There were issues with some computations   <span style=color:#bb0;font-weight:700>A</span>: x5   <span style=color:#b00;font-weight:700>B</span>: x5</span></span>
<span></span></code></pre></div><p>This interface is hopefully less overwhelming for users. When the messages attached to these issues aren&rsquo;t enough to debug the issue, the complete set of information about the issues lives inside of the tuning result object, and can be retrieved with <code>collect_notes(tuning_res)</code>. To turn off the interactive logging, set the <code>verbose</code> control option to <code>TRUE</code>.</p><h2 id=speedups>Speedups
<a href=#speedups><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Each of these three releases, as well as releases of core tidymodels packages they depend on like parsnip, recipes, and hardhat, include a plethora of changes meant to optimize computational performance. Especially for modeling practitioners who work with many resamples and/or small data sets, our modeling workflows will feel a whole lot snappier:</p><p><img src=https://simonpcouch.com/blog/speedups-2023/index_files/figure-html/unnamed-chunk-10-1.png alt="A ggplot2 line graph plotting relative change in time to evaluate model fits with the tidymodels packages. Fits on datasets with 100 training rows are 2 to 3 times faster, while fits on datasets with 100,000 or more rows take about the same amount of time as they used to."></p><p>With 100-row training data sets, the time to resample models with tune and friends has been at least halved. These releases are the first iteration of a set of changes to reduce the evaluation time of tidymodels code, and users can expect further optimizations in coming releases! See
<a href=https://www.simonpcouch.com/blog/speedups-2023/ target=_blank rel=noopener>this post on my blog</a> for more information about those speedups.</p><h2 id=bonus-points>Bonus points
<a href=#bonus-points><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Although they&rsquo;re smaller in scope, we wanted to highlight two additional developments in tuning hyperparameters with tidymodels.</p><h3 id=workflow-set-support-for-tidyclust>Workflow set support for tidyclust
<a href=#workflow-set-support-for-tidyclust><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>The recent tidymodels package
<a href=github.com/tidymodels/tidyclust>tidyclust</a> introduced support for fitting and tuning clustering models in tidymodels. That package&rsquo;s function
<a href=https://tidyclust.tidymodels.org/reference/tune_cluster.html target=_blank rel=noopener><code>tune_cluster()</code></a> is now an option for tuning in
<a href=https://workflowsets.tidymodels.org/reference/workflow_map.html target=_blank rel=noopener><code>workflow_map()</code></a>, meaning that users can fit sets of clustering models and preprocessors using workflow sets. These changes further integrate the tidyclust package into tidymodels framework.</p><h3 id=refined-retrieval-of-intermediate-results>Refined retrieval of intermediate results
<a href=#refined-retrieval-of-intermediate-results><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><p>The <code>.Last.tune.result</code> helper stores the most recent tuning result in the object <code>.Last.tune.result</code> as a fail-safe in cases of interrupted tuning, uncaught tuning errors, and simply forgetting to assign tuning results to an object.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=c># be a silly goose and forget to assign results</span></span>
<span><span class=nf><a href=https://tune.tidymodels.org/reference/tune_grid.html>tune_grid</a></span><span class=o>(</span></span>
<span>  <span class=nv>knn_model_spec</span>,</span>
<span>  <span class=nv>mpg</span> <span class=o>~</span> <span class=nv>.</span>,</span>
<span>  <span class=nf>bootstraps</span><span class=o>(</span><span class=nv>mtcars</span>, <span class=m>5</span><span class=o>)</span>,</span>
<span>  control <span class=o>=</span> <span class=nf><a href=https://tune.tidymodels.org/reference/control_grid.html>control_grid</a></span><span class=o>(</span>save_workflow <span class=o>=</span> <span class=kc>TRUE</span><span class=o>)</span></span>
<span><span class=o>)</span></span>
<span><span class=c>#&gt; # Tuning results</span></span>
<span><span class=c>#&gt; # Bootstrap sampling </span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 5 × 4</span></span></span>
<span><span class=c>#&gt;   splits          id         .metrics          .notes          </span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;list&gt;</span>          <span style=color:#555;font-style:italic>&lt;chr&gt;</span>      <span style=color:#555;font-style:italic>&lt;list&gt;</span>            <span style=color:#555;font-style:italic>&lt;list&gt;</span>          </span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span> <span style=color:#555>&lt;split [32/11]&gt;</span> Bootstrap1 <span style=color:#555>&lt;tibble [18 × 5]&gt;</span> <span style=color:#555>&lt;tibble [0 × 3]&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span> <span style=color:#555>&lt;split [32/14]&gt;</span> Bootstrap2 <span style=color:#555>&lt;tibble [18 × 5]&gt;</span> <span style=color:#555>&lt;tibble [0 × 3]&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span> <span style=color:#555>&lt;split [32/13]&gt;</span> Bootstrap3 <span style=color:#555>&lt;tibble [18 × 5]&gt;</span> <span style=color:#555>&lt;tibble [0 × 3]&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span> <span style=color:#555>&lt;split [32/12]&gt;</span> Bootstrap4 <span style=color:#555>&lt;tibble [18 × 5]&gt;</span> <span style=color:#555>&lt;tibble [0 × 3]&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>5</span> <span style=color:#555>&lt;split [32/11]&gt;</span> Bootstrap5 <span style=color:#555>&lt;tibble [18 × 5]&gt;</span> <span style=color:#555>&lt;tibble [0 × 3]&gt;</span></span></span>
<span></span><span></span>
<span><span class=c># all is not lost!</span></span>
<span><span class=nv>.Last.tune.result</span></span>
<span><span class=c>#&gt; # Tuning results</span></span>
<span><span class=c>#&gt; # Bootstrap sampling </span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 5 × 4</span></span></span>
<span><span class=c>#&gt;   splits          id         .metrics          .notes          </span></span>
<span><span class=c>#&gt;   <span style=color:#555;font-style:italic>&lt;list&gt;</span>          <span style=color:#555;font-style:italic>&lt;chr&gt;</span>      <span style=color:#555;font-style:italic>&lt;list&gt;</span>            <span style=color:#555;font-style:italic>&lt;list&gt;</span>          </span></span>
<span><span class=c>#&gt; <span style=color:#555>1</span> <span style=color:#555>&lt;split [32/11]&gt;</span> Bootstrap1 <span style=color:#555>&lt;tibble [18 × 5]&gt;</span> <span style=color:#555>&lt;tibble [0 × 3]&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>2</span> <span style=color:#555>&lt;split [32/14]&gt;</span> Bootstrap2 <span style=color:#555>&lt;tibble [18 × 5]&gt;</span> <span style=color:#555>&lt;tibble [0 × 3]&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>3</span> <span style=color:#555>&lt;split [32/13]&gt;</span> Bootstrap3 <span style=color:#555>&lt;tibble [18 × 5]&gt;</span> <span style=color:#555>&lt;tibble [0 × 3]&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>4</span> <span style=color:#555>&lt;split [32/12]&gt;</span> Bootstrap4 <span style=color:#555>&lt;tibble [18 × 5]&gt;</span> <span style=color:#555>&lt;tibble [0 × 3]&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>5</span> <span style=color:#555>&lt;split [32/11]&gt;</span> Bootstrap5 <span style=color:#555>&lt;tibble [18 × 5]&gt;</span> <span style=color:#555>&lt;tibble [0 × 3]&gt;</span></span></span>
<span></span><span></span>
<span><span class=c># assign to object after the fact</span></span>
<span><span class=nv>res</span> <span class=o>&lt;-</span> <span class=nv>.Last.tune.result</span></span></code></pre></div><p>These three releases introduce support for the <code>.Last.tune.result</code> object in more settings and refine support in existing implementations.</p><h2 id=acknowledgements>Acknowledgements
<a href=#acknowledgements><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Thanks to
<a href=https://github.com/walrossker target=_blank rel=noopener>@walrossker</a>,
<a href=https://github.com/Freestyleyang target=_blank rel=noopener>@Freestyleyang</a>, and
<a href=https://github.com/Jeffrothschild target=_blank rel=noopener>@Jeffrothschild</a> for their contributions to these packages since their last releases.</p><p>Happy modeling, y&rsquo;all!</p></div></div><div class=column25><div class="section hideOnMobile"><div class=sectionTitle>Contents</div><nav id=TableOfContents><ul><li><a href=#a-shorthand-for-fitting-the-optimal-model>A shorthand for fitting the optimal model</a></li><li><a href=#interactive-issue-logging>Interactive issue logging</a></li><li><a href=#speedups>Speedups</a></li><li><a href=#bonus-points>Bonus points</a></li><li><a href=#acknowledgements>Acknowledgements</a></li></ul></nav></div><div class=section></div></div></div></div></div><div id=rStudioFooter class=band><div class=bandContent><div id=copyright>The tidyverse is proudly supported by <a class=rstudioLogo href=https://posit.co/ aria-label="Posit Homepage"></a></div><div id=logos><a href=https://www.tidyverse.org/google_privacy_policy>Privacy policy</a>
<a href=https://github.com/tidyverse class="footerLogo gitHub" aria-label="Tidyverse GitHub organization"></a><a href=https://twitter.com/hashtag/rstats class="footerLogo twitter" aria-label="rstats hashtag on twitter.com"></a></div></div></div></div></div><script type=application/javascript>var dnt=(navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack);var doNotTrack=(dnt=="1"||dnt=="yes");if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');if(window.sessionStorage){var GA_SESSION_STORAGE_KEY='ga:clientId';ga('create','UA-115082821-1',{'storage':'none','clientId':sessionStorage.getItem(GA_SESSION_STORAGE_KEY)});ga(function(tracker){sessionStorage.setItem(GA_SESSION_STORAGE_KEY,tracker.get('clientId'));});}
ga('set','anonymizeIp',true);ga('send','pageview');}</script></body></html></div></div></body></html>