<!doctype html><html><head><!doctype html><html lang=en-us><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/css/main-site.css><link rel=stylesheet href=/css/fa5-all.css><style type=text/css>body{background-color:#fff;color:#1a1917}a{color:#38577f}a:hover{color:#42709b}a:focus{outline-color:#42709b}.column25-left .sectionTitle a:hover:not(.current),.column16-left .sectionTitle a:hover:not(.current){color:#1a1917}.icon-attribution,.icon-attribution a{color:#1a1917;opacity:75%}#homeContent .band.first{background-color:#fff}#homeContent .band.second{background-color:#fdeba4}#homeContent .band.third{background-color:#fff}#rStudioHeader{background-color:#1a162d;color:#fff}#rStudioHeader .productName{color:#fff}#rStudioHeader .productName:hover,#rStudioHeader .productName:focus{color:#fdeba4}#rStudioHeader #menu .menuItem.a{background-color:#75aadb;color:#fff}#rStudioHeader #menu .menuItem:hover{background-color:#484557;color:#fff}#rStudioHeader #menu .menuItem.current{background-color:#fff;color:#1a162d;text-decoration:none}#rStudioFooter.band{background-color:#767381}#rStudioFooter .bandContent #copyright{color:#e3eef8}table tbody tr:nth-child(even){background-color:#f7faff}table tbody tr:nth-child(odd){background-color:#fff}.latest{border-top:.5em solid <no value>}.event{-moz-box-shadow:0 0 0 0 rgba(0,0,0,.1);-webkit-box-shadow:0 0 0 0 rgba(0,0,0,.1);box-shadow:0 0 0 0 rgba(0,0,0,.1)}.section .event{background-color:#eab0c41a}.section .event{border-top:7pt solid #a19ea936}.section .event a{color:#1a162d}.section .event{color:#404040}</style><link rel=stylesheet href=/css/tidyverse.css><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.71.1"><title>Three ways errors are about to get better in tidymodels</title><meta property="og:title" content="Three ways errors are about to get better in tidymodels"><meta property="og:description" content="The tidymodels team's biannual spring cleaning gave us a chance to revisit  the way we raise some error messages."><meta property="og:type" content="article"><meta property="og:url" content="https://www.tidyverse.org/blog/2023/11/tidymodels-errors-q4/"><meta property="twitter:card" content="summary_large_image"><meta property="og:title" content="Three ways errors are about to get better in tidymodels - Tidyverse"><meta property="description" content="The tidymodels team's biannual spring cleaning gave us a chance to revisit  the way we raise some error messages."><meta property="og:description" content="The tidymodels team's biannual spring cleaning gave us a chance to revisit  the way we raise some error messages."><meta property="og:image" content="https://www.tidyverse.org/blog/2023/11/tidymodels-errors-q4/thumbnail-sq.jpg"><meta name=twitter:image content="https://www.tidyverse.org/blog/2023/11/tidymodels-errors-q4/thumbnail-wd.jpg"><link rel=apple-touch-icon sizes=180x180 href=/images/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicons/favicon-16x16.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg><link rel="shortcut icon" href=/images/favicons/favicon.ico><meta name=msapplication-TileColor content="#da532c"><meta name=msapplication-config href=/images/favicons/browserconfig.xml><script type=text/javascript src=/js/jquery-3.5.1.min.js></script><script type=text/javascript src=/js/site.js></script><link rel=icon href=/images/favicon.ico><script type=text/javascript src=/js/clipboard.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin=anonymous></script><script defer data-domain=tidyverse.org,all.tidyverse.org src=https://plausible.io/js/plausible.js></script></head><body><div id=appTidyverseSite class="shrinkHeader alwaysShrinkHeader"><div id=main><div id=rStudioHeader><nav class=band><div class="innards bandContent"><div><a class=productName href=/%20/>Tidyverse</a></div><div id=menu><div id=menuToggler></div><div id=menuItems><a class=menuItem href=/packages/>Packages</a>
<a class="menuItem current" href=/blog/>Blog</a>
<a class=menuItem href=/learn/>Learn</a>
<a class=menuItem href=/help/>Help</a>
<a class=menuItem href=/contribute/>Contribute</a></div></div></div></nav></div><main><div class="band padForHeader pushFooter"><div class=bandContent><div class="full splitColumns withMobileMargins"><div class=column75><h1 class=article-title>Three ways errors are about to get better in tidymodels</h1><div class=article-header aria-hidden=true><div class=photo><img src=/blog/2023/11/tidymodels-errors-q4/thumbnail-wd.jpg></div><div class=photoCredit>Photo by <a href=https://unsplash.com/photos/vYcH7pI6v1Q>Nagesh Badu</a></div></div><span class=article-date><i class="fas fa-calendar-day fa-fw"></i>&nbsp;&nbsp;2023/11/10</span><p style=margin-bottom:.5em;margin-top:.85em><i class="fas fa-tags"></i>&nbsp;
<a href=/tags/tidymodels/>tidymodels</a>,
<a href=/tags/parsnip/>parsnip</a>,
<a href=/tags/tune/>tune</a>,
<a href=/tags/package-maintenance/>package maintenance</a></p><p style=margin-top:.5em><i class="fas fa-user-circle fa-fw"></i>&nbsp;
Simon Couch</p><div class=article-content><p>Twice a year, the tidymodels team comes together for &ldquo;spring cleaning,&rdquo; a week-long project devoted to package maintenance. Ahead of the week, we come up with a list of maintenance tasks that we&rsquo;d like to see consistently implemented across our packages. Many of these tasks can be completed by running one usethis function, while others are much more involved, like issue triage.<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> In tidymodels, triaging issues in our core packages helps us to better understand common ways that users struggle to wrap their heads around an API choice we&rsquo;ve made or find the information they need. So, among other things, refinements to the wording of our error messages is a common output of our spring cleanings. This blog post will call out three kinds of changes to our erroring that came out of this spring cleaning:</p><ul><li>Improving existing errors:
<a href=#outcome>The outcome went missing</a></li><li>Do something where we once did nothing:
<a href=#predict>Predicting with things that can&rsquo;t predict</a></li><li>Make a place and point to it:
<a href=#model>Model formulas</a></li></ul><p>To demonstrate, we&rsquo;ll walk through some examples using the tidymodels packages:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=kr><a href=https://rdrr.io/r/base/library.html>library</a></span><span class=o>(</span><span class=nv><a href=https://tidymodels.tidymodels.org>tidymodels</a></span><span class=o>)</span></span>
<span><span class=c>#&gt; ── <span style=font-weight:700>Attaching packages</span> ──────────────────────────── tidymodels 1.1.1 ──</span></span>
<span></span><span><span class=c>#&gt; <span style=color:#0b0>✔</span> <span style=color:#00b>broom       </span> 1.0.5          <span style=color:#0b0>✔</span> <span style=color:#00b>recipes     </span> 1.0.8.<span style=color:#b00>9000</span></span></span>
<span><span class=c>#&gt; <span style=color:#0b0>✔</span> <span style=color:#00b>dials       </span> 1.2.0          <span style=color:#0b0>✔</span> <span style=color:#00b>rsample     </span> 1.2.0     </span></span>
<span><span class=c>#&gt; <span style=color:#0b0>✔</span> <span style=color:#00b>dplyr       </span> 1.1.3          <span style=color:#0b0>✔</span> <span style=color:#00b>tibble      </span> 3.2.1     </span></span>
<span><span class=c>#&gt; <span style=color:#0b0>✔</span> <span style=color:#00b>ggplot2     </span> 3.4.4          <span style=color:#0b0>✔</span> <span style=color:#00b>tidyr       </span> 1.3.0     </span></span>
<span><span class=c>#&gt; <span style=color:#0b0>✔</span> <span style=color:#00b>infer       </span> 1.0.5          <span style=color:#0b0>✔</span> <span style=color:#00b>tune        </span> 1.1.2.<span style=color:#b00>9000</span></span></span>
<span><span class=c>#&gt; <span style=color:#0b0>✔</span> <span style=color:#00b>modeldata   </span> 1.2.0          <span style=color:#0b0>✔</span> <span style=color:#00b>workflows   </span> 1.1.3     </span></span>
<span><span class=c>#&gt; <span style=color:#0b0>✔</span> <span style=color:#00b>parsnip     </span> 1.1.1.<span style=color:#b00>9001</span>     <span style=color:#0b0>✔</span> <span style=color:#00b>workflowsets</span> 1.0.1     </span></span>
<span><span class=c>#&gt; <span style=color:#0b0>✔</span> <span style=color:#00b>purrr       </span> 1.0.2          <span style=color:#0b0>✔</span> <span style=color:#00b>yardstick   </span> 1.2.0</span></span>
<span></span><span><span class=c>#&gt; ── <span style=font-weight:700>Conflicts</span> ─────────────────────────────── tidymodels_conflicts() ──</span></span>
<span><span class=c>#&gt; <span style=color:#b00>✖</span> <span style=color:#00b>purrr</span>::<span style=color:#0b0>discard()</span> masks <span style=color:#00b>scales</span>::discard()</span></span>
<span><span class=c>#&gt; <span style=color:#b00>✖</span> <span style=color:#00b>dplyr</span>::<span style=color:#0b0>filter()</span>  masks <span style=color:#00b>stats</span>::filter()</span></span>
<span><span class=c>#&gt; <span style=color:#b00>✖</span> <span style=color:#00b>dplyr</span>::<span style=color:#0b0>lag()</span>     masks <span style=color:#00b>stats</span>::lag()</span></span>
<span><span class=c>#&gt; <span style=color:#b00>✖</span> <span style=color:#00b>recipes</span>::<span style=color:#0b0>step()</span>  masks <span style=color:#00b>stats</span>::step()</span></span>
<span><span class=c>#&gt; <span style=color:#00b>•</span> Use suppressPackageStartupMessages() to eliminate package startup messages</span></span>
<span></span></code></pre></div><p>Note that my installed versions include the current dev version of a few tidymodels packages. You can install those versions with:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf>pak</span><span class=nf>::</span><span class=nf><a href=https://pak.r-lib.org/reference/pak.html>pak</a></span><span class=o>(</span><span class=nf><a href=https://rdrr.io/r/base/paste.html>paste0</a></span><span class=o>(</span><span class=s>"tidymodels/"</span>, <span class=nf><a href=https://rdrr.io/r/base/c.html>c</a></span><span class=o>(</span><span class=s>"tune"</span>, <span class=s>"parsnip"</span>, <span class=s>"recipes"</span><span class=o>)</span><span class=o>)</span><span class=o>)</span></span></code></pre></div><h2 id=the-outcome-went-missing->The outcome went missing 👻
<a href=#the-outcome-went-missing-><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>The tidymodels packages focus on <em>supervised</em> machine learning problems, predicting the value of an outcome using predictors.<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> For example, in the code:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>linear_spec</span> <span class=o>&lt;-</span> <span class=nf>linear_reg</span><span class=o>(</span><span class=o>)</span></span>
<span></span>
<span><span class=nv>linear_fit</span> <span class=o>&lt;-</span> <span class=nf>fit</span><span class=o>(</span><span class=nv>linear_spec</span>, <span class=nv>mpg</span> <span class=o>~</span> <span class=nv>hp</span>, <span class=nv>mtcars</span><span class=o>)</span></span></code></pre></div><p>The <code>mpg</code> variable is the outcome. There are many ways that an analyst may mistakenly fail to pass an outcome. In the most straightforward case, they might omit the outcome on the LHS of the formula:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>fit</span><span class=p>(</span><span class=n>linear_spec</span><span class=p>,</span> <span class=o>~</span> <span class=n>hp</span><span class=p>,</span> <span class=n>mtcars</span><span class=p>)</span>
<span class=c1>#&gt; Error in lm.fit(x, y, offset = offset, singular.ok = singular.ok, ...) : </span>
<span class=c1>#&gt;   incompatible dimensions</span>
</code></pre></div><p>In this case, parsnip used to defer to the modeling engine to raise an error, which may or may not be informative.</p><p>There are many less obvious ways an analyst may mistakenly supply no outcome variable. For example, try spotting the issue in the following code, defining a recipe to perform principal component analysis (PCA) on the numeric variables in the data before fitting the model:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=n>mtcars_rec</span> <span class=o>&lt;-</span>
  <span class=nf>recipe</span><span class=p>(</span><span class=n>mpg</span> <span class=o>~</span> <span class=n>.,</span> <span class=n>mtcars</span><span class=p>)</span> <span class=o>%&gt;%</span>
  <span class=nf>step_pca</span><span class=p>(</span><span class=nf>all_numeric</span><span class=p>())</span>

<span class=nf>workflow</span><span class=p>(</span><span class=n>mtcars_rec</span><span class=p>,</span> <span class=n>linear_spec</span><span class=p>)</span> <span class=o>%&gt;%</span> <span class=nf>fit</span><span class=p>(</span><span class=n>mtcars</span><span class=p>)</span>
<span class=c1>#&gt; Error: object &#39;.&#39; not found</span>
</code></pre></div><p>A head-scratcher! To help diagnose what&rsquo;s happening here, we could first try seeing what data is actually being passed to the model.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>mtcars_rec_trained</span> <span class=o>&lt;-</span></span>
<span>  <span class=nv>mtcars_rec</span> <span class=o>%&gt;%</span> </span>
<span>  <span class=nf>prep</span><span class=o>(</span><span class=nv>mtcars</span><span class=o>)</span> </span>
<span></span>
<span><span class=nv>mtcars_rec_trained</span> <span class=o>%&gt;%</span> <span class=nf>bake</span><span class=o>(</span><span class=kc>NULL</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 32 × 5</span></span></span>
<span><span class=c>#&gt;      PC1   PC2    PC3     PC4    PC5</span></span>
<span><span class=c>#&gt;    <span style=color:#555;font-style:italic>&lt;dbl&gt;</span> <span style=color:#555;font-style:italic>&lt;dbl&gt;</span>  <span style=color:#555;font-style:italic>&lt;dbl&gt;</span>   <span style=color:#555;font-style:italic>&lt;dbl&gt;</span>  <span style=color:#555;font-style:italic>&lt;dbl&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555> 1</span> -<span style=color:#b00>195.</span>  12.8 -<span style=color:#b00>11.4</span>   0.016<span style=text-decoration:underline>4</span>  2.17 </span></span>
<span><span class=c>#&gt; <span style=color:#555> 2</span> -<span style=color:#b00>195.</span>  12.9 -<span style=color:#b00>11.7</span>  -<span style=color:#b00>0.479</span>   2.11 </span></span>
<span><span class=c>#&gt; <span style=color:#555> 3</span> -<span style=color:#b00>142.</span>  25.9 -<span style=color:#b00>16.0</span>  -<span style=color:#b00>1.34</span>   -<span style=color:#b00>1.18</span> </span></span>
<span><span class=c>#&gt; <span style=color:#555> 4</span> -<span style=color:#b00>279.</span> -<span style=color:#b00>38.3</span> -<span style=color:#b00>14.0</span>   0.157  -<span style=color:#b00>0.817</span></span></span>
<span><span class=c>#&gt; <span style=color:#555> 5</span> -<span style=color:#b00>399.</span> -<span style=color:#b00>37.3</span>  -<span style=color:#b00>1.38</span>  2.56   -<span style=color:#b00>0.444</span></span></span>
<span><span class=c>#&gt; <span style=color:#555> 6</span> -<span style=color:#b00>248.</span> -<span style=color:#b00>25.6</span> -<span style=color:#b00>12.2</span>  -<span style=color:#b00>3.01</span>   -<span style=color:#b00>1.08</span> </span></span>
<span><span class=c>#&gt; <span style=color:#555> 7</span> -<span style=color:#b00>435.</span>  20.9  13.9   0.801  -<span style=color:#b00>0.916</span></span></span>
<span><span class=c>#&gt; <span style=color:#555> 8</span> -<span style=color:#b00>160.</span> -<span style=color:#b00>20.0</span> -<span style=color:#b00>23.3</span>  -<span style=color:#b00>1.06</span>    0.787</span></span>
<span><span class=c>#&gt; <span style=color:#555> 9</span> -<span style=color:#b00>172.</span>  10.8 -<span style=color:#b00>18.3</span>  -<span style=color:#b00>4.40</span>   -<span style=color:#b00>0.836</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>10</span> -<span style=color:#b00>209.</span>  19.7  -<span style=color:#b00>8.94</span> -<span style=color:#b00>2.58</span>    1.33 </span></span>
<span><span class=c>#&gt; <span style=color:#555># ℹ 22 more rows</span></span></span>
<span></span></code></pre></div><p>Mmm. What happened to <code>mpg</code>? We mistakenly told <code>step_pca()</code> to perform PCA on <em>all</em> of the numeric variables, not just the numeric <em>predictors</em>! As a result, it incorporated <code>mpg</code> into the principal components, removing each of the original numeric variables after the fact. Rewriting using the correct tidyselect specification <code>all_numeric_predictors()</code>:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>mtcars_rec_new</span> <span class=o>&lt;-</span> </span>
<span>  <span class=nf>recipe</span><span class=o>(</span><span class=nv>mpg</span> <span class=o>~</span> <span class=nv>.</span>, <span class=nv>mtcars</span><span class=o>)</span> <span class=o>%&gt;%</span></span>
<span>  <span class=nf>step_pca</span><span class=o>(</span><span class=nf>all_numeric_predictors</span><span class=o>(</span><span class=o>)</span><span class=o>)</span></span>
<span></span>
<span><span class=nf>workflow</span><span class=o>(</span><span class=nv>mtcars_rec_new</span>, <span class=nv>linear_spec</span><span class=o>)</span> <span class=o>%&gt;%</span> <span class=nf>fit</span><span class=o>(</span><span class=nv>mtcars</span><span class=o>)</span></span>
<span><span class=c>#&gt; ══ Workflow [trained] ════════════════════════════════════════════════</span></span>
<span><span class=c>#&gt; <span style=font-style:italic>Preprocessor:</span> Recipe</span></span>
<span><span class=c>#&gt; <span style=font-style:italic>Model:</span> linear_reg()</span></span>
<span><span class=c>#&gt; </span></span>
<span><span class=c>#&gt; ── Preprocessor ──────────────────────────────────────────────────────</span></span>
<span><span class=c>#&gt; 1 Recipe Step</span></span>
<span><span class=c>#&gt; </span></span>
<span><span class=c>#&gt; • step_pca()</span></span>
<span><span class=c>#&gt; </span></span>
<span><span class=c>#&gt; ── Model ─────────────────────────────────────────────────────────────</span></span>
<span><span class=c>#&gt; </span></span>
<span><span class=c>#&gt; Call:</span></span>
<span><span class=c>#&gt; stats::lm(formula = ..y ~ ., data = data)</span></span>
<span><span class=c>#&gt; </span></span>
<span><span class=c>#&gt; Coefficients:</span></span>
<span><span class=c>#&gt; (Intercept)          PC1          PC2          PC3          PC4  </span></span>
<span><span class=c>#&gt;    43.39293      0.07609     -0.05266      0.57892      0.94890  </span></span>
<span><span class=c>#&gt;         PC5  </span></span>
<span><span class=c>#&gt;    -1.72569</span></span>
<span></span></code></pre></div><p>Works like a charm. That error we saw previously could be much more helpful, though. With the current developmental version of parsnip, this looks like:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf>fit</span><span class=o>(</span><span class=nv>linear_spec</span>, <span class=o>~</span> <span class=nv>hp</span>, <span class=nv>mtcars</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#bb0;font-weight:700>Error</span><span style=font-weight:700>:</span></span></span>
<span><span class=c>#&gt; <span style=color:#bb0>!</span> `linear_reg()` was unable to find an outcome.</span></span>
<span><span class=c>#&gt; <span style=color:#0bb>ℹ</span> Ensure that you have specified an outcome column and that it hasn't</span></span>
<span><span class=c>#&gt;   been removed in pre-processing.</span></span>
<span></span></code></pre></div><p>Or, with workflows:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf>workflow</span><span class=o>(</span><span class=nv>mtcars_rec</span>, <span class=nv>linear_spec</span><span class=o>)</span> <span class=o>%&gt;%</span> <span class=nf>fit</span><span class=o>(</span><span class=nv>mtcars</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#bb0;font-weight:700>Error</span><span style=font-weight:700>:</span></span></span>
<span><span class=c>#&gt; <span style=color:#bb0>!</span> `linear_reg()` was unable to find an outcome.</span></span>
<span><span class=c>#&gt; <span style=color:#0bb>ℹ</span> Ensure that you have specified an outcome column and that it hasn't</span></span>
<span><span class=c>#&gt;   been removed in pre-processing.</span></span>
<span></span></code></pre></div><p>Much better.</p><h2 id=predicting-with-things-that-cant-predict>Predicting with things that can&rsquo;t predict
<a href=#predicting-with-things-that-cant-predict><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>Earlier this year, Dr. Louise E. Sinks put out a
<a href=https://lsinks.github.io/posts/2023-04-10-tidymodels/tidymodels_tutorial.html target=_blank rel=noopener>wonderful blog post</a> documenting what it felt like to approach the various object types defined in the tidymodels as a newcomer to the collection of packages. They wrote:</p><blockquote><p>I found it confusing that <code>fit</code>, <code>last_fit</code>, <code>fit_resamples</code>, etc., did not all produce objects that contained the same information and could be acted on by the same functions.</p></blockquote><p>This makes sense. While we try to forefront the intended mental model for fitting and predicting with tidymodels in our APIs and documentation, we also need to be proactive in anticipating common challenges in constructing that mental model.</p><p>For example, we&rsquo;ve found that it&rsquo;s sometimes not clear to users which outputs they can call
<a href=https://rdrr.io/r/stats/predict.html target=_blank rel=noopener><code>predict()</code></a> on. One such situation, as Louise points out, is with <code>fit_resamples()</code>:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=c># fit a linear regression model to bootstrap resamples of mtcars</span></span>
<span><span class=nv>mtcars_res</span> <span class=o>&lt;-</span> <span class=nf>fit_resamples</span><span class=o>(</span><span class=nf>linear_reg</span><span class=o>(</span><span class=o>)</span>, <span class=nv>mpg</span> <span class=o>~</span> <span class=nv>.</span>, <span class=nf>bootstraps</span><span class=o>(</span><span class=nv>mtcars</span><span class=o>)</span><span class=o>)</span></span>
<span></span>
<span><span class=nv>mtcars_res</span></span>
<span><span class=c>#&gt; # Resampling results</span></span>
<span><span class=c>#&gt; # Bootstrap sampling </span></span>
<span><span class=c>#&gt; <span style=color:#555># A tibble: 25 × 4</span></span></span>
<span><span class=c>#&gt;    splits          id          .metrics         .notes          </span></span>
<span><span class=c>#&gt;    <span style=color:#555;font-style:italic>&lt;list&gt;</span>          <span style=color:#555;font-style:italic>&lt;chr&gt;</span>       <span style=color:#555;font-style:italic>&lt;list&gt;</span>           <span style=color:#555;font-style:italic>&lt;list&gt;</span>          </span></span>
<span><span class=c>#&gt; <span style=color:#555> 1</span> <span style=color:#555>&lt;split [32/11]&gt;</span> Bootstrap01 <span style=color:#555>&lt;tibble [2 × 4]&gt;</span> <span style=color:#555>&lt;tibble [0 × 3]&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555> 2</span> <span style=color:#555>&lt;split [32/10]&gt;</span> Bootstrap02 <span style=color:#555>&lt;tibble [2 × 4]&gt;</span> <span style=color:#555>&lt;tibble [0 × 3]&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555> 3</span> <span style=color:#555>&lt;split [32/16]&gt;</span> Bootstrap03 <span style=color:#555>&lt;tibble [2 × 4]&gt;</span> <span style=color:#555>&lt;tibble [0 × 3]&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555> 4</span> <span style=color:#555>&lt;split [32/11]&gt;</span> Bootstrap04 <span style=color:#555>&lt;tibble [2 × 4]&gt;</span> <span style=color:#555>&lt;tibble [0 × 3]&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555> 5</span> <span style=color:#555>&lt;split [32/10]&gt;</span> Bootstrap05 <span style=color:#555>&lt;tibble [2 × 4]&gt;</span> <span style=color:#555>&lt;tibble [0 × 3]&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555> 6</span> <span style=color:#555>&lt;split [32/13]&gt;</span> Bootstrap06 <span style=color:#555>&lt;tibble [2 × 4]&gt;</span> <span style=color:#555>&lt;tibble [0 × 3]&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555> 7</span> <span style=color:#555>&lt;split [32/16]&gt;</span> Bootstrap07 <span style=color:#555>&lt;tibble [2 × 4]&gt;</span> <span style=color:#555>&lt;tibble [0 × 3]&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555> 8</span> <span style=color:#555>&lt;split [32/11]&gt;</span> Bootstrap08 <span style=color:#555>&lt;tibble [2 × 4]&gt;</span> <span style=color:#555>&lt;tibble [0 × 3]&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555> 9</span> <span style=color:#555>&lt;split [32/11]&gt;</span> Bootstrap09 <span style=color:#555>&lt;tibble [2 × 4]&gt;</span> <span style=color:#555>&lt;tibble [0 × 3]&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555>10</span> <span style=color:#555>&lt;split [32/10]&gt;</span> Bootstrap10 <span style=color:#555>&lt;tibble [2 × 4]&gt;</span> <span style=color:#555>&lt;tibble [0 × 3]&gt;</span></span></span>
<span><span class=c>#&gt; <span style=color:#555># ℹ 15 more rows</span></span></span>
<span></span></code></pre></div><p>With previous tidymodels versions, mistakenly trying to predict with this object resulted in the following output:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>predict</span><span class=p>(</span><span class=n>mtcars_res</span><span class=p>)</span>
<span class=c1>#&gt; Error in UseMethod(&#34;predict&#34;) : </span>
<span class=c1>#&gt;   no applicable method for &#39;predict&#39; applied to an object of class</span>
<span class=c1>#&gt;   &#34;c(&#39;resample_results&#39;, &#39;tune_results&#39;, &#39;tbl_df&#39;, &#39;tbl&#39;, &#39;data.frame&#39;)&#34;</span>
</code></pre></div><p>Some R developers may recognize this error as what results when we didn&rsquo;t define any
<a href=https://rdrr.io/r/stats/predict.html target=_blank rel=noopener><code>predict()</code></a> method for <code>tune_results</code> objects. We didn&rsquo;t do so because prediction isn&rsquo;t well-defined for tuning results. <em>But</em>, this error message does little to help a user understand why that&rsquo;s the case.</p><p>We&rsquo;ve recently made some changes to error more informatively in this case. We do so by defining a &ldquo;dummy&rdquo;
<a href=https://rdrr.io/r/stats/predict.html target=_blank rel=noopener><code>predict()</code></a> method for tuning results, implemented only for the sake of erroring more informatively. The same code will now give the following output:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>predict</span><span class=p>(</span><span class=n>mtcars_res</span><span class=p>)</span>
<span class=c1>#&gt; Error in `predict()`:</span>
<span class=c1>#&gt; ! `predict()` is not well-defined for tuning results.</span>
<span class=c1>#&gt; ℹ To predict with the optimal model configuration from tuning</span>
<span class=c1>#&gt;   results, ensure that the tuning result was generated with the</span>
<span class=c1>#&gt;   control option `save_workflow = TRUE`, run `fit_best()`, and</span>
<span class=c1>#&gt;   then predict using `predict()` on its output.</span>
<span class=c1>#&gt; ℹ To collect predictions from tuning results, ensure that the</span>
<span class=c1>#&gt;   tuning result was generated with the control option `save_pred</span>
<span class=c1>#&gt;   = TRUE` and run `collect_predictions()`.</span>
</code></pre></div><p>References to important concepts or functions, like
<a href=https://tune.tidymodels.org/reference/control_grid.html target=_blank rel=noopener>control options</a>,
<a href="https://tune.tidymodels.org/reference/fit_best.html?q=fit_best" target=_blank rel=noopener><code>fit_best()</code></a>, and
<a href="https://tune.tidymodels.org/reference/collect_predictions.html?q=collect" target=_blank rel=noopener><code>collect_predictions()</code></a>, link to the help-files for those functions using
<a href=https://cli.r-lib.org/reference/cli_abort.html target=_blank rel=noopener>cli&rsquo;s erroring tools</a>.</p><p>We hope new error messages like this will help to get folks back on track.</p><h2 id=model-formulas>Model formulas
<a href=#model-formulas><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="currentcolor"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h2><p>In R, formulas provide a compact, symbolic notation to specify model terms. Many modeling functions in R make use of &ldquo;specials,&rdquo; or nonstandard notations used in formulas. Specials are defined and handled as a special case by a given modeling package. parsnip defers to engine packages to handle specials, so you can work with them as usual. For example, the mgcv package provides support for generalized additive models in R, and defines a special called <code>s()</code> to indicate smoothing terms. You can interface with it via tidymodels like so:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=c># define a generalized additive model specification</span></span>
<span><span class=nv>gam_spec</span> <span class=o>&lt;-</span> <span class=nf>gen_additive_mod</span><span class=o>(</span><span class=s>"regression"</span><span class=o>)</span></span>
<span></span>
<span><span class=c># fit the specification using a formula with specials</span></span>
<span><span class=nf>fit</span><span class=o>(</span><span class=nv>gam_spec</span>, <span class=nv>mpg</span> <span class=o>~</span> <span class=nv>cyl</span> <span class=o>+</span> <span class=nf>s</span><span class=o>(</span><span class=nv>disp</span>, k <span class=o>=</span> <span class=m>5</span><span class=o>)</span>, <span class=nv>mtcars</span><span class=o>)</span></span>
<span><span class=c>#&gt; parsnip model object</span></span>
<span><span class=c>#&gt; </span></span>
<span><span class=c>#&gt; </span></span>
<span><span class=c>#&gt; Family: gaussian </span></span>
<span><span class=c>#&gt; Link function: identity </span></span>
<span><span class=c>#&gt; </span></span>
<span><span class=c>#&gt; Formula:</span></span>
<span><span class=c>#&gt; mpg ~ cyl + s(disp, k = 5)</span></span>
<span><span class=c>#&gt; </span></span>
<span><span class=c>#&gt; Estimated degrees of freedom:</span></span>
<span><span class=c>#&gt; 3.39  total = 5.39 </span></span>
<span><span class=c>#&gt; </span></span>
<span><span class=c>#&gt; GCV score: 6.380152</span></span>
<span></span></code></pre></div><p>While parsnip can handle specials just fine, the package is often used in conjunction with the greater tidymodels package ecosystem, which defines its own pre-processing infrastructure and functionality via packages like hardhat and recipes. The specials defined in many modeling packages introduce conflicts with that infrastructure. To support specials while also maintaining consistent syntax elsewhere in the ecosystem, <strong>tidymodels delineates between two types of formulas: preprocessing formulas and model formulas</strong>. Preprocessing formulas determine the input variables, while model formulas determine the model structure.</p><p>This is a tricky abstraction, and one that users have tripped up on in the past. Users could generate all sorts of different errors by 1) mistakenly passing model formulas where preprocessing formulas were expected, or 2) forgetting to pass a model formula where it&rsquo;s needed. For an example of 1), we could pass recipes the same formula we passed to parsnip:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>recipe</span><span class=p>(</span><span class=n>mpg</span> <span class=o>~</span> <span class=n>cyl</span> <span class=o>+</span> <span class=nf>s</span><span class=p>(</span><span class=n>disp</span><span class=p>,</span> <span class=n>k</span> <span class=o>=</span> <span class=m>5</span><span class=p>),</span> <span class=n>mtcars</span><span class=p>)</span>
<span class=c1>#&gt; Error in `inline_check()`:</span>
<span class=c1>#&gt; ! No in-line functions should be used here; use steps to </span>
<span class=c1>#&gt;   define baking actions.</span>
</code></pre></div><p>But we <em>just</em> used a special with another tidymodels function! Rude!</p><p>Or, to demonstrate 2), we pass the preprocessing formula as we ought to but forget to provide the model formula:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=n>gam_wflow</span> <span class=o>&lt;-</span> 
  <span class=nf>workflow</span><span class=p>()</span> <span class=o>%&gt;%</span>
  <span class=nf>add_formula</span><span class=p>(</span><span class=n>mpg</span> <span class=o>~</span> <span class=n>.)</span> <span class=o>%&gt;%</span>
  <span class=nf>add_model</span><span class=p>(</span><span class=n>gam_spec</span><span class=p>)</span> 

<span class=n>gam_wflow</span> <span class=o>%&gt;%</span> <span class=nf>fit</span><span class=p>(</span><span class=n>mtcars</span><span class=p>)</span>
<span class=c1>#&gt; Error in `fit_xy()`:</span>
<span class=c1>#&gt; ! `fit()` must be used with GAM models (due to its use of formulas).</span>
</code></pre></div><p>Uh, but I <em>did</em> just use <code>fit()</code>!</p><p>Since the distinction between model formulas and preprocessor formulas comes up in functions across tidymodels, we decide to create a
<a href=https://parsnip.tidymodels.org/dev/reference/model_formula.html target=_blank rel=noopener>central page</a> that documents the concept itself, hopefully making the syntax associated with it come more easily to users. Then, we link to it <em>all over the place</em>. For example, those errors now look like:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nf>recipe</span><span class=o>(</span><span class=nv>mpg</span> <span class=o>~</span> <span class=nv>cyl</span> <span class=o>+</span> <span class=nf>s</span><span class=o>(</span><span class=nv>disp</span>, k <span class=o>=</span> <span class=m>5</span><span class=o>)</span>, <span class=nv>mtcars</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#bb0;font-weight:700>Error</span><span style=font-weight:700> in `inline_check()`:</span></span></span>
<span><span class=c>#&gt; <span style=color:#b00>✖</span> No in-line functions should be used here.</span></span>
<span><span class=c>#&gt; <span style=color:#0bb>ℹ</span> The following function was found: `s`.</span></span>
<span><span class=c>#&gt; <span style=color:#0bb>ℹ</span> Use steps to do transformations instead.</span></span>
<span><span class=c>#&gt; <span style=color:#0bb>ℹ</span> If your modeling engine uses special terms in formulas, pass that</span></span>
<span><span class=c>#&gt;   formula to workflows as a model formula</span></span>
<span><span class=c>#&gt;   (`?parsnip::model_formula()`).</span></span>
<span></span></code></pre></div><p>Or:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span><span class=nv>gam_wflow</span> <span class=o>%&gt;%</span> <span class=nf>fit</span><span class=o>(</span><span class=nv>mtcars</span><span class=o>)</span></span>
<span><span class=c>#&gt; <span style=color:#bb0;font-weight:700>Error</span><span style=font-weight:700>:</span></span></span>
<span><span class=c>#&gt; <span style=color:#bb0>!</span> When working with generalized additive models, please supply</span></span>
<span><span class=c>#&gt;   the model specification to `workflows::add_model()` along with a</span></span>
<span><span class=c>#&gt;   `formula` argument.</span></span>
<span><span class=c>#&gt; <span style=color:#0bb>ℹ</span> See `?parsnip::model_formula()` to learn more.</span></span>
<span></span></code></pre></div><p>While I&rsquo;ve only outlined three, there are all sorts of improvements to error messages on their way to the tidymodels packages in upcoming releases. If you happen to stumble across them, we hope they quickly set you back on the right path. 🗺</p><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>Issue triage consists of categorizing, prioritizing, and consolidating issues in a repository&rsquo;s issue tracker. <a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p>See the
<a href=https://tidyclust.tidymodels.org target=_blank rel=noopener>tidyclust</a> package for unsupervised learning with tidymodels! <a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></div></div><div class=column25><div class="section hideOnMobile"><div class=sectionTitle>Contents</div><nav id=TableOfContents><ul><li><a href=#the-outcome-went-missing->The outcome went missing 👻</a></li><li><a href=#predicting-with-things-that-cant-predict>Predicting with things that can&rsquo;t predict</a></li><li><a href=#model-formulas>Model formulas</a></li></ul></nav></div><div class=section></div></div></div></div></div><div id=rStudioFooter class=band><div class=bandContent><div id=copyright>The tidyverse is proudly supported by <a class=rstudioLogo href=https://posit.co/ aria-label="Posit Homepage"></a></div><div id=logos><a href=https://www.tidyverse.org/google_privacy_policy>Privacy policy</a>
<a href=https://github.com/tidyverse class="footerLogo gitHub" aria-label="Tidyverse GitHub organization"></a><a href=https://twitter.com/hashtag/rstats class="footerLogo twitter" aria-label="rstats hashtag on twitter.com"></a></div></div></div></div></div><script type=application/javascript>var dnt=(navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack);var doNotTrack=(dnt=="1"||dnt=="yes");if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');if(window.sessionStorage){var GA_SESSION_STORAGE_KEY='ga:clientId';ga('create','UA-115082821-1',{'storage':'none','clientId':sessionStorage.getItem(GA_SESSION_STORAGE_KEY)});ga(function(tracker){sessionStorage.setItem(GA_SESSION_STORAGE_KEY,tracker.get('clientId'));});}
ga('set','anonymizeIp',true);ga('send','pageview');}</script></body></html></div></div></body></html>