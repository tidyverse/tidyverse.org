<!doctype html><html><head><!doctype html><html lang=en-us><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/css/main-site.css><link rel=stylesheet href=/css/fa5-all.css><style type=text/css>body{background-color:#fff;color:#1a1917}a{color:#38577f}a:hover{color:#42709b}a:focus{outline-color:#42709b}.column25-left .sectionTitle a:hover:not(.current),.column16-left .sectionTitle a:hover:not(.current){color:#1a1917}.icon-attribution,.icon-attribution a{color:#1a1917;opacity:75%}#homeContent .band.first{background-color:#fff}#homeContent .band.second{background-color:#fdeba4}#homeContent .band.third{background-color:#fff}#rStudioHeader{background-color:#1a162d;color:#fff}#rStudioHeader .productName{color:#fff}#rStudioHeader .productName:hover,#rStudioHeader .productName:focus{color:#fdeba4}#rStudioHeader #menu .menuItem.a{background-color:#75aadb;color:#fff}#rStudioHeader #menu .menuItem:hover{background-color:#484557;color:#fff}#rStudioHeader #menu .menuItem.current{background-color:#fff;color:#1a162d;text-decoration:none}#rStudioFooter.band{background-color:#767381}#rStudioFooter .bandContent #copyright{color:#e3eef8}table tbody tr:nth-child(even){background-color:#f7faff}table tbody tr:nth-child(odd){background-color:#fff}.latest{border-top:.5em solid <no value>}.event{-moz-box-shadow:0 0 0 0 rgba(0,0,0,.1);-webkit-box-shadow:0 0 0 0 rgba(0,0,0,.1);box-shadow:0 0 0 0 rgba(0,0,0,.1)}.section .event{background-color:#eab0c41a}.section .event{border-top:7pt solid #a19ea936}.section .event a{color:#1a162d}.section .event{color:#404040}</style><link rel=stylesheet href=/css/tidyverse.css><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.71.1"><title>lubridate 1.7.0</title><meta property="og:title" content="lubridate 1.7.0"><meta property="og:description" content="A new version of lubridate is on CRAN!"><meta property="og:type" content="article"><meta property="og:url" content="https://www.tidyverse.org/blog/2017/11/lubridate-1.7.0/"><meta property="twitter:card" content="summary_large_image"><meta property="og:title" content="lubridate 1.7.0 - Tidyverse"><meta property="description" content="A new version of lubridate is on CRAN!"><meta property="og:description" content="A new version of lubridate is on CRAN!"><meta property="og:image" content="https://www.tidyverse.org/blog/2017/11/lubridate-1.7.0/lubridate-1.7.0-sq.jpg"><meta name=twitter:image content="https://www.tidyverse.org/blog/2017/11/lubridate-1.7.0/lubridate-1.7.0-wd.jpg"><link rel=apple-touch-icon sizes=180x180 href=/images/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicons/favicon-16x16.png><link rel=manifest href=/images/favicons/site.webmanifest><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg><link rel="shortcut icon" href=/images/favicons/favicon.ico><meta name=msapplication-TileColor content="#da532c"><meta name=msapplication-config href=/images/favicons/browserconfig.xml><script type=text/javascript src=/js/jquery-3.5.1.min.js></script><script type=text/javascript src=/js/site.js></script><link rel=icon href=/images/favicon.ico><script type=text/javascript src=/js/clipboard.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin=anonymous></script><script defer data-domain=tidyverse.org,all.tidyverse.org src=https://plausible.io/js/plausible.js></script></head><body><div id=appTidyverseSite class="shrinkHeader alwaysShrinkHeader"><div id=main><div id=rStudioHeader><nav class=band><div class="innards bandContent"><div><a class=productName href=/>Tidyverse</a></div><div id=menu><div id=menuToggler></div><div id=menuItems><a class=menuItem href=/packages/>Packages</a>
<a class="menuItem current" href=/blog/>Blog</a>
<a class=menuItem href=/learn/>Learn</a>
<a class=menuItem href=/help/>Help</a>
<a class=menuItem href=/contribute/>Contribute</a></div></div></div></nav></div><main><div class="band padForHeader pushFooter"><div class=bandContent><div class="full splitColumns withMobileMargins"><div class=column75><h1 class=article-title>lubridate 1.7.0</h1><div class=article-header aria-hidden=true><div class=photo><img src=/blog/2017/11/lubridate-1.7.0/lubridate-1.7.0-wd.jpg></div><div class=photoCredit>Photo by <a href=https://unsplash.com/photos/yBzrPGLjMQw>Heather Zabriskie</a></div></div><span class=article-date><i class="fas fa-calendar-day fa-fw"></i>&nbsp;&nbsp;2017/11/01</span><p style=margin-bottom:.5em;margin-top:.85em><i class="fas fa-tags"></i>&nbsp;
<a href=/tags/tidyverse/>tidyverse</a>,
<a href=/tags/lubridate/>lubridate</a></p><p style=margin-top:.5em><i class="fas fa-user-circle fa-fw"></i>&nbsp;
Vitalie Spinu</p><div class=article-content><p>We are pleased to announce that <a href=https://cran.r-project.org/web/packages/lubridate/index.html>lubridate 1.7.0</a> is now on CRAN! For a complete set of changes please see the release <a href=https://github.com/tidyverse/lubridate/releases/tag/v1.7.0>NEWS</a>.</p><p>Lubridate is a package that makes working with date-time and time-span objects easier. It provides fast and user friendly parsing of date-time strings, extraction and updating of components of a date-time objects (years, months, days etc.) and algebraic manipulation on date-time and time-span objects.</p><p>Here is a brief walk-through of the prominent new features in 1.7.0.</p><div id=built-in-cctz-and-much-faster-update-and-force_tz class="section level2"><h2>Built-in CCTZ and much faster <code>update</code> and <code>force_tz</code></h2><p>From this version lubridate relies on google’s <a href=https://github.com/google/cctz>CCTZ</a> library for the date-time updates and time-zone manipulation. This means that <code>force_tz</code>, <code>update</code>, <code>round</code>ing and a range of arithmetic operations on timespans are now considerably faster.</p></div><div id=vectorized-time-zone-manipulation class="section level2"><h2>Vectorized time-zone manipulation</h2><p>Often date-time data comes with heterogeneous time-zones. For example, you might have a character vector of date-times and a separate vector of time-zones. In such cases you can parse your date-time vector in one time zone (<code>UTC</code>) and then “enforce” the heterogeneous time-zones with <code>force_tzs</code>.</p><pre class=r><code>x &lt;- ymd_hms(c(&quot;2009-08-01 00:00:00&quot;, &quot;2009-08-01 00:00:00&quot;))
tzs &lt;- c(&quot;America/New_York&quot;, &quot;Europe/Amsterdam&quot;)

force_tzs(x, tzones = tzs)
##=&gt; [1] &quot;2009-08-01 04:00:00 UTC&quot; &quot;2009-07-31 22:00:00 UTC&quot;

force_tzs(x, tzones = tzs, tzone_out = &quot;America/New_York&quot;)
##=&gt; [1] &quot;2009-08-01 00:00:00 EDT&quot; &quot;2009-07-31 18:00:00 EDT&quot;</code></pre><p>Note that first <code>force_tzs</code> call produced a vector of instants in UTC time-zone, for the second call we specified the desired time-zone of the output vector with the <code>tzone_out</code> argument. This is needed as R’s date-time vectors cannot represent heterogeneous time-zones. For the same reason, the counterpart of <code>with_tz</code>, <code>with_tzs</code>, does not exist. Instead, <code>local_time</code> should cover the <code>with_tzs</code> use case in most situations.</p><p>New <code>local_time</code> function retrieves day clock time of the input vector in the specified time zones. It returns a <code>difftime</code> object and it is vectorized over both date-time and time-zone arguments:</p><pre class=r><code>x &lt;- ymd_hms(c(&quot;2009-08-01 01:02:03&quot;, &quot;2009-08-01 10:20:30&quot;))
local_time(x, units = &quot;hours&quot;)
##=&gt; Time differences in hours
##=&gt; [1]  1.034167 10.341667

x &lt;- ymd_hms(c(&quot;2009-08-01 00:00:00&quot;, &quot;2009-08-01 00:00:00&quot;))
tzs &lt;- c(&quot;America/New_York&quot;, &quot;Europe/Amsterdam&quot;)
local_time(x, tzs, units = &quot;hours&quot;)
##=&gt; Time differences in hours
##=&gt; [1] 20  2</code></pre></div><div id=new-cutoff_2000-parameter-in-parsing-functions class="section level2"><h2>New <code>cutoff_2000</code> parameter in parsing functions</h2><p>Lower level lubridate parser functions (<code>parse_datetime2</code>,<code>fast_strptime</code>) now accept <code>cutoff_2000</code> parameter to determine when the parsing of <code>yy</code> format should output 19th or 20th century.</p><pre class=r><code>x &lt;- c(&quot;50-01-01&quot;, &quot;70-01-01&quot;)
parse_date_time2(x, &quot;ymd&quot;)
##=&gt; [1] &quot;2050-01-01 UTC&quot; &quot;1970-01-01 UTC&quot;
parse_date_time2(x, &quot;ymd&quot;, cutoff_2000 = 30)
##=&gt; [1] &quot;1950-01-01 UTC&quot; &quot;1970-01-01 UTC&quot;</code></pre><p>By default <code>cutoff_2000</code> is 68 to comply with R’s <code>strptime</code> function.</p><p>This feature was not propagated to higher level parsing function because base <code>strptime</code>, on which those occasionally rely, doesn’t support this option.</p></div><div id=functions-wday-and-month-are-now-localized class="section level2"><h2>Functions <code>wday</code> and <code>month</code> are now localized</h2><p>When <code>label=TRUE</code> <code>wday</code> and <code>month</code> extractors return localized strings:</p><pre class=r><code>Sys.setlocale(locale = &quot;zh_CN.utf8&quot;)
##=&gt; [1] &quot;LC_CTYPE=zh_CN.utf8;LC_NUMERIC=C;LC_TIME=zh_CN.utf8;LC_COLLATE=zh_CN.utf8;LC_MONETARY=zh_CN.utf8;LC_MESSAGES=C;LC_PAPER=en_GB.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_GB.UTF-8;LC_IDENTIFICATION=C&quot;
wday(now(), label = TRUE)
##=&gt; [1] 三
##=&gt; Levels: 日 &lt; 一 &lt; 二 &lt; 三 &lt; 四 &lt; 五 &lt; 六
month(now(), label = TRUE)
##=&gt; [1] 11月
##=&gt; 12 Levels: 1月 &lt; 2月 &lt; 3月 &lt; 4月 &lt; 5月 &lt; 6月 &lt; 7月 &lt; 8月 &lt; ... &lt; 12月</code></pre><p>Please note that for this reason using labels for comparison is not recommended. You should use numeric output instead. Otherwise your code might not work on other computers.</p></div><div id=several-functions-gained-the-week_start-parameter class="section level2"><h2>Several functions gained the <code>week_start</code> parameter</h2><p>Functions for which depend on the week-start conventions (<code>wday</code>, <code>wday&lt;-</code>, <code>floor_date</code>, <code>ceiling_date</code> and <code>round_date</code>) now accept <code>week_start</code> argument which defaults to <code>getOption("lubridate.week.start", 7)</code>.</p><pre class=r><code>x &lt;- today()
wday(x, label = TRUE, abbr = FALSE)
##=&gt; [1] 星期三
##=&gt; 7 Levels: 星期日 &lt; 星期一 &lt; 星期二 &lt; 星期三 &lt; 星期四 &lt; ... &lt; 星期六
wday(x)
##=&gt; [1] 4
wday(x,  week_start = 2)
##=&gt; [1] 2</code></pre></div><div id=rounding-to-fraction-of-a-second class="section level2"><h2>Rounding to fraction of a second</h2><p>R’s date-time format (POSIXct) is accurate up to microseconds, thus it makes sense to round to fractions of a second. Unfortunately R currently prints fractional seconds incorrectly which can lead to confusion:</p><pre class=r><code>## print fractional seconds
options(digits.secs=6, digits = 13)

x &lt;- ymd_hms(&quot;2009-08-03 12:01:59.031&quot;)
rx &lt;- round_date(x, &quot;.01sec&quot;)
cx &lt;- ceiling_date(x, &quot;.01sec&quot;)

c(rx, cx)
##=&gt; [1] &quot;2009-08-03 14:01:59.02 CEST&quot; &quot;2009-08-03 14:01:59.03 CEST&quot;
as.double(c(rx, cx))
##=&gt; [1] 1249300919.03 1249300919.04</code></pre><p>So, fractional rounding and ceiling work, but don’t be taken aback by incorrect printing;)</p></div><div id=new-epiweek-and-epiyear-functions class="section level2"><h2>New <code>epiweek</code> and <code>epiyear</code> functions</h2><p>New functions <code>epiyear</code> and <code>epiweek</code> are the US CDC version of epidemiological weeks and years. They follow same rules as <code>isoweek</code> and <code>isoyear</code> but with the week starting on Sunday. In other parts of the world the convention is to start epidemiological weeks on Monday, which is then the same as for <code>isoweek</code> and <code>isoyear</code>.</p></div></div></div><div class=column25><div class="section hideOnMobile"></div><div class=section></div></div></div></div></div><div id=rStudioFooter class=band><div class=bandContent><div id=copyright>The tidyverse is proudly supported by <a class=rstudioLogo href=https://posit.co/ aria-label="Posit Homepage"></a></div><div id=logos><a href=https://www.tidyverse.org/google_privacy_policy>Privacy policy</a>
<a href=https://github.com/tidyverse class="footerLogo gitHub" aria-label="Tidyverse GitHub organization"></a><a href=https://twitter.com/hashtag/rstats class="footerLogo twitter" aria-label="rstats hashtag on twitter.com"></a></div></div></div></div></div><script type=application/javascript>var dnt=(navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack);var doNotTrack=(dnt=="1"||dnt=="yes");if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');if(window.sessionStorage){var GA_SESSION_STORAGE_KEY='ga:clientId';ga('create','UA-115082821-1',{'storage':'none','clientId':sessionStorage.getItem(GA_SESSION_STORAGE_KEY)});ga(function(tracker){sessionStorage.setItem(GA_SESSION_STORAGE_KEY,tracker.get('clientId'));});}
ga('set','anonymizeIp',true);ga('send','pageview');}</script></body></html></div></div></body></html>